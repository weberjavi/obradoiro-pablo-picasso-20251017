function sg(B,N){for(var V=0;V<N.length;V++){const U=N[V];if(typeof U!="string"&&!Array.isArray(U)){for(const J in U)if(J!=="default"&&!(J in B)){const oe=Object.getOwnPropertyDescriptor(U,J);oe&&Object.defineProperty(B,J,oe.get?oe:{enumerable:!0,get:()=>U[J]})}}}return Object.freeze(Object.defineProperty(B,Symbol.toStringTag,{value:"Module"}))}(function(){const N=document.createElement("link").relList;if(N&&N.supports&&N.supports("modulepreload"))return;for(const J of document.querySelectorAll('link[rel="modulepreload"]'))U(J);new MutationObserver(J=>{for(const oe of J)if(oe.type==="childList")for(const z of oe.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&U(z)}).observe(document,{childList:!0,subtree:!0});function V(J){const oe={};return J.integrity&&(oe.integrity=J.integrity),J.referrerPolicy&&(oe.referrerPolicy=J.referrerPolicy),J.crossOrigin==="use-credentials"?oe.credentials="include":J.crossOrigin==="anonymous"?oe.credentials="omit":oe.credentials="same-origin",oe}function U(J){if(J.ep)return;J.ep=!0;const oe=V(J);fetch(J.href,oe)}})();function og(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var Qp={exports:{}},jf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pm;function lg(){if(pm)return jf;pm=1;var B=Symbol.for("react.transitional.element"),N=Symbol.for("react.fragment");function V(U,J,oe){var z=null;if(oe!==void 0&&(z=""+oe),J.key!==void 0&&(z=""+J.key),"key"in J){oe={};for(var h in J)h!=="key"&&(oe[h]=J[h])}else oe=J;return J=oe.ref,{$$typeof:B,type:U,key:z,ref:J!==void 0?J:null,props:oe}}return jf.Fragment=N,jf.jsx=V,jf.jsxs=V,jf}var mm;function cg(){return mm||(mm=1,Qp.exports=lg()),Qp.exports}var zh=cg(),Jp={exports:{}},Wt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gm;function ug(){if(gm)return Wt;gm=1;var B=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),V=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),oe=Symbol.for("react.consumer"),z=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),_e=Symbol.for("react.memo"),We=Symbol.for("react.lazy"),ke=Symbol.for("react.activity"),Ne=Symbol.iterator;function Te(fe){return fe===null||typeof fe!="object"?null:(fe=Ne&&fe[Ne]||fe["@@iterator"],typeof fe=="function"?fe:null)}var ti={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},kt=Object.assign,Zi={};function Ii(fe,Ge,rt){this.props=fe,this.context=Ge,this.refs=Zi,this.updater=rt||ti}Ii.prototype.isReactComponent={},Ii.prototype.setState=function(fe,Ge){if(typeof fe!="object"&&typeof fe!="function"&&fe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,fe,Ge,"setState")},Ii.prototype.forceUpdate=function(fe){this.updater.enqueueForceUpdate(this,fe,"forceUpdate")};function di(){}di.prototype=Ii.prototype;function Mt(fe,Ge,rt){this.props=fe,this.context=Ge,this.refs=Zi,this.updater=rt||ti}var Jt=Mt.prototype=new di;Jt.constructor=Mt,kt(Jt,Ii.prototype),Jt.isPureReactComponent=!0;var vi=Array.isArray;function ei(){}var Dt={H:null,A:null,T:null,S:null},Pn=Object.prototype.hasOwnProperty;function Dn(fe,Ge,rt){var ut=rt.ref;return{$$typeof:B,type:fe,key:Ge,ref:ut!==void 0?ut:null,props:rt}}function In(fe,Ge){return Dn(fe.type,Ge,fe.props)}function xi(fe){return typeof fe=="object"&&fe!==null&&fe.$$typeof===B}function Gi(fe){var Ge={"=":"=0",":":"=2"};return"$"+fe.replace(/[=:]/g,function(rt){return Ge[rt]})}var da=/\/+/g;function wa(fe,Ge){return typeof fe=="object"&&fe!==null&&fe.key!=null?Gi(""+fe.key):Ge.toString(36)}function Rn(fe){switch(fe.status){case"fulfilled":return fe.value;case"rejected":throw fe.reason;default:switch(typeof fe.status=="string"?fe.then(ei,ei):(fe.status="pending",fe.then(function(Ge){fe.status==="pending"&&(fe.status="fulfilled",fe.value=Ge)},function(Ge){fe.status==="pending"&&(fe.status="rejected",fe.reason=Ge)})),fe.status){case"fulfilled":return fe.value;case"rejected":throw fe.reason}}throw fe}function Fe(fe,Ge,rt,ut,Et){var At=typeof fe;(At==="undefined"||At==="boolean")&&(fe=null);var Qt=!1;if(fe===null)Qt=!0;else switch(At){case"bigint":case"string":case"number":Qt=!0;break;case"object":switch(fe.$$typeof){case B:case N:Qt=!0;break;case We:return Qt=fe._init,Fe(Qt(fe._payload),Ge,rt,ut,Et)}}if(Qt)return Et=Et(fe),Qt=ut===""?"."+wa(fe,0):ut,vi(Et)?(rt="",Qt!=null&&(rt=Qt.replace(da,"$&/")+"/"),Fe(Et,Ge,rt,"",function(ir){return ir})):Et!=null&&(xi(Et)&&(Et=In(Et,rt+(Et.key==null||fe&&fe.key===Et.key?"":(""+Et.key).replace(da,"$&/")+"/")+Qt)),Ge.push(Et)),1;Qt=0;var Ci=ut===""?".":ut+":";if(vi(fe))for(var ui=0;ui<fe.length;ui++)ut=fe[ui],At=Ci+wa(ut,ui),Qt+=Fe(ut,Ge,rt,At,Et);else if(ui=Te(fe),typeof ui=="function")for(fe=ui.call(fe),ui=0;!(ut=fe.next()).done;)ut=ut.value,At=Ci+wa(ut,ui++),Qt+=Fe(ut,Ge,rt,At,Et);else if(At==="object"){if(typeof fe.then=="function")return Fe(Rn(fe),Ge,rt,ut,Et);throw Ge=String(fe),Error("Objects are not valid as a React child (found: "+(Ge==="[object Object]"?"object with keys {"+Object.keys(fe).join(", ")+"}":Ge)+"). If you meant to render a collection of children, use an array instead.")}return Qt}function st(fe,Ge,rt){if(fe==null)return fe;var ut=[],Et=0;return Fe(fe,ut,"","",function(At){return Ge.call(rt,At,Et++)}),ut}function Ct(fe){if(fe._status===-1){var Ge=fe._result;Ge=Ge(),Ge.then(function(rt){(fe._status===0||fe._status===-1)&&(fe._status=1,fe._result=rt)},function(rt){(fe._status===0||fe._status===-1)&&(fe._status=2,fe._result=rt)}),fe._status===-1&&(fe._status=0,fe._result=Ge)}if(fe._status===1)return fe._result.default;throw fe._result}var _t=typeof reportError=="function"?reportError:function(fe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ge=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof fe=="object"&&fe!==null&&typeof fe.message=="string"?String(fe.message):String(fe),error:fe});if(!window.dispatchEvent(Ge))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",fe);return}console.error(fe)},oi={map:st,forEach:function(fe,Ge,rt){st(fe,function(){Ge.apply(this,arguments)},rt)},count:function(fe){var Ge=0;return st(fe,function(){Ge++}),Ge},toArray:function(fe){return st(fe,function(Ge){return Ge})||[]},only:function(fe){if(!xi(fe))throw Error("React.Children.only expected to receive a single React element child.");return fe}};return Wt.Activity=ke,Wt.Children=oi,Wt.Component=Ii,Wt.Fragment=V,Wt.Profiler=J,Wt.PureComponent=Mt,Wt.StrictMode=U,Wt.Suspense=pe,Wt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Dt,Wt.__COMPILER_RUNTIME={__proto__:null,c:function(fe){return Dt.H.useMemoCache(fe)}},Wt.cache=function(fe){return function(){return fe.apply(null,arguments)}},Wt.cacheSignal=function(){return null},Wt.cloneElement=function(fe,Ge,rt){if(fe==null)throw Error("The argument must be a React element, but you passed "+fe+".");var ut=kt({},fe.props),Et=fe.key;if(Ge!=null)for(At in Ge.key!==void 0&&(Et=""+Ge.key),Ge)!Pn.call(Ge,At)||At==="key"||At==="__self"||At==="__source"||At==="ref"&&Ge.ref===void 0||(ut[At]=Ge[At]);var At=arguments.length-2;if(At===1)ut.children=rt;else if(1<At){for(var Qt=Array(At),Ci=0;Ci<At;Ci++)Qt[Ci]=arguments[Ci+2];ut.children=Qt}return Dn(fe.type,Et,ut)},Wt.createContext=function(fe){return fe={$$typeof:z,_currentValue:fe,_currentValue2:fe,_threadCount:0,Provider:null,Consumer:null},fe.Provider=fe,fe.Consumer={$$typeof:oe,_context:fe},fe},Wt.createElement=function(fe,Ge,rt){var ut,Et={},At=null;if(Ge!=null)for(ut in Ge.key!==void 0&&(At=""+Ge.key),Ge)Pn.call(Ge,ut)&&ut!=="key"&&ut!=="__self"&&ut!=="__source"&&(Et[ut]=Ge[ut]);var Qt=arguments.length-2;if(Qt===1)Et.children=rt;else if(1<Qt){for(var Ci=Array(Qt),ui=0;ui<Qt;ui++)Ci[ui]=arguments[ui+2];Et.children=Ci}if(fe&&fe.defaultProps)for(ut in Qt=fe.defaultProps,Qt)Et[ut]===void 0&&(Et[ut]=Qt[ut]);return Dn(fe,At,Et)},Wt.createRef=function(){return{current:null}},Wt.forwardRef=function(fe){return{$$typeof:h,render:fe}},Wt.isValidElement=xi,Wt.lazy=function(fe){return{$$typeof:We,_payload:{_status:-1,_result:fe},_init:Ct}},Wt.memo=function(fe,Ge){return{$$typeof:_e,type:fe,compare:Ge===void 0?null:Ge}},Wt.startTransition=function(fe){var Ge=Dt.T,rt={};Dt.T=rt;try{var ut=fe(),Et=Dt.S;Et!==null&&Et(rt,ut),typeof ut=="object"&&ut!==null&&typeof ut.then=="function"&&ut.then(ei,_t)}catch(At){_t(At)}finally{Ge!==null&&rt.types!==null&&(Ge.types=rt.types),Dt.T=Ge}},Wt.unstable_useCacheRefresh=function(){return Dt.H.useCacheRefresh()},Wt.use=function(fe){return Dt.H.use(fe)},Wt.useActionState=function(fe,Ge,rt){return Dt.H.useActionState(fe,Ge,rt)},Wt.useCallback=function(fe,Ge){return Dt.H.useCallback(fe,Ge)},Wt.useContext=function(fe){return Dt.H.useContext(fe)},Wt.useDebugValue=function(){},Wt.useDeferredValue=function(fe,Ge){return Dt.H.useDeferredValue(fe,Ge)},Wt.useEffect=function(fe,Ge){return Dt.H.useEffect(fe,Ge)},Wt.useEffectEvent=function(fe){return Dt.H.useEffectEvent(fe)},Wt.useId=function(){return Dt.H.useId()},Wt.useImperativeHandle=function(fe,Ge,rt){return Dt.H.useImperativeHandle(fe,Ge,rt)},Wt.useInsertionEffect=function(fe,Ge){return Dt.H.useInsertionEffect(fe,Ge)},Wt.useLayoutEffect=function(fe,Ge){return Dt.H.useLayoutEffect(fe,Ge)},Wt.useMemo=function(fe,Ge){return Dt.H.useMemo(fe,Ge)},Wt.useOptimistic=function(fe,Ge){return Dt.H.useOptimistic(fe,Ge)},Wt.useReducer=function(fe,Ge,rt){return Dt.H.useReducer(fe,Ge,rt)},Wt.useRef=function(fe){return Dt.H.useRef(fe)},Wt.useState=function(fe){return Dt.H.useState(fe)},Wt.useSyncExternalStore=function(fe,Ge,rt){return Dt.H.useSyncExternalStore(fe,Ge,rt)},Wt.useTransition=function(){return Dt.H.useTransition()},Wt.version="19.2.0",Wt}var _m;function lm(){return _m||(_m=1,Jp.exports=ug()),Jp.exports}var yt=lm(),em={exports:{}},Nf={},tm={exports:{}},im={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ym;function hg(){return ym||(ym=1,(function(B){function N(Fe,st){var Ct=Fe.length;Fe.push(st);e:for(;0<Ct;){var _t=Ct-1>>>1,oi=Fe[_t];if(0<J(oi,st))Fe[_t]=st,Fe[Ct]=oi,Ct=_t;else break e}}function V(Fe){return Fe.length===0?null:Fe[0]}function U(Fe){if(Fe.length===0)return null;var st=Fe[0],Ct=Fe.pop();if(Ct!==st){Fe[0]=Ct;e:for(var _t=0,oi=Fe.length,fe=oi>>>1;_t<fe;){var Ge=2*(_t+1)-1,rt=Fe[Ge],ut=Ge+1,Et=Fe[ut];if(0>J(rt,Ct))ut<oi&&0>J(Et,rt)?(Fe[_t]=Et,Fe[ut]=Ct,_t=ut):(Fe[_t]=rt,Fe[Ge]=Ct,_t=Ge);else if(ut<oi&&0>J(Et,Ct))Fe[_t]=Et,Fe[ut]=Ct,_t=ut;else break e}}return st}function J(Fe,st){var Ct=Fe.sortIndex-st.sortIndex;return Ct!==0?Ct:Fe.id-st.id}if(B.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var oe=performance;B.unstable_now=function(){return oe.now()}}else{var z=Date,h=z.now();B.unstable_now=function(){return z.now()-h}}var pe=[],_e=[],We=1,ke=null,Ne=3,Te=!1,ti=!1,kt=!1,Zi=!1,Ii=typeof setTimeout=="function"?setTimeout:null,di=typeof clearTimeout=="function"?clearTimeout:null,Mt=typeof setImmediate<"u"?setImmediate:null;function Jt(Fe){for(var st=V(_e);st!==null;){if(st.callback===null)U(_e);else if(st.startTime<=Fe)U(_e),st.sortIndex=st.expirationTime,N(pe,st);else break;st=V(_e)}}function vi(Fe){if(kt=!1,Jt(Fe),!ti)if(V(pe)!==null)ti=!0,ei||(ei=!0,Gi());else{var st=V(_e);st!==null&&Rn(vi,st.startTime-Fe)}}var ei=!1,Dt=-1,Pn=5,Dn=-1;function In(){return Zi?!0:!(B.unstable_now()-Dn<Pn)}function xi(){if(Zi=!1,ei){var Fe=B.unstable_now();Dn=Fe;var st=!0;try{e:{ti=!1,kt&&(kt=!1,di(Dt),Dt=-1),Te=!0;var Ct=Ne;try{t:{for(Jt(Fe),ke=V(pe);ke!==null&&!(ke.expirationTime>Fe&&In());){var _t=ke.callback;if(typeof _t=="function"){ke.callback=null,Ne=ke.priorityLevel;var oi=_t(ke.expirationTime<=Fe);if(Fe=B.unstable_now(),typeof oi=="function"){ke.callback=oi,Jt(Fe),st=!0;break t}ke===V(pe)&&U(pe),Jt(Fe)}else U(pe);ke=V(pe)}if(ke!==null)st=!0;else{var fe=V(_e);fe!==null&&Rn(vi,fe.startTime-Fe),st=!1}}break e}finally{ke=null,Ne=Ct,Te=!1}st=void 0}}finally{st?Gi():ei=!1}}}var Gi;if(typeof Mt=="function")Gi=function(){Mt(xi)};else if(typeof MessageChannel<"u"){var da=new MessageChannel,wa=da.port2;da.port1.onmessage=xi,Gi=function(){wa.postMessage(null)}}else Gi=function(){Ii(xi,0)};function Rn(Fe,st){Dt=Ii(function(){Fe(B.unstable_now())},st)}B.unstable_IdlePriority=5,B.unstable_ImmediatePriority=1,B.unstable_LowPriority=4,B.unstable_NormalPriority=3,B.unstable_Profiling=null,B.unstable_UserBlockingPriority=2,B.unstable_cancelCallback=function(Fe){Fe.callback=null},B.unstable_forceFrameRate=function(Fe){0>Fe||125<Fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Pn=0<Fe?Math.floor(1e3/Fe):5},B.unstable_getCurrentPriorityLevel=function(){return Ne},B.unstable_next=function(Fe){switch(Ne){case 1:case 2:case 3:var st=3;break;default:st=Ne}var Ct=Ne;Ne=st;try{return Fe()}finally{Ne=Ct}},B.unstable_requestPaint=function(){Zi=!0},B.unstable_runWithPriority=function(Fe,st){switch(Fe){case 1:case 2:case 3:case 4:case 5:break;default:Fe=3}var Ct=Ne;Ne=Fe;try{return st()}finally{Ne=Ct}},B.unstable_scheduleCallback=function(Fe,st,Ct){var _t=B.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?_t+Ct:_t):Ct=_t,Fe){case 1:var oi=-1;break;case 2:oi=250;break;case 5:oi=1073741823;break;case 4:oi=1e4;break;default:oi=5e3}return oi=Ct+oi,Fe={id:We++,callback:st,priorityLevel:Fe,startTime:Ct,expirationTime:oi,sortIndex:-1},Ct>_t?(Fe.sortIndex=Ct,N(_e,Fe),V(pe)===null&&Fe===V(_e)&&(kt?(di(Dt),Dt=-1):kt=!0,Rn(vi,Ct-_t))):(Fe.sortIndex=oi,N(pe,Fe),ti||Te||(ti=!0,ei||(ei=!0,Gi()))),Fe},B.unstable_shouldYield=In,B.unstable_wrapCallback=function(Fe){var st=Ne;return function(){var Ct=Ne;Ne=st;try{return Fe.apply(this,arguments)}finally{Ne=Ct}}}})(im)),im}var vm;function dg(){return vm||(vm=1,tm.exports=hg()),tm.exports}var nm={exports:{}},vr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xm;function fg(){if(xm)return vr;xm=1;var B=lm();function N(pe){var _e="https://react.dev/errors/"+pe;if(1<arguments.length){_e+="?args[]="+encodeURIComponent(arguments[1]);for(var We=2;We<arguments.length;We++)_e+="&args[]="+encodeURIComponent(arguments[We])}return"Minified React error #"+pe+"; visit "+_e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function V(){}var U={d:{f:V,r:function(){throw Error(N(522))},D:V,C:V,L:V,m:V,X:V,S:V,M:V},p:0,findDOMNode:null},J=Symbol.for("react.portal");function oe(pe,_e,We){var ke=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:J,key:ke==null?null:""+ke,children:pe,containerInfo:_e,implementation:We}}var z=B.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(pe,_e){if(pe==="font")return"";if(typeof _e=="string")return _e==="use-credentials"?_e:""}return vr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=U,vr.createPortal=function(pe,_e){var We=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_e||_e.nodeType!==1&&_e.nodeType!==9&&_e.nodeType!==11)throw Error(N(299));return oe(pe,_e,null,We)},vr.flushSync=function(pe){var _e=z.T,We=U.p;try{if(z.T=null,U.p=2,pe)return pe()}finally{z.T=_e,U.p=We,U.d.f()}},vr.preconnect=function(pe,_e){typeof pe=="string"&&(_e?(_e=_e.crossOrigin,_e=typeof _e=="string"?_e==="use-credentials"?_e:"":void 0):_e=null,U.d.C(pe,_e))},vr.prefetchDNS=function(pe){typeof pe=="string"&&U.d.D(pe)},vr.preinit=function(pe,_e){if(typeof pe=="string"&&_e&&typeof _e.as=="string"){var We=_e.as,ke=h(We,_e.crossOrigin),Ne=typeof _e.integrity=="string"?_e.integrity:void 0,Te=typeof _e.fetchPriority=="string"?_e.fetchPriority:void 0;We==="style"?U.d.S(pe,typeof _e.precedence=="string"?_e.precedence:void 0,{crossOrigin:ke,integrity:Ne,fetchPriority:Te}):We==="script"&&U.d.X(pe,{crossOrigin:ke,integrity:Ne,fetchPriority:Te,nonce:typeof _e.nonce=="string"?_e.nonce:void 0})}},vr.preinitModule=function(pe,_e){if(typeof pe=="string")if(typeof _e=="object"&&_e!==null){if(_e.as==null||_e.as==="script"){var We=h(_e.as,_e.crossOrigin);U.d.M(pe,{crossOrigin:We,integrity:typeof _e.integrity=="string"?_e.integrity:void 0,nonce:typeof _e.nonce=="string"?_e.nonce:void 0})}}else _e==null&&U.d.M(pe)},vr.preload=function(pe,_e){if(typeof pe=="string"&&typeof _e=="object"&&_e!==null&&typeof _e.as=="string"){var We=_e.as,ke=h(We,_e.crossOrigin);U.d.L(pe,We,{crossOrigin:ke,integrity:typeof _e.integrity=="string"?_e.integrity:void 0,nonce:typeof _e.nonce=="string"?_e.nonce:void 0,type:typeof _e.type=="string"?_e.type:void 0,fetchPriority:typeof _e.fetchPriority=="string"?_e.fetchPriority:void 0,referrerPolicy:typeof _e.referrerPolicy=="string"?_e.referrerPolicy:void 0,imageSrcSet:typeof _e.imageSrcSet=="string"?_e.imageSrcSet:void 0,imageSizes:typeof _e.imageSizes=="string"?_e.imageSizes:void 0,media:typeof _e.media=="string"?_e.media:void 0})}},vr.preloadModule=function(pe,_e){if(typeof pe=="string")if(_e){var We=h(_e.as,_e.crossOrigin);U.d.m(pe,{as:typeof _e.as=="string"&&_e.as!=="script"?_e.as:void 0,crossOrigin:We,integrity:typeof _e.integrity=="string"?_e.integrity:void 0})}else U.d.m(pe)},vr.requestFormReset=function(pe){U.d.r(pe)},vr.unstable_batchedUpdates=function(pe,_e){return pe(_e)},vr.useFormState=function(pe,_e,We){return z.H.useFormState(pe,_e,We)},vr.useFormStatus=function(){return z.H.useHostTransitionStatus()},vr.version="19.2.0",vr}var bm;function Bm(){if(bm)return nm.exports;bm=1;function B(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(B)}catch(N){console.error(N)}}return B(),nm.exports=fg(),nm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wm;function pg(){if(wm)return Nf;wm=1;var B=dg(),N=lm(),V=Bm();function U(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function J(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function oe(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function z(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function h(i){if(i.tag===31){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function pe(i){if(oe(i)!==i)throw Error(U(188))}function _e(i){var s=i.alternate;if(!s){if(s=oe(i),s===null)throw Error(U(188));return s!==i?null:i}for(var c=i,f=s;;){var x=c.return;if(x===null)break;var S=x.alternate;if(S===null){if(f=x.return,f!==null){c=f;continue}break}if(x.child===S.child){for(S=x.child;S;){if(S===c)return pe(x),i;if(S===f)return pe(x),s;S=S.sibling}throw Error(U(188))}if(c.return!==f.return)c=x,f=S;else{for(var R=!1,$=x.child;$;){if($===c){R=!0,c=x,f=S;break}if($===f){R=!0,f=x,c=S;break}$=$.sibling}if(!R){for($=S.child;$;){if($===c){R=!0,c=S,f=x;break}if($===f){R=!0,f=S,c=x;break}$=$.sibling}if(!R)throw Error(U(189))}}if(c.alternate!==f)throw Error(U(190))}if(c.tag!==3)throw Error(U(188));return c.stateNode.current===c?i:s}function We(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=We(i),s!==null)return s;i=i.sibling}return null}var ke=Object.assign,Ne=Symbol.for("react.element"),Te=Symbol.for("react.transitional.element"),ti=Symbol.for("react.portal"),kt=Symbol.for("react.fragment"),Zi=Symbol.for("react.strict_mode"),Ii=Symbol.for("react.profiler"),di=Symbol.for("react.consumer"),Mt=Symbol.for("react.context"),Jt=Symbol.for("react.forward_ref"),vi=Symbol.for("react.suspense"),ei=Symbol.for("react.suspense_list"),Dt=Symbol.for("react.memo"),Pn=Symbol.for("react.lazy"),Dn=Symbol.for("react.activity"),In=Symbol.for("react.memo_cache_sentinel"),xi=Symbol.iterator;function Gi(i){return i===null||typeof i!="object"?null:(i=xi&&i[xi]||i["@@iterator"],typeof i=="function"?i:null)}var da=Symbol.for("react.client.reference");function wa(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===da?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case kt:return"Fragment";case Ii:return"Profiler";case Zi:return"StrictMode";case vi:return"Suspense";case ei:return"SuspenseList";case Dn:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case ti:return"Portal";case Mt:return i.displayName||"Context";case di:return(i._context.displayName||"Context")+".Consumer";case Jt:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Dt:return s=i.displayName||null,s!==null?s:wa(i.type)||"Memo";case Pn:s=i._payload,i=i._init;try{return wa(i(s))}catch{}}return null}var Rn=Array.isArray,Fe=N.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,st=V.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ct={pending:!1,data:null,method:null,action:null},_t=[],oi=-1;function fe(i){return{current:i}}function Ge(i){0>oi||(i.current=_t[oi],_t[oi]=null,oi--)}function rt(i,s){oi++,_t[oi]=i.current,i.current=s}var ut=fe(null),Et=fe(null),At=fe(null),Qt=fe(null);function Ci(i,s){switch(rt(At,s),rt(Et,i),rt(ut,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?Ko(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=Ko(s),i=Pf(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Ge(ut),rt(ut,i)}function ui(){Ge(ut),Ge(Et),Ge(At)}function ir(i){i.memoizedState!==null&&rt(Qt,i);var s=ut.current,c=Pf(s,i.type);s!==c&&(rt(Et,i),rt(ut,c))}function nr(i){Et.current===i&&(Ge(ut),Ge(Et)),Qt.current===i&&(Ge(Qt),He._currentValue=Ct)}var Qn,qi;function Ri(i){if(Qn===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Qn=s&&s[1]||"",qi=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Qn+i+qi}var Xa=!1;function ar(i,s){if(!i||Xa)return"";Xa=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(s){var Ye=function(){throw Error()};if(Object.defineProperty(Ye.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ye,[])}catch(Oe){var Re=Oe}Reflect.construct(i,[],Ye)}else{try{Ye.call()}catch(Oe){Re=Oe}i.call(Ye.prototype)}}else{try{throw Error()}catch(Oe){Re=Oe}(Ye=i())&&typeof Ye.catch=="function"&&Ye.catch(function(){})}}catch(Oe){if(Oe&&Re&&typeof Oe.stack=="string")return[Oe.stack,Re.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=f.DetermineComponentFrameRoot(),R=S[0],$=S[1];if(R&&$){var he=R.split(`
`),Ie=$.split(`
`);for(x=f=0;f<he.length&&!he[f].includes("DetermineComponentFrameRoot");)f++;for(;x<Ie.length&&!Ie[x].includes("DetermineComponentFrameRoot");)x++;if(f===he.length||x===Ie.length)for(f=he.length-1,x=Ie.length-1;1<=f&&0<=x&&he[f]!==Ie[x];)x--;for(;1<=f&&0<=x;f--,x--)if(he[f]!==Ie[x]){if(f!==1||x!==1)do if(f--,x--,0>x||he[f]!==Ie[x]){var Ze=`
`+he[f].replace(" at new "," at ");return i.displayName&&Ze.includes("<anonymous>")&&(Ze=Ze.replace("<anonymous>",i.displayName)),Ze}while(1<=f&&0<=x);break}}}finally{Xa=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?Ri(c):""}function wo(i,s){switch(i.tag){case 26:case 27:case 5:return Ri(i.type);case 16:return Ri("Lazy");case 13:return i.child!==s&&s!==null?Ri("Suspense Fallback"):Ri("Suspense");case 19:return Ri("SuspenseList");case 0:case 15:return ar(i.type,!1);case 11:return ar(i.type.render,!1);case 1:return ar(i.type,!0);case 31:return Ri("Activity");default:return""}}function xr(i){try{var s="",c=null;do s+=wo(i,c),c=i,i=i.return;while(i);return s}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var rr=Object.prototype.hasOwnProperty,Us=B.unstable_scheduleCallback,Dr=B.unstable_cancelCallback,js=B.unstable_shouldYield,Ns=B.unstable_requestPaint,Nn=B.unstable_now,Vs=B.unstable_getCurrentPriorityLevel,us=B.unstable_ImmediatePriority,hs=B.unstable_UserBlockingPriority,ds=B.unstable_NormalPriority,ye=B.unstable_LowPriority,Z=B.unstable_IdlePriority,G=B.log,X=B.unstable_setDisableYieldValue,re=null,le=null;function ge(i){if(typeof G=="function"&&X(i),le&&typeof le.setStrictMode=="function")try{le.setStrictMode(re,i)}catch{}}var Se=Math.clz32?Math.clz32:Ke,we=Math.log,Be=Math.LN2;function Ke(i){return i>>>=0,i===0?32:31-(we(i)/Be|0)|0}var Ue=256,ct=262144,be=4194304;function Tt(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Zt(i,s,c){var f=i.pendingLanes;if(f===0)return 0;var x=0,S=i.suspendedLanes,R=i.pingedLanes;i=i.warmLanes;var $=f&134217727;return $!==0?(f=$&~S,f!==0?x=Tt(f):(R&=$,R!==0?x=Tt(R):c||(c=$&~i,c!==0&&(x=Tt(c))))):($=f&~S,$!==0?x=Tt($):R!==0?x=Tt(R):c||(c=f&~i,c!==0&&(x=Tt(c)))),x===0?0:s!==0&&s!==x&&(s&S)===0&&(S=x&-x,c=s&-s,S>=c||S===32&&(c&4194048)!==0)?s:x}function pt(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function Ut(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Li(){var i=be;return be<<=1,(be&62914560)===0&&(be=4194304),i}function sn(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function on(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Vn(i,s,c,f,x,S){var R=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var $=i.entanglements,he=i.expirationTimes,Ie=i.hiddenUpdates;for(c=R&~c;0<c;){var Ze=31-Se(c),Ye=1<<Ze;$[Ze]=0,he[Ze]=-1;var Re=Ie[Ze];if(Re!==null)for(Ie[Ze]=null,Ze=0;Ze<Re.length;Ze++){var Oe=Re[Ze];Oe!==null&&(Oe.lane&=-536870913)}c&=~Ye}f!==0&&Ln(i,f,0),S!==0&&x===0&&i.tag!==0&&(i.suspendedLanes|=S&~(R&~s))}function Ln(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var f=31-Se(s);i.entangledLanes|=s,i.entanglements[f]=i.entanglements[f]|1073741824|c&261930}function ki(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var f=31-Se(c),x=1<<f;x&s|i[f]&s&&(i[f]|=s),c&=~x}}function mn(i,s){var c=s&-s;return c=(c&42)!==0?1:Ve(c),(c&(i.suspendedLanes|s))!==0?0:c}function Ve(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function ln(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Ia(){var i=st.p;return i!==0?i:(i=window.event,i===void 0?32:_r(i.type))}function Zs(i,s){var c=st.p;try{return st.p=i,s()}finally{st.p=c}}var cn=Math.random().toString(36).slice(2),Xe="__reactFiber$"+cn,bt="__reactProps$"+cn,Rt="__reactContainer$"+cn,Zn="__reactEvents$"+cn,To="__reactListeners$"+cn,Gs="__reactHandles$"+cn,Bt="__reactResources$"+cn,qs="__reactMarker$"+cn;function Ir(i){delete i[Xe],delete i[bt],delete i[Zn],delete i[To],delete i[Gs]}function fs(i){var s=i[Xe];if(s)return s;for(var c=i.parentNode;c;){if(s=c[Rt]||c[Xe]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=Dp(i);i!==null;){if(c=i[Xe])return c;i=Dp(i)}return s}i=c,c=i.parentNode}return null}function Ta(i){if(i=i[Xe]||i[Rt]){var s=i.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return i}return null}function Rr(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(U(33))}function Bi(i){var s=i[Bt];return s||(s=i[Bt]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function vn(i){i[qs]=!0}var Sa=new Set,Ei={};function Hs(i,s){Lr(i,s),Lr(i+"Capture",s)}function Lr(i,s){for(Ei[i]=s,i=0;i<s.length;i++)Sa.add(s[i])}var wu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ps={},ms={};function Tu(i){return rr.call(ms,i)?!0:rr.call(ps,i)?!1:wu.test(i)?ms[i]=!0:(ps[i]=!0,!1)}function jl(i,s,c){if(Tu(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var f=s.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function Nl(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function Ra(i,s,c,f){if(f===null)i.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+f)}}function Ya(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Dh(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function kd(i,s,c){var f=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);if(!i.hasOwnProperty(s)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var x=f.get,S=f.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return x.call(this)},set:function(R){c=""+R,S.call(this,R)}}),Object.defineProperty(i,s,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Su(i){if(!i._valueTracker){var s=Dh(i)?"checked":"value";i._valueTracker=kd(i,s,""+i[s])}}function Pc(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),f="";return i&&(f=Dh(i)?i.checked?"true":"false":i.value),i=f,i!==c?(s.setValue(i),!0):!1}function gs(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Mu=/[\n"\\]/g;function La(i){return i.replace(Mu,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function $s(i,s,c,f,x,S,R,$){i.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?i.type=R:i.removeAttribute("type"),s!=null?R==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+Ya(s)):i.value!==""+Ya(s)&&(i.value=""+Ya(s)):R!=="submit"&&R!=="reset"||i.removeAttribute("value"),s!=null?Vl(i,R,Ya(s)):c!=null?Vl(i,R,Ya(c)):f!=null&&i.removeAttribute("value"),x==null&&S!=null&&(i.defaultChecked=!!S),x!=null&&(i.checked=x&&typeof x!="function"&&typeof x!="symbol"),$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?i.name=""+Ya($):i.removeAttribute("name")}function Dc(i,s,c,f,x,S,R,$){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.type=S),s!=null||c!=null){if(!(S!=="submit"&&S!=="reset"||s!=null)){Su(i);return}c=c!=null?""+Ya(c):"",s=s!=null?""+Ya(s):c,$||s===i.value||(i.value=s),i.defaultValue=s}f=f??x,f=typeof f!="function"&&typeof f!="symbol"&&!!f,i.checked=$?i.checked:!!f,i.defaultChecked=!!f,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(i.name=R),Su(i)}function Vl(i,s,c){s==="number"&&gs(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function il(i,s,c,f){if(i=i.options,s){s={};for(var x=0;x<c.length;x++)s["$"+c[x]]=!0;for(c=0;c<i.length;c++)x=s.hasOwnProperty("$"+i[c].value),i[c].selected!==x&&(i[c].selected=x),x&&f&&(i[c].defaultSelected=!0)}else{for(c=""+Ya(c),s=null,x=0;x<i.length;x++){if(i[x].value===c){i[x].selected=!0,f&&(i[x].defaultSelected=!0);return}s!==null||i[x].disabled||(s=i[x])}s!==null&&(s.selected=!0)}}function So(i,s,c){if(s!=null&&(s=""+Ya(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+Ya(c):""}function nl(i,s,c,f){if(s==null){if(f!=null){if(c!=null)throw Error(U(92));if(Rn(f)){if(1<f.length)throw Error(U(93));f=f[0]}c=f}c==null&&(c=""),s=c}c=Ya(s),i.defaultValue=c,f=i.textContent,f===c&&f!==""&&f!==null&&(i.value=f),Su(i)}function fa(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var Ht=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Xs(i,s,c){var f=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":f?i.setProperty(s,c):typeof c!="number"||c===0||Ht.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function _s(i,s,c){if(s!=null&&typeof s!="object")throw Error(U(62));if(i=i.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||s!=null&&s.hasOwnProperty(f)||(f.indexOf("--")===0?i.setProperty(f,""):f==="float"?i.cssFloat="":i[f]="");for(var x in s)f=s[x],s.hasOwnProperty(x)&&c[x]!==f&&Xs(i,x,f)}else for(var S in s)s.hasOwnProperty(S)&&Xs(i,S,s[S])}function br(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$t=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function kr(i){return $t.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function sr(){}var al=null;function la(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var un=null,kn=null;function xn(i){var s=Ta(i);if(s&&(i=s.stateNode)){var c=i[bt]||null;e:switch(i=s.stateNode,s.type){case"input":if($s(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+La(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var f=c[s];if(f!==i&&f.form===i.form){var x=f[bt]||null;if(!x)throw Error(U(90));$s(f,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(s=0;s<c.length;s++)f=c[s],f.form===i.form&&Pc(f)}break e;case"textarea":So(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&il(i,!!c.multiple,s,!1)}}}var bi=!1;function Cu(i,s,c){if(bi)return i(s,c);bi=!0;try{var f=i(s);return f}finally{if(bi=!1,(un!==null||kn!==null)&&(pd(),un&&(s=un,i=kn,kn=un=null,xn(s),i)))for(s=0;s<i.length;s++)xn(i[s])}}function Gn(i,s){var c=i.stateNode;if(c===null)return null;var f=c[bt]||null;if(f===null)return null;c=f[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(U(231,s,typeof c));return c}var bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jn=!1;if(bn)try{var wi={};Object.defineProperty(wi,"passive",{get:function(){Jn=!0}}),window.addEventListener("test",wi,wi),window.removeEventListener("test",wi,wi)}catch{Jn=!1}var ka=null,wt=null,It=null;function Br(){if(It)return It;var i,s=wt,c=s.length,f,x="value"in ka?ka.value:ka.textContent,S=x.length;for(i=0;i<c&&s[i]===x[i];i++);var R=c-i;for(f=1;f<=R&&s[c-f]===x[S-f];f++);return It=x.slice(i,1<f?1-f:void 0)}function Kt(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function pa(){return!0}function wr(){return!1}function hn(i){function s(c,f,x,S,R){this._reactName=c,this._targetInst=x,this.type=f,this.nativeEvent=S,this.target=R,this.currentTarget=null;for(var $ in i)i.hasOwnProperty($)&&(c=i[$],this[$]=c?c(S):S[$]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?pa:wr,this.isPropagationStopped=wr,this}return ke(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=pa)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=pa)},persist:function(){},isPersistent:pa}),s}var Or={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rl=hn(Or),Fr=ke({},Or,{view:0,detail:0}),Zl=hn(Fr),sl,ol,Ys,Ba=ke({},Fr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Eo,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ys&&(Ys&&i.type==="mousemove"?(sl=i.screenX-Ys.screenX,ol=i.screenY-Ys.screenY):ol=sl=0,Ys=i),sl)},movementY:function(i){return"movementY"in i?i.movementY:ol}}),qn=hn(Ba),ll=ke({},Ba,{dataTransfer:0}),Gl=hn(ll),Co=ke({},Fr,{relatedTarget:0}),nn=hn(Co),Ih=ke({},Or,{animationName:0,elapsedTime:0,pseudoElement:0}),ql=hn(Ih),Eu=ke({},Or,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Bd=hn(Eu),cl=ke({},Or,{data:0}),ea=hn(cl),Hl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ur={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$l={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xl(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=$l[i])?!!s[i]:!1}function Eo(){return Xl}var ma=ke({},Fr,{key:function(i){if(i.key){var s=Hl[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Kt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Ur[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Eo,charCode:function(i){return i.type==="keypress"?Kt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Kt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Rh=hn(ma),Ic=ke({},Ba,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lh=hn(Ic),Au=ke({},Fr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Eo}),Od=hn(Au),Fd=ke({},Or,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rc=hn(Fd),zu=ke({},Ba,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Ao=hn(zu),Pu=ke({},Or,{newState:0,oldState:0}),Lc=hn(Pu),Tr=[9,13,27,32],Du=bn&&"CompositionEvent"in window,Ks=null;bn&&"documentMode"in document&&(Ks=document.documentMode);var Yl=bn&&"TextEvent"in window&&!Ks,ul=bn&&(!Du||Ks&&8<Ks&&11>=Ks),kh=" ",Kl=!1;function Bh(i,s){switch(i){case"keyup":return Tr.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ws(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var zo=!1;function Iu(i,s){switch(i){case"compositionend":return Ws(s);case"keypress":return s.which!==32?null:(Kl=!0,kh);case"textInput":return i=s.data,i===kh&&Kl?null:i;default:return null}}function Ud(i,s){if(zo)return i==="compositionend"||!Du&&Bh(i,s)?(i=Br(),It=wt=ka=null,zo=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ul&&s.locale!=="ko"?null:s.data;default:return null}}var Oh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kc(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Oh[i.type]:s==="textarea"}function Ru(i,s,c,f){un?kn?kn.push(f):kn=[f]:un=f,s=pu(s,"onChange"),0<s.length&&(c=new rl("onChange","change",null,c,f),i.push({event:c,listeners:s}))}var Qs=null,hl=null;function Fh(i){wp(i,0)}function jr(i){var s=Rr(i);if(Pc(s))return i}function Bc(i,s){if(i==="change")return s}var Oc=!1;if(bn){var Po;if(bn){var Lu="oninput"in document;if(!Lu){var dl=document.createElement("div");dl.setAttribute("oninput","return;"),Lu=typeof dl.oninput=="function"}Po=Lu}else Po=!1;Oc=Po&&(!document.documentMode||9<document.documentMode)}function ku(){Qs&&(Qs.detachEvent("onpropertychange",Uh),hl=Qs=null)}function Uh(i){if(i.propertyName==="value"&&jr(hl)){var s=[];Ru(s,hl,i,la(i)),Cu(Fh,s)}}function jh(i,s,c){i==="focusin"?(ku(),Qs=s,hl=c,Qs.attachEvent("onpropertychange",Uh)):i==="focusout"&&ku()}function Nh(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return jr(hl)}function Bu(i,s){if(i==="click")return jr(s)}function Ou(i,s){if(i==="input"||i==="change")return jr(s)}function Vh(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var ga=typeof Object.is=="function"?Object.is:Vh;function Ka(i,s){if(ga(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),f=Object.keys(s);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var x=c[f];if(!rr.call(s,x)||!ga(i[x],s[x]))return!1}return!0}function li(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Fc(i,s){var c=li(i);i=0;for(var f;c;){if(c.nodeType===3){if(f=i+c.textContent.length,i<=s&&f>=s)return{node:c,offset:s-i};i=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=li(c)}}function Uc(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Uc(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Fu(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=gs(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=gs(i.document)}return s}function Wl(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var Do=bn&&"documentMode"in document&&11>=document.documentMode,Js=null,Uu=null,Ql=null,ju=!1;function Zh(i,s,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;ju||Js==null||Js!==gs(f)||(f=Js,"selectionStart"in f&&Wl(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Ql&&Ka(Ql,f)||(Ql=f,f=pu(Uu,"onSelect"),0<f.length&&(s=new rl("onSelect","select",null,s,c),i.push({event:s,listeners:f}),s.target=Js)))}function eo(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var fl={animationend:eo("Animation","AnimationEnd"),animationiteration:eo("Animation","AnimationIteration"),animationstart:eo("Animation","AnimationStart"),transitionrun:eo("Transition","TransitionRun"),transitionstart:eo("Transition","TransitionStart"),transitioncancel:eo("Transition","TransitionCancel"),transitionend:eo("Transition","TransitionEnd")},jc={},Jl={};bn&&(Jl=document.createElement("div").style,"AnimationEvent"in window||(delete fl.animationend.animation,delete fl.animationiteration.animation,delete fl.animationstart.animation),"TransitionEvent"in window||delete fl.transitionend.transition);function Nr(i){if(jc[i])return jc[i];if(!fl[i])return i;var s=fl[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in Jl)return jc[i]=s[c];return i}var ec=Nr("animationend"),Nc=Nr("animationiteration"),to=Nr("animationstart"),tc=Nr("transitionrun"),pl=Nr("transitionstart"),or=Nr("transitioncancel"),Nu=Nr("transitionend"),Vu=new Map,ic="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ic.push("scrollEnd");function ca(i,s){Vu.set(i,s),Hs(s,[i])}var Io=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Ma=[],Vr=0,ml=0;function nc(){for(var i=Vr,s=ml=Vr=0;s<i;){var c=Ma[s];Ma[s++]=null;var f=Ma[s];Ma[s++]=null;var x=Ma[s];Ma[s++]=null;var S=Ma[s];if(Ma[s++]=null,f!==null&&x!==null){var R=f.pending;R===null?x.next=x:(x.next=R.next,R.next=x),f.pending=x}S!==0&&Vc(c,x,S)}}function ys(i,s,c,f){Ma[Vr++]=i,Ma[Vr++]=s,Ma[Vr++]=c,Ma[Vr++]=f,ml|=f,i.lanes|=f,i=i.alternate,i!==null&&(i.lanes|=f)}function Zr(i,s,c,f){return ys(i,s,c,f),Gt(i)}function io(i,s){return ys(i,null,null,s),Gt(i)}function Vc(i,s,c){i.lanes|=c;var f=i.alternate;f!==null&&(f.lanes|=c);for(var x=!1,S=i.return;S!==null;)S.childLanes|=c,f=S.alternate,f!==null&&(f.childLanes|=c),S.tag===22&&(i=S.stateNode,i===null||i._visibility&1||(x=!0)),i=S,S=S.return;return i.tag===3?(S=i.stateNode,x&&s!==null&&(x=31-Se(c),i=S.hiddenUpdates,f=i[x],f===null?i[x]=[s]:f.push(s),s.lane=c|536870912),S):null}function Gt(i){if(50<Sc)throw Sc=0,kl=null,Error(U(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Gr={};function jd(i,s,c,f){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oa(i,s,c,f){return new jd(i,s,c,f)}function qr(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Hr(i,s){var c=i.alternate;return c===null?(c=Oa(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Gh(i,s){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function ac(i,s,c,f,x,S){var R=0;if(f=i,typeof i=="function")qr(i)&&(R=1);else if(typeof i=="string")R=j(i,c,ut.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Dn:return i=Oa(31,c,s,x),i.elementType=Dn,i.lanes=S,i;case kt:return Ro(c.children,x,S,s);case Zi:R=8,x|=24;break;case Ii:return i=Oa(12,c,s,x|2),i.elementType=Ii,i.lanes=S,i;case vi:return i=Oa(13,c,s,x),i.elementType=vi,i.lanes=S,i;case ei:return i=Oa(19,c,s,x),i.elementType=ei,i.lanes=S,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Mt:R=10;break e;case di:R=9;break e;case Jt:R=11;break e;case Dt:R=14;break e;case Pn:R=16,f=null;break e}R=29,c=Error(U(130,i===null?"null":typeof i,"")),f=null}return s=Oa(R,c,s,x),s.elementType=i,s.type=f,s.lanes=S,s}function Ro(i,s,c,f){return i=Oa(7,i,f,s),i.lanes=c,i}function rc(i,s,c){return i=Oa(6,i,null,s),i.lanes=c,i}function sc(i){var s=Oa(18,null,null,0);return s.stateNode=i,s}function Lo(i,s,c){return s=Oa(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var gl=new WeakMap;function Fa(i,s){if(typeof i=="object"&&i!==null){var c=gl.get(i);return c!==void 0?c:(s={value:i,source:s,stack:xr(s)},gl.set(i,s),s)}return{value:i,source:s,stack:xr(s)}}var ko=[],$r=0,no=null,vs=0,ta=[],_a=0,Xr=null,ya=1,lr="";function Wa(i,s){ko[$r++]=vs,ko[$r++]=no,no=i,vs=s}function oc(i,s,c){ta[_a++]=ya,ta[_a++]=lr,ta[_a++]=Xr,Xr=i;var f=ya;i=lr;var x=32-Se(f)-1;f&=~(1<<x),c+=1;var S=32-Se(s)+x;if(30<S){var R=x-x%5;S=(f&(1<<R)-1).toString(32),f>>=R,x-=R,ya=1<<32-Se(s)+x|c<<x|f,lr=S+i}else ya=1<<S|c<<x|f,lr=i}function lc(i){i.return!==null&&(Wa(i,1),oc(i,1,0))}function Zc(i){for(;i===no;)no=ko[--$r],ko[$r]=null,vs=ko[--$r],ko[$r]=null;for(;i===Xr;)Xr=ta[--_a],ta[_a]=null,lr=ta[--_a],ta[_a]=null,ya=ta[--_a],ta[_a]=null}function Zu(i,s){ta[_a++]=ya,ta[_a++]=lr,ta[_a++]=Xr,ya=s.id,lr=s.overflow,Xr=i}var Bn=null,Oi=null,ni=!1,Yr=null,ai=!1,xs=Error(U(519));function On(i){var s=Error(U(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ws(Fa(s,i)),xs}function cc(i){var s=i.stateNode,c=i.type,f=i.memoizedProps;switch(s[Xe]=i,s[bt]=f,c){case"dialog":ii("cancel",s),ii("close",s);break;case"iframe":case"object":case"embed":ii("load",s);break;case"video":case"audio":for(c=0;c<bh.length;c++)ii(bh[c],s);break;case"source":ii("error",s);break;case"img":case"image":case"link":ii("error",s),ii("load",s);break;case"details":ii("toggle",s);break;case"input":ii("invalid",s),Dc(s,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":ii("invalid",s);break;case"textarea":ii("invalid",s),nl(s,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||f.suppressHydrationWarning===!0||gr(s.textContent,c)?(f.popover!=null&&(ii("beforetoggle",s),ii("toggle",s)),f.onScroll!=null&&ii("scroll",s),f.onScrollEnd!=null&&ii("scrollend",s),f.onClick!=null&&(s.onclick=sr),s=!0):s=!1,s||On(i,!0)}function uc(i){for(Bn=i.return;Bn;)switch(Bn.tag){case 5:case 31:case 13:ai=!1;return;case 27:case 3:ai=!0;return;default:Bn=Bn.return}}function ao(i){if(i!==Bn)return!1;if(!ni)return uc(i),ni=!0,!1;var s=i.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||Md(i.type,i.memoizedProps)),c=!c),c&&Oi&&On(i),uc(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(317));Oi=zd(i)}else if(s===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(317));Oi=zd(i)}else s===27?(s=Oi,Wo(i.type)?(i=Ad,Ad=null,Oi=i):Oi=s):Oi=Bn?zr(i.stateNode.nextSibling):null;return!0}function Qa(){Oi=Bn=null,ni=!1}function bs(){var i=Yr;return i!==null&&(za===null?za=i:za.push.apply(za,i),Yr=null),i}function ws(i){Yr===null?Yr=[i]:Yr.push(i)}var hc=fe(null),ro=null,Kr=null;function Ts(i,s,c){rt(hc,s._currentValue),s._currentValue=c}function Wr(i){i._currentValue=hc.current,Ge(hc)}function so(i,s,c){for(;i!==null;){var f=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,f!==null&&(f.childLanes|=s)):f!==null&&(f.childLanes&s)!==s&&(f.childLanes|=s),i===c)break;i=i.return}}function Ja(i,s,c,f){var x=i.child;for(x!==null&&(x.return=i);x!==null;){var S=x.dependencies;if(S!==null){var R=x.child;S=S.firstContext;e:for(;S!==null;){var $=S;S=x;for(var he=0;he<s.length;he++)if($.context===s[he]){S.lanes|=c,$=S.alternate,$!==null&&($.lanes|=c),so(S.return,c,i),f||(R=null);break e}S=$.next}}else if(x.tag===18){if(R=x.return,R===null)throw Error(U(341));R.lanes|=c,S=R.alternate,S!==null&&(S.lanes|=c),so(R,c,i),R=null}else R=x.child;if(R!==null)R.return=x;else for(R=x;R!==null;){if(R===i){R=null;break}if(x=R.sibling,x!==null){x.return=R.return,R=x;break}R=R.return}x=R}}function Hn(i,s,c,f){i=null;for(var x=s,S=!1;x!==null;){if(!S){if((x.flags&524288)!==0)S=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var R=x.alternate;if(R===null)throw Error(U(387));if(R=R.memoizedProps,R!==null){var $=x.type;ga(x.pendingProps.value,R.value)||(i!==null?i.push($):i=[$])}}else if(x===Qt.current){if(R=x.alternate,R===null)throw Error(U(387));R.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(i!==null?i.push(He):i=[He])}x=x.return}i!==null&&Ja(s,i,c,f),s.flags|=262144}function Ss(i){for(i=i.firstContext;i!==null;){if(!ga(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Ms(i){ro=i,Kr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function ia(i){return Bo(ro,i)}function dc(i,s){return ro===null&&Ms(i),Bo(i,s)}function Bo(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},Kr===null){if(i===null)throw Error(U(308));Kr=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Kr=Kr.next=s;return c}var Gu=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,f){i.push(f)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},Gc=B.unstable_scheduleCallback,qc=B.unstable_NormalPriority,dn={$$typeof:Mt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ua(){return{controller:new Gu,data:new Map,refCount:0}}function $n(i){i.refCount--,i.refCount===0&&Gc(qc,function(){i.controller.abort()})}var _l=null,er=0,Sr=0,Qr=null;function Nd(i,s){if(_l===null){var c=_l=[];er=0,Sr=xd(),Qr={status:"pending",value:void 0,then:function(f){c.push(f)}}}return er++,s.then(qh,qh),s}function qh(){if(--er===0&&_l!==null){Qr!==null&&(Qr.status="fulfilled");var i=_l;_l=null,Sr=0,Qr=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function Hc(i,s){var c=[],f={status:"pending",value:null,reason:null,then:function(x){c.push(x)}};return i.then(function(){f.status="fulfilled",f.value=s;for(var x=0;x<c.length;x++)(0,c[x])(s)},function(x){for(f.status="rejected",f.reason=x,x=0;x<c.length;x++)(0,c[x])(void 0)}),f}var qu=Fe.S;Fe.S=function(i,s){up=Nn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Nd(i,s),qu!==null&&qu(i,s)};var tr=fe(null);function ja(){var i=tr.current;return i!==null?i:Ki.pooledCache}function ot(i,s){s===null?rt(tr,tr.current):rt(tr,s.pool)}function $c(){var i=ja();return i===null?null:{parent:dn._currentValue,pool:i}}var Cs=Error(U(460)),fc=Error(U(474)),Jr=Error(U(542)),Es={then:function(){}};function Xc(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Xt(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(sr,sr),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Hu(i),i;default:if(typeof s.status=="string")s.then(sr,sr);else{if(i=Ki,i!==null&&100<i.shellSuspendCounter)throw Error(U(482));i=s,i.status="pending",i.then(function(f){if(s.status==="pending"){var x=s;x.status="fulfilled",x.value=f}},function(f){if(s.status==="pending"){var x=s;x.status="rejected",x.reason=f}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Hu(i),i}throw oo=s,Cs}}function As(i){try{var s=i._init;return s(i._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(oo=c,Cs):c}}var oo=null;function Yc(){if(oo===null)throw Error(U(459));var i=oo;return oo=null,i}function Hu(i){if(i===Cs||i===Jr)throw Error(U(483))}var Oo=null,yl=0;function vl(i){var s=yl;return yl+=1,Oo===null&&(Oo=[]),Xt(Oo,i,s)}function Fo(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function pc(i,s){throw s.$$typeof===Ne?Error(U(525)):(i=Object.prototype.toString.call(s),Error(U(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Kc(i){function s(Me,ve){if(i){var De=Me.deletions;De===null?(Me.deletions=[ve],Me.flags|=16):De.push(ve)}}function c(Me,ve){if(!i)return null;for(;ve!==null;)s(Me,ve),ve=ve.sibling;return null}function f(Me){for(var ve=new Map;Me!==null;)Me.key!==null?ve.set(Me.key,Me):ve.set(Me.index,Me),Me=Me.sibling;return ve}function x(Me,ve){return Me=Hr(Me,ve),Me.index=0,Me.sibling=null,Me}function S(Me,ve,De){return Me.index=De,i?(De=Me.alternate,De!==null?(De=De.index,De<ve?(Me.flags|=67108866,ve):De):(Me.flags|=67108866,ve)):(Me.flags|=1048576,ve)}function R(Me){return i&&Me.alternate===null&&(Me.flags|=67108866),Me}function $(Me,ve,De,$e){return ve===null||ve.tag!==6?(ve=rc(De,Me.mode,$e),ve.return=Me,ve):(ve=x(ve,De),ve.return=Me,ve)}function he(Me,ve,De,$e){var Pt=De.type;return Pt===kt?Ze(Me,ve,De.props.children,$e,De.key):ve!==null&&(ve.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===Pn&&As(Pt)===ve.type)?(ve=x(ve,De.props),Fo(ve,De),ve.return=Me,ve):(ve=ac(De.type,De.key,De.props,null,Me.mode,$e),Fo(ve,De),ve.return=Me,ve)}function Ie(Me,ve,De,$e){return ve===null||ve.tag!==4||ve.stateNode.containerInfo!==De.containerInfo||ve.stateNode.implementation!==De.implementation?(ve=Lo(De,Me.mode,$e),ve.return=Me,ve):(ve=x(ve,De.children||[]),ve.return=Me,ve)}function Ze(Me,ve,De,$e,Pt){return ve===null||ve.tag!==7?(ve=Ro(De,Me.mode,$e,Pt),ve.return=Me,ve):(ve=x(ve,De),ve.return=Me,ve)}function Ye(Me,ve,De){if(typeof ve=="string"&&ve!==""||typeof ve=="number"||typeof ve=="bigint")return ve=rc(""+ve,Me.mode,De),ve.return=Me,ve;if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case Te:return De=ac(ve.type,ve.key,ve.props,null,Me.mode,De),Fo(De,ve),De.return=Me,De;case ti:return ve=Lo(ve,Me.mode,De),ve.return=Me,ve;case Pn:return ve=As(ve),Ye(Me,ve,De)}if(Rn(ve)||Gi(ve))return ve=Ro(ve,Me.mode,De,null),ve.return=Me,ve;if(typeof ve.then=="function")return Ye(Me,vl(ve),De);if(ve.$$typeof===Mt)return Ye(Me,dc(Me,ve),De);pc(Me,ve)}return null}function Re(Me,ve,De,$e){var Pt=ve!==null?ve.key:null;if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return Pt!==null?null:$(Me,ve,""+De,$e);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case Te:return De.key===Pt?he(Me,ve,De,$e):null;case ti:return De.key===Pt?Ie(Me,ve,De,$e):null;case Pn:return De=As(De),Re(Me,ve,De,$e)}if(Rn(De)||Gi(De))return Pt!==null?null:Ze(Me,ve,De,$e,null);if(typeof De.then=="function")return Re(Me,ve,vl(De),$e);if(De.$$typeof===Mt)return Re(Me,ve,dc(Me,De),$e);pc(Me,De)}return null}function Oe(Me,ve,De,$e,Pt){if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return Me=Me.get(De)||null,$(ve,Me,""+$e,Pt);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case Te:return Me=Me.get($e.key===null?De:$e.key)||null,he(ve,Me,$e,Pt);case ti:return Me=Me.get($e.key===null?De:$e.key)||null,Ie(ve,Me,$e,Pt);case Pn:return $e=As($e),Oe(Me,ve,De,$e,Pt)}if(Rn($e)||Gi($e))return Me=Me.get(De)||null,Ze(ve,Me,$e,Pt,null);if(typeof $e.then=="function")return Oe(Me,ve,De,vl($e),Pt);if($e.$$typeof===Mt)return Oe(Me,ve,De,dc(ve,$e),Pt);pc(ve,$e)}return null}function vt(Me,ve,De,$e){for(var Pt=null,Ft=null,ht=ve,jt=ve=0,Vt=null;ht!==null&&jt<De.length;jt++){ht.index>jt?(Vt=ht,ht=null):Vt=ht.sibling;var si=Re(Me,ht,De[jt],$e);if(si===null){ht===null&&(ht=Vt);break}i&&ht&&si.alternate===null&&s(Me,ht),ve=S(si,ve,jt),Ft===null?Pt=si:Ft.sibling=si,Ft=si,ht=Vt}if(jt===De.length)return c(Me,ht),ni&&Wa(Me,jt),Pt;if(ht===null){for(;jt<De.length;jt++)ht=Ye(Me,De[jt],$e),ht!==null&&(ve=S(ht,ve,jt),Ft===null?Pt=ht:Ft.sibling=ht,Ft=ht);return ni&&Wa(Me,jt),Pt}for(ht=f(ht);jt<De.length;jt++)Vt=Oe(ht,Me,jt,De[jt],$e),Vt!==null&&(i&&Vt.alternate!==null&&ht.delete(Vt.key===null?jt:Vt.key),ve=S(Vt,ve,jt),Ft===null?Pt=Vt:Ft.sibling=Vt,Ft=Vt);return i&&ht.forEach(function(Da){return s(Me,Da)}),ni&&Wa(Me,jt),Pt}function Lt(Me,ve,De,$e){if(De==null)throw Error(U(151));for(var Pt=null,Ft=null,ht=ve,jt=ve=0,Vt=null,si=De.next();ht!==null&&!si.done;jt++,si=De.next()){ht.index>jt?(Vt=ht,ht=null):Vt=ht.sibling;var Da=Re(Me,ht,si.value,$e);if(Da===null){ht===null&&(ht=Vt);break}i&&ht&&Da.alternate===null&&s(Me,ht),ve=S(Da,ve,jt),Ft===null?Pt=Da:Ft.sibling=Da,Ft=Da,ht=Vt}if(si.done)return c(Me,ht),ni&&Wa(Me,jt),Pt;if(ht===null){for(;!si.done;jt++,si=De.next())si=Ye(Me,si.value,$e),si!==null&&(ve=S(si,ve,jt),Ft===null?Pt=si:Ft.sibling=si,Ft=si);return ni&&Wa(Me,jt),Pt}for(ht=f(ht);!si.done;jt++,si=De.next())si=Oe(ht,Me,jt,si.value,$e),si!==null&&(i&&si.alternate!==null&&ht.delete(si.key===null?jt:si.key),ve=S(si,ve,jt),Ft===null?Pt=si:Ft.sibling=si,Ft=si);return i&&ht.forEach(function(rg){return s(Me,rg)}),ni&&Wa(Me,jt),Pt}function ri(Me,ve,De,$e){if(typeof De=="object"&&De!==null&&De.type===kt&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case Te:e:{for(var Pt=De.key;ve!==null;){if(ve.key===Pt){if(Pt=De.type,Pt===kt){if(ve.tag===7){c(Me,ve.sibling),$e=x(ve,De.props.children),$e.return=Me,Me=$e;break e}}else if(ve.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===Pn&&As(Pt)===ve.type){c(Me,ve.sibling),$e=x(ve,De.props),Fo($e,De),$e.return=Me,Me=$e;break e}c(Me,ve);break}else s(Me,ve);ve=ve.sibling}De.type===kt?($e=Ro(De.props.children,Me.mode,$e,De.key),$e.return=Me,Me=$e):($e=ac(De.type,De.key,De.props,null,Me.mode,$e),Fo($e,De),$e.return=Me,Me=$e)}return R(Me);case ti:e:{for(Pt=De.key;ve!==null;){if(ve.key===Pt)if(ve.tag===4&&ve.stateNode.containerInfo===De.containerInfo&&ve.stateNode.implementation===De.implementation){c(Me,ve.sibling),$e=x(ve,De.children||[]),$e.return=Me,Me=$e;break e}else{c(Me,ve);break}else s(Me,ve);ve=ve.sibling}$e=Lo(De,Me.mode,$e),$e.return=Me,Me=$e}return R(Me);case Pn:return De=As(De),ri(Me,ve,De,$e)}if(Rn(De))return vt(Me,ve,De,$e);if(Gi(De)){if(Pt=Gi(De),typeof Pt!="function")throw Error(U(150));return De=Pt.call(De),Lt(Me,ve,De,$e)}if(typeof De.then=="function")return ri(Me,ve,vl(De),$e);if(De.$$typeof===Mt)return ri(Me,ve,dc(Me,De),$e);pc(Me,De)}return typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint"?(De=""+De,ve!==null&&ve.tag===6?(c(Me,ve.sibling),$e=x(ve,De),$e.return=Me,Me=$e):(c(Me,ve),$e=rc(De,Me.mode,$e),$e.return=Me,Me=$e),R(Me)):c(Me,ve)}return function(Me,ve,De,$e){try{yl=0;var Pt=ri(Me,ve,De,$e);return Oo=null,Pt}catch(ht){if(ht===Cs||ht===Jr)throw ht;var Ft=Oa(29,ht,null,Me.mode);return Ft.lanes=$e,Ft.return=Me,Ft}finally{}}}var lo=Kc(!0),mc=Kc(!1),Ca=!1;function pi(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $u(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Mr(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Cr(i,s,c){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(Mi&2)!==0){var x=f.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),f.pending=s,s=Gt(i),Vc(i,null,c),s}return ys(i,f,s,c),Gt(i)}function Uo(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var f=s.lanes;f&=i.pendingLanes,c|=f,s.lanes=c,ki(i,c)}}function gc(i,s){var c=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var x=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var R={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};S===null?x=S=R:S=S.next=R,c=c.next}while(c!==null);S===null?x=S=s:S=S.next=s}else x=S=s;c={baseState:f.baseState,firstBaseUpdate:x,lastBaseUpdate:S,shared:f.shared,callbacks:f.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var Wc=!1;function _c(){if(Wc){var i=Qr;if(i!==null)throw i}}function Na(i,s,c,f){Wc=!1;var x=i.updateQueue;Ca=!1;var S=x.firstBaseUpdate,R=x.lastBaseUpdate,$=x.shared.pending;if($!==null){x.shared.pending=null;var he=$,Ie=he.next;he.next=null,R===null?S=Ie:R.next=Ie,R=he;var Ze=i.alternate;Ze!==null&&(Ze=Ze.updateQueue,$=Ze.lastBaseUpdate,$!==R&&($===null?Ze.firstBaseUpdate=Ie:$.next=Ie,Ze.lastBaseUpdate=he))}if(S!==null){var Ye=x.baseState;R=0,Ze=Ie=he=null,$=S;do{var Re=$.lane&-536870913,Oe=Re!==$.lane;if(Oe?(hi&Re)===Re:(f&Re)===Re){Re!==0&&Re===Sr&&(Wc=!0),Ze!==null&&(Ze=Ze.next={lane:0,tag:$.tag,payload:$.payload,callback:null,next:null});e:{var vt=i,Lt=$;Re=s;var ri=c;switch(Lt.tag){case 1:if(vt=Lt.payload,typeof vt=="function"){Ye=vt.call(ri,Ye,Re);break e}Ye=vt;break e;case 3:vt.flags=vt.flags&-65537|128;case 0:if(vt=Lt.payload,Re=typeof vt=="function"?vt.call(ri,Ye,Re):vt,Re==null)break e;Ye=ke({},Ye,Re);break e;case 2:Ca=!0}}Re=$.callback,Re!==null&&(i.flags|=64,Oe&&(i.flags|=8192),Oe=x.callbacks,Oe===null?x.callbacks=[Re]:Oe.push(Re))}else Oe={lane:Re,tag:$.tag,payload:$.payload,callback:$.callback,next:null},Ze===null?(Ie=Ze=Oe,he=Ye):Ze=Ze.next=Oe,R|=Re;if($=$.next,$===null){if($=x.shared.pending,$===null)break;Oe=$,$=Oe.next,Oe.next=null,x.lastBaseUpdate=Oe,x.shared.pending=null}}while(!0);Ze===null&&(he=Ye),x.baseState=he,x.firstBaseUpdate=Ie,x.lastBaseUpdate=Ze,S===null&&(x.shared.lanes=0),$o|=R,i.lanes=R,i.memoizedState=Ye}}function yc(i,s){if(typeof i!="function")throw Error(U(191,i));i.call(s)}function dt(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)yc(c[i],s)}var mt=fe(null),co=fe(0);function Xu(i,s){i=Ho,rt(co,i),rt(mt,s),Ho=i|s.baseLanes}function xl(){rt(co,Ho),rt(mt,mt.current)}function na(){Ho=co.current,Ge(mt),Ge(co)}var Va=fe(null),gn=null;function Za(i){var s=i.alternate;rt(Ji,Ji.current&1),rt(Va,i),gn===null&&(s===null||mt.current!==null||s.memoizedState!==null)&&(gn=i)}function uo(i){rt(Ji,Ji.current),rt(Va,i),gn===null&&(gn=i)}function Fi(i){i.tag===22?(rt(Ji,Ji.current),rt(Va,i),gn===null&&(gn=i)):Ti()}function Ti(){rt(Ji,Ji.current),rt(Va,Va.current)}function va(i){Ge(Va),gn===i&&(gn=null),Ge(Ji)}var Ji=fe(0);function es(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Fl(c)||sa(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ea=0,Nt=null,mi=null,Pi=null,bl=!1,ho=!1,ts=!1,wl=0,m=0,e=null,r=0;function l(){throw Error(U(321))}function d(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!ga(i[c],s[c]))return!1;return!0}function g(i,s,c,f,x,S){return Ea=S,Nt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Fe.H=i===null||i.memoizedState===null?$h:Xh,ts=!1,S=c(f,x),ts=!1,ho&&(S=w(s,c,f,x)),y(i),S}function y(i){Fe.H=eu;var s=mi!==null&&mi.next!==null;if(Ea=0,Pi=mi=Nt=null,bl=!1,m=0,e=null,s)throw Error(U(300));i===null||fn||(i=i.dependencies,i!==null&&Ss(i)&&(fn=!0))}function w(i,s,c,f){Nt=i;var x=0;do{if(ho&&(e=null),m=0,ho=!1,25<=x)throw Error(U(301));if(x+=1,Pi=mi=null,i.updateQueue!=null){var S=i.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}Fe.H=Cl,S=s(c,f)}while(ho);return S}function T(){var i=Fe.H,s=i.useState()[0];return s=typeof s.then=="function"?K(s):s,i=i.useState()[0],(mi!==null?mi.memoizedState:null)!==i&&(Nt.flags|=1024),s}function E(){var i=wl!==0;return wl=0,i}function A(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function I(i){if(bl){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}bl=!1}Ea=0,Pi=mi=Nt=null,ho=!1,m=wl=0,e=null}function D(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pi===null?Nt.memoizedState=Pi=i:Pi=Pi.next=i,Pi}function O(){if(mi===null){var i=Nt.alternate;i=i!==null?i.memoizedState:null}else i=mi.next;var s=Pi===null?Nt.memoizedState:Pi.next;if(s!==null)Pi=s,mi=i;else{if(i===null)throw Nt.alternate===null?Error(U(467)):Error(U(310));mi=i,i={memoizedState:mi.memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},Pi===null?Nt.memoizedState=Pi=i:Pi=Pi.next=i}return Pi}function q(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function K(i){var s=m;return m+=1,e===null&&(e=[]),i=Xt(e,i,s),s=Nt,(Pi===null?s.memoizedState:Pi.next)===null&&(s=s.alternate,Fe.H=s===null||s.memoizedState===null?$h:Xh),i}function W(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return K(i);if(i.$$typeof===Mt)return ia(i)}throw Error(U(438,String(i)))}function Q(i){var s=null,c=Nt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var f=Nt.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(s={data:f.data.map(function(x){return x.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=q(),Nt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),f=0;f<i;f++)c[f]=In;return s.index++,c}function ee(i,s){return typeof s=="function"?s(i):s}function ne(i){var s=O();return ie(s,mi,i)}function ie(i,s,c){var f=i.queue;if(f===null)throw Error(U(311));f.lastRenderedReducer=c;var x=i.baseQueue,S=f.pending;if(S!==null){if(x!==null){var R=x.next;x.next=S.next,S.next=R}s.baseQueue=x=S,f.pending=null}if(S=i.baseState,x===null)i.memoizedState=S;else{s=x.next;var $=R=null,he=null,Ie=s,Ze=!1;do{var Ye=Ie.lane&-536870913;if(Ye!==Ie.lane?(hi&Ye)===Ye:(Ea&Ye)===Ye){var Re=Ie.revertLane;if(Re===0)he!==null&&(he=he.next={lane:0,revertLane:0,gesture:null,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null}),Ye===Sr&&(Ze=!0);else if((Ea&Re)===Re){Ie=Ie.next,Re===Sr&&(Ze=!0);continue}else Ye={lane:0,revertLane:Ie.revertLane,gesture:null,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null},he===null?($=he=Ye,R=S):he=he.next=Ye,Nt.lanes|=Re,$o|=Re;Ye=Ie.action,ts&&c(S,Ye),S=Ie.hasEagerState?Ie.eagerState:c(S,Ye)}else Re={lane:Ye,revertLane:Ie.revertLane,gesture:Ie.gesture,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null},he===null?($=he=Re,R=S):he=he.next=Re,Nt.lanes|=Ye,$o|=Ye;Ie=Ie.next}while(Ie!==null&&Ie!==s);if(he===null?R=S:he.next=$,!ga(S,i.memoizedState)&&(fn=!0,Ze&&(c=Qr,c!==null)))throw c;i.memoizedState=S,i.baseState=R,i.baseQueue=he,f.lastRenderedState=S}return x===null&&(f.lanes=0),[i.memoizedState,f.dispatch]}function ce(i){var s=O(),c=s.queue;if(c===null)throw Error(U(311));c.lastRenderedReducer=i;var f=c.dispatch,x=c.pending,S=s.memoizedState;if(x!==null){c.pending=null;var R=x=x.next;do S=i(S,R.action),R=R.next;while(R!==x);ga(S,s.memoizedState)||(fn=!0),s.memoizedState=S,s.baseQueue===null&&(s.baseState=S),c.lastRenderedState=S}return[S,f]}function de(i,s,c){var f=Nt,x=O(),S=ni;if(S){if(c===void 0)throw Error(U(407));c=c()}else c=s();var R=!ga((mi||x).memoizedState,c);if(R&&(x.memoizedState=c,fn=!0),x=x.queue,is(ze.bind(null,f,x,i),[i]),x.getSnapshot!==s||R||Pi!==null&&Pi.memoizedState.tag&1){if(f.flags|=2048,Ai(9,{destroy:void 0},me.bind(null,f,x,c,s),null),Ki===null)throw Error(U(349));S||(Ea&127)!==0||ae(f,s,c)}return c}function ae(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=Nt.updateQueue,s===null?(s=q(),Nt.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function me(i,s,c,f){s.value=c,s.getSnapshot=f,Ee(s)&&Ae(i)}function ze(i,s,c){return c(function(){Ee(s)&&Ae(i)})}function Ee(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!ga(i,c)}catch{return!0}}function Ae(i){var s=io(i,2);s!==null&&mr(s,i,2)}function Pe(i){var s=D();if(typeof i=="function"){var c=i;if(i=c(),ts){ge(!0);try{c()}finally{ge(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ee,lastRenderedState:i},s}function Je(i,s,c,f){return i.baseState=c,ie(i,mi,typeof f=="function"?f:ee)}function Qe(i,s,c,f,x){if(No(i))throw Error(U(485));if(i=s.action,i!==null){var S={payload:x,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){S.listeners.push(R)}};Fe.T!==null?c(!0):S.isTransition=!1,f(S),c=s.pending,c===null?(S.next=s.pending=S,qe(s,S)):(S.next=c.next,s.pending=c.next=S)}}function qe(i,s){var c=s.action,f=s.payload,x=i.state;if(s.isTransition){var S=Fe.T,R={};Fe.T=R;try{var $=c(x,f),he=Fe.S;he!==null&&he(R,$),lt(i,s,$)}catch(Ie){fi(i,s,Ie)}finally{S!==null&&R.types!==null&&(S.types=R.types),Fe.T=S}}else try{S=c(x,f),lt(i,s,S)}catch(Ie){fi(i,s,Ie)}}function lt(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){Ot(i,s,f)},function(f){return fi(i,s,f)}):Ot(i,s,c)}function Ot(i,s,c){s.status="fulfilled",s.value=c,Ui(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,qe(i,c)))}function fi(i,s,c){var f=i.pending;if(i.pending=null,f!==null){f=f.next;do s.status="rejected",s.reason=c,Ui(s),s=s.next;while(s!==f)}i.action=null}function Ui(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function Di(i,s){return s}function Hi(i,s){if(ni){var c=Ki.formState;if(c!==null){e:{var f=Nt;if(ni){if(Oi){t:{for(var x=Oi,S=ai;x.nodeType!==8;){if(!S){x=null;break t}if(x=zr(x.nextSibling),x===null){x=null;break t}}S=x.data,x=S==="F!"||S==="F"?x:null}if(x){Oi=zr(x.nextSibling),f=x.data==="F!";break e}}On(f)}f=!1}f&&(s=c[0])}}return c=D(),c.memoizedState=c.baseState=s,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Di,lastRenderedState:s},c.queue=f,c=as.bind(null,Nt,f),f.dispatch=c,f=Pe(!1),S=xc.bind(null,Nt,!1,f.queue),f=D(),x={state:s,dispatch:null,action:i,pending:null},f.queue=x,c=Qe.bind(null,Nt,x,S,c),x.dispatch=c,f.memoizedState=i,[s,c,!1]}function ji(i){var s=O();return Fn(s,mi,i)}function Fn(i,s,c){if(s=ie(i,s,Di)[0],i=ne(ee)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var f=K(s)}catch(R){throw R===Cs?Jr:R}else f=s;s=O();var x=s.queue,S=x.dispatch;return c!==s.memoizedState&&(Nt.flags|=2048,Ai(9,{destroy:void 0},$i.bind(null,x,c),null)),[f,S,i]}function $i(i,s){i.action=s}function Si(i){var s=O(),c=mi;if(c!==null)return Fn(s,c,i);O(),s=s.memoizedState,c=O();var f=c.queue.dispatch;return c.memoizedState=i,[s,f,!1]}function Ai(i,s,c,f){return i={tag:i,create:c,deps:f,inst:s,next:null},s=Nt.updateQueue,s===null&&(s=q(),Nt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(f=c.next,c.next=i,i.next=f,s.lastEffect=i),i}function qt(){return O().memoizedState}function Un(i,s,c,f){var x=D();Nt.flags|=i,x.memoizedState=Ai(1|s,{destroy:void 0},c,f===void 0?null:f)}function cr(i,s,c,f){var x=O();f=f===void 0?null:f;var S=x.memoizedState.inst;mi!==null&&f!==null&&d(f,mi.memoizedState.deps)?x.memoizedState=Ai(s,S,c,f):(Nt.flags|=i,x.memoizedState=Ai(1|s,S,c,f))}function fo(i,s){Un(8390656,8,i,s)}function is(i,s){cr(2048,8,i,s)}function jo(i){Nt.flags|=4;var s=Nt.updateQueue;if(s===null)s=q(),Nt.updateQueue=s,s.events=[i];else{var c=s.events;c===null?s.events=[i]:c.push(i)}}function Tl(i){var s=O().memoizedState;return jo({ref:s,nextImpl:i}),function(){if((Mi&2)!==0)throw Error(U(440));return s.impl.apply(void 0,arguments)}}function zs(i,s){return cr(4,2,i,s)}function po(i,s){return cr(4,4,i,s)}function Ga(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function Ps(i,s,c){c=c!=null?c.concat([i]):null,cr(4,4,Ga.bind(null,s,i),c)}function Er(){}function Ds(i,s){var c=O();s=s===void 0?null:s;var f=c.memoizedState;return s!==null&&d(s,f[1])?f[0]:(c.memoizedState=[i,s],i)}function wn(i,s){var c=O();s=s===void 0?null:s;var f=c.memoizedState;if(s!==null&&d(s,f[1]))return f[0];if(f=i(),ts){ge(!0);try{i()}finally{ge(!1)}}return c.memoizedState=[f,s],f}function _n(i,s,c){return c===void 0||(Ea&1073741824)!==0&&(hi&261930)===0?i.memoizedState=s:(i.memoizedState=c,i=hp(),Nt.lanes|=i,$o|=i,c)}function xa(i,s,c,f){return ga(c,s)?c:mt.current!==null?(i=_n(i,c,f),ga(i,s)||(fn=!0),i):(Ea&42)===0||(Ea&1073741824)!==0&&(hi&261930)===0?(fn=!0,i.memoizedState=c):(i=hp(),Nt.lanes|=i,$o|=i,s)}function Ni(i,s,c,f,x){var S=st.p;st.p=S!==0&&8>S?S:8;var R=Fe.T,$={};Fe.T=$,xc(i,!1,s,c);try{var he=x(),Ie=Fe.S;if(Ie!==null&&Ie($,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var Ze=Hc(he,f);mo(i,s,Ze,pr(i))}else mo(i,s,f,pr(i))}catch(Ye){mo(i,s,{then:function(){},status:"rejected",reason:Ye},pr())}finally{st.p=S,R!==null&&$.types!==null&&(R.types=$.types),Fe.T=R}}function Qc(){}function Jc(i,s,c,f){if(i.tag!==5)throw Error(U(476));var x=Yu(i).queue;Ni(i,x,s,Ct,c===null?Qc:function(){return Hh(i),c(f)})}function Yu(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:Ct,baseState:Ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ee,lastRenderedState:Ct},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ee,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Hh(i){var s=Yu(i);s.next===null&&(s=i.alternate.memoizedState),mo(i,s.next.queue,{},pr())}function vc(){return ia(He)}function Sl(){return O().memoizedState}function qa(){return O().memoizedState}function ns(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=pr();i=Mr(c);var f=Cr(s,i,c);f!==null&&(mr(f,s,c),Uo(f,s,c)),s={cache:Ua()},i.payload=s;return}s=s.return}}function ur(i,s,c){var f=pr();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},No(i)?Ml(s,c):(c=Zr(i,s,c,f),c!==null&&(mr(c,i,f),qf(c,s,f)))}function as(i,s,c){var f=pr();mo(i,s,c,f)}function mo(i,s,c,f){var x={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(No(i))Ml(s,x);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=s.lastRenderedReducer,S!==null))try{var R=s.lastRenderedState,$=S(R,c);if(x.hasEagerState=!0,x.eagerState=$,ga($,R))return ys(i,s,x,0),Ki===null&&nc(),!1}catch{}finally{}if(c=Zr(i,s,x,f),c!==null)return mr(c,i,f),qf(c,s,f),!0}return!1}function xc(i,s,c,f){if(f={lane:2,revertLane:xd(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},No(i)){if(s)throw Error(U(479))}else s=Zr(i,c,f,2),s!==null&&mr(s,i,2)}function No(i){var s=i.alternate;return i===Nt||s!==null&&s===Nt}function Ml(i,s){ho=bl=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function qf(i,s,c){if((c&4194048)!==0){var f=s.lanes;f&=i.pendingLanes,c|=f,s.lanes=c,ki(i,c)}}var eu={readContext:ia,use:W,useCallback:l,useContext:l,useEffect:l,useImperativeHandle:l,useLayoutEffect:l,useInsertionEffect:l,useMemo:l,useReducer:l,useRef:l,useState:l,useDebugValue:l,useDeferredValue:l,useTransition:l,useSyncExternalStore:l,useId:l,useHostTransitionStatus:l,useFormState:l,useActionState:l,useOptimistic:l,useMemoCache:l,useCacheRefresh:l};eu.useEffectEvent=l;var $h={readContext:ia,use:W,useCallback:function(i,s){return D().memoizedState=[i,s===void 0?null:s],i},useContext:ia,useEffect:fo,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,Un(4194308,4,Ga.bind(null,s,i),c)},useLayoutEffect:function(i,s){return Un(4194308,4,i,s)},useInsertionEffect:function(i,s){Un(4,2,i,s)},useMemo:function(i,s){var c=D();s=s===void 0?null:s;var f=i();if(ts){ge(!0);try{i()}finally{ge(!1)}}return c.memoizedState=[f,s],f},useReducer:function(i,s,c){var f=D();if(c!==void 0){var x=c(s);if(ts){ge(!0);try{c(s)}finally{ge(!1)}}}else x=s;return f.memoizedState=f.baseState=x,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:x},f.queue=i,i=i.dispatch=ur.bind(null,Nt,i),[f.memoizedState,i]},useRef:function(i){var s=D();return i={current:i},s.memoizedState=i},useState:function(i){i=Pe(i);var s=i.queue,c=as.bind(null,Nt,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:Er,useDeferredValue:function(i,s){var c=D();return _n(c,i,s)},useTransition:function(){var i=Pe(!1);return i=Ni.bind(null,Nt,i.queue,!0,!1),D().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var f=Nt,x=D();if(ni){if(c===void 0)throw Error(U(407));c=c()}else{if(c=s(),Ki===null)throw Error(U(349));(hi&127)!==0||ae(f,s,c)}x.memoizedState=c;var S={value:c,getSnapshot:s};return x.queue=S,fo(ze.bind(null,f,S,i),[i]),f.flags|=2048,Ai(9,{destroy:void 0},me.bind(null,f,S,c,s),null),c},useId:function(){var i=D(),s=Ki.identifierPrefix;if(ni){var c=lr,f=ya;c=(f&~(1<<32-Se(f)-1)).toString(32)+c,s="_"+s+"R_"+c,c=wl++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=r++,s="_"+s+"r_"+c.toString(32)+"_";return i.memoizedState=s},useHostTransitionStatus:vc,useFormState:Hi,useActionState:Hi,useOptimistic:function(i){var s=D();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=xc.bind(null,Nt,!0,c),c.dispatch=s,[i,s]},useMemoCache:Q,useCacheRefresh:function(){return D().memoizedState=ns.bind(null,Nt)},useEffectEvent:function(i){var s=D(),c={impl:i};return s.memoizedState=c,function(){if((Mi&2)!==0)throw Error(U(440));return c.impl.apply(void 0,arguments)}}},Xh={readContext:ia,use:W,useCallback:Ds,useContext:ia,useEffect:is,useImperativeHandle:Ps,useInsertionEffect:zs,useLayoutEffect:po,useMemo:wn,useReducer:ne,useRef:qt,useState:function(){return ne(ee)},useDebugValue:Er,useDeferredValue:function(i,s){var c=O();return xa(c,mi.memoizedState,i,s)},useTransition:function(){var i=ne(ee)[0],s=O().memoizedState;return[typeof i=="boolean"?i:K(i),s]},useSyncExternalStore:de,useId:Sl,useHostTransitionStatus:vc,useFormState:ji,useActionState:ji,useOptimistic:function(i,s){var c=O();return Je(c,mi,i,s)},useMemoCache:Q,useCacheRefresh:qa};Xh.useEffectEvent=Tl;var Cl={readContext:ia,use:W,useCallback:Ds,useContext:ia,useEffect:is,useImperativeHandle:Ps,useInsertionEffect:zs,useLayoutEffect:po,useMemo:wn,useReducer:ce,useRef:qt,useState:function(){return ce(ee)},useDebugValue:Er,useDeferredValue:function(i,s){var c=O();return mi===null?_n(c,i,s):xa(c,mi.memoizedState,i,s)},useTransition:function(){var i=ce(ee)[0],s=O().memoizedState;return[typeof i=="boolean"?i:K(i),s]},useSyncExternalStore:de,useId:Sl,useHostTransitionStatus:vc,useFormState:Si,useActionState:Si,useOptimistic:function(i,s){var c=O();return mi!==null?Je(c,mi,i,s):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:Q,useCacheRefresh:qa};Cl.useEffectEvent=Tl;function Vo(i,s,c,f){s=i.memoizedState,c=c(f,s),c=c==null?s:ke({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Yh={enqueueSetState:function(i,s,c){i=i._reactInternals;var f=pr(),x=Mr(f);x.payload=s,c!=null&&(x.callback=c),s=Cr(i,x,f),s!==null&&(mr(s,i,f),Uo(s,i,f))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var f=pr(),x=Mr(f);x.tag=1,x.payload=s,c!=null&&(x.callback=c),s=Cr(i,x,f),s!==null&&(mr(s,i,f),Uo(s,i,f))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=pr(),f=Mr(c);f.tag=2,s!=null&&(f.callback=s),s=Cr(i,f,c),s!==null&&(mr(s,i,c),Uo(s,i,c))}};function Hf(i,s,c,f,x,S,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,S,R):s.prototype&&s.prototype.isPureReactComponent?!Ka(c,f)||!Ka(x,S):!0}function Kh(i,s,c,f){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,f),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,f),s.state!==i&&Yh.enqueueReplaceState(s,s.state,null)}function El(i,s){var c=s;if("ref"in s){c={};for(var f in s)f!=="ref"&&(c[f]=s[f])}if(i=i.defaultProps){c===s&&(c=ke({},c));for(var x in i)c[x]===void 0&&(c[x]=i[x])}return c}function Ku(i){Io(i)}function Vd(i){console.error(i)}function $f(i){Io(i)}function tu(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(f){setTimeout(function(){throw f})}}function Xf(i,s,c){try{var f=i.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function Wu(i,s,c){return c=Mr(c),c.tag=3,c.payload={element:null},c.callback=function(){tu(i,s)},c}function Zd(i){return i=Mr(i),i.tag=3,i}function Gd(i,s,c,f){var x=c.type.getDerivedStateFromError;if(typeof x=="function"){var S=f.value;i.payload=function(){return x(S)},i.callback=function(){Xf(s,c,f)}}var R=c.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(i.callback=function(){Xf(s,c,f),typeof x!="function"&&(Yo===null?Yo=new Set([this]):Yo.add(this));var $=f.stack;this.componentDidCatch(f.value,{componentStack:$!==null?$:""})})}function iu(i,s,c,f,x){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(s=c.alternate,s!==null&&Hn(s,c,x,!0),c=Va.current,c!==null){switch(c.tag){case 31:case 13:return gn===null?lu():c.alternate===null&&jn===0&&(jn=3),c.flags&=-257,c.flags|=65536,c.lanes=x,f===Es?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([f]):s.add(f),_f(i,f,x)),!1;case 22:return c.flags|=65536,f===Es?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([f]):c.add(f)),_f(i,f,x)),!1}throw Error(U(435,c.tag))}return _f(i,f,x),lu(),!1}if(ni)return s=Va.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=x,f!==xs&&(i=Error(U(422),{cause:f}),ws(Fa(i,c)))):(f!==xs&&(s=Error(U(423),{cause:f}),ws(Fa(s,c))),i=i.current.alternate,i.flags|=65536,x&=-x,i.lanes|=x,f=Fa(f,c),x=Wu(i.stateNode,f,x),gc(i,x),jn!==4&&(jn=2)),!1;var S=Error(U(520),{cause:f});if(S=Fa(S,c),fh===null?fh=[S]:fh.push(S),jn!==4&&(jn=2),s===null)return!0;f=Fa(f,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=x&-x,c.lanes|=i,i=Wu(c.stateNode,f,i),gc(c,i),!1;case 1:if(s=c.type,S=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Yo===null||!Yo.has(S))))return c.flags|=65536,x&=-x,c.lanes|=x,x=Zd(x),Gd(x,i,c,f),gc(c,x),!1}c=c.return}while(c!==null);return!1}var qd=Error(U(461)),fn=!1;function aa(i,s,c,f){s.child=i===null?mc(s,null,c,f):lo(s,i.child,c,f)}function Qu(i,s,c,f,x){c=c.render;var S=s.ref;if("ref"in f){var R={};for(var $ in f)$!=="ref"&&(R[$]=f[$])}else R=f;return Ms(s),f=g(i,s,c,R,S,x),$=E(),i!==null&&!fn?(A(i,s,x),Zo(i,s,x)):(ni&&$&&lc(s),s.flags|=1,aa(i,s,f,x),s.child)}function Yf(i,s,c,f,x){if(i===null){var S=c.type;return typeof S=="function"&&!qr(S)&&S.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=S,Kf(i,s,S,f,x)):(i=ac(c.type,null,f,s,s.mode,x),i.ref=s.ref,i.return=s,s.child=i)}if(S=i.child,!ed(i,x)){var R=S.memoizedProps;if(c=c.compare,c=c!==null?c:Ka,c(R,f)&&i.ref===s.ref)return Zo(i,s,x)}return s.flags|=1,i=Hr(S,f),i.ref=s.ref,i.return=s,s.child=i}function Kf(i,s,c,f,x){if(i!==null){var S=i.memoizedProps;if(Ka(S,f)&&i.ref===s.ref)if(fn=!1,s.pendingProps=f=S,ed(i,x))(i.flags&131072)!==0&&(fn=!0);else return s.lanes=i.lanes,Zo(i,s,x)}return Xd(i,s,c,f,x)}function Wf(i,s,c,f){var x=f.children,S=i!==null?i.memoizedState:null;if(i===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((s.flags&128)!==0){if(S=S!==null?S.baseLanes|c:c,i!==null){for(f=s.child=i.child,x=0;f!==null;)x=x|f.lanes|f.childLanes,f=f.sibling;f=x&~S}else f=0,s.child=null;return Hd(i,s,S,c,f)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&ot(s,S!==null?S.cachePool:null),S!==null?Xu(s,S):xl(),Fi(s);else return f=s.lanes=536870912,Hd(i,s,S!==null?S.baseLanes|c:c,c,f)}else S!==null?(ot(s,S.cachePool),Xu(s,S),Ti(),s.memoizedState=null):(i!==null&&ot(s,null),xl(),Ti());return aa(i,s,x,c),s.child}function Ju(i,s){return i!==null&&i.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Hd(i,s,c,f,x){var S=ja();return S=S===null?null:{parent:dn._currentValue,pool:S},s.memoizedState={baseLanes:c,cachePool:S},i!==null&&ot(s,null),xl(),Fi(s),i!==null&&Hn(i,s,f,!0),s.childLanes=x,null}function nu(i,s){return s=ih({mode:s.mode,children:s.children},i.mode),s.ref=i.ref,i.child=s,s.return=i,s}function $d(i,s,c){return lo(s,i.child,null,c),i=nu(s,s.pendingProps),i.flags|=2,va(s),s.memoizedState=null,i}function Qf(i,s,c){var f=s.pendingProps,x=(s.flags&128)!==0;if(s.flags&=-129,i===null){if(ni){if(f.mode==="hidden")return i=nu(s,f),s.lanes=536870912,Ju(null,i);if(uo(s),(i=Oi)?(i=Pp(i,ai),i=i!==null&&i.data==="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Xr!==null?{id:ya,overflow:lr}:null,retryLane:536870912,hydrationErrors:null},c=sc(i),c.return=s,s.child=c,Bn=s,Oi=null)):i=null,i===null)throw On(s);return s.lanes=536870912,null}return nu(s,f)}var S=i.memoizedState;if(S!==null){var R=S.dehydrated;if(uo(s),x)if(s.flags&256)s.flags&=-257,s=$d(i,s,c);else if(s.memoizedState!==null)s.child=i.child,s.flags|=128,s=null;else throw Error(U(558));else if(fn||Hn(i,s,c,!1),x=(c&i.childLanes)!==0,fn||x){if(f=Ki,f!==null&&(R=mn(f,c),R!==0&&R!==S.retryLane))throw S.retryLane=R,io(i,R),mr(f,i,R),qd;lu(),s=$d(i,s,c)}else i=S.treeContext,Oi=zr(R.nextSibling),Bn=s,ni=!0,Yr=null,ai=!1,i!==null&&Zu(s,i),s=nu(s,f),s.flags|=4096;return s}return i=Hr(i.child,{mode:f.mode,children:f.children}),i.ref=s.ref,s.child=i,i.return=s,i}function Wh(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(U(284));(i===null||i.ref!==c)&&(s.flags|=4194816)}}function Xd(i,s,c,f,x){return Ms(s),c=g(i,s,c,f,void 0,x),f=E(),i!==null&&!fn?(A(i,s,x),Zo(i,s,x)):(ni&&f&&lc(s),s.flags|=1,aa(i,s,c,x),s.child)}function Yd(i,s,c,f,x,S){return Ms(s),s.updateQueue=null,c=w(s,f,c,x),y(i),f=E(),i!==null&&!fn?(A(i,s,S),Zo(i,s,S)):(ni&&f&&lc(s),s.flags|=1,aa(i,s,c,S),s.child)}function Kd(i,s,c,f,x){if(Ms(s),s.stateNode===null){var S=Gr,R=c.contextType;typeof R=="object"&&R!==null&&(S=ia(R)),S=new c(f,S),s.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Yh,s.stateNode=S,S._reactInternals=s,S=s.stateNode,S.props=f,S.state=s.memoizedState,S.refs={},pi(s),R=c.contextType,S.context=typeof R=="object"&&R!==null?ia(R):Gr,S.state=s.memoizedState,R=c.getDerivedStateFromProps,typeof R=="function"&&(Vo(s,c,R,f),S.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(R=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),R!==S.state&&Yh.enqueueReplaceState(S,S.state,null),Na(s,f,S,x),_c(),S.state=s.memoizedState),typeof S.componentDidMount=="function"&&(s.flags|=4194308),f=!0}else if(i===null){S=s.stateNode;var $=s.memoizedProps,he=El(c,$);S.props=he;var Ie=S.context,Ze=c.contextType;R=Gr,typeof Ze=="object"&&Ze!==null&&(R=ia(Ze));var Ye=c.getDerivedStateFromProps;Ze=typeof Ye=="function"||typeof S.getSnapshotBeforeUpdate=="function",$=s.pendingProps!==$,Ze||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||($||Ie!==R)&&Kh(s,S,f,R),Ca=!1;var Re=s.memoizedState;S.state=Re,Na(s,f,S,x),_c(),Ie=s.memoizedState,$||Re!==Ie||Ca?(typeof Ye=="function"&&(Vo(s,c,Ye,f),Ie=s.memoizedState),(he=Ca||Hf(s,c,he,f,Re,Ie,R))?(Ze||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=f,s.memoizedState=Ie),S.props=f,S.state=Ie,S.context=R,f=he):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),f=!1)}else{S=s.stateNode,$u(i,s),R=s.memoizedProps,Ze=El(c,R),S.props=Ze,Ye=s.pendingProps,Re=S.context,Ie=c.contextType,he=Gr,typeof Ie=="object"&&Ie!==null&&(he=ia(Ie)),$=c.getDerivedStateFromProps,(Ie=typeof $=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(R!==Ye||Re!==he)&&Kh(s,S,f,he),Ca=!1,Re=s.memoizedState,S.state=Re,Na(s,f,S,x),_c();var Oe=s.memoizedState;R!==Ye||Re!==Oe||Ca||i!==null&&i.dependencies!==null&&Ss(i.dependencies)?(typeof $=="function"&&(Vo(s,c,$,f),Oe=s.memoizedState),(Ze=Ca||Hf(s,c,Ze,f,Re,Oe,he)||i!==null&&i.dependencies!==null&&Ss(i.dependencies))?(Ie||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(f,Oe,he),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(f,Oe,he)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||R===i.memoizedProps&&Re===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&Re===i.memoizedState||(s.flags|=1024),s.memoizedProps=f,s.memoizedState=Oe),S.props=f,S.state=Oe,S.context=he,f=Ze):(typeof S.componentDidUpdate!="function"||R===i.memoizedProps&&Re===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&Re===i.memoizedState||(s.flags|=1024),f=!1)}return S=f,Wh(i,s),f=(s.flags&128)!==0,S||f?(S=s.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:S.render(),s.flags|=1,i!==null&&f?(s.child=lo(s,i.child,null,x),s.child=lo(s,null,c,x)):aa(i,s,c,x),s.memoizedState=S.state,i=s.child):i=Zo(i,s,x),i}function Jf(i,s,c,f){return Qa(),s.flags|=256,aa(i,s,c,f),s.child}var eh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qh(i){return{baseLanes:i,cachePool:$c()}}function th(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=fr),i}function au(i,s,c){var f=s.pendingProps,x=!1,S=(s.flags&128)!==0,R;if((R=S)||(R=i!==null&&i.memoizedState===null?!1:(Ji.current&2)!==0),R&&(x=!0,s.flags&=-129),R=(s.flags&32)!==0,s.flags&=-33,i===null){if(ni){if(x?Za(s):Ti(),(i=Oi)?(i=Pp(i,ai),i=i!==null&&i.data!=="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Xr!==null?{id:ya,overflow:lr}:null,retryLane:536870912,hydrationErrors:null},c=sc(i),c.return=s,s.child=c,Bn=s,Oi=null)):i=null,i===null)throw On(s);return sa(i)?s.lanes=32:s.lanes=536870912,null}var $=f.children;return f=f.fallback,x?(Ti(),x=s.mode,$=ih({mode:"hidden",children:$},x),f=Ro(f,x,c,null),$.return=s,f.return=s,$.sibling=f,s.child=$,f=s.child,f.memoizedState=Qh(c),f.childLanes=th(i,R,c),s.memoizedState=eh,Ju(null,f)):(Za(s),Aa(s,$))}var he=i.memoizedState;if(he!==null&&($=he.dehydrated,$!==null)){if(S)s.flags&256?(Za(s),s.flags&=-257,s=nh(i,s,c)):s.memoizedState!==null?(Ti(),s.child=i.child,s.flags|=128,s=null):(Ti(),$=f.fallback,x=s.mode,f=ih({mode:"visible",children:f.children},x),$=Ro($,x,c,null),$.flags|=2,f.return=s,$.return=s,f.sibling=$,s.child=f,lo(s,i.child,null,c),f=s.child,f.memoizedState=Qh(c),f.childLanes=th(i,R,c),s.memoizedState=eh,s=Ju(null,f));else if(Za(s),sa($)){if(R=$.nextSibling&&$.nextSibling.dataset,R)var Ie=R.dgst;R=Ie,f=Error(U(419)),f.stack="",f.digest=R,ws({value:f,source:null,stack:null}),s=nh(i,s,c)}else if(fn||Hn(i,s,c,!1),R=(c&i.childLanes)!==0,fn||R){if(R=Ki,R!==null&&(f=mn(R,c),f!==0&&f!==he.retryLane))throw he.retryLane=f,io(i,f),mr(R,i,f),qd;Fl($)||lu(),s=nh(i,s,c)}else Fl($)?(s.flags|=192,s.child=i.child,s=null):(i=he.treeContext,Oi=zr($.nextSibling),Bn=s,ni=!0,Yr=null,ai=!1,i!==null&&Zu(s,i),s=Aa(s,f.children),s.flags|=4096);return s}return x?(Ti(),$=f.fallback,x=s.mode,he=i.child,Ie=he.sibling,f=Hr(he,{mode:"hidden",children:f.children}),f.subtreeFlags=he.subtreeFlags&65011712,Ie!==null?$=Hr(Ie,$):($=Ro($,x,c,null),$.flags|=2),$.return=s,f.return=s,f.sibling=$,s.child=f,Ju(null,f),f=s.child,$=i.child.memoizedState,$===null?$=Qh(c):(x=$.cachePool,x!==null?(he=dn._currentValue,x=x.parent!==he?{parent:he,pool:he}:x):x=$c(),$={baseLanes:$.baseLanes|c,cachePool:x}),f.memoizedState=$,f.childLanes=th(i,R,c),s.memoizedState=eh,Ju(i.child,f)):(Za(s),c=i.child,i=c.sibling,c=Hr(c,{mode:"visible",children:f.children}),c.return=s,c.sibling=null,i!==null&&(R=s.deletions,R===null?(s.deletions=[i],s.flags|=16):R.push(i)),s.child=c,s.memoizedState=null,c)}function Aa(i,s){return s=ih({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function ih(i,s){return i=Oa(22,i,null,s),i.lanes=0,i}function nh(i,s,c){return lo(s,i.child,null,c),i=Aa(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function ep(i,s,c){i.lanes|=s;var f=i.alternate;f!==null&&(f.lanes|=s),so(i.return,s,c)}function Jh(i,s,c,f,x,S){var R=i.memoizedState;R===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:x,treeForkCount:S}:(R.isBackwards=s,R.rendering=null,R.renderingStartTime=0,R.last=f,R.tail=c,R.tailMode=x,R.treeForkCount=S)}function tp(i,s,c){var f=s.pendingProps,x=f.revealOrder,S=f.tail;f=f.children;var R=Ji.current,$=(R&2)!==0;if($?(R=R&1|2,s.flags|=128):R&=1,rt(Ji,R),aa(i,s,f,c),f=ni?vs:0,!$&&i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&ep(i,c,s);else if(i.tag===19)ep(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(x){case"forwards":for(c=s.child,x=null;c!==null;)i=c.alternate,i!==null&&es(i)===null&&(x=c),c=c.sibling;c=x,c===null?(x=s.child,s.child=null):(x=c.sibling,c.sibling=null),Jh(s,!1,x,c,S,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,x=s.child,s.child=null;x!==null;){if(i=x.alternate,i!==null&&es(i)===null){s.child=x;break}i=x.sibling,x.sibling=c,c=x,x=i}Jh(s,!0,c,null,S,f);break;case"together":Jh(s,!1,null,null,void 0,f);break;default:s.memoizedState=null}return s.child}function Zo(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),$o|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(Hn(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(U(153));if(s.child!==null){for(i=s.child,c=Hr(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=Hr(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function ed(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&Ss(i)))}function Op(i,s,c){switch(s.tag){case 3:Ci(s,s.stateNode.containerInfo),Ts(s,dn,i.memoizedState.cache),Qa();break;case 27:case 5:ir(s);break;case 4:Ci(s,s.stateNode.containerInfo);break;case 10:Ts(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,uo(s),null;break;case 13:var f=s.memoizedState;if(f!==null)return f.dehydrated!==null?(Za(s),s.flags|=128,null):(c&s.child.childLanes)!==0?au(i,s,c):(Za(s),i=Zo(i,s,c),i!==null?i.sibling:null);Za(s);break;case 19:var x=(i.flags&128)!==0;if(f=(c&s.childLanes)!==0,f||(Hn(i,s,c,!1),f=(c&s.childLanes)!==0),x){if(f)return tp(i,s,c);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),rt(Ji,Ji.current),f)break;return null;case 22:return s.lanes=0,Wf(i,s,c,s.pendingProps);case 24:Ts(s,dn,i.memoizedState.cache)}return Zo(i,s,c)}function td(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)fn=!0;else{if(!ed(i,c)&&(s.flags&128)===0)return fn=!1,Op(i,s,c);fn=(i.flags&131072)!==0}else fn=!1,ni&&(s.flags&1048576)!==0&&oc(s,vs,s.index);switch(s.lanes=0,s.tag){case 16:e:{var f=s.pendingProps;if(i=As(s.elementType),s.type=i,typeof i=="function")qr(i)?(f=El(i,f),s.tag=1,s=Kd(null,s,i,f,c)):(s.tag=0,s=Xd(null,s,i,f,c));else{if(i!=null){var x=i.$$typeof;if(x===Jt){s.tag=11,s=Qu(null,s,i,f,c);break e}else if(x===Dt){s.tag=14,s=Yf(null,s,i,f,c);break e}}throw s=wa(i)||i,Error(U(306,s,""))}}return s;case 0:return Xd(i,s,s.type,s.pendingProps,c);case 1:return f=s.type,x=El(f,s.pendingProps),Kd(i,s,f,x,c);case 3:e:{if(Ci(s,s.stateNode.containerInfo),i===null)throw Error(U(387));f=s.pendingProps;var S=s.memoizedState;x=S.element,$u(i,s),Na(s,f,null,c);var R=s.memoizedState;if(f=R.cache,Ts(s,dn,f),f!==S.cache&&Ja(s,[dn],c,!0),_c(),f=R.element,S.isDehydrated)if(S={element:f,isDehydrated:!1,cache:R.cache},s.updateQueue.baseState=S,s.memoizedState=S,s.flags&256){s=Jf(i,s,f,c);break e}else if(f!==x){x=Fa(Error(U(424)),s),ws(x),s=Jf(i,s,f,c);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Oi=zr(i.firstChild),Bn=s,ni=!0,Yr=null,ai=!0,c=mc(s,null,f,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Qa(),f===x){s=Zo(i,s,c);break e}aa(i,s,f,c)}s=s.child}return s;case 26:return Wh(i,s),i===null?(c=a(s.type,null,s.pendingProps,null))?s.memoizedState=c:ni||(c=s.type,i=s.pendingProps,f=Th(At.current).createElement(c),f[Xe]=s,f[bt]=i,Tn(f,c,i),vn(f),s.stateNode=f):s.memoizedState=a(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return ir(s),i===null&&ni&&(f=s.stateNode=Rf(s.type,s.pendingProps,At.current),Bn=s,ai=!0,x=Oi,Wo(s.type)?(Ad=x,Oi=zr(f.firstChild)):Oi=x),aa(i,s,s.pendingProps.children,c),Wh(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&ni&&((x=f=Oi)&&(f=Yp(f,s.type,s.pendingProps,ai),f!==null?(s.stateNode=f,Bn=s,Oi=zr(f.firstChild),ai=!1,x=!0):x=!1),x||On(s)),ir(s),x=s.type,S=s.pendingProps,R=i!==null?i.memoizedProps:null,f=S.children,Md(x,S)?f=null:R!==null&&Md(x,R)&&(s.flags|=32),s.memoizedState!==null&&(x=g(i,s,T,null,null,c),He._currentValue=x),Wh(i,s),aa(i,s,f,c),s.child;case 6:return i===null&&ni&&((i=c=Oi)&&(c=Kp(c,s.pendingProps,ai),c!==null?(s.stateNode=c,Bn=s,Oi=null,i=!0):i=!1),i||On(s)),null;case 13:return au(i,s,c);case 4:return Ci(s,s.stateNode.containerInfo),f=s.pendingProps,i===null?s.child=lo(s,null,f,c):aa(i,s,f,c),s.child;case 11:return Qu(i,s,s.type,s.pendingProps,c);case 7:return aa(i,s,s.pendingProps,c),s.child;case 8:return aa(i,s,s.pendingProps.children,c),s.child;case 12:return aa(i,s,s.pendingProps.children,c),s.child;case 10:return f=s.pendingProps,Ts(s,s.type,f.value),aa(i,s,f.children,c),s.child;case 9:return x=s.type._context,f=s.pendingProps.children,Ms(s),x=ia(x),f=f(x),s.flags|=1,aa(i,s,f,c),s.child;case 14:return Yf(i,s,s.type,s.pendingProps,c);case 15:return Kf(i,s,s.type,s.pendingProps,c);case 19:return tp(i,s,c);case 31:return Qf(i,s,c);case 22:return Wf(i,s,c,s.pendingProps);case 24:return Ms(s),f=ia(dn),i===null?(x=ja(),x===null&&(x=Ki,S=Ua(),x.pooledCache=S,S.refCount++,S!==null&&(x.pooledCacheLanes|=c),x=S),s.memoizedState={parent:f,cache:x},pi(s),Ts(s,dn,x)):((i.lanes&c)!==0&&($u(i,s),Na(s,null,null,c),_c()),x=i.memoizedState,S=s.memoizedState,x.parent!==f?(x={parent:f,cache:f},s.memoizedState=x,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=x),Ts(s,dn,f)):(f=S.cache,Ts(s,dn,f),f!==x.cache&&Ja(s,[dn],c,!0))),aa(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(U(156,s.tag))}function go(i){i.flags|=4}function id(i,s,c,f,x){if((s=(i.mode&32)!==0)&&(s=!1),s){if(i.flags|=16777216,(x&335544128)===x)if(i.stateNode.complete)i.flags|=8192;else if(mp())i.flags|=8192;else throw oo=Es,fc}else i.flags&=-16777217}function ip(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!H(s))if(mp())i.flags|=8192;else throw oo=Es,fc}function nd(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Li():536870912,i.lanes|=s,Tc|=s)}function ah(i,s){if(!ni)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Xi(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,f=0;if(s)for(var x=i.child;x!==null;)c|=x.lanes|x.childLanes,f|=x.subtreeFlags&65011712,f|=x.flags&65011712,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)c|=x.lanes|x.childLanes,f|=x.subtreeFlags,f|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=f,i.childLanes=c,s}function Wd(i,s,c){var f=s.pendingProps;switch(Zc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xi(s),null;case 1:return Xi(s),null;case 3:return c=s.stateNode,f=null,i!==null&&(f=i.memoizedState.cache),s.memoizedState.cache!==f&&(s.flags|=2048),Wr(dn),ui(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(ao(s)?go(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,bs())),Xi(s),null;case 26:var x=s.type,S=s.memoizedState;return i===null?(go(s),S!==null?(Xi(s),ip(s,S)):(Xi(s),id(s,x,null,f,c))):S?S!==i.memoizedState?(go(s),Xi(s),ip(s,S)):(Xi(s),s.flags&=-16777217):(i=i.memoizedProps,i!==f&&go(s),Xi(s),id(s,x,i,f,c)),null;case 27:if(nr(s),c=At.current,x=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==f&&go(s);else{if(!f){if(s.stateNode===null)throw Error(U(166));return Xi(s),null}i=ut.current,ao(s)?cc(s):(i=Rf(x,f,c),s.stateNode=i,go(s))}return Xi(s),null;case 5:if(nr(s),x=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==f&&go(s);else{if(!f){if(s.stateNode===null)throw Error(U(166));return Xi(s),null}if(S=ut.current,ao(s))cc(s);else{var R=Th(At.current);switch(S){case 1:S=R.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:S=R.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":S=R.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":S=R.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":S=R.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof f.is=="string"?R.createElement("select",{is:f.is}):R.createElement("select"),f.multiple?S.multiple=!0:f.size&&(S.size=f.size);break;default:S=typeof f.is=="string"?R.createElement(x,{is:f.is}):R.createElement(x)}}S[Xe]=s,S[bt]=f;e:for(R=s.child;R!==null;){if(R.tag===5||R.tag===6)S.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===s)break e;for(;R.sibling===null;){if(R.return===null||R.return===s)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}s.stateNode=S;e:switch(Tn(S,x,f),x){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&go(s)}}return Xi(s),id(s,s.type,i===null?null:i.memoizedProps,s.pendingProps,c),null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==f&&go(s);else{if(typeof f!="string"&&s.stateNode===null)throw Error(U(166));if(i=At.current,ao(s)){if(i=s.stateNode,c=s.memoizedProps,f=null,x=Bn,x!==null)switch(x.tag){case 27:case 5:f=x.memoizedProps}i[Xe]=s,i=!!(i.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||gr(i.nodeValue,c)),i||On(s,!0)}else i=Th(i).createTextNode(f),i[Xe]=s,s.stateNode=i}return Xi(s),null;case 31:if(c=s.memoizedState,i===null||i.memoizedState!==null){if(f=ao(s),c!==null){if(i===null){if(!f)throw Error(U(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(557));i[Xe]=s}else Qa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Xi(s),i=!1}else c=bs(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=c),i=!0;if(!i)return s.flags&256?(va(s),s):(va(s),null);if((s.flags&128)!==0)throw Error(U(558))}return Xi(s),null;case 13:if(f=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(x=ao(s),f!==null&&f.dehydrated!==null){if(i===null){if(!x)throw Error(U(318));if(x=s.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(U(317));x[Xe]=s}else Qa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Xi(s),x=!1}else x=bs(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=x),x=!0;if(!x)return s.flags&256?(va(s),s):(va(s),null)}return va(s),(s.flags&128)!==0?(s.lanes=c,s):(c=f!==null,i=i!==null&&i.memoizedState!==null,c&&(f=s.child,x=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(x=f.alternate.memoizedState.cachePool.pool),S=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(S=f.memoizedState.cachePool.pool),S!==x&&(f.flags|=2048)),c!==i&&c&&(s.child.flags|=8192),nd(s,s.updateQueue),Xi(s),null);case 4:return ui(),i===null&&wd(s.stateNode.containerInfo),Xi(s),null;case 10:return Wr(s.type),Xi(s),null;case 19:if(Ge(Ji),f=s.memoizedState,f===null)return Xi(s),null;if(x=(s.flags&128)!==0,S=f.rendering,S===null)if(x)ah(f,!1);else{if(jn!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(S=es(i),S!==null){for(s.flags|=128,ah(f,!1),i=S.updateQueue,s.updateQueue=i,nd(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)Gh(c,i),c=c.sibling;return rt(Ji,Ji.current&1|2),ni&&Wa(s,f.treeForkCount),s.child}i=i.sibling}f.tail!==null&&Nn()>hd&&(s.flags|=128,x=!0,ah(f,!1),s.lanes=4194304)}else{if(!x)if(i=es(S),i!==null){if(s.flags|=128,x=!0,i=i.updateQueue,s.updateQueue=i,nd(s,i),ah(f,!0),f.tail===null&&f.tailMode==="hidden"&&!S.alternate&&!ni)return Xi(s),null}else 2*Nn()-f.renderingStartTime>hd&&c!==536870912&&(s.flags|=128,x=!0,ah(f,!1),s.lanes=4194304);f.isBackwards?(S.sibling=s.child,s.child=S):(i=f.last,i!==null?i.sibling=S:s.child=S,f.last=S)}return f.tail!==null?(i=f.tail,f.rendering=i,f.tail=i.sibling,f.renderingStartTime=Nn(),i.sibling=null,c=Ji.current,rt(Ji,x?c&1|2:c&1),ni&&Wa(s,f.treeForkCount),i):(Xi(s),null);case 22:case 23:return va(s),na(),f=s.memoizedState!==null,i!==null?i.memoizedState!==null!==f&&(s.flags|=8192):f&&(s.flags|=8192),f?(c&536870912)!==0&&(s.flags&128)===0&&(Xi(s),s.subtreeFlags&6&&(s.flags|=8192)):Xi(s),c=s.updateQueue,c!==null&&nd(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),f=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(f=s.memoizedState.cachePool.pool),f!==c&&(s.flags|=2048),i!==null&&Ge(tr),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Wr(dn),Xi(s),null;case 25:return null;case 30:return null}throw Error(U(156,s.tag))}function np(i,s){switch(Zc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Wr(dn),ui(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return nr(s),null;case 31:if(s.memoizedState!==null){if(va(s),s.alternate===null)throw Error(U(340));Qa()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 13:if(va(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(U(340));Qa()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Ge(Ji),null;case 4:return ui(),null;case 10:return Wr(s.type),null;case 22:case 23:return va(s),na(),i!==null&&Ge(tr),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Wr(dn),null;case 25:return null;default:return null}}function Al(i,s){switch(Zc(s),s.tag){case 3:Wr(dn),ui();break;case 26:case 27:case 5:nr(s);break;case 4:ui();break;case 31:s.memoizedState!==null&&va(s);break;case 13:va(s);break;case 19:Ge(Ji);break;case 10:Wr(s.type);break;case 22:case 23:va(s),na(),i!==null&&Ge(tr);break;case 24:Wr(dn)}}function Go(i,s){try{var c=s.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var x=f.next;c=x;do{if((c.tag&i)===i){f=void 0;var S=c.create,R=c.inst;f=S(),R.destroy=f}c=c.next}while(c!==x)}}catch($){Vi(s,s.return,$)}}function zl(i,s,c){try{var f=s.updateQueue,x=f!==null?f.lastEffect:null;if(x!==null){var S=x.next;f=S;do{if((f.tag&i)===i){var R=f.inst,$=R.destroy;if($!==void 0){R.destroy=void 0,x=s;var he=c,Ie=$;try{Ie()}catch(Ze){Vi(x,he,Ze)}}}f=f.next}while(f!==S)}}catch(Ze){Vi(s,s.return,Ze)}}function ap(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{dt(s,c)}catch(f){Vi(i,i.return,f)}}}function rp(i,s,c){c.props=El(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(f){Vi(i,s,f)}}function rh(i,s){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var f=i.stateNode;break;case 30:f=i.stateNode;break;default:f=i.stateNode}typeof c=="function"?i.refCleanup=c(f):c.current=f}}catch(x){Vi(i,s,x)}}function _o(i,s){var c=i.ref,f=i.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(x){Vi(i,s,x)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(x){Vi(i,s,x)}else c.current=null}function sp(i){var s=i.type,c=i.memoizedProps,f=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(x){Vi(i,i.return,x)}}function Qd(i,s,c){try{var f=i.stateNode;Mp(f,i.type,c,s),f[bt]=s}catch(x){Vi(i,i.return,x)}}function ad(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Wo(i.type)||i.tag===4}function Jd(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||ad(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Wo(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function rd(i,s,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(i),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=sr));else if(f!==4&&(f===27&&Wo(i.type)&&(c=i.stateNode,s=null),i=i.child,i!==null))for(rd(i,s,c),i=i.sibling;i!==null;)rd(i,s,c),i=i.sibling}function Pl(i,s,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(f!==4&&(f===27&&Wo(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(Pl(i,s,c),i=i.sibling;i!==null;)Pl(i,s,c),i=i.sibling}function op(i){var s=i.stateNode,c=i.memoizedProps;try{for(var f=i.type,x=s.attributes;x.length;)s.removeAttributeNode(x[0]);Tn(s,f,c),s[Xe]=i,s[bt]=c}catch(S){Vi(i,i.return,S)}}var zi=!1,pn=!1,sd=!1,sh=typeof WeakSet=="function"?WeakSet:Set,Xn=null;function oh(i,s){if(i=i.containerInfo,Sd=zt,i=Fu(i),Wl(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var x=f.anchorOffset,S=f.focusNode;f=f.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var R=0,$=-1,he=-1,Ie=0,Ze=0,Ye=i,Re=null;t:for(;;){for(var Oe;Ye!==c||x!==0&&Ye.nodeType!==3||($=R+x),Ye!==S||f!==0&&Ye.nodeType!==3||(he=R+f),Ye.nodeType===3&&(R+=Ye.nodeValue.length),(Oe=Ye.firstChild)!==null;)Re=Ye,Ye=Oe;for(;;){if(Ye===i)break t;if(Re===c&&++Ie===x&&($=R),Re===S&&++Ze===f&&(he=R),(Oe=Ye.nextSibling)!==null)break;Ye=Re,Re=Ye.parentNode}Ye=Oe}c=$===-1||he===-1?null:{start:$,end:he}}else c=null}c=c||{start:0,end:0}}else c=null;for(zf={focusedElem:i,selectionRange:c},zt=!1,Xn=s;Xn!==null;)if(s=Xn,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Xn=i;else for(;Xn!==null;){switch(s=Xn,S=s.alternate,i=s.flags,s.tag){case 0:if((i&4)!==0&&(i=s.updateQueue,i=i!==null?i.events:null,i!==null))for(c=0;c<i.length;c++)x=i[c],x.ref.impl=x.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&S!==null){i=void 0,c=s,x=S.memoizedProps,S=S.memoizedState,f=c.stateNode;try{var vt=El(c.type,x);i=f.getSnapshotBeforeUpdate(vt,S),f.__reactInternalSnapshotBeforeUpdate=i}catch(Lt){Vi(c,c.return,Lt)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)gu(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":gu(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(U(163))}if(i=s.sibling,i!==null){i.return=s.return,Xn=i;break}Xn=s.return}}function ef(i,s,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:yo(i,c),f&4&&Go(5,c);break;case 1:if(yo(i,c),f&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(R){Vi(c,c.return,R)}else{var x=El(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(x,s,i.__reactInternalSnapshotBeforeUpdate)}catch(R){Vi(c,c.return,R)}}f&64&&ap(c),f&512&&rh(c,c.return);break;case 3:if(yo(i,c),f&64&&(i=c.updateQueue,i!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{dt(i,s)}catch(R){Vi(c,c.return,R)}}break;case 27:s===null&&f&4&&op(c);case 26:case 5:yo(i,c),s===null&&f&4&&sp(c),f&512&&rh(c,c.return);break;case 12:yo(i,c);break;case 31:yo(i,c),f&4&&bc(i,c);break;case 13:yo(i,c),f&4&&ru(i,c),f&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=Zp.bind(null,c),If(i,c))));break;case 22:if(f=c.memoizedState!==null||zi,!f){s=s!==null&&s.memoizedState!==null||pn,x=zi;var S=pn;zi=f,(pn=s)&&!S?qo(i,c,(c.subtreeFlags&8772)!==0):yo(i,c),zi=x,pn=S}break;case 30:break;default:yo(i,c)}}function tf(i){var s=i.alternate;s!==null&&(i.alternate=null,tf(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&Ir(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Yi=null,Ha=!1;function hr(i,s,c){for(c=c.child;c!==null;)lh(i,s,c),c=c.sibling}function lh(i,s,c){if(le&&typeof le.onCommitFiberUnmount=="function")try{le.onCommitFiberUnmount(re,c)}catch{}switch(c.tag){case 26:pn||_o(c,s),hr(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:pn||_o(c,s);var f=Yi,x=Ha;Wo(c.type)&&(Yi=c.stateNode,Ha=!1),hr(i,s,c),_u(c.stateNode),Yi=f,Ha=x;break;case 5:pn||_o(c,s);case 6:if(f=Yi,x=Ha,Yi=null,hr(i,s,c),Yi=f,Ha=x,Yi!==null)if(Ha)try{(Yi.nodeType===9?Yi.body:Yi.nodeName==="HTML"?Yi.ownerDocument.body:Yi).removeChild(c.stateNode)}catch(S){Vi(c,s,S)}else try{Yi.removeChild(c.stateNode)}catch(S){Vi(c,s,S)}break;case 18:Yi!==null&&(Ha?(i=Yi,Sh(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),vu(i)):Sh(Yi,c.stateNode));break;case 4:f=Yi,x=Ha,Yi=c.stateNode.containerInfo,Ha=!0,hr(i,s,c),Yi=f,Ha=x;break;case 0:case 11:case 14:case 15:zl(2,c,s),pn||zl(4,c,s),hr(i,s,c);break;case 1:pn||(_o(c,s),f=c.stateNode,typeof f.componentWillUnmount=="function"&&rp(c,s,f)),hr(i,s,c);break;case 21:hr(i,s,c);break;case 22:pn=(f=pn)||c.memoizedState!==null,hr(i,s,c),pn=f;break;default:hr(i,s,c)}}function bc(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{vu(i)}catch(c){Vi(s,s.return,c)}}}function ru(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{vu(i)}catch(c){Vi(s,s.return,c)}}function Fp(i){switch(i.tag){case 31:case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new sh),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new sh),s;default:throw Error(U(435,i.tag))}}function ch(i,s){var c=Fp(i);s.forEach(function(f){if(!c.has(f)){c.add(f);var x=xp.bind(null,i,f);f.then(x,x)}})}function ra(i,s){var c=s.deletions;if(c!==null)for(var f=0;f<c.length;f++){var x=c[f],S=i,R=s,$=R;e:for(;$!==null;){switch($.tag){case 27:if(Wo($.type)){Yi=$.stateNode,Ha=!1;break e}break;case 5:Yi=$.stateNode,Ha=!1;break e;case 3:case 4:Yi=$.stateNode.containerInfo,Ha=!0;break e}$=$.return}if(Yi===null)throw Error(U(160));lh(S,R,x),Yi=null,Ha=!1,S=x.alternate,S!==null&&(S.return=null),x.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)nf(s,i),s=s.sibling}var Is=null;function nf(i,s){var c=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:ra(s,i),ba(i),f&4&&(zl(3,i,i.return),Go(3,i),zl(5,i,i.return));break;case 1:ra(s,i),ba(i),f&512&&(pn||c===null||_o(c,c.return)),f&64&&zi&&(i=i.updateQueue,i!==null&&(f=i.callbacks,f!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var x=Is;if(ra(s,i),ba(i),f&512&&(pn||c===null||_o(c,c.return)),f&4){var S=c!==null?c.memoizedState:null;if(f=i.memoizedState,c===null)if(f===null)if(i.stateNode===null){e:{f=i.type,c=i.memoizedProps,x=x.ownerDocument||x;t:switch(f){case"title":S=x.getElementsByTagName("title")[0],(!S||S[qs]||S[Xe]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=x.createElement(f),x.head.insertBefore(S,x.querySelector("head > title"))),Tn(S,f,c),S[Xe]=i,vn(S),f=S;break e;case"link":var R=k("link","href",x).get(f+(c.href||""));if(R){for(var $=0;$<R.length;$++)if(S=R[$],S.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&S.getAttribute("rel")===(c.rel==null?null:c.rel)&&S.getAttribute("title")===(c.title==null?null:c.title)&&S.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){R.splice($,1);break t}}S=x.createElement(f),Tn(S,f,c),x.head.appendChild(S);break;case"meta":if(R=k("meta","content",x).get(f+(c.content||""))){for($=0;$<R.length;$++)if(S=R[$],S.getAttribute("content")===(c.content==null?null:""+c.content)&&S.getAttribute("name")===(c.name==null?null:c.name)&&S.getAttribute("property")===(c.property==null?null:c.property)&&S.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&S.getAttribute("charset")===(c.charSet==null?null:c.charSet)){R.splice($,1);break t}}S=x.createElement(f),Tn(S,f,c),x.head.appendChild(S);break;default:throw Error(U(468,f))}S[Xe]=i,vn(S),f=S}i.stateNode=f}else F(x,i.type,i.stateNode);else i.stateNode=v(x,f,i.memoizedProps);else S!==f?(S===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):S.count--,f===null?F(x,i.type,i.stateNode):v(x,f,i.memoizedProps)):f===null&&i.stateNode!==null&&Qd(i,i.memoizedProps,c.memoizedProps)}break;case 27:ra(s,i),ba(i),f&512&&(pn||c===null||_o(c,c.return)),c!==null&&f&4&&Qd(i,i.memoizedProps,c.memoizedProps);break;case 5:if(ra(s,i),ba(i),f&512&&(pn||c===null||_o(c,c.return)),i.flags&32){x=i.stateNode;try{fa(x,"")}catch(vt){Vi(i,i.return,vt)}}f&4&&i.stateNode!=null&&(x=i.memoizedProps,Qd(i,x,c!==null?c.memoizedProps:x)),f&1024&&(sd=!0);break;case 6:if(ra(s,i),ba(i),f&4){if(i.stateNode===null)throw Error(U(162));f=i.memoizedProps,c=i.stateNode;try{c.nodeValue=f}catch(vt){Vi(i,i.return,vt)}}break;case 3:if(P=null,x=Is,Is=yu(s.containerInfo),ra(s,i),Is=x,ba(i),f&4&&c!==null&&c.memoizedState.isDehydrated)try{vu(s.containerInfo)}catch(vt){Vi(i,i.return,vt)}sd&&(sd=!1,od(i));break;case 4:f=Is,Is=yu(i.stateNode.containerInfo),ra(s,i),ba(i),Is=f;break;case 12:ra(s,i),ba(i);break;case 31:ra(s,i),ba(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,ch(i,f)));break;case 13:ra(s,i),ba(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(ph=Nn()),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,ch(i,f)));break;case 22:x=i.memoizedState!==null;var he=c!==null&&c.memoizedState!==null,Ie=zi,Ze=pn;if(zi=Ie||x,pn=Ze||he,ra(s,i),pn=Ze,zi=Ie,ba(i),f&8192)e:for(s=i.stateNode,s._visibility=x?s._visibility&-2:s._visibility|1,x&&(c===null||he||zi||pn||Dl(i)),c=null,s=i;;){if(s.tag===5||s.tag===26){if(c===null){he=c=s;try{if(S=he.stateNode,x)R=S.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{$=he.stateNode;var Ye=he.memoizedProps.style,Re=Ye!=null&&Ye.hasOwnProperty("display")?Ye.display:null;$.style.display=Re==null||typeof Re=="boolean"?"":(""+Re).trim()}}catch(vt){Vi(he,he.return,vt)}}}else if(s.tag===6){if(c===null){he=s;try{he.stateNode.nodeValue=x?"":he.memoizedProps}catch(vt){Vi(he,he.return,vt)}}}else if(s.tag===18){if(c===null){he=s;try{var Oe=he.stateNode;x?Mh(Oe,!0):Mh(he.stateNode,!1)}catch(vt){Vi(he,he.return,vt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}f&4&&(f=i.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,ch(i,c))));break;case 19:ra(s,i),ba(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,ch(i,f)));break;case 30:break;case 21:break;default:ra(s,i),ba(i)}}function ba(i){var s=i.flags;if(s&2){try{for(var c,f=i.return;f!==null;){if(ad(f)){c=f;break}f=f.return}if(c==null)throw Error(U(160));switch(c.tag){case 27:var x=c.stateNode,S=Jd(i);Pl(i,S,x);break;case 5:var R=c.stateNode;c.flags&32&&(fa(R,""),c.flags&=-33);var $=Jd(i);Pl(i,$,R);break;case 3:case 4:var he=c.stateNode.containerInfo,Ie=Jd(i);rd(i,Ie,he);break;default:throw Error(U(161))}}catch(Ze){Vi(i,i.return,Ze)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function od(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;od(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function yo(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)ef(i,s.alternate,s),s=s.sibling}function Dl(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:zl(4,s,s.return),Dl(s);break;case 1:_o(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&rp(s,s.return,c),Dl(s);break;case 27:_u(s.stateNode);case 26:case 5:_o(s,s.return),Dl(s);break;case 22:s.memoizedState===null&&Dl(s);break;case 30:Dl(s);break;default:Dl(s)}i=i.sibling}}function qo(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var f=s.alternate,x=i,S=s,R=S.flags;switch(S.tag){case 0:case 11:case 15:qo(x,S,c),Go(4,S);break;case 1:if(qo(x,S,c),f=S,x=f.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(Ie){Vi(f,f.return,Ie)}if(f=S,x=f.updateQueue,x!==null){var $=f.stateNode;try{var he=x.shared.hiddenCallbacks;if(he!==null)for(x.shared.hiddenCallbacks=null,x=0;x<he.length;x++)yc(he[x],$)}catch(Ie){Vi(f,f.return,Ie)}}c&&R&64&&ap(S),rh(S,S.return);break;case 27:op(S);case 26:case 5:qo(x,S,c),c&&f===null&&R&4&&sp(S),rh(S,S.return);break;case 12:qo(x,S,c);break;case 31:qo(x,S,c),c&&R&4&&bc(x,S);break;case 13:qo(x,S,c),c&&R&4&&ru(x,S);break;case 22:S.memoizedState===null&&qo(x,S,c),rh(S,S.return);break;case 30:break;default:qo(x,S,c)}s=s.sibling}}function af(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&$n(c))}function rf(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&$n(i))}function Rs(i,s,c,f){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)lp(i,s,c,f),s=s.sibling}function lp(i,s,c,f){var x=s.flags;switch(s.tag){case 0:case 11:case 15:Rs(i,s,c,f),x&2048&&Go(9,s);break;case 1:Rs(i,s,c,f);break;case 3:Rs(i,s,c,f),x&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&$n(i)));break;case 12:if(x&2048){Rs(i,s,c,f),i=s.stateNode;try{var S=s.memoizedProps,R=S.id,$=S.onPostCommit;typeof $=="function"&&$(R,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(he){Vi(s,s.return,he)}}else Rs(i,s,c,f);break;case 31:Rs(i,s,c,f);break;case 13:Rs(i,s,c,f);break;case 23:break;case 22:S=s.stateNode,R=s.alternate,s.memoizedState!==null?S._visibility&2?Rs(i,s,c,f):uh(i,s):S._visibility&2?Rs(i,s,c,f):(S._visibility|=2,Ls(i,s,c,f,(s.subtreeFlags&10256)!==0||!1)),x&2048&&af(R,s);break;case 24:Rs(i,s,c,f),x&2048&&rf(s.alternate,s);break;default:Rs(i,s,c,f)}}function Ls(i,s,c,f,x){for(x=x&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var S=i,R=s,$=c,he=f,Ie=R.flags;switch(R.tag){case 0:case 11:case 15:Ls(S,R,$,he,x),Go(8,R);break;case 23:break;case 22:var Ze=R.stateNode;R.memoizedState!==null?Ze._visibility&2?Ls(S,R,$,he,x):uh(S,R):(Ze._visibility|=2,Ls(S,R,$,he,x)),x&&Ie&2048&&af(R.alternate,R);break;case 24:Ls(S,R,$,he,x),x&&Ie&2048&&rf(R.alternate,R);break;default:Ls(S,R,$,he,x)}s=s.sibling}}function uh(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,f=s,x=f.flags;switch(f.tag){case 22:uh(c,f),x&2048&&af(f.alternate,f);break;case 24:uh(c,f),x&2048&&rf(f.alternate,f);break;default:uh(c,f)}s=s.sibling}}var hh=8192;function wc(i,s,c){if(i.subtreeFlags&hh)for(i=i.child;i!==null;)cp(i,s,c),i=i.sibling}function cp(i,s,c){switch(i.tag){case 26:wc(i,s,c),i.flags&hh&&i.memoizedState!==null&&Y(c,Is,i.memoizedState,i.memoizedProps);break;case 5:wc(i,s,c);break;case 3:case 4:var f=Is;Is=yu(i.stateNode.containerInfo),wc(i,s,c),Is=f;break;case 22:i.memoizedState===null&&(f=i.alternate,f!==null&&f.memoizedState!==null?(f=hh,hh=16777216,wc(i,s,c),hh=f):wc(i,s,c));break;default:wc(i,s,c)}}function sf(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function dh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];Xn=f,cd(f,i)}sf(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)ld(i),i=i.sibling}function ld(i){switch(i.tag){case 0:case 11:case 15:dh(i),i.flags&2048&&zl(9,i,i.return);break;case 3:dh(i);break;case 12:dh(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,Il(i)):dh(i);break;default:dh(i)}}function Il(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];Xn=f,cd(f,i)}sf(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:zl(8,s,s.return),Il(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,Il(s));break;default:Il(s)}i=i.sibling}}function cd(i,s){for(;Xn!==null;){var c=Xn;switch(c.tag){case 0:case 11:case 15:zl(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:$n(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Xn=f;else e:for(c=i;Xn!==null;){f=Xn;var x=f.sibling,S=f.return;if(tf(f),f===c){Xn=null;break e}if(x!==null){x.return=S,Xn=x;break e}Xn=S}}}var Up={getCacheForType:function(i){var s=ia(dn),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c},cacheSignal:function(){return ia(dn).controller.signal}},jp=typeof WeakMap=="function"?WeakMap:Map,Mi=0,Ki=null,ci=null,hi=0,gi=0,dr=null,Rl=!1,su=!1,of=!1,Ho=0,jn=0,$o=0,Xo=0,ud=0,fr=0,Tc=0,fh=null,za=null,lf=!1,ph=0,up=0,hd=1/0,dd=null,Yo=null,ua=0,Ll=null,vo=null,Wi=0,mh=0,fd=null,cf=null,Sc=0,kl=null;function pr(){return(Mi&2)!==0&&hi!==0?hi&-hi:Fe.T!==null?xd():Ia()}function hp(){if(fr===0)if((hi&536870912)===0||ni){var i=ct;ct<<=1,(ct&3932160)===0&&(ct=262144),fr=i}else fr=536870912;return i=Va.current,i!==null&&(i.flags|=32),fr}function mr(i,s,c){(i===Ki&&(gi===2||gi===9)||i.cancelPendingCommit!==null)&&(ou(i,0),Bl(i,hi,fr,!1)),on(i,c),((Mi&2)===0||i!==Ki)&&(i===Ki&&((Mi&2)===0&&(Xo|=c),jn===4&&Bl(i,hi,fr,!1)),ss(i))}function dp(i,s,c){if((Mi&6)!==0)throw Error(U(327));var f=!c&&(s&127)===0&&(s&i.expiredLanes)===0||pt(i,s),x=f?gh(i,s):md(i,s,!0),S=f;do{if(x===0){su&&!f&&Bl(i,s,0,!1);break}else{if(c=i.current.alternate,S&&!Np(c)){x=md(i,s,!1),S=!1;continue}if(x===2){if(S=s,i.errorRecoveryDisabledLanes&S)var R=0;else R=i.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){s=R;e:{var $=i;x=fh;var he=$.current.memoizedState.isDehydrated;if(he&&(ou($,R).flags|=256),R=md($,R,!1),R!==2){if(of&&!he){$.errorRecoveryDisabledLanes|=S,Xo|=S,x=4;break e}S=za,za=x,S!==null&&(za===null?za=S:za.push.apply(za,S))}x=R}if(S=!1,x!==2)continue}}if(x===1){ou(i,0),Bl(i,s,0,!0);break}e:{switch(f=i,S=x,S){case 0:case 1:throw Error(U(345));case 4:if((s&4194048)!==s)break;case 6:Bl(f,s,fr,!Rl);break e;case 2:za=null;break;case 3:case 5:break;default:throw Error(U(329))}if((s&62914560)===s&&(x=ph+300-Nn(),10<x)){if(Bl(f,s,fr,!Rl),Zt(f,0,!0)!==0)break e;Wi=s,f.timeoutHandle=Ap(fp.bind(null,f,c,za,dd,lf,s,fr,Xo,Tc,Rl,S,"Throttled",-0,0),x);break e}fp(f,c,za,dd,lf,s,fr,Xo,Tc,Rl,S,null,-0,0)}}break}while(!0);ss(i)}function fp(i,s,c,f,x,S,R,$,he,Ie,Ze,Ye,Re,Oe){if(i.timeoutHandle=-1,Ye=s.subtreeFlags,Ye&8192||(Ye&16785408)===16785408){Ye={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:sr},cp(s,S,Ye);var vt=(S&62914560)===S?ph-Nn():(S&4194048)===S?up-Nn():0;if(vt=xe(Ye,vt),vt!==null){Wi=S,i.cancelPendingCommit=vt(ff.bind(null,i,s,S,c,f,x,R,$,he,Ze,Ye,null,Re,Oe)),Bl(i,S,R,!Ie);return}}ff(i,s,S,c,f,x,R,$,he)}function Np(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var x=c[f],S=x.getSnapshot;x=x.value;try{if(!ga(S(),x))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Bl(i,s,c,f){s&=~ud,s&=~Xo,i.suspendedLanes|=s,i.pingedLanes&=~s,f&&(i.warmLanes|=s),f=i.expirationTimes;for(var x=s;0<x;){var S=31-Se(x),R=1<<S;f[S]=-1,x&=~R}c!==0&&Ln(i,c,s)}function pd(){return(Mi&6)===0?(vh(0),!1):!0}function uf(){if(ci!==null){if(gi===0)var i=ci.return;else i=ci,Kr=ro=null,I(i),Oo=null,yl=0,i=ci;for(;i!==null;)Al(i.alternate,i),i=i.return;ci=null}}function ou(i,s){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,Xp(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),Wi=0,uf(),Ki=i,ci=c=Hr(i.current,null),hi=s,gi=0,dr=null,Rl=!1,su=pt(i,s),of=!1,Tc=fr=ud=Xo=$o=jn=0,za=fh=null,lf=!1,(s&8)!==0&&(s|=s&32);var f=i.entangledLanes;if(f!==0)for(i=i.entanglements,f&=s;0<f;){var x=31-Se(f),S=1<<x;s|=i[x],f&=~S}return Ho=s,nc(),c}function pp(i,s){Nt=null,Fe.H=eu,s===Cs||s===Jr?(s=Yc(),gi=3):s===fc?(s=Yc(),gi=4):gi=s===qd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,dr=s,ci===null&&(jn=1,tu(i,Fa(s,i.current)))}function mp(){var i=Va.current;return i===null?!0:(hi&4194048)===hi?gn===null:(hi&62914560)===hi||(hi&536870912)!==0?i===gn:!1}function gp(){var i=Fe.H;return Fe.H=eu,i===null?eu:i}function hf(){var i=Fe.A;return Fe.A=Up,i}function lu(){jn=4,Rl||(hi&4194048)!==hi&&Va.current!==null||(su=!0),($o&134217727)===0&&(Xo&134217727)===0||Ki===null||Bl(Ki,hi,fr,!1)}function md(i,s,c){var f=Mi;Mi|=2;var x=gp(),S=hf();(Ki!==i||hi!==s)&&(dd=null,ou(i,s)),s=!1;var R=jn;e:do try{if(gi!==0&&ci!==null){var $=ci,he=dr;switch(gi){case 8:uf(),R=6;break e;case 3:case 2:case 9:case 6:Va.current===null&&(s=!0);var Ie=gi;if(gi=0,dr=null,uu(i,$,he,Ie),c&&su){R=0;break e}break;default:Ie=gi,gi=0,dr=null,uu(i,$,he,Ie)}}Ol(),R=jn;break}catch(Ze){pp(i,Ze)}while(!0);return s&&i.shellSuspendCounter++,Kr=ro=null,Mi=f,Fe.H=x,Fe.A=S,ci===null&&(Ki=null,hi=0,nc()),R}function Ol(){for(;ci!==null;)_h(ci)}function gh(i,s){var c=Mi;Mi|=2;var f=gp(),x=hf();Ki!==i||hi!==s?(dd=null,hd=Nn()+500,ou(i,s)):su=pt(i,s);e:do try{if(gi!==0&&ci!==null){s=ci;var S=dr;t:switch(gi){case 1:gi=0,dr=null,uu(i,s,S,1);break;case 2:case 9:if(Xc(S)){gi=0,dr=null,yh(s);break}s=function(){gi!==2&&gi!==9||Ki!==i||(gi=7),ss(i)},S.then(s,s);break e;case 3:gi=7;break e;case 4:gi=5;break e;case 7:Xc(S)?(gi=0,dr=null,yh(s)):(gi=0,dr=null,uu(i,s,S,7));break;case 5:var R=null;switch(ci.tag){case 26:R=ci.memoizedState;case 5:case 27:var $=ci;if(R?H(R):$.stateNode.complete){gi=0,dr=null;var he=$.sibling;if(he!==null)ci=he;else{var Ie=$.return;Ie!==null?(ci=Ie,gd(Ie)):ci=null}break t}}gi=0,dr=null,uu(i,s,S,5);break;case 6:gi=0,dr=null,uu(i,s,S,6);break;case 8:uf(),jn=6;break e;default:throw Error(U(462))}}cu();break}catch(Ze){pp(i,Ze)}while(!0);return Kr=ro=null,Fe.H=f,Fe.A=x,Mi=c,ci!==null?0:(Ki=null,hi=0,nc(),jn)}function cu(){for(;ci!==null&&!js();)_h(ci)}function _h(i){var s=td(i.alternate,i,Ho);i.memoizedProps=i.pendingProps,s===null?gd(i):ci=s}function yh(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=Yd(c,s,s.pendingProps,s.type,void 0,hi);break;case 11:s=Yd(c,s,s.pendingProps,s.type.render,s.ref,hi);break;case 5:I(s);default:Al(c,s),s=ci=Gh(s,Ho),s=td(c,s,Ho)}i.memoizedProps=i.pendingProps,s===null?gd(i):ci=s}function uu(i,s,c,f){Kr=ro=null,I(s),Oo=null,yl=0;var x=s.return;try{if(iu(i,x,s,c,hi)){jn=1,tu(i,Fa(c,i.current)),ci=null;return}}catch(S){if(x!==null)throw ci=x,S;jn=1,tu(i,Fa(c,i.current)),ci=null;return}s.flags&32768?(ni||f===1?i=!0:su||(hi&536870912)!==0?i=!1:(Rl=i=!0,(f===2||f===9||f===3||f===6)&&(f=Va.current,f!==null&&f.tag===13&&(f.flags|=16384))),df(s,i)):gd(s)}function gd(i){var s=i;do{if((s.flags&32768)!==0){df(s,Rl);return}i=s.return;var c=Wd(s.alternate,s,Ho);if(c!==null){ci=c;return}if(s=s.sibling,s!==null){ci=s;return}ci=s=i}while(s!==null);jn===0&&(jn=5)}function df(i,s){do{var c=np(i.alternate,i);if(c!==null){c.flags&=32767,ci=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){ci=i;return}ci=i=c}while(i!==null);jn=6,ci=null}function ff(i,s,c,f,x,S,R,$,he){i.cancelPendingCommit=null;do hu();while(ua!==0);if((Mi&6)!==0)throw Error(U(327));if(s!==null){if(s===i.current)throw Error(U(177));if(S=s.lanes|s.childLanes,S|=ml,Vn(i,c,S,R,$,he),i===Ki&&(ci=Ki=null,hi=0),vo=s,Ll=i,Wi=c,mh=S,fd=x,cf=f,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,bp(ds,function(){return yp(),null})):(i.callbackNode=null,i.callbackPriority=0),f=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||f){f=Fe.T,Fe.T=null,x=st.p,st.p=2,R=Mi,Mi|=4;try{oh(i,s,c)}finally{Mi=R,st.p=x,Fe.T=f}}ua=1,_p(),pf(),mf()}}function _p(){if(ua===1){ua=0;var i=Ll,s=vo,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Fe.T,Fe.T=null;var f=st.p;st.p=2;var x=Mi;Mi|=4;try{nf(s,i);var S=zf,R=Fu(i.containerInfo),$=S.focusedElem,he=S.selectionRange;if(R!==$&&$&&$.ownerDocument&&Uc($.ownerDocument.documentElement,$)){if(he!==null&&Wl($)){var Ie=he.start,Ze=he.end;if(Ze===void 0&&(Ze=Ie),"selectionStart"in $)$.selectionStart=Ie,$.selectionEnd=Math.min(Ze,$.value.length);else{var Ye=$.ownerDocument||document,Re=Ye&&Ye.defaultView||window;if(Re.getSelection){var Oe=Re.getSelection(),vt=$.textContent.length,Lt=Math.min(he.start,vt),ri=he.end===void 0?Lt:Math.min(he.end,vt);!Oe.extend&&Lt>ri&&(R=ri,ri=Lt,Lt=R);var Me=Fc($,Lt),ve=Fc($,ri);if(Me&&ve&&(Oe.rangeCount!==1||Oe.anchorNode!==Me.node||Oe.anchorOffset!==Me.offset||Oe.focusNode!==ve.node||Oe.focusOffset!==ve.offset)){var De=Ye.createRange();De.setStart(Me.node,Me.offset),Oe.removeAllRanges(),Lt>ri?(Oe.addRange(De),Oe.extend(ve.node,ve.offset)):(De.setEnd(ve.node,ve.offset),Oe.addRange(De))}}}}for(Ye=[],Oe=$;Oe=Oe.parentNode;)Oe.nodeType===1&&Ye.push({element:Oe,left:Oe.scrollLeft,top:Oe.scrollTop});for(typeof $.focus=="function"&&$.focus(),$=0;$<Ye.length;$++){var $e=Ye[$];$e.element.scrollLeft=$e.left,$e.element.scrollTop=$e.top}}zt=!!Sd,zf=Sd=null}finally{Mi=x,st.p=f,Fe.T=c}}i.current=s,ua=2}}function pf(){if(ua===2){ua=0;var i=Ll,s=vo,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Fe.T,Fe.T=null;var f=st.p;st.p=2;var x=Mi;Mi|=4;try{ef(i,s.alternate,s)}finally{Mi=x,st.p=f,Fe.T=c}}ua=3}}function mf(){if(ua===4||ua===3){ua=0,Ns();var i=Ll,s=vo,c=Wi,f=cf;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ua=5:(ua=0,vo=Ll=null,_d(i,i.pendingLanes));var x=i.pendingLanes;if(x===0&&(Yo=null),ln(c),s=s.stateNode,le&&typeof le.onCommitFiberRoot=="function")try{le.onCommitFiberRoot(re,s,void 0,(s.current.flags&128)===128)}catch{}if(f!==null){s=Fe.T,x=st.p,st.p=2,Fe.T=null;try{for(var S=i.onRecoverableError,R=0;R<f.length;R++){var $=f[R];S($.value,{componentStack:$.stack})}}finally{Fe.T=s,st.p=x}}(Wi&3)!==0&&hu(),ss(i),x=i.pendingLanes,(c&261930)!==0&&(x&42)!==0?i===kl?Sc++:(Sc=0,kl=i):Sc=0,vh(0)}}function _d(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,$n(s)))}function hu(){return _p(),pf(),mf(),yp()}function yp(){if(ua!==5)return!1;var i=Ll,s=mh;mh=0;var c=ln(Wi),f=Fe.T,x=st.p;try{st.p=32>c?32:c,Fe.T=null,c=fd,fd=null;var S=Ll,R=Wi;if(ua=0,vo=Ll=null,Wi=0,(Mi&6)!==0)throw Error(U(331));var $=Mi;if(Mi|=4,ld(S.current),lp(S,S.current,R,c),Mi=$,vh(0,!1),le&&typeof le.onPostCommitFiberRoot=="function")try{le.onPostCommitFiberRoot(re,S)}catch{}return!0}finally{st.p=x,Fe.T=f,_d(i,s)}}function gf(i,s,c){s=Fa(c,s),s=Wu(i.stateNode,s,2),i=Cr(i,s,2),i!==null&&(on(i,2),ss(i))}function Vi(i,s,c){if(i.tag===3)gf(i,i,c);else for(;s!==null;){if(s.tag===3){gf(s,i,c);break}else if(s.tag===1){var f=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Yo===null||!Yo.has(f))){i=Fa(c,i),c=Zd(2),f=Cr(s,c,2),f!==null&&(Gd(c,f,s,i),on(f,2),ss(f));break}}s=s.return}}function _f(i,s,c){var f=i.pingCache;if(f===null){f=i.pingCache=new jp;var x=new Set;f.set(s,x)}else x=f.get(s),x===void 0&&(x=new Set,f.set(s,x));x.has(c)||(of=!0,x.add(c),i=Vp.bind(null,i,s,c),s.then(i,i))}function Vp(i,s,c){var f=i.pingCache;f!==null&&f.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Ki===i&&(hi&c)===c&&(jn===4||jn===3&&(hi&62914560)===hi&&300>Nn()-ph?(Mi&2)===0&&ou(i,0):ud|=c,Tc===hi&&(Tc=0)),ss(i)}function vp(i,s){s===0&&(s=Li()),i=io(i,s),i!==null&&(on(i,s),ss(i))}function Zp(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),vp(i,c)}function xp(i,s){var c=0;switch(i.tag){case 31:case 13:var f=i.stateNode,x=i.memoizedState;x!==null&&(c=x.retryLane);break;case 19:f=i.stateNode;break;case 22:f=i.stateNode._retryCache;break;default:throw Error(U(314))}f!==null&&f.delete(s),vp(i,c)}function bp(i,s){return Us(i,s)}var rs=null,Ar=null,yd=!1,du=!1,yf=!1,ks=0;function ss(i){i!==Ar&&i.next===null&&(Ar===null?rs=Ar=i:Ar=Ar.next=i),du=!0,yd||(yd=!0,wf())}function vh(i,s){if(!yf&&du){yf=!0;do for(var c=!1,f=rs;f!==null;){if(i!==0){var x=f.pendingLanes;if(x===0)var S=0;else{var R=f.suspendedLanes,$=f.pingedLanes;S=(1<<31-Se(42|i)+1)-1,S&=x&~(R&~$),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(c=!0,bf(f,S))}else S=hi,S=Zt(f,f===Ki?S:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(S&3)===0||pt(f,S)||(c=!0,bf(f,S));f=f.next}while(c);yf=!1}}function vf(){vd()}function vd(){du=yd=!1;var i=0;ks!==0&&Ep()&&(i=ks);for(var s=Nn(),c=null,f=rs;f!==null;){var x=f.next,S=Mc(f,s);S===0?(f.next=null,c===null?rs=x:c.next=x,x===null&&(Ar=c)):(c=f,(i!==0||(S&3)!==0)&&(du=!0)),f=x}ua!==0&&ua!==5||vh(i),ks!==0&&(ks=0)}function Mc(i,s){for(var c=i.suspendedLanes,f=i.pingedLanes,x=i.expirationTimes,S=i.pendingLanes&-62914561;0<S;){var R=31-Se(S),$=1<<R,he=x[R];he===-1?(($&c)===0||($&f)!==0)&&(x[R]=Ut($,s)):he<=s&&(i.expiredLanes|=$),S&=~$}if(s=Ki,c=hi,c=Zt(i,i===s?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f=i.callbackNode,c===0||i===s&&(gi===2||gi===9)||i.cancelPendingCommit!==null)return f!==null&&f!==null&&Dr(f),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||pt(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(f!==null&&Dr(f),ln(c)){case 2:case 8:c=hs;break;case 32:c=ds;break;case 268435456:c=Z;break;default:c=ds}return f=xf.bind(null,i),c=Us(c,f),i.callbackPriority=s,i.callbackNode=c,s}return f!==null&&f!==null&&Dr(f),i.callbackPriority=2,i.callbackNode=null,2}function xf(i,s){if(ua!==0&&ua!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(hu()&&i.callbackNode!==c)return null;var f=hi;return f=Zt(i,i===Ki?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f===0?null:(dp(i,f,s),Mc(i,Nn()),i.callbackNode!=null&&i.callbackNode===c?xf.bind(null,i):null)}function bf(i,s){if(hu())return null;dp(i,s,!0)}function wf(){zp(function(){(Mi&6)!==0?Us(us,vf):vd()})}function xd(){if(ks===0){var i=Sr;i===0&&(i=Ue,Ue<<=1,(Ue&261888)===0&&(Ue=256)),ks=i}return ks}function xh(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:kr(""+i)}function Tf(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function Gp(i,s,c,f,x){if(s==="submit"&&c&&c.stateNode===x){var S=xh((x[bt]||null).action),R=f.submitter;R&&(s=(s=R[bt]||null)?xh(s.formAction):R.getAttribute("formAction"),s!==null&&(S=s,R=null));var $=new rl("action","action",null,f,x);i.push({event:$,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(ks!==0){var he=R?Tf(x,R):new FormData(x);Jc(c,{pending:!0,data:he,method:x.method,action:S},null,he)}}else typeof S=="function"&&($.preventDefault(),he=R?Tf(x,R):new FormData(x),Jc(c,{pending:!0,data:he,method:x.method,action:S},S,he))},currentTarget:x}]})}}for(var Sf=0;Sf<ic.length;Sf++){var bd=ic[Sf],qp=bd.toLowerCase(),Hp=bd[0].toUpperCase()+bd.slice(1);ca(qp,"on"+Hp)}ca(ec,"onAnimationEnd"),ca(Nc,"onAnimationIteration"),ca(to,"onAnimationStart"),ca("dblclick","onDoubleClick"),ca("focusin","onFocus"),ca("focusout","onBlur"),ca(tc,"onTransitionRun"),ca(pl,"onTransitionStart"),ca(or,"onTransitionCancel"),ca(Nu,"onTransitionEnd"),Lr("onMouseEnter",["mouseout","mouseover"]),Lr("onMouseLeave",["mouseout","mouseover"]),Lr("onPointerEnter",["pointerout","pointerover"]),Lr("onPointerLeave",["pointerout","pointerover"]),Hs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Hs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Hs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Hs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Hs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Hs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$p=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bh));function wp(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var f=i[c],x=f.event;f=f.listeners;e:{var S=void 0;if(s)for(var R=f.length-1;0<=R;R--){var $=f[R],he=$.instance,Ie=$.currentTarget;if($=$.listener,he!==S&&x.isPropagationStopped())break e;S=$,x.currentTarget=Ie;try{S(x)}catch(Ze){Io(Ze)}x.currentTarget=null,S=he}else for(R=0;R<f.length;R++){if($=f[R],he=$.instance,Ie=$.currentTarget,$=$.listener,he!==S&&x.isPropagationStopped())break e;S=$,x.currentTarget=Ie;try{S(x)}catch(Ze){Io(Ze)}x.currentTarget=null,S=he}}}}function ii(i,s){var c=s[Zn];c===void 0&&(c=s[Zn]=new Set);var f=i+"__bubble";c.has(f)||(Mf(s,i,2,!1),c.add(f))}function xo(i,s,c){var f=0;s&&(f|=4),Mf(c,i,f,s)}var wh="_reactListening"+Math.random().toString(36).slice(2);function wd(i){if(!i[wh]){i[wh]=!0,Sa.forEach(function(c){c!=="selectionchange"&&($p.has(c)||xo(c,!1,i),xo(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[wh]||(s[wh]=!0,xo("selectionchange",!1,s))}}function Mf(i,s,c,f){switch(_r(s)){case 2:var x=xt;break;case 8:x=ft;break;default:x=Yt}c=x.bind(null,s,c,i),x=void 0,!Jn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),f?x!==void 0?i.addEventListener(s,c,{capture:!0,passive:x}):i.addEventListener(s,c,!0):x!==void 0?i.addEventListener(s,c,{passive:x}):i.addEventListener(s,c,!1)}function Td(i,s,c,f,x){var S=f;if((s&1)===0&&(s&2)===0&&f!==null)e:for(;;){if(f===null)return;var R=f.tag;if(R===3||R===4){var $=f.stateNode.containerInfo;if($===x)break;if(R===4)for(R=f.return;R!==null;){var he=R.tag;if((he===3||he===4)&&R.stateNode.containerInfo===x)return;R=R.return}for(;$!==null;){if(R=fs($),R===null)return;if(he=R.tag,he===5||he===6||he===26||he===27){f=S=R;continue e}$=$.parentNode}}f=f.return}Cu(function(){var Ie=S,Ze=la(c),Ye=[];e:{var Re=Vu.get(i);if(Re!==void 0){var Oe=rl,vt=i;switch(i){case"keypress":if(Kt(c)===0)break e;case"keydown":case"keyup":Oe=Rh;break;case"focusin":vt="focus",Oe=nn;break;case"focusout":vt="blur",Oe=nn;break;case"beforeblur":case"afterblur":Oe=nn;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=qn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=Gl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=Od;break;case ec:case Nc:case to:Oe=ql;break;case Nu:Oe=Rc;break;case"scroll":case"scrollend":Oe=Zl;break;case"wheel":Oe=Ao;break;case"copy":case"cut":case"paste":Oe=Bd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Lh;break;case"toggle":case"beforetoggle":Oe=Lc}var Lt=(s&4)!==0,ri=!Lt&&(i==="scroll"||i==="scrollend"),Me=Lt?Re!==null?Re+"Capture":null:Re;Lt=[];for(var ve=Ie,De;ve!==null;){var $e=ve;if(De=$e.stateNode,$e=$e.tag,$e!==5&&$e!==26&&$e!==27||De===null||Me===null||($e=Gn(ve,Me),$e!=null&&Lt.push(fu(ve,$e,De))),ri)break;ve=ve.return}0<Lt.length&&(Re=new Oe(Re,vt,null,c,Ze),Ye.push({event:Re,listeners:Lt}))}}if((s&7)===0){e:{if(Re=i==="mouseover"||i==="pointerover",Oe=i==="mouseout"||i==="pointerout",Re&&c!==al&&(vt=c.relatedTarget||c.fromElement)&&(fs(vt)||vt[Rt]))break e;if((Oe||Re)&&(Re=Ze.window===Ze?Ze:(Re=Ze.ownerDocument)?Re.defaultView||Re.parentWindow:window,Oe?(vt=c.relatedTarget||c.toElement,Oe=Ie,vt=vt?fs(vt):null,vt!==null&&(ri=oe(vt),Lt=vt.tag,vt!==ri||Lt!==5&&Lt!==27&&Lt!==6)&&(vt=null)):(Oe=null,vt=Ie),Oe!==vt)){if(Lt=qn,$e="onMouseLeave",Me="onMouseEnter",ve="mouse",(i==="pointerout"||i==="pointerover")&&(Lt=Lh,$e="onPointerLeave",Me="onPointerEnter",ve="pointer"),ri=Oe==null?Re:Rr(Oe),De=vt==null?Re:Rr(vt),Re=new Lt($e,ve+"leave",Oe,c,Ze),Re.target=ri,Re.relatedTarget=De,$e=null,fs(Ze)===Ie&&(Lt=new Lt(Me,ve+"enter",vt,c,Ze),Lt.target=De,Lt.relatedTarget=ri,$e=Lt),ri=$e,Oe&&vt)t:{for(Lt=Tp,Me=Oe,ve=vt,De=0,$e=Me;$e;$e=Lt($e))De++;$e=0;for(var Pt=ve;Pt;Pt=Lt(Pt))$e++;for(;0<De-$e;)Me=Lt(Me),De--;for(;0<$e-De;)ve=Lt(ve),$e--;for(;De--;){if(Me===ve||ve!==null&&Me===ve.alternate){Lt=Me;break t}Me=Lt(Me),ve=Lt(ve)}Lt=null}else Lt=null;Oe!==null&&mu(Ye,Re,Oe,Lt,!1),vt!==null&&ri!==null&&mu(Ye,ri,vt,Lt,!0)}}e:{if(Re=Ie?Rr(Ie):window,Oe=Re.nodeName&&Re.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Re.type==="file")var Ft=Bc;else if(kc(Re))if(Oc)Ft=Ou;else{Ft=Nh;var ht=jh}else Oe=Re.nodeName,!Oe||Oe.toLowerCase()!=="input"||Re.type!=="checkbox"&&Re.type!=="radio"?Ie&&br(Ie.elementType)&&(Ft=Bc):Ft=Bu;if(Ft&&(Ft=Ft(i,Ie))){Ru(Ye,Ft,c,Ze);break e}ht&&ht(i,Re,Ie),i==="focusout"&&Ie&&Re.type==="number"&&Ie.memoizedProps.value!=null&&Vl(Re,"number",Re.value)}switch(ht=Ie?Rr(Ie):window,i){case"focusin":(kc(ht)||ht.contentEditable==="true")&&(Js=ht,Uu=Ie,Ql=null);break;case"focusout":Ql=Uu=Js=null;break;case"mousedown":ju=!0;break;case"contextmenu":case"mouseup":case"dragend":ju=!1,Zh(Ye,c,Ze);break;case"selectionchange":if(Do)break;case"keydown":case"keyup":Zh(Ye,c,Ze)}var jt;if(Du)e:{switch(i){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else zo?Bh(i,c)&&(Vt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Vt="onCompositionStart");Vt&&(ul&&c.locale!=="ko"&&(zo||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&zo&&(jt=Br()):(ka=Ze,wt="value"in ka?ka.value:ka.textContent,zo=!0)),ht=pu(Ie,Vt),0<ht.length&&(Vt=new ea(Vt,i,null,c,Ze),Ye.push({event:Vt,listeners:ht}),jt?Vt.data=jt:(jt=Ws(c),jt!==null&&(Vt.data=jt)))),(jt=Yl?Iu(i,c):Ud(i,c))&&(Vt=pu(Ie,"onBeforeInput"),0<Vt.length&&(ht=new ea("onBeforeInput","beforeinput",null,c,Ze),Ye.push({event:ht,listeners:Vt}),ht.data=jt)),Gp(Ye,i,Ie,c,Ze)}wp(Ye,s)})}function fu(i,s,c){return{instance:i,listener:s,currentTarget:c}}function pu(i,s){for(var c=s+"Capture",f=[];i!==null;){var x=i,S=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||S===null||(x=Gn(i,c),x!=null&&f.unshift(fu(i,x,S)),x=Gn(i,s),x!=null&&f.push(fu(i,x,S))),i.tag===3)return f;i=i.return}return[]}function Tp(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function mu(i,s,c,f,x){for(var S=s._reactName,R=[];c!==null&&c!==f;){var $=c,he=$.alternate,Ie=$.stateNode;if($=$.tag,he!==null&&he===f)break;$!==5&&$!==26&&$!==27||Ie===null||(he=Ie,x?(Ie=Gn(c,S),Ie!=null&&R.unshift(fu(c,Ie,he))):x||(Ie=Gn(c,S),Ie!=null&&R.push(fu(c,Ie,he)))),c=c.return}R.length!==0&&i.push({event:s,listeners:R})}var Sp=/\r\n?/g,Cf=/\u0000|\uFFFD/g;function Ef(i){return(typeof i=="string"?i:""+i).replace(Sp,`
`).replace(Cf,"")}function gr(i,s){return s=Ef(s),Ef(i)===s}function _i(i,s,c,f,x,S){switch(c){case"children":typeof f=="string"?s==="body"||s==="textarea"&&f===""||fa(i,f):(typeof f=="number"||typeof f=="bigint")&&s!=="body"&&fa(i,""+f);break;case"className":Nl(i,"class",f);break;case"tabIndex":Nl(i,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Nl(i,c,f);break;case"style":_s(i,f,S);break;case"data":if(s!=="object"){Nl(i,"data",f);break}case"src":case"href":if(f===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=kr(""+f),i.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(c==="formAction"?(s!=="input"&&_i(i,s,"name",x.name,x,null),_i(i,s,"formEncType",x.formEncType,x,null),_i(i,s,"formMethod",x.formMethod,x,null),_i(i,s,"formTarget",x.formTarget,x,null)):(_i(i,s,"encType",x.encType,x,null),_i(i,s,"method",x.method,x,null),_i(i,s,"target",x.target,x,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=kr(""+f),i.setAttribute(c,f);break;case"onClick":f!=null&&(i.onclick=sr);break;case"onScroll":f!=null&&ii("scroll",i);break;case"onScrollEnd":f!=null&&ii("scrollend",i);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(U(61));if(c=f.__html,c!=null){if(x.children!=null)throw Error(U(60));i.innerHTML=c}}break;case"multiple":i.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":i.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){i.removeAttribute("xlink:href");break}c=kr(""+f),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""+f):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":f===!0?i.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,f):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?i.setAttribute(c,f):i.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?i.removeAttribute(c):i.setAttribute(c,f);break;case"popover":ii("beforetoggle",i),ii("toggle",i),jl(i,"popover",f);break;case"xlinkActuate":Ra(i,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Ra(i,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Ra(i,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Ra(i,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Ra(i,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Ra(i,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Ra(i,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Ra(i,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Ra(i,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":jl(i,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Mo.get(c)||c,jl(i,c,f))}}function Cc(i,s,c,f,x,S){switch(c){case"style":_s(i,f,S);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(U(61));if(c=f.__html,c!=null){if(x.children!=null)throw Error(U(60));i.innerHTML=c}}break;case"children":typeof f=="string"?fa(i,f):(typeof f=="number"||typeof f=="bigint")&&fa(i,""+f);break;case"onScroll":f!=null&&ii("scroll",i);break;case"onScrollEnd":f!=null&&ii("scrollend",i);break;case"onClick":f!=null&&(i.onclick=sr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ei.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(x=c.endsWith("Capture"),s=c.slice(2,x?c.length-7:void 0),S=i[bt]||null,S=S!=null?S[c]:null,typeof S=="function"&&i.removeEventListener(s,S,x),typeof f=="function")){typeof S!="function"&&S!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,f,x);break e}c in i?i[c]=f:f===!0?i.setAttribute(c,""):jl(i,c,f)}}}function Tn(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ii("error",i),ii("load",i);var f=!1,x=!1,S;for(S in c)if(c.hasOwnProperty(S)){var R=c[S];if(R!=null)switch(S){case"src":f=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(U(137,s));default:_i(i,s,S,R,c,null)}}x&&_i(i,s,"srcSet",c.srcSet,c,null),f&&_i(i,s,"src",c.src,c,null);return;case"input":ii("invalid",i);var $=S=R=x=null,he=null,Ie=null;for(f in c)if(c.hasOwnProperty(f)){var Ze=c[f];if(Ze!=null)switch(f){case"name":x=Ze;break;case"type":R=Ze;break;case"checked":he=Ze;break;case"defaultChecked":Ie=Ze;break;case"value":S=Ze;break;case"defaultValue":$=Ze;break;case"children":case"dangerouslySetInnerHTML":if(Ze!=null)throw Error(U(137,s));break;default:_i(i,s,f,Ze,c,null)}}Dc(i,S,$,he,Ie,R,x,!1);return;case"select":ii("invalid",i),f=R=S=null;for(x in c)if(c.hasOwnProperty(x)&&($=c[x],$!=null))switch(x){case"value":S=$;break;case"defaultValue":R=$;break;case"multiple":f=$;default:_i(i,s,x,$,c,null)}s=S,c=R,i.multiple=!!f,s!=null?il(i,!!f,s,!1):c!=null&&il(i,!!f,c,!0);return;case"textarea":ii("invalid",i),S=x=f=null;for(R in c)if(c.hasOwnProperty(R)&&($=c[R],$!=null))switch(R){case"value":f=$;break;case"defaultValue":x=$;break;case"children":S=$;break;case"dangerouslySetInnerHTML":if($!=null)throw Error(U(91));break;default:_i(i,s,R,$,c,null)}nl(i,f,x,S);return;case"option":for(he in c)if(c.hasOwnProperty(he)&&(f=c[he],f!=null))switch(he){case"selected":i.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:_i(i,s,he,f,c,null)}return;case"dialog":ii("beforetoggle",i),ii("toggle",i),ii("cancel",i),ii("close",i);break;case"iframe":case"object":ii("load",i);break;case"video":case"audio":for(f=0;f<bh.length;f++)ii(bh[f],i);break;case"image":ii("error",i),ii("load",i);break;case"details":ii("toggle",i);break;case"embed":case"source":case"link":ii("error",i),ii("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ie in c)if(c.hasOwnProperty(Ie)&&(f=c[Ie],f!=null))switch(Ie){case"children":case"dangerouslySetInnerHTML":throw Error(U(137,s));default:_i(i,s,Ie,f,c,null)}return;default:if(br(s)){for(Ze in c)c.hasOwnProperty(Ze)&&(f=c[Ze],f!==void 0&&Cc(i,s,Ze,f,c,void 0));return}}for($ in c)c.hasOwnProperty($)&&(f=c[$],f!=null&&_i(i,s,$,f,c,null))}function Mp(i,s,c,f){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,S=null,R=null,$=null,he=null,Ie=null,Ze=null;for(Oe in c){var Ye=c[Oe];if(c.hasOwnProperty(Oe)&&Ye!=null)switch(Oe){case"checked":break;case"value":break;case"defaultValue":he=Ye;default:f.hasOwnProperty(Oe)||_i(i,s,Oe,null,f,Ye)}}for(var Re in f){var Oe=f[Re];if(Ye=c[Re],f.hasOwnProperty(Re)&&(Oe!=null||Ye!=null))switch(Re){case"type":S=Oe;break;case"name":x=Oe;break;case"checked":Ie=Oe;break;case"defaultChecked":Ze=Oe;break;case"value":R=Oe;break;case"defaultValue":$=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(U(137,s));break;default:Oe!==Ye&&_i(i,s,Re,Oe,f,Ye)}}$s(i,R,$,he,Ie,Ze,S,x);return;case"select":Oe=R=$=Re=null;for(S in c)if(he=c[S],c.hasOwnProperty(S)&&he!=null)switch(S){case"value":break;case"multiple":Oe=he;default:f.hasOwnProperty(S)||_i(i,s,S,null,f,he)}for(x in f)if(S=f[x],he=c[x],f.hasOwnProperty(x)&&(S!=null||he!=null))switch(x){case"value":Re=S;break;case"defaultValue":$=S;break;case"multiple":R=S;default:S!==he&&_i(i,s,x,S,f,he)}s=$,c=R,f=Oe,Re!=null?il(i,!!c,Re,!1):!!f!=!!c&&(s!=null?il(i,!!c,s,!0):il(i,!!c,c?[]:"",!1));return;case"textarea":Oe=Re=null;for($ in c)if(x=c[$],c.hasOwnProperty($)&&x!=null&&!f.hasOwnProperty($))switch($){case"value":break;case"children":break;default:_i(i,s,$,null,f,x)}for(R in f)if(x=f[R],S=c[R],f.hasOwnProperty(R)&&(x!=null||S!=null))switch(R){case"value":Re=x;break;case"defaultValue":Oe=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(U(91));break;default:x!==S&&_i(i,s,R,x,f,S)}So(i,Re,Oe);return;case"option":for(var vt in c)if(Re=c[vt],c.hasOwnProperty(vt)&&Re!=null&&!f.hasOwnProperty(vt))switch(vt){case"selected":i.selected=!1;break;default:_i(i,s,vt,null,f,Re)}for(he in f)if(Re=f[he],Oe=c[he],f.hasOwnProperty(he)&&Re!==Oe&&(Re!=null||Oe!=null))switch(he){case"selected":i.selected=Re&&typeof Re!="function"&&typeof Re!="symbol";break;default:_i(i,s,he,Re,f,Oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Lt in c)Re=c[Lt],c.hasOwnProperty(Lt)&&Re!=null&&!f.hasOwnProperty(Lt)&&_i(i,s,Lt,null,f,Re);for(Ie in f)if(Re=f[Ie],Oe=c[Ie],f.hasOwnProperty(Ie)&&Re!==Oe&&(Re!=null||Oe!=null))switch(Ie){case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(U(137,s));break;default:_i(i,s,Ie,Re,f,Oe)}return;default:if(br(s)){for(var ri in c)Re=c[ri],c.hasOwnProperty(ri)&&Re!==void 0&&!f.hasOwnProperty(ri)&&Cc(i,s,ri,void 0,f,Re);for(Ze in f)Re=f[Ze],Oe=c[Ze],!f.hasOwnProperty(Ze)||Re===Oe||Re===void 0&&Oe===void 0||Cc(i,s,Ze,Re,f,Oe);return}}for(var Me in c)Re=c[Me],c.hasOwnProperty(Me)&&Re!=null&&!f.hasOwnProperty(Me)&&_i(i,s,Me,null,f,Re);for(Ye in f)Re=f[Ye],Oe=c[Ye],!f.hasOwnProperty(Ye)||Re===Oe||Re==null&&Oe==null||_i(i,s,Ye,Re,f,Oe)}function Af(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Cp(){if(typeof performance.getEntriesByType=="function"){for(var i=0,s=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var x=c[f],S=x.transferSize,R=x.initiatorType,$=x.duration;if(S&&$&&Af(R)){for(R=0,$=x.responseEnd,f+=1;f<c.length;f++){var he=c[f],Ie=he.startTime;if(Ie>$)break;var Ze=he.transferSize,Ye=he.initiatorType;Ze&&Af(Ye)&&(he=he.responseEnd,R+=Ze*(he<$?1:($-Ie)/(he-Ie)))}if(--f,s+=8*(S+R)/(x.duration/1e3),i++,10<i)break}}if(0<i)return s/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Sd=null,zf=null;function Th(i){return i.nodeType===9?i:i.ownerDocument}function Ko(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Pf(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Md(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Cd=null;function Ep(){var i=window.event;return i&&i.type==="popstate"?i===Cd?!1:(Cd=i,!0):(Cd=null,!1)}var Ap=typeof setTimeout=="function"?setTimeout:void 0,Xp=typeof clearTimeout=="function"?clearTimeout:void 0,Df=typeof Promise=="function"?Promise:void 0,zp=typeof queueMicrotask=="function"?queueMicrotask:typeof Df<"u"?function(i){return Df.resolve(null).then(i).catch(Ed)}:Ap;function Ed(i){setTimeout(function(){throw i})}function Wo(i){return i==="head"}function Sh(i,s){var c=s,f=0;do{var x=c.nextSibling;if(i.removeChild(c),x&&x.nodeType===8)if(c=x.data,c==="/$"||c==="/&"){if(f===0){i.removeChild(x),vu(s);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")_u(i.ownerDocument.documentElement);else if(c==="head"){c=i.ownerDocument.head,_u(c);for(var S=c.firstChild;S;){var R=S.nextSibling,$=S.nodeName;S[qs]||$==="SCRIPT"||$==="STYLE"||$==="LINK"&&S.rel.toLowerCase()==="stylesheet"||c.removeChild(S),S=R}}else c==="body"&&_u(i.ownerDocument.body);c=x}while(c);vu(s)}function Mh(i,s){var c=i;i=0;do{var f=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(i===0)break;i--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||i++;c=f}while(c)}function gu(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":gu(c),Ir(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function Yp(i,s,c,f){for(;i.nodeType===1;){var x=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!f&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(f){if(!i[qs])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(S=i.getAttribute("rel"),S==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(S!==x.rel||i.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||i.getAttribute("title")!==(x.title==null?null:x.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(S=i.getAttribute("src"),(S!==(x.src==null?null:x.src)||i.getAttribute("type")!==(x.type==null?null:x.type)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&S&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var S=x.name==null?null:""+x.name;if(x.type==="hidden"&&i.getAttribute("name")===S)return i}else return i;if(i=zr(i.nextSibling),i===null)break}return null}function Kp(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=zr(i.nextSibling),i===null))return null;return i}function Pp(i,s){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!s||(i=zr(i.nextSibling),i===null))return null;return i}function Fl(i){return i.data==="$?"||i.data==="$~"}function sa(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function If(i,s){var c=i.ownerDocument;if(i.data==="$~")i._reactRetry=s;else if(i.data!=="$?"||c.readyState!=="loading")s();else{var f=function(){s(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),i._reactRetry=f}}function zr(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return i}var Ad=null;function zd(i){i=i.nextSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"||c==="/&"){if(s===0)return zr(i.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}i=i.nextSibling}return null}function Dp(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return i;s--}else c!=="/$"&&c!=="/&"||s++}i=i.previousSibling}return null}function Rf(i,s,c){switch(s=Th(c),i){case"html":if(i=s.documentElement,!i)throw Error(U(452));return i;case"head":if(i=s.head,!i)throw Error(U(453));return i;case"body":if(i=s.body,!i)throw Error(U(454));return i;default:throw Error(U(451))}}function _u(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);Ir(i)}var os=new Map,Lf=new Set;function yu(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Bs=st.d;st.d={f:Ip,r:Ch,D:Bf,C:Pd,L:Eh,m:Of,X:Uf,S:Ff,M:Wp};function Ip(){var i=Bs.f(),s=pd();return i||s}function Ch(i){var s=Ta(i);s!==null&&s.tag===5&&s.type==="form"?Hh(s):Bs.r(i)}var Ul=typeof document>"u"?null:document;function kf(i,s,c){var f=Ul;if(f&&typeof s=="string"&&s){var x=La(s);x='link[rel="'+i+'"][href="'+x+'"]',typeof c=="string"&&(x+='[crossorigin="'+c+'"]'),Lf.has(x)||(Lf.add(x),i={rel:i,crossOrigin:c,href:s},f.querySelector(x)===null&&(s=f.createElement("link"),Tn(s,"link",i),vn(s),f.head.appendChild(s)))}}function Bf(i){Bs.D(i),kf("dns-prefetch",i,null)}function Pd(i,s){Bs.C(i,s),kf("preconnect",i,s)}function Eh(i,s,c){Bs.L(i,s,c);var f=Ul;if(f&&i&&s){var x='link[rel="preload"][as="'+La(s)+'"]';s==="image"&&c&&c.imageSrcSet?(x+='[imagesrcset="'+La(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(x+='[imagesizes="'+La(c.imageSizes)+'"]')):x+='[href="'+La(i)+'"]';var S=x;switch(s){case"style":S=t(i);break;case"script":S=p(i)}os.has(S)||(i=ke({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),os.set(S,i),f.querySelector(x)!==null||s==="style"&&f.querySelector(n(S))||s==="script"&&f.querySelector(_(S))||(s=f.createElement("link"),Tn(s,"link",i),vn(s),f.head.appendChild(s)))}}function Of(i,s){Bs.m(i,s);var c=Ul;if(c&&i){var f=s&&typeof s.as=="string"?s.as:"script",x='link[rel="modulepreload"][as="'+La(f)+'"][href="'+La(i)+'"]',S=x;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=p(i)}if(!os.has(S)&&(i=ke({rel:"modulepreload",href:i},s),os.set(S,i),c.querySelector(x)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(_(S)))return}f=c.createElement("link"),Tn(f,"link",i),vn(f),c.head.appendChild(f)}}}function Ff(i,s,c){Bs.S(i,s,c);var f=Ul;if(f&&i){var x=Bi(f).hoistableStyles,S=t(i);s=s||"default";var R=x.get(S);if(!R){var $={loading:0,preload:null};if(R=f.querySelector(n(S)))$.loading=5;else{i=ke({rel:"stylesheet",href:i,"data-precedence":s},c),(c=os.get(S))&&M(i,c);var he=R=f.createElement("link");vn(he),Tn(he,"link",i),he._p=new Promise(function(Ie,Ze){he.onload=Ie,he.onerror=Ze}),he.addEventListener("load",function(){$.loading|=1}),he.addEventListener("error",function(){$.loading|=2}),$.loading|=4,b(R,s,f)}R={type:"stylesheet",instance:R,count:1,state:$},x.set(S,R)}}}function Uf(i,s){Bs.X(i,s);var c=Ul;if(c&&i){var f=Bi(c).hoistableScripts,x=p(i),S=f.get(x);S||(S=c.querySelector(_(x)),S||(i=ke({src:i,async:!0},s),(s=os.get(x))&&C(i,s),S=c.createElement("script"),vn(S),Tn(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},f.set(x,S))}}function Wp(i,s){Bs.M(i,s);var c=Ul;if(c&&i){var f=Bi(c).hoistableScripts,x=p(i),S=f.get(x);S||(S=c.querySelector(_(x)),S||(i=ke({src:i,async:!0,type:"module"},s),(s=os.get(x))&&C(i,s),S=c.createElement("script"),vn(S),Tn(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},f.set(x,S))}}function a(i,s,c,f){var x=(x=At.current)?yu(x):null;if(!x)throw Error(U(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=t(c.href),c=Bi(x).hoistableStyles,f=c.get(s),f||(f={type:"style",instance:null,count:0,state:null},c.set(s,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=t(c.href);var S=Bi(x).hoistableStyles,R=S.get(i);if(R||(x=x.ownerDocument||x,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(i,R),(S=x.querySelector(n(i)))&&!S._p&&(R.instance=S,R.state.loading=5),os.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},os.set(i,c),S||u(x,i,c,R.state))),s&&f===null)throw Error(U(528,""));return R}if(s&&f!==null)throw Error(U(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=p(c),c=Bi(x).hoistableScripts,f=c.get(s),f||(f={type:"script",instance:null,count:0,state:null},c.set(s,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(U(444,i))}}function t(i){return'href="'+La(i)+'"'}function n(i){return'link[rel="stylesheet"]['+i+"]"}function o(i){return ke({},i,{"data-precedence":i.precedence,precedence:null})}function u(i,s,c,f){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?f.loading=1:(s=i.createElement("link"),f.preload=s,s.addEventListener("load",function(){return f.loading|=1}),s.addEventListener("error",function(){return f.loading|=2}),Tn(s,"link",c),vn(s),i.head.appendChild(s))}function p(i){return'[src="'+La(i)+'"]'}function _(i){return"script[async]"+i}function v(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var f=i.querySelector('style[data-href~="'+La(c.href)+'"]');if(f)return s.instance=f,vn(f),f;var x=ke({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(i.ownerDocument||i).createElement("style"),vn(f),Tn(f,"style",x),b(f,c.precedence,i),s.instance=f;case"stylesheet":x=t(c.href);var S=i.querySelector(n(x));if(S)return s.state.loading|=4,s.instance=S,vn(S),S;f=o(c),(x=os.get(x))&&M(f,x),S=(i.ownerDocument||i).createElement("link"),vn(S);var R=S;return R._p=new Promise(function($,he){R.onload=$,R.onerror=he}),Tn(S,"link",f),s.state.loading|=4,b(S,c.precedence,i),s.instance=S;case"script":return S=p(c.src),(x=i.querySelector(_(S)))?(s.instance=x,vn(x),x):(f=c,(x=os.get(S))&&(f=ke({},c),C(f,x)),i=i.ownerDocument||i,x=i.createElement("script"),vn(x),Tn(x,"link",f),i.head.appendChild(x),s.instance=x);case"void":return null;default:throw Error(U(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(f=s.instance,s.state.loading|=4,b(f,c.precedence,i));return s.instance}function b(i,s,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=f.length?f[f.length-1]:null,S=x,R=0;R<f.length;R++){var $=f[R];if($.dataset.precedence===s)S=$;else if(S!==x)break}S?S.parentNode.insertBefore(i,S.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function M(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function C(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var P=null;function k(i,s,c){if(P===null){var f=new Map,x=P=new Map;x.set(c,f)}else x=P,f=x.get(c),f||(f=new Map,x.set(c,f));if(f.has(i))return f;for(f.set(i,null),c=c.getElementsByTagName(i),x=0;x<c.length;x++){var S=c[x];if(!(S[qs]||S[Xe]||i==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var R=S.getAttribute(s)||"";R=i+R;var $=f.get(R);$?$.push(S):f.set(R,[S])}}return f}function F(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function j(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function H(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function Y(i,s,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var x=t(f.href),S=s.querySelector(n(x));if(S){s=S._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(i.count++,i=se.bind(i),s.then(i,i)),c.state.loading|=4,c.instance=S,vn(S);return}S=s.ownerDocument||s,f=o(f),(x=os.get(x))&&M(f,x),S=S.createElement("link"),vn(S);var R=S;R._p=new Promise(function($,he){R.onload=$,R.onerror=he}),Tn(S,"link",f),c.instance=S}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(i.count++,c=se.bind(i),s.addEventListener("load",c),s.addEventListener("error",c))}}var te=0;function xe(i,s){return i.stylesheets&&i.count===0&&Ce(i,i.stylesheets),0<i.count||0<i.imgCount?function(c){var f=setTimeout(function(){if(i.stylesheets&&Ce(i,i.stylesheets),i.unsuspend){var S=i.unsuspend;i.unsuspend=null,S()}},6e4+s);0<i.imgBytes&&te===0&&(te=62500*Cp());var x=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&Ce(i,i.stylesheets),i.unsuspend)){var S=i.unsuspend;i.unsuspend=null,S()}},(i.imgBytes>te?50:800)+s);return i.unsuspend=c,function(){i.unsuspend=null,clearTimeout(f),clearTimeout(x)}}:null}function se(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ce(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var ue=null;function Ce(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,ue=new Map,s.forEach(Le,i),ue=null,se.call(i))}function Le(i,s){if(!(s.state.loading&4)){var c=ue.get(i);if(c)var f=c.get(null);else{c=new Map,ue.set(i,c);for(var x=i.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<x.length;S++){var R=x[S];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(c.set(R.dataset.precedence,R),f=R)}f&&c.set(null,f)}x=s.instance,R=x.getAttribute("data-precedence"),S=c.get(R)||f,S===f&&c.set(null,x),c.set(R,x),this.count++,f=se.bind(this),x.addEventListener("load",f),x.addEventListener("error",f),S?S.parentNode.insertBefore(x,S.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(x,i.firstChild)),s.state.loading|=4}}var He={$$typeof:Mt,Provider:null,Consumer:null,_currentValue:Ct,_currentValue2:Ct,_threadCount:0};function at(i,s,c,f,x,S,R,$,he){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=sn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sn(0),this.hiddenUpdates=sn(null),this.identifierPrefix=f,this.onUncaughtError=x,this.onCaughtError=S,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function et(i,s,c,f,x,S,R,$,he,Ie,Ze,Ye){return i=new at(i,s,c,R,he,Ie,Ze,Ye,$),s=1,S===!0&&(s|=24),S=Oa(3,null,null,s),i.current=S,S.stateNode=i,s=Ua(),s.refCount++,i.pooledCache=s,s.refCount++,S.memoizedState={element:f,isDehydrated:c,cache:s},pi(S),i}function nt(i){return i?(i=Gr,i):Gr}function gt(i,s,c,f,x,S){x=nt(x),f.context===null?f.context=x:f.pendingContext=x,f=Mr(s),f.payload={element:c},S=S===void 0?null:S,S!==null&&(f.callback=S),c=Cr(i,f,s),c!==null&&(mr(c,i,s),Uo(c,i,s))}function tt(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function it(i,s){tt(i,s),(i=i.alternate)&&tt(i,s)}function je(i){if(i.tag===13||i.tag===31){var s=io(i,67108864);s!==null&&mr(s,i,67108864),it(i,67108864)}}function St(i){if(i.tag===13||i.tag===31){var s=pr();s=Ve(s);var c=io(i,s);c!==null&&mr(c,i,s),it(i,s)}}var zt=!0;function xt(i,s,c,f){var x=Fe.T;Fe.T=null;var S=st.p;try{st.p=2,Yt(i,s,c,f)}finally{st.p=S,Fe.T=x}}function ft(i,s,c,f){var x=Fe.T;Fe.T=null;var S=st.p;try{st.p=8,Yt(i,s,c,f)}finally{st.p=S,Fe.T=x}}function Yt(i,s,c,f){if(zt){var x=en(f);if(x===null)Td(i,s,f,yn,c),Yn(i,f);else if(Kn(x,i,s,c,f))f.stopPropagation();else if(Yn(i,f),s&4&&-1<Pr.indexOf(i)){for(;x!==null;){var S=Ta(x);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var R=Tt(S.pendingLanes);if(R!==0){var $=S;for($.pendingLanes|=2,$.entangledLanes|=2;R;){var he=1<<31-Se(R);$.entanglements[1]|=he,R&=~he}ss(S),(Mi&6)===0&&(hd=Nn()+500,vh(0))}}break;case 31:case 13:$=io(S,2),$!==null&&mr($,S,2),pd(),it(S,2)}if(S=en(f),S===null&&Td(i,s,f,yn,c),S===x)break;x=S}x!==null&&f.stopPropagation()}else Td(i,s,f,null,c)}}function en(i){return i=la(i),oa(i)}var yn=null;function oa(i){if(yn=null,i=fs(i),i!==null){var s=oe(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=z(s),i!==null)return i;i=null}else if(c===31){if(i=h(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return yn=i,null}function _r(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Vs()){case us:return 2;case hs:return 8;case ds:case ye:return 32;case Z:return 268435456;default:return 32}default:return 32}}var Pa=!1,an=null,yi=null,tn=null,Sn=new Map,Mn=new Map,Cn=[],Pr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Yn(i,s){switch(i){case"focusin":case"focusout":an=null;break;case"dragenter":case"dragleave":yi=null;break;case"mouseover":case"mouseout":tn=null;break;case"pointerover":case"pointerout":Sn.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mn.delete(s.pointerId)}}function ha(i,s,c,f,x,S){return i===null||i.nativeEvent!==S?(i={blockedOn:s,domEventName:c,eventSystemFlags:f,nativeEvent:S,targetContainers:[x]},s!==null&&(s=Ta(s),s!==null&&je(s)),i):(i.eventSystemFlags|=f,s=i.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),i)}function Kn(i,s,c,f,x){switch(s){case"focusin":return an=ha(an,i,s,c,f,x),!0;case"dragenter":return yi=ha(yi,i,s,c,f,x),!0;case"mouseover":return tn=ha(tn,i,s,c,f,x),!0;case"pointerover":var S=x.pointerId;return Sn.set(S,ha(Sn.get(S)||null,i,s,c,f,x)),!0;case"gotpointercapture":return S=x.pointerId,Mn.set(S,ha(Mn.get(S)||null,i,s,c,f,x)),!0}return!1}function Wn(i){var s=fs(i.target);if(s!==null){var c=oe(s);if(c!==null){if(s=c.tag,s===13){if(s=z(c),s!==null){i.blockedOn=s,Zs(i.priority,function(){St(c)});return}}else if(s===31){if(s=h(c),s!==null){i.blockedOn=s,Zs(i.priority,function(){St(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function En(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=en(i.nativeEvent);if(c===null){c=i.nativeEvent;var f=new c.constructor(c.type,c);al=f,c.target.dispatchEvent(f),al=null}else return s=Ta(c),s!==null&&je(s),i.blockedOn=c,!1;s.shift()}return!0}function An(i,s,c){En(i)&&c.delete(s)}function Qi(){Pa=!1,an!==null&&En(an)&&(an=null),yi!==null&&En(yi)&&(yi=null),tn!==null&&En(tn)&&(tn=null),Sn.forEach(An),Mn.forEach(An)}function yr(i,s){i.blockedOn===s&&(i.blockedOn=null,Pa||(Pa=!0,B.unstable_scheduleCallback(B.unstable_NormalPriority,Qi)))}var Qo=null;function ls(i){Qo!==i&&(Qo=i,B.unstable_scheduleCallback(B.unstable_NormalPriority,function(){Qo===i&&(Qo=null);for(var s=0;s<i.length;s+=3){var c=i[s],f=i[s+1],x=i[s+2];if(typeof f!="function"){if(oa(f||c)===null)continue;break}var S=Ta(c);S!==null&&(i.splice(s,3),s-=3,Jc(S,{pending:!0,data:x,method:c.method,action:f},f,x))}}))}function vu(i){function s(he){return yr(he,i)}an!==null&&yr(an,i),yi!==null&&yr(yi,i),tn!==null&&yr(tn,i),Sn.forEach(s),Mn.forEach(s);for(var c=0;c<Cn.length;c++){var f=Cn[c];f.blockedOn===i&&(f.blockedOn=null)}for(;0<Cn.length&&(c=Cn[0],c.blockedOn===null);)Wn(c),c.blockedOn===null&&Cn.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var x=c[f],S=c[f+1],R=x[bt]||null;if(typeof S=="function")R||ls(c);else if(R){var $=null;if(S&&S.hasAttribute("formAction")){if(x=S,R=S[bt]||null)$=R.formAction;else if(oa(x)!==null)continue}else $=R.action;typeof $=="function"?c[f+1]=$:(c.splice(f,3),f-=3),ls(c)}}}function Ec(){function i(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(R){return x=R})},focusReset:"manual",scroll:"manual"})}function s(){x!==null&&(x(),x=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,x=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),x!==null&&(x(),x=null)}}}function Jo(i){this._internalRoot=i}el.prototype.render=Jo.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(U(409));var c=s.current,f=pr();gt(c,f,i,s,null,null)},el.prototype.unmount=Jo.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;gt(i.current,2,null,i,null,null),pd(),s[Rt]=null}};function el(i){this._internalRoot=i}el.prototype.unstable_scheduleHydration=function(i){if(i){var s=Ia();i={blockedOn:null,target:i,priority:s};for(var c=0;c<Cn.length&&s!==0&&s<Cn[c].priority;c++);Cn.splice(c,0,i),c===0&&Wn(i)}};var Ac=N.version;if(Ac!=="19.2.0")throw Error(U(527,Ac,"19.2.0"));st.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(U(188)):(i=Object.keys(i).join(","),Error(U(268,i)));return i=_e(s),i=i!==null?We(i):null,i=i===null?null:i.stateNode,i};var xu={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Fe,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ah=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ah.isDisabled&&Ah.supportsFiber)try{re=Ah.inject(xu),le=Ah}catch{}}return Nf.createRoot=function(i,s){if(!J(i))throw Error(U(299));var c=!1,f="",x=Ku,S=Vd,R=$f;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(f=s.identifierPrefix),s.onUncaughtError!==void 0&&(x=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(R=s.onRecoverableError)),s=et(i,1,!1,null,null,c,f,null,x,S,R,Ec),i[Rt]=s.current,wd(i),new Jo(s)},Nf.hydrateRoot=function(i,s,c){if(!J(i))throw Error(U(299));var f=!1,x="",S=Ku,R=Vd,$=$f,he=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&($=c.onRecoverableError),c.formState!==void 0&&(he=c.formState)),s=et(i,1,!0,s,c??null,f,x,he,S,R,$,Ec),s.context=nt(null),c=s.current,f=pr(),f=Ve(f),x=Mr(f),x.callback=null,Cr(c,x,f),c=f,s.current.lanes=c,on(s,c),ss(s),i[Rt]=s.current,wd(i),new el(s)},Nf.version="19.2.0",Nf}var Tm;function mg(){if(Tm)return em.exports;Tm=1;function B(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(B)}catch(N){console.error(N)}}return B(),em.exports=pg(),em.exports}var gg=mg();const _g="_mapContainer_19ypd_1",yg="_mapPopup_19ypd_9",Sm={mapContainer:_g,mapPopup:yg},vg="modulepreload",xg=function(B){return"/"+B},Mm={},bg=function(N,V,U){let J=Promise.resolve();if(V&&V.length>0){let z=function(_e){return Promise.all(_e.map(We=>Promise.resolve(We).then(ke=>({status:"fulfilled",value:ke}),ke=>({status:"rejected",reason:ke}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),pe=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));J=z(V.map(_e=>{if(_e=xg(_e),_e in Mm)return;Mm[_e]=!0;const We=_e.endsWith(".css"),ke=We?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_e}"]${ke}`))return;const Ne=document.createElement("link");if(Ne.rel=We?"stylesheet":vg,We||(Ne.as="script"),Ne.crossOrigin="",Ne.href=_e,pe&&Ne.setAttribute("nonce",pe),document.head.appendChild(Ne),We)return new Promise((Te,ti)=>{Ne.addEventListener("load",Te),Ne.addEventListener("error",()=>ti(new Error(`Unable to preload CSS for ${_e}`)))})}))}function oe(z){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=z,window.dispatchEvent(h),!h.defaultPrevented)throw z}return J.then(z=>{for(const h of z||[])h.status==="rejected"&&oe(h.reason);return N().catch(oe)})},wg=yt.createContext(null);function Tg(B,N){const V=Array.isArray(B)?B[0]:B?B.x:0,U=Array.isArray(B)?B[1]:B?B.y:0,J=Array.isArray(N)?N[0]:N?N.x:0,oe=Array.isArray(N)?N[1]:N?N.y:0;return V===J&&U===oe}function cs(B,N){if(B===N)return!0;if(!B||!N)return!1;if(Array.isArray(B)){if(!Array.isArray(N)||B.length!==N.length)return!1;for(let V=0;V<B.length;V++)if(!cs(B[V],N[V]))return!1;return!0}else if(Array.isArray(N))return!1;if(typeof B=="object"&&typeof N=="object"){const V=Object.keys(B),U=Object.keys(N);if(V.length!==U.length)return!1;for(const J of V)if(!N.hasOwnProperty(J)||!cs(B[J],N[J]))return!1;return!0}return!1}function Cm(B){return{longitude:B.center.lng,latitude:B.center.lat,zoom:B.zoom,pitch:B.pitch,bearing:B.bearing,padding:B.padding}}function Em(B,N){const V=N.viewState||N,U={};if("longitude"in V&&"latitude"in V&&(V.longitude!==B.center.lng||V.latitude!==B.center.lat)){const J=B.center.constructor;U.center=new J(V.longitude,V.latitude)}return"zoom"in V&&V.zoom!==B.zoom&&(U.zoom=V.zoom),"bearing"in V&&V.bearing!==B.bearing&&(U.bearing=V.bearing),"pitch"in V&&V.pitch!==B.pitch&&(U.pitch=V.pitch),V.padding&&B.padding&&!cs(V.padding,B.padding)&&(U.padding=V.padding),U}const Sg=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Am(B){if(!B)return null;if(typeof B=="string"||("toJS"in B&&(B=B.toJS()),!B.layers))return B;const N={};for(const U of B.layers)N[U.id]=U;const V=B.layers.map(U=>{let J=null;"interactive"in U&&(J=Object.assign({},U),delete J.interactive);const oe=N[U.ref];if(oe){J=J||Object.assign({},U),delete J.ref;for(const z of Sg)z in oe&&(J[z]=oe[z])}return J||U});return{...B,layers:V}}const zm={version:8,sources:{},layers:[]},Pm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Dm={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Im={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Mg=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Cg=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Rd{constructor(N,V,U){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=J=>{const oe=this.props[Im[J.type]];oe?oe(J):J.type==="error"&&console.error(J.error)},this._onCameraEvent=J=>{if(this._internalUpdate)return;J.viewState=this._propsedCameraUpdate||Cm(this._map.transform);const oe=this.props[Dm[J.type]];oe&&oe(J)},this._onCameraUpdate=J=>this._internalUpdate?J:(this._propsedCameraUpdate=Cm(J),Em(J,this.props)),this._onPointerEvent=J=>{(J.type==="mousemove"||J.type==="mouseout")&&this._updateHover(J);const oe=this.props[Pm[J.type]];oe&&(this.props.interactiveLayerIds&&J.type!=="mouseover"&&J.type!=="mouseout"&&(J.features=this._hoveredFeatures||this._queryRenderedFeatures(J.point)),oe(J),delete J.features)},this._MapClass=N,this.props=V,this._initialize(U)}get map(){return this._map}setProps(N){const V=this.props;this.props=N;const U=this._updateSettings(N,V),J=this._updateSize(N),oe=this._updateViewState(N);this._updateStyle(N,V),this._updateStyleComponents(N),this._updateHandlers(N,V),(U||J||oe&&!this._map.isMoving())&&this.redraw()}static reuse(N,V){const U=Rd.savedMaps.pop();if(!U)return null;const J=U.map,oe=J.getContainer();for(V.className=oe.className;oe.childNodes.length>0;)V.appendChild(oe.childNodes[0]);J._container=V;const z=J._resizeObserver;z&&(z.disconnect(),z.observe(V)),U.setProps({...N,styleDiffing:!1}),J.resize();const{initialViewState:h}=N;return h&&(h.bounds?J.fitBounds(h.bounds,{...h.fitBoundsOptions,duration:0}):U._updateViewState(h)),J.isStyleLoaded()?J.fire("load"):J.once("style.load",()=>J.fire("load")),J._update(),U}_initialize(N){const{props:V}=this,{mapStyle:U=zm}=V,J={...V,...V.initialViewState,container:N,style:Am(U)},oe=J.initialViewState||J.viewState||J;if(Object.assign(J,{center:[oe.longitude||0,oe.latitude||0],zoom:oe.zoom||0,pitch:oe.pitch||0,bearing:oe.bearing||0}),V.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,V.gl)}const z=new this._MapClass(J);oe.padding&&z.setPadding(oe.padding),V.cursor&&(z.getCanvas().style.cursor=V.cursor),z.transformCameraUpdate=this._onCameraUpdate,z.on("style.load",()=>{var h;this._styleComponents={light:z.getLight(),sky:z.getSky(),projection:(h=z.getProjection)==null?void 0:h.call(z),terrain:z.getTerrain()},this._updateStyleComponents(this.props)}),z.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const h in Pm)z.on(h,this._onPointerEvent);for(const h in Dm)z.on(h,this._onCameraEvent);for(const h in Im)z.on(h,this._onEvent);this._map=z}recycle(){const V=this.map.getContainer().querySelector("[mapboxgl-children]");V==null||V.remove(),Rd.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const N=this._map;N.style&&(N._frame&&(N._frame.cancel(),N._frame=null),N._render())}_updateSize(N){const{viewState:V}=N;if(V){const U=this._map;if(V.width!==U.transform.width||V.height!==U.transform.height)return U.resize(),!0}return!1}_updateViewState(N){const V=this._map,U=V.transform;if(!V.isMoving()){const oe=Em(U,N);if(Object.keys(oe).length>0)return this._internalUpdate=!0,V.jumpTo(oe),this._internalUpdate=!1,!0}return!1}_updateSettings(N,V){const U=this._map;let J=!1;for(const oe of Mg)if(oe in N&&!cs(N[oe],V[oe])){J=!0;const z=U[`set${oe[0].toUpperCase()}${oe.slice(1)}`];z==null||z.call(U,N[oe])}return J}_updateStyle(N,V){if(N.cursor!==V.cursor&&(this._map.getCanvas().style.cursor=N.cursor||""),N.mapStyle!==V.mapStyle){const{mapStyle:U=zm,styleDiffing:J=!0}=N,oe={diff:J};"localIdeographFontFamily"in N&&(oe.localIdeographFontFamily=N.localIdeographFontFamily),this._map.setStyle(Am(U),oe)}}_updateStyleComponents({light:N,projection:V,sky:U,terrain:J}){var h,pe;const oe=this._map,z=this._styleComponents;oe.style._loaded&&(N&&!cs(N,z.light)&&(z.light=N,oe.setLight(N)),V&&!cs(V,z.projection)&&V!==((h=z.projection)==null?void 0:h.type)&&(z.projection=typeof V=="string"?{type:V}:V,(pe=oe.setProjection)==null||pe.call(oe,z.projection)),U&&!cs(U,z.sky)&&(z.sky=U,oe.setSky(U)),J!==void 0&&!cs(J,z.terrain)&&(!J||oe.getSource(J.source))&&(z.terrain=J,oe.setTerrain(J)))}_updateHandlers(N,V){const U=this._map;for(const J of Cg){const oe=N[J]??!0,z=V[J]??!0;cs(oe,z)||(oe?U[J].enable(oe):U[J].disable())}}_queryRenderedFeatures(N){const V=this._map,{interactiveLayerIds:U=[]}=this.props;try{return V.queryRenderedFeatures(N,{layers:U.filter(V.getLayer.bind(V))})}catch{return[]}}_updateHover(N){var J;const{props:V}=this;if(V.interactiveLayerIds&&(V.onMouseMove||V.onMouseEnter||V.onMouseLeave)){const oe=N.type,z=((J=this._hoveredFeatures)==null?void 0:J.length)>0,h=this._queryRenderedFeatures(N.point),pe=h.length>0;!pe&&z&&(N.type="mouseleave",this._onPointerEvent(N)),this._hoveredFeatures=h,pe&&!z&&(N.type="mouseenter",this._onPointerEvent(N)),N.type=oe}else this._hoveredFeatures=null}}Rd.savedMaps=[];const Eg=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ag(B){if(!B)return null;const N=B.map,V={getMap:()=>N};for(const U of zg(N))!(U in V)&&!Eg.includes(U)&&(V[U]=N[U].bind(N));return V}function zg(B){const N=new Set;let V=B;for(;V;){for(const U of Object.getOwnPropertyNames(V))U[0]!=="_"&&typeof B[U]=="function"&&U!=="fire"&&U!=="setEventedParent"&&N.add(U);V=Object.getPrototypeOf(V)}return Array.from(N)}const Pg=typeof document<"u"?yt.useLayoutEffect:yt.useEffect;function Dg(B,N){const{RTLTextPlugin:V,maxParallelImageRequests:U,workerCount:J,workerUrl:oe}=N;if(V&&B.getRTLTextPluginStatus&&B.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:z,lazy:h=!0}=typeof V=="string"?{pluginUrl:V}:V;B.setRTLTextPlugin(z,pe=>{pe&&console.error(pe)},h)}U!==void 0&&B.setMaxParallelImageRequests(U),J!==void 0&&B.setWorkerCount(J),oe!==void 0&&B.setWorkerUrl(oe)}const Ld=yt.createContext(null);function Ig(B,N){const V=yt.useContext(wg),[U,J]=yt.useState(null),oe=yt.useRef(),{current:z}=yt.useRef({mapLib:null,map:null});yt.useEffect(()=>{const _e=B.mapLib;let We=!0,ke;return Promise.resolve(_e||bg(()=>Promise.resolve().then(()=>Jg),void 0)).then(Ne=>{if(!We)return;if(!Ne)throw new Error("Invalid mapLib");const Te="Map"in Ne?Ne:Ne.default;if(!Te.Map)throw new Error("Invalid mapLib");Dg(Te,B),B.reuseMaps&&(ke=Rd.reuse(B,oe.current)),ke||(ke=new Rd(Te.Map,B,oe.current)),z.map=Ag(ke),z.mapLib=Te,J(ke),V==null||V.onMapMount(z.map,B.id)}).catch(Ne=>{const{onError:Te}=B;Te?Te({type:"error",target:null,originalEvent:null,error:Ne}):console.error(Ne)}),()=>{We=!1,ke&&(V==null||V.onMapUnmount(B.id),B.reuseMaps?ke.recycle():ke.destroy())}},[]),Pg(()=>{U&&U.setProps(B)}),yt.useImperativeHandle(N,()=>z.map,[U]);const h=yt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...B.style}),[B.style]),pe={height:"100%"};return yt.createElement("div",{id:B.id,ref:oe,style:h},U&&yt.createElement(Ld.Provider,{value:z},yt.createElement("div",{"mapboxgl-children":"",style:pe},B.children)))}const Rg=yt.forwardRef(Ig);var Om=Bm();const Lg=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function zc(B,N){if(!B||!N)return;const V=B.style;for(const U in N){const J=N[U];Number.isFinite(J)&&!Lg.test(U)?V[U]=`${J}px`:V[U]=J}}function Fm(B,N){if(B===N)return null;const V=Rm(B),U=Rm(N),J=[];for(const oe of U)V.has(oe)||J.push(oe);for(const oe of V)U.has(oe)||J.push(oe);return J.length===0?null:J}function Rm(B){return new Set(B?B.trim().split(/\s+/):[])}yt.memo(yt.forwardRef((B,N)=>{const{map:V,mapLib:U}=yt.useContext(Ld),J=yt.useRef({props:B}),oe=yt.useMemo(()=>{let Ii=!1;yt.Children.forEach(B.children,Jt=>{Jt&&(Ii=!0)});const di={...B,element:Ii?document.createElement("div"):void 0},Mt=new U.Marker(di);return Mt.setLngLat([B.longitude,B.latitude]),Mt.getElement().addEventListener("click",Jt=>{var vi,ei;(ei=(vi=J.current.props).onClick)==null||ei.call(vi,{type:"click",target:Mt,originalEvent:Jt})}),Mt.on("dragstart",Jt=>{var ei,Dt;const vi=Jt;vi.lngLat=oe.getLngLat(),(Dt=(ei=J.current.props).onDragStart)==null||Dt.call(ei,vi)}),Mt.on("drag",Jt=>{var ei,Dt;const vi=Jt;vi.lngLat=oe.getLngLat(),(Dt=(ei=J.current.props).onDrag)==null||Dt.call(ei,vi)}),Mt.on("dragend",Jt=>{var ei,Dt;const vi=Jt;vi.lngLat=oe.getLngLat(),(Dt=(ei=J.current.props).onDragEnd)==null||Dt.call(ei,vi)}),Mt},[]);yt.useEffect(()=>(oe.addTo(V.getMap()),()=>{oe.remove()}),[]);const{longitude:z,latitude:h,offset:pe,style:_e,draggable:We=!1,popup:ke=null,rotation:Ne=0,rotationAlignment:Te="auto",pitchAlignment:ti="auto"}=B;yt.useEffect(()=>{zc(oe.getElement(),_e)},[_e]),yt.useImperativeHandle(N,()=>oe,[]);const kt=J.current.props;(oe.getLngLat().lng!==z||oe.getLngLat().lat!==h)&&oe.setLngLat([z,h]),pe&&!Tg(oe.getOffset(),pe)&&oe.setOffset(pe),oe.isDraggable()!==We&&oe.setDraggable(We),oe.getRotation()!==Ne&&oe.setRotation(Ne),oe.getRotationAlignment()!==Te&&oe.setRotationAlignment(Te),oe.getPitchAlignment()!==ti&&oe.setPitchAlignment(ti),oe.getPopup()!==ke&&oe.setPopup(ke);const Zi=Fm(kt.className,B.className);if(Zi)for(const Ii of Zi)oe.toggleClassName(Ii);return J.current.props=B,Om.createPortal(B.children,oe.getElement())}));const kg=yt.memo(yt.forwardRef((B,N)=>{const{map:V,mapLib:U}=yt.useContext(Ld),J=yt.useMemo(()=>document.createElement("div"),[]),oe=yt.useRef({props:B}),z=yt.useMemo(()=>{const h={...B},pe=new U.Popup(h);return pe.setLngLat([B.longitude,B.latitude]),pe.once("open",_e=>{var We,ke;(ke=(We=oe.current.props).onOpen)==null||ke.call(We,_e)}),pe},[]);if(yt.useEffect(()=>{const h=pe=>{var _e,We;(We=(_e=oe.current.props).onClose)==null||We.call(_e,pe)};return z.on("close",h),z.setDOMContent(J).addTo(V.getMap()),()=>{z.off("close",h),z.isOpen()&&z.remove()}},[]),yt.useEffect(()=>{zc(z.getElement(),B.style)},[B.style]),yt.useImperativeHandle(N,()=>z,[]),z.isOpen()){const h=oe.current.props;(z.getLngLat().lng!==B.longitude||z.getLngLat().lat!==B.latitude)&&z.setLngLat([B.longitude,B.latitude]),B.offset&&!cs(h.offset,B.offset)&&z.setOffset(B.offset),(h.anchor!==B.anchor||h.maxWidth!==B.maxWidth)&&(z.options.anchor=B.anchor,z.setMaxWidth(B.maxWidth));const pe=Fm(h.className,B.className);if(pe)for(const _e of pe)z.toggleClassName(_e);oe.current.props=B}return Om.createPortal(B.children,J)}));function Ph(B,N,V,U){const J=yt.useContext(Ld),oe=yt.useMemo(()=>B(J),[]);return yt.useEffect(()=>{const z=N,h=null,pe=typeof N=="function"?N:null,{map:_e}=J;return _e.hasControl(oe)||(_e.addControl(oe,z==null?void 0:z.position),h&&h(J)),()=>{pe&&pe(J),_e.hasControl(oe)&&_e.removeControl(oe)}},[]),oe}function Bg(B){const N=Ph(({mapLib:V})=>new V.AttributionControl(B),{position:B.position});return yt.useEffect(()=>{zc(N._container,B.style)},[B.style]),null}yt.memo(Bg);function Og(B){const N=Ph(({mapLib:V})=>new V.FullscreenControl({container:B.containerId&&document.getElementById(B.containerId)}),{position:B.position});return yt.useEffect(()=>{zc(N._controlContainer,B.style)},[B.style]),null}yt.memo(Og);function Fg(B,N){const V=yt.useRef({props:B}),U=Ph(({mapLib:J})=>{const oe=new J.GeolocateControl(B),z=oe._setupUI;return oe._setupUI=()=>{oe._container.hasChildNodes()||z()},oe.on("geolocate",h=>{var pe,_e;(_e=(pe=V.current.props).onGeolocate)==null||_e.call(pe,h)}),oe.on("error",h=>{var pe,_e;(_e=(pe=V.current.props).onError)==null||_e.call(pe,h)}),oe.on("outofmaxbounds",h=>{var pe,_e;(_e=(pe=V.current.props).onOutOfMaxBounds)==null||_e.call(pe,h)}),oe.on("trackuserlocationstart",h=>{var pe,_e;(_e=(pe=V.current.props).onTrackUserLocationStart)==null||_e.call(pe,h)}),oe.on("trackuserlocationend",h=>{var pe,_e;(_e=(pe=V.current.props).onTrackUserLocationEnd)==null||_e.call(pe,h)}),oe},{position:B.position});return V.current.props=B,yt.useImperativeHandle(N,()=>U,[]),yt.useEffect(()=>{zc(U._container,B.style)},[B.style]),null}yt.memo(yt.forwardRef(Fg));function Ug(B){const N=Ph(({mapLib:V})=>new V.NavigationControl(B),{position:B.position});return yt.useEffect(()=>{zc(N._container,B.style)},[B.style]),null}yt.memo(Ug);function jg(B){const N=Ph(({mapLib:oe})=>new oe.ScaleControl(B),{position:B.position}),V=yt.useRef(B),U=V.current;V.current=B;const{style:J}=B;return B.maxWidth!==void 0&&B.maxWidth!==U.maxWidth&&(N.options.maxWidth=B.maxWidth),B.unit!==void 0&&B.unit!==U.unit&&N.setUnit(B.unit),yt.useEffect(()=>{zc(N._container,J)},[J]),null}yt.memo(jg);function Ng(B){const N=Ph(({mapLib:V})=>new V.TerrainControl(B),{position:B.position});return yt.useEffect(()=>{zc(N._container,B.style)},[B.style]),null}yt.memo(Ng);function Vg(B){const N=Ph(({mapLib:V})=>new V.LogoControl(B),{position:B.position});return yt.useEffect(()=>{zc(N._container,B.style)},[B.style]),null}yt.memo(Vg);function kp(B,N){if(!B)throw new Error(N)}let Zg=0;function Gg(B,N,V){if(B.style&&B.style._loaded){const U={...V};return delete U.id,delete U.children,B.addSource(N,U),B.getSource(N)}return null}function qg(B,N,V){var z,h,pe;kp(N.id===V.id,"source id changed"),kp(N.type===V.type,"source type changed");let U="",J=0;for(const _e in N)_e!=="children"&&_e!=="id"&&!cs(V[_e],N[_e])&&(U=_e,J++);if(!J)return;const oe=N.type;if(oe==="geojson")B.setData(N.data);else if(oe==="image")B.updateImage({url:N.url,coordinates:N.coordinates});else switch(U){case"coordinates":(z=B.setCoordinates)==null||z.call(B,N.coordinates);break;case"url":(h=B.setUrl)==null||h.call(B,N.url);break;case"tiles":(pe=B.setTiles)==null||pe.call(B,N.tiles);break;default:console.warn(`Unable to update <Source> prop: ${U}`)}}function Hg(B){const N=yt.useContext(Ld).map.getMap(),V=yt.useRef(B),[,U]=yt.useState(0),J=yt.useMemo(()=>B.id||`jsx-source-${Zg++}`,[]);yt.useEffect(()=>{if(N){const z=()=>setTimeout(()=>U(h=>h+1),0);return N.on("styledata",z),z(),()=>{var h;if(N.off("styledata",z),N.style&&N.style._loaded&&N.getSource(J)){const pe=(h=N.getStyle())==null?void 0:h.layers;if(pe)for(const _e of pe)_e.source===J&&N.removeLayer(_e.id);N.removeSource(J)}}}},[N]);let oe=N&&N.style&&N.getSource(J);return oe?qg(oe,B,V.current):oe=Gg(N,J,B),V.current=B,oe&&yt.Children.map(B.children,z=>z&&yt.cloneElement(z,{source:J}))||null}function $g(B,N,V,U){if(kp(V.id===U.id,"layer id changed"),kp(V.type===U.type,"layer type changed"),V.type==="custom"||U.type==="custom")return;const{layout:J={},paint:oe={},filter:z,minzoom:h,maxzoom:pe,beforeId:_e}=V;if(_e!==U.beforeId&&B.moveLayer(N,_e),J!==U.layout){const We=U.layout||{};for(const ke in J)cs(J[ke],We[ke])||B.setLayoutProperty(N,ke,J[ke]);for(const ke in We)J.hasOwnProperty(ke)||B.setLayoutProperty(N,ke,void 0)}if(oe!==U.paint){const We=U.paint||{};for(const ke in oe)cs(oe[ke],We[ke])||B.setPaintProperty(N,ke,oe[ke]);for(const ke in We)oe.hasOwnProperty(ke)||B.setPaintProperty(N,ke,void 0)}cs(z,U.filter)||B.setFilter(N,z),(h!==U.minzoom||pe!==U.maxzoom)&&B.setLayerZoomRange(N,h,pe)}function Xg(B,N,V){if(B.style&&B.style._loaded&&(!("source"in V)||B.getSource(V.source))){const U={...V,id:N};delete U.beforeId,B.addLayer(U,V.beforeId)}}let Yg=0;function Kg(B){const N=yt.useContext(Ld).map.getMap(),V=yt.useRef(B),[,U]=yt.useState(0),J=yt.useMemo(()=>B.id||`jsx-layer-${Yg++}`,[]);if(yt.useEffect(()=>{if(N){const z=()=>U(h=>h+1);return N.on("styledata",z),z(),()=>{N.off("styledata",z),N.style&&N.style._loaded&&N.getLayer(J)&&N.removeLayer(J)}}},[N]),N&&N.style&&N.getLayer(J))try{$g(N,J,B,V.current)}catch(z){console.warn(z)}else Xg(N,J,B);return V.current=B,null}var Rp={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.8.0/LICENSE.txt
 */var Wg=Rp.exports,Lm;function Qg(){return Lm||(Lm=1,(function(B,N){(function(V,U){B.exports=U()})(Wg,(function(){var V={},U={};function J(z,h,pe){if(U[z]=pe,z==="index"){var _e="var sharedModule = {}; ("+U.shared+")(sharedModule); ("+U.worker+")(sharedModule);",We={};return U.shared(We),U.index(V,We),typeof window<"u"&&V.setWorkerUrl(window.URL.createObjectURL(new Blob([_e],{type:"text/javascript"}))),V}}J("shared",["exports"],(function(z){function h(a,t,n,o){return new(n||(n=Promise))((function(u,p){function _(M){try{b(o.next(M))}catch(C){p(C)}}function v(M){try{b(o.throw(M))}catch(C){p(C)}}function b(M){var C;M.done?u(M.value):(C=M.value,C instanceof n?C:new n((function(P){P(C)}))).then(_,v)}b((o=o.apply(a,t||[])).next())}))}function pe(a,t){this.x=a,this.y=t}function _e(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var We,ke;typeof SuppressedError=="function"&&SuppressedError,pe.prototype={clone(){return new pe(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,n=a.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),n=Math.sin(a),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround(a,t){const n=Math.cos(a),o=Math.sin(a),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:pe},pe.convert=function(a){if(a instanceof pe)return a;if(Array.isArray(a))return new pe(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new pe(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ne=(function(){if(ke)return We;function a(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return ke=1,We=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=p/_}var v=0,b=1;for(o=t,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<n));u++)t>p?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},We})(),Te=_e(Ne);let ti,kt;function Zi(){return ti==null&&(ti=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ti}function Ii(){if(kt==null&&(kt=!1,Zi())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){kt=!0;break}}}return kt||!1}var di=1e-6,Mt=typeof Float32Array<"u"?Float32Array:Array;function Jt(){var a=new Mt(9);return Mt!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function vi(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ei(){var a=new Mt(3);return Mt!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Dt(a){var t=a[0],n=a[1],o=a[2];return Math.sqrt(t*t+n*n+o*o)}function Pn(a,t,n){var o=new Mt(3);return o[0]=a,o[1]=t,o[2]=n,o}function Dn(a,t,n){return a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a}function In(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a}function xi(a,t,n){var o=t[0],u=t[1],p=t[2],_=n[0],v=n[1],b=n[2];return a[0]=u*b-p*v,a[1]=p*_-o*b,a[2]=o*v-u*_,a}var Gi,da=Dt;function wa(a,t,n){var o=t[0],u=t[1],p=t[2],_=t[3];return a[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*_,a[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*_,a[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*_,a[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*_,a}function Rn(){var a=new Mt(4);return Mt!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Fe(a,t,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;t*=p,o*=p,n*=p;var _=Math.sin(t),v=Math.cos(t),b=Math.sin(n),M=Math.cos(n),C=Math.sin(o),P=Math.cos(o);switch(u){case"xyz":a[0]=_*M*P+v*b*C,a[1]=v*b*P-_*M*C,a[2]=v*M*C+_*b*P,a[3]=v*M*P-_*b*C;break;case"xzy":a[0]=_*M*P-v*b*C,a[1]=v*b*P-_*M*C,a[2]=v*M*C+_*b*P,a[3]=v*M*P+_*b*C;break;case"yxz":a[0]=_*M*P+v*b*C,a[1]=v*b*P-_*M*C,a[2]=v*M*C-_*b*P,a[3]=v*M*P+_*b*C;break;case"yzx":a[0]=_*M*P+v*b*C,a[1]=v*b*P+_*M*C,a[2]=v*M*C-_*b*P,a[3]=v*M*P-_*b*C;break;case"zxy":a[0]=_*M*P-v*b*C,a[1]=v*b*P+_*M*C,a[2]=v*M*C+_*b*P,a[3]=v*M*P-_*b*C;break;case"zyx":a[0]=_*M*P-v*b*C,a[1]=v*b*P+_*M*C,a[2]=v*M*C-_*b*P,a[3]=v*M*P+_*b*C;break;default:throw new Error("Unknown angle order "+u)}return a}function st(){var a=new Mt(2);return Mt!=Float32Array&&(a[0]=0,a[1]=0),a}function Ct(a,t){var n=new Mt(2);return n[0]=a,n[1]=t,n}ei(),Gi=new Mt(4),Mt!=Float32Array&&(Gi[0]=0,Gi[1]=0,Gi[2]=0,Gi[3]=0),ei(),Pn(1,0,0),Pn(0,1,0),Rn(),Rn(),Jt(),st();const _t=8192;function oi(a,t,n){return t*(_t/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}function fe(a,t){return(a%t+t)%t}function Ge(a,t,n){return a*(1-n)+t*n}function rt(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,n=t*a;return 4*(a<.5?n:3*(a-t)+n-.75)}function ut(a,t,n,o){const u=new Te(a,t,n,o);return p=>u.solve(p)}const Et=ut(.25,.1,.25,1);function At(a,t,n){return Math.min(n,Math.max(t,a))}function Qt(a,t,n){const o=n-t,u=((a-t)%o+o)%o+t;return u===t?n:u}function Ci(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}let ui=1;function ir(a,t,n){const o={};for(const u in a)o[u]=t.call(this,a[u],u,a);return o}function nr(a,t,n){const o={};for(const u in a)t.call(this,a[u],u,a)&&(o[u]=a[u]);return o}function Qn(a){return Array.isArray(a)?a.map(Qn):typeof a=="object"&&a?ir(a,Qn):a}const qi={};function Ri(a){qi[a]||(typeof console<"u"&&console.warn(a),qi[a]=!0)}function Xa(a,t,n){return(n.y-a.y)*(t.x-a.x)>(t.y-a.y)*(n.x-a.x)}function ar(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let wo=null;function xr(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const rr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Us(a,t,n,o,u){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(a,{timestamp:0});try{const _=p==null?void 0:p.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),b=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(b,(function(M,C,P,k,F){const j=4*Math.max(-C,0),H=(Math.max(0,P)-P)*k*4+j,Y=4*k,te=Math.max(0,C),xe=Math.max(0,P);return{rect:{x:te,y:xe,width:Math.min(M.width,C+k)-te,height:Math.min(M.height,P+F)-xe},layout:[{offset:H,stride:Y}]}})(a,t,n,o,u)),v)for(let M=0;M<b.length;M+=4){const C=b[M];b[M]=b[M+2],b[M+2]=C}return b}finally{p.close()}}))}let Dr,js;function Ns(a,t,n,o){return a.addEventListener(t,n,o),{unsubscribe:()=>{a.removeEventListener(t,n,o)}}}function Nn(a){return a*Math.PI/180}function Vs(a){return a/Math.PI*180}const us={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},hs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ds="AbortError";function ye(){return new Error(ds)}const Z={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function G(a){return Z.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const X="global-dispatcher";class re extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const le=()=>ar(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ge=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=G(a.url);if(o)return o(a,t);if(ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:X},t)}if(!(/^file:/.test(n=a.url)||/^file:/.test(le())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return h(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:le(),signal:u.signal});let _,v;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{_=yield fetch(p)}catch(M){throw new re(0,M.message,o.url,new Blob)}if(!_.ok){const M=yield _.blob();throw new re(_.status,_.statusText,o.url,M)}v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const b=yield v;if(u.signal.aborted)throw ye();return{data:b,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(a,t);if(ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:X},t)}var n;return(function(o,u){return new Promise(((p,_)=>{var v;const b=new XMLHttpRequest;b.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(b.responseType="arraybuffer");for(const M in o.headers)b.setRequestHeader(M,o.headers[M]);o.type==="json"&&(b.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=o.credentials==="include",b.onerror=()=>{_(new Error(b.statusText))},b.onload=()=>{if(!u.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let M=b.response;if(o.type==="json")try{M=JSON.parse(b.response)}catch(C){return void _(C)}p({data:M,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const M=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});_(new re(b.status,b.statusText,o.url,M))}},u.signal.addEventListener("abort",(()=>{b.abort(),_(ye())})),b.send(o.body)}))})(a,t)};function Se(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function we(a,t,n){n[a]&&n[a].indexOf(t)!==-1||(n[a]=n[a]||[],n[a].push(t))}function Be(a,t,n){if(n&&n[a]){const o=n[a].indexOf(t);o!==-1&&n[a].splice(o,1)}}class Ke{constructor(t,n={}){Ci(this,n),this.type=t}}class Ue extends Ke{constructor(t,n={}){super("error",Ci({error:t},n))}}class ct{on(t,n){return this._listeners=this._listeners||{},we(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Be(t,n,this._listeners),Be(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},we(t,n,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,n){typeof t=="string"&&(t=new Ke(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of u)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of p)Be(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(Ci(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Ue&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Tt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Zt(a,t){const n={};for(const o in a)o!=="ref"&&(n[o]=a[o]);return Tt.forEach((o=>{o in t&&(n[o]=t[o])})),n}function pt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!pt(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!pt(a[n],t[n]))return!1;return!0}return a===t}function Ut(a,t){a.push(t)}function Li(a,t,n){Ut(n,{command:"addSource",args:[a,t[a]]})}function sn(a,t,n){Ut(t,{command:"removeSource",args:[a]}),n[a]=!0}function on(a,t,n,o){sn(a,n,o),Li(a,t,n)}function Vn(a,t,n){let o;for(o in a[n])if(Object.prototype.hasOwnProperty.call(a[n],o)&&o!=="data"&&!pt(a[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!pt(a[n][o],t[n][o]))return!1;return!0}function Ln(a,t,n,o,u,p){a=a||{},t=t||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(pt(a[_],t[_])||n.push({command:p,args:[o,_,t[_],u]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(pt(a[_],t[_])||n.push({command:p,args:[o,_,t[_],u]}))}function ki(a){return a.id}function mn(a,t){return a[t.id]=t,a}class Ve{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function ln(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}class Ia extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Zs{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Zs(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const cn={kind:"null"},Xe={kind:"number"},bt={kind:"string"},Rt={kind:"boolean"},Zn={kind:"color"},To={kind:"projectionDefinition"},Gs={kind:"object"},Bt={kind:"value"},qs={kind:"collator"},Ir={kind:"formatted"},fs={kind:"padding"},Ta={kind:"colorArray"},Rr={kind:"numberArray"},Bi={kind:"resolvedImage"},vn={kind:"variableAnchorOffsetCollection"};function Sa(a,t){return{kind:"array",itemType:a,N:t}}function Ei(a){if(a.kind==="array"){const t=Ei(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const Hs=[cn,Xe,bt,Rt,Zn,To,Ir,Gs,Sa(Bt),fs,Rr,Ta,Bi,vn];function Lr(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Lr(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const n of Hs)if(!Lr(n,t))return null}}return`Expected ${Ei(a)} but found ${Ei(t)} instead.`}function wu(a,t){return t.some((n=>n.kind===a.kind))}function ps(a,t){return t.some((n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a))}function ms(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const Tu=.96422,jl=.82521,Nl=4/29,Ra=6/29,Ya=3*Ra*Ra,Dh=Ra*Ra*Ra,kd=Math.PI/180,Su=180/Math.PI;function Pc(a){return(a%=360)<0&&(a+=360),a}function gs([a,t,n,o]){let u,p;const _=La((.2225045*(a=Mu(a))+.7168786*(t=Mu(t))+.0606169*(n=Mu(n)))/1);a===t&&t===n?u=p=_:(u=La((.4360747*a+.3850649*t+.1430804*n)/Tu),p=La((.0139322*a+.0971045*t+.7141733*n)/jl));const v=116*_-16;return[v<0?0:v,500*(u-_),200*(_-p),o]}function Mu(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function La(a){return a>Dh?Math.pow(a,1/3):a/Ya+Nl}function $s([a,t,n,o]){let u=(a+16)/116,p=isNaN(t)?u:u+t/500,_=isNaN(n)?u:u-n/200;return u=1*Vl(u),p=Tu*Vl(p),_=jl*Vl(_),[Dc(3.1338561*p-1.6168667*u-.4906146*_),Dc(-.9787684*p+1.9161415*u+.033454*_),Dc(.0719453*p-.2289914*u+1.4052427*_),o]}function Dc(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function Vl(a){return a>Ra?a*a*a:Ya*(a-Nl)}const il=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function So(a,t){return il(a,t)?a[t]:void 0}function nl(a){return parseInt(a.padEnd(2,a),16)/255}function fa(a,t){return Ht(t?a/100:a,0,1)}function Ht(a,t,n){return Math.min(Math.max(t,a),n)}function Xs(a){return!a.some(Number.isNaN)}const _s={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function br(a,t,n){return a+n*(t-a)}function Mo(a,t,n){return a.map(((o,u)=>br(o,t[u],n)))}class $t{constructor(t,n,o,u=1,p=!0){this.r=t,this.g=n,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof $t)return t;if(typeof t!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=So(_s,o);if(u){const[_,v,b]=u;return[_/255,v/255,b/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[nl(o.slice(v,v+=_)),nl(o.slice(v,v+=_)),nl(o.slice(v,v+=_)),nl(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,M,C,P,k,F,j,H,Y,te,xe]=_,se=[C||" ",F||" ",Y].join("");if(se==="  "||se==="  /"||se===",,"||se===",,,"){const ue=[M,k,H].join(""),Ce=ue==="%%%"?100:ue===""?255:0;if(Ce){const Le=[Ht(+b/Ce,0,1),Ht(+P/Ce,0,1),Ht(+j/Ce,0,1),te?fa(+te,xe):1];if(Xs(Le))return Le}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[_,v,b,M,C,P,k,F,j]=p,H=[b||" ",C||" ",k].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const Y=[+v,Ht(+M,0,100),Ht(+P,0,100),F?fa(+F,j):1];if(Xs(Y))return(function([te,xe,se,ue]){function Ce(Le){const He=(Le+te/30)%12,at=xe*Math.min(se,1-se);return se-at*Math.max(-1,Math.min(He-3,9-He,1))}return te=Pc(te),xe/=100,se/=100,[Ce(0),Ce(8),Ce(4),ue]})(Y)}}})(t);return n?new $t(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[t/p,n/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,o,u,p]=gs(t),_=Math.sqrt(o*o+u*u);return[Math.round(1e4*_)?Pc(Math.atan2(u,o)*Su):NaN,_,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",gs(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map((p=>Math.round(255*p))).join(",")},${u})`}static interpolate(t,n,o,u="rgb"){switch(u){case"rgb":{const[p,_,v,b]=Mo(t.rgb,n.rgb,o);return new $t(p,_,v,b,!1)}case"hcl":{const[p,_,v,b]=t.hcl,[M,C,P,k]=n.hcl;let F,j;if(isNaN(p)||isNaN(M))isNaN(p)?isNaN(M)?F=NaN:(F=M,v!==1&&v!==0||(j=C)):(F=p,P!==1&&P!==0||(j=_));else{let se=M-p;M>p&&se>180?se-=360:M<p&&p-M>180&&(se+=360),F=p+o*se}const[H,Y,te,xe]=(function([se,ue,Ce,Le]){return se=isNaN(se)?0:se*kd,$s([Ce,Math.cos(se)*ue,Math.sin(se)*ue,Le])})([F,j??br(_,C,o),br(v,P,o),br(b,k,o)]);return new $t(H,Y,te,xe,!1)}case"lab":{const[p,_,v,b]=$s(Mo(t.lab,n.lab,o));return new $t(p,_,v,b,!1)}}}}$t.black=new $t(0,0,0,1),$t.white=new $t(1,1,1,1),$t.transparent=new $t(0,0,0,0),$t.red=new $t(1,0,0,1);class kr{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const sr=["bottom","center","top"];class al{constructor(t,n,o,u,p,_){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p,this.verticalAlign=_}}class la{constructor(t){this.sections=t}static fromString(t){return new la([new al(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof la?t:la.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(typeof t=="number")return new un([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new un(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new un(Mo(t.values,n.values,o))}}class kn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kn)return t;if(typeof t=="number")return new kn([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new kn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new kn(Mo(t.values,n.values,o))}}class xn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xn)return t;if(typeof t=="string"){const o=$t.parse(t);return o?new xn([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const u=$t.parse(o);if(!u)return;n.push(u)}return new xn(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,u="rgb"){const p=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)p.push($t.interpolate(t.values[_],n.values[_],o,u));return new xn(p)}}class bi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Cu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Gn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!Cu.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new Gn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const u=t.values,p=n.values;if(u.length!==p.length)throw new bi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let v=0;v<u.length;v+=2){if(u[v]!==p[v])throw new bi(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${u[v]}, to[${v}]: ${p[v]}`);_.push(u[v]);const[b,M]=u[v+1],[C,P]=p[v+1];_.push([br(b,C,o),br(M,P,o)])}return new Gn(_)}}class bn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new bn({name:t,available:!1}):null}}class Jn{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new Jn(t,n,o)}static parse(t){return t instanceof Jn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Jn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Jn(t.from,t.to,t.transition):typeof t=="string"?new Jn(t,t,1):void 0}}function wi(a,t,n,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,n,o]:[a,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ka(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Jn||a instanceof $t||a instanceof kr||a instanceof la||a instanceof un||a instanceof kn||a instanceof xn||a instanceof Gn||a instanceof bn)return!0;if(Array.isArray(a)){for(const t of a)if(!ka(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!ka(a[t]))return!1;return!0}return!1}function wt(a){if(a===null)return cn;if(typeof a=="string")return bt;if(typeof a=="boolean")return Rt;if(typeof a=="number")return Xe;if(a instanceof $t)return Zn;if(a instanceof Jn)return To;if(a instanceof kr)return qs;if(a instanceof la)return Ir;if(a instanceof un)return fs;if(a instanceof kn)return Rr;if(a instanceof xn)return Ta;if(a instanceof Gn)return vn;if(a instanceof bn)return Bi;if(Array.isArray(a)){const t=a.length;let n;for(const o of a){const u=wt(o);if(n){if(n===u)continue;n=Bt;break}n=u}return Sa(n||Bt,t)}return Gs}function It(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof $t||a instanceof Jn||a instanceof la||a instanceof un||a instanceof kn||a instanceof xn||a instanceof Gn||a instanceof bn?a.toString():JSON.stringify(a)}class Br{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ka(t[1]))return n.error("invalid value");const o=t[1];let u=wt(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Br(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Kt={string:bt,number:Xe,boolean:Rt,object:Gs};class pa{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=t[0];if(p==="array"){let v,b;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in Kt)||M==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Kt[M],u++}else v=Bt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=t[2],u++}o=Sa(v,b)}else{if(!Kt[p])throw new Error(`Types doesn't contain name = ${p}`);o=Kt[p]}const _=[];for(;u<t.length;u++){const v=n.parse(t[u],u,Bt);if(!v)return null;_.push(v)}return new pa(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Lr(this.type,wt(o)))return o;if(n===this.args.length-1)throw new bi(`Expected value to be of type ${Ei(this.type)}, but found ${Ei(wt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const wr={"to-boolean":Rt,"to-color":Zn,"to-number":Xe,"to-string":bt};class hn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!wr[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=wr[o],p=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],_,Bt);if(!v)return null;p.push(v)}return new hn(u,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof $t)return n;if(typeof n=="string"){const p=t.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:wi(n[0],n[1],n[2],n[3]),!o))return new $t(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new bi(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=un.parse(n);if(u)return u}throw new bi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=kn.parse(n);if(u)return u}throw new bi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=xn.parse(n);if(u)return u}throw new bi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=Gn.parse(n);if(u)return u}throw new bi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new bi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return la.fromString(It(this.args[0].evaluate(t)));case"resolvedImage":return bn.fromString(It(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return It(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Or=["Unknown","Point","LineString","Polygon"];class rl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Or[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=$t.parse(t),this._parseColorCache.set(t,n)),n}}class Fr{constructor(t,n,o=[],u,p=new Zs,_=[]){this.registry=t,this.path=o,this.key=o.map((v=>`[${v}]`)).join(""),this.scope=p,this.errors=_,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,p={}){return n?this.concat(n,o,u)._parse(t,p):this._parse(t,p)}_parse(t,n){function o(u,p,_){return _==="assert"?new pa(p,[u]):_==="coerce"?new hn(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let _=p.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(b.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(b.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(b.kind)||v.kind==="colorArray"&&["value","string","array"].includes(b.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(b.kind))_=o(_,v,n.typeAnnotation||"coerce");else if(this.checkSubtype(v,b))return null}else _=o(_,v,n.typeAnnotation||"assert")}if(!(_ instanceof Br)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new rl;try{_=new Br(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new Fr(this.registry,this._isConstant,u,n||null,p,this.errors)}error(t,...n){const o=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new Ia(o,t))}checkSubtype(t,n){const o=Lr(t,n);return o&&this.error(o),o}}class Zl{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const _=t[p];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=n.parse(t[p+1],p+1);if(!v)return null;o.push([_,v])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new Zl(o,u):null}outputDefined(){return this.result.outputDefined()}}class sl{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new sl(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ol{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Xe),u=n.parse(t[2],2,Sa(n.expectedType||Bt));return o&&u?new ol(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new bi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new bi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new bi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ys{constructor(t,n){this.type=Rt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Bt),u=n.parse(t[2],2,Bt);return o&&u?wu(o.type,[Rt,bt,Xe,cn,Bt])?new Ys(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!ps(n,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(wt(n))} instead.`);if(!ps(o,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${Ei(wt(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ba{constructor(t,n,o){this.type=Xe,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Bt),u=n.parse(t[2],2,Bt);if(!o||!u)return null;if(!wu(o.type,[Rt,bt,Xe,cn,Bt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Xe);return p?new Ba(o,u,p):null}return new Ba(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!ps(n,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(wt(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),ps(o,["string"])){const p=o.indexOf(n,u);return p===-1?-1:[...o.slice(0,p)].length}if(ps(o,["array"]))return o.indexOf(n,u);throw new bi(`Expected second argument to be of type array or string, but found ${Ei(wt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class qn{constructor(t,n,o,u,p,_){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},_=[];for(let M=2;M<t.length-1;M+=2){let C=t[M];const P=t[M+1];Array.isArray(C)||(C=[C]);const k=n.concat(M);if(C.length===0)return k.error("Expected at least one branch label.");for(const j of C){if(typeof j!="number"&&typeof j!="string")return k.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,wt(j)))return null}else o=wt(j);if(p[String(j)]!==void 0)return k.error("Branch labels must be unique.");p[String(j)]=_.length}const F=n.parse(P,M,u);if(!F)return null;u=u||F.type,_.push(F)}const v=n.parse(t[1],1,Bt);if(!v)return null;const b=n.parse(t[t.length-1],t.length-1,u);return b?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new qn(o,u,v,p,_,b):null}evaluate(t){const n=this.input.evaluate(t);return(wt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ll{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let _=1;_<t.length-1;_+=2){const v=n.parse(t[_],_,Rt);if(!v)return null;const b=n.parse(t[_+1],_+1,o);if(!b)return null;u.push([v,b]),o=o||b.type}const p=n.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new ll(o,u,p)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Gl{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Bt),u=n.parse(t[2],2,Xe);if(!o||!u)return null;if(!wu(o.type,[Sa(Bt),bt,Bt]))return n.error(`Expected first argument to be of type array or string, but found ${Ei(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Xe);return p?new Gl(o.type,o,u,p):null}return new Gl(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),ps(n,["string"]))return[...n].slice(o,u).join("");if(ps(n,["array"]))return n.slice(o,u);throw new bi(`Expected first argument to be of type array or string, but found ${Ei(wt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Co(a,t){const n=a.length-1;let o,u,p=0,_=n,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),o=a[v],u=a[v+1],o<=t){if(v===n||t<u)return v;p=v+1}else{if(!(o>t))throw new bi("Input is not a number.");_=v-1}return 0}class nn{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Xe);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],b=t[_+1],M=_,C=_+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const P=n.parse(b,C,p);if(!P)return null;p=p||P.type,u.push([v,P])}return new nn(p,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(t):o[Co(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Ih(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ql,Eu,Bd=(function(){if(Eu)return ql;function a(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return Eu=1,ql=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var p=this.sampleCurveX(o)-t;if(Math.abs(p)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=p/_}var v=0,b=1;for(o=t,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-t)<n));u++)t>p?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},ql})(),cl=Ih(Bd);class ea{constructor(t,n,o,u,p){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,n,o,u){let p=0;if(t.name==="exponential")p=Hl(n,t.base,o,u);else if(t.name==="linear")p=Hl(n,1,o,u);else if(t.name==="cubic-bezier"){const _=t.controlPoints;p=new cl(_[0],_[1],_[2],_[3]).solve(Hl(n,1,o,u))}return p}static parse(t,n){let[o,u,p,..._]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some((C=>typeof C!="number"||C<0||C>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Xe),!p)return null;const v=[];let b=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==Ta?n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType):b=Zn;for(let M=0;M<_.length;M+=2){const C=_[M],P=_[M+1],k=M+3,F=M+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const j=n.parse(P,F,b);if(!j)return null;b=b||j.type,v.push([C,j])}return ms(b,Xe)||ms(b,To)||ms(b,Zn)||ms(b,fs)||ms(b,Rr)||ms(b,Ta)||ms(b,vn)||ms(b,Sa(Xe))?new ea(b,o,u,p,v):n.error(`Type ${Ei(b)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(t);const _=Co(n,u),v=ea.interpolationFactor(this.interpolation,u,n[_],n[_+1]),b=o[_].evaluate(t),M=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return br(b,M,v);case"color":return $t.interpolate(b,M,v);case"padding":return un.interpolate(b,M,v);case"colorArray":return xn.interpolate(b,M,v);case"numberArray":return kn.interpolate(b,M,v);case"variableAnchorOffsetCollection":return Gn.interpolate(b,M,v);case"array":return Mo(b,M,v);case"projectionDefinition":return Jn.interpolate(b,M,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return $t.interpolate(b,M,v,"hcl");case"colorArray":return xn.interpolate(b,M,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return $t.interpolate(b,M,v,"lab");case"colorArray":return xn.interpolate(b,M,v,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Hl(a,t,n,o){const u=o-n,p=a-n;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}const Ur={color:$t.interpolate,number:br,padding:un.interpolate,numberArray:kn.interpolate,colorArray:xn.interpolate,variableAnchorOffsetCollection:Gn.interpolate,array:Mo};class $l{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const v of t.slice(1)){const b=n.parse(v,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,p.push(b)}if(!o)throw new Error("No output type");const _=u&&p.some((v=>Lr(u,v.type)));return new $l(_?Bt:o,p)}evaluate(t){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(t),o&&o instanceof bn&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Xl(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Eo(a,t,n,o){return o.compare(t,n)===0}function ma(a,t,n){const o=a!=="=="&&a!=="!=";return class Um{constructor(p,_,v){this.type=Rt,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const v=p[0];let b=_.parse(p[1],1,Bt);if(!b)return null;if(!Xl(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Ei(b.type)}'.`);let M=_.parse(p[2],2,Bt);if(!M)return null;if(!Xl(v,M.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Ei(M.type)}'.`);if(b.type.kind!==M.type.kind&&b.type.kind!=="value"&&M.type.kind!=="value")return _.error(`Cannot compare types '${Ei(b.type)}' and '${Ei(M.type)}'.`);o&&(b.type.kind==="value"&&M.type.kind!=="value"?b=new pa(M.type,[b]):b.type.kind!=="value"&&M.type.kind==="value"&&(M=new pa(b.type,[M])));let C=null;if(p.length===4){if(b.type.kind!=="string"&&M.type.kind!=="string"&&b.type.kind!=="value"&&M.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(p[3],3,qs),!C)return null}return new Um(b,M,C)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const b=wt(_),M=wt(v);if(b.kind!==M.kind||b.kind!=="string"&&b.kind!=="number")throw new bi(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${b.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=wt(_),M=wt(v);if(b.kind!=="string"||M.kind!=="string")return t(p,_,v)}return this.collator?n(p,_,v,this.collator.evaluate(p)):t(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Rh=ma("==",(function(a,t,n){return t===n}),Eo),Ic=ma("!=",(function(a,t,n){return t!==n}),(function(a,t,n,o){return!Eo(0,t,n,o)})),Lh=ma("<",(function(a,t,n){return t<n}),(function(a,t,n,o){return o.compare(t,n)<0})),Au=ma(">",(function(a,t,n){return t>n}),(function(a,t,n,o){return o.compare(t,n)>0})),Od=ma("<=",(function(a,t,n){return t<=n}),(function(a,t,n,o){return o.compare(t,n)<=0})),Fd=ma(">=",(function(a,t,n){return t>=n}),(function(a,t,n,o){return o.compare(t,n)>=0}));class Rc{constructor(t,n,o){this.type=qs,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Rt);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Rt);if(!p)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,bt),!_)?null:new Rc(u,p,_)}evaluate(t){return new kr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class zu{constructor(t,n,o,u,p){this.type=bt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Xe);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,bt),!p))return null;let _=null;if(u.currency&&(_=n.parse(u.currency,1,bt),!_))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,Xe),!v))return null;let b=null;return u["max-fraction-digits"]&&(b=n.parse(u["max-fraction-digits"],1,Xe),!b)?null:new zu(o,p,_,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ao{constructor(t){this.type=Ir,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let b=null;if(v["font-scale"]&&(b=n.parse(v["font-scale"],1,Xe),!b))return null;let M=null;if(v["text-font"]&&(M=n.parse(v["text-font"],1,Sa(bt)),!M))return null;let C=null;if(v["text-color"]&&(C=n.parse(v["text-color"],1,Zn),!C))return null;let P=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!sr.includes(v["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(P=n.parse(v["vertical-align"],1,bt),!P)return null}const k=u[u.length-1];k.scale=b,k.font=M,k.textColor=C,k.verticalAlign=P}else{const b=n.parse(t[_],1,Bt);if(!b)return null;const M=b.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ao(u)}evaluate(t){return new la(this.sections.map((n=>{const o=n.content.evaluate(t);return wt(o)===Bi?new al("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new al(It(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Pu{constructor(t){this.type=Bi,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,bt);return o?new Pu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=bn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Lc{constructor(t){this.type=Xe,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ei(o.type)} instead.`):new Lc(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new bi(`Expected value to be of type string or array, but found ${Ei(wt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Tr=8192;function Du(a,t){const n=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*Tr),Math.round(o*u*Tr)]}function Ks(a,t){const n=Math.pow(2,t.z);return[(u=(a[0]/Tr+t.x)/n,360*u-180),(o=(a[1]/Tr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Yl(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function ul(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function kh(a,t,n){const o=a[0]-t[0],u=a[1]-t[1],p=a[0]-n[0],_=a[1]-n[1];return o*_-p*u==0&&o*p<=0&&u*_<=0}function Kl(a,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(p=[t[0]-a[0],t[1]-a[1]])[1]-u[1]*p[0]!=0&&!(!Oh(a,t,n,o)||!Oh(n,o,a,t));var u,p}function Bh(a,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(Kl(a,t,o[u],o[u+1]))return!0;return!1}function Ws(a,t,n=!1){let o=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(kh(a,v[b],v[b+1]))return n;(p=v[b])[1]>(u=a)[1]!=(_=v[b+1])[1]>u[1]&&u[0]<(_[0]-p[0])*(u[1]-p[1])/(_[1]-p[1])+p[0]&&(o=!o)}var u,p,_;return o}function zo(a,t){for(const n of t)if(Ws(a,n))return!0;return!1}function Iu(a,t){for(const n of a)if(!Ws(n,t))return!1;for(let n=0;n<a.length-1;++n)if(Bh(a[n],a[n+1],t))return!1;return!0}function Ud(a,t){for(const n of t)if(Iu(a,n))return!0;return!1}function Oh(a,t,n,o){const u=o[0]-n[0],p=o[1]-n[1],_=(a[0]-n[0])*p-u*(a[1]-n[1]),v=(t[0]-n[0])*p-u*(t[1]-n[1]);return _>0&&v<0||_<0&&v>0}function kc(a,t,n){const o=[];for(let u=0;u<a.length;u++){const p=[];for(let _=0;_<a[u].length;_++){const v=Du(a[u][_],n);Yl(t,v),p.push(v)}o.push(p)}return o}function Ru(a,t,n){const o=[];for(let u=0;u<a.length;u++){const p=kc(a[u],t,n);o.push(p)}return o}function Qs(a,t,n,o){if(a[0]<n[0]||a[0]>n[2]){const u=.5*o;let p=a[0]-n[0]>u?-o:n[0]-a[0]>u?o:0;p===0&&(p=a[0]-n[2]>u?-o:n[2]-a[0]>u?o:0),a[0]+=p}Yl(t,a)}function hl(a,t,n,o){const u=Math.pow(2,o.z)*Tr,p=[o.x*Tr,o.y*Tr],_=[];for(const v of a)for(const b of v){const M=[b.x+p[0],b.y+p[1]];Qs(M,t,n,u),_.push(M)}return _}function Fh(a,t,n,o){const u=Math.pow(2,o.z)*Tr,p=[o.x*Tr,o.y*Tr],_=[];for(const b of a){const M=[];for(const C of b){const P=[C.x+p[0],C.y+p[1]];Yl(t,P),M.push(P)}_.push(M)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const M of b)Qs(M,t,n,u)}var v;return _}class jr{constructor(t,n){this.type=Rt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ka(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:_,coordinates:v}=p.geometry;_==="Polygon"&&u.push(v),_==="MultiPolygon"&&u.push(...v)}if(u.length)return new jr(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new jr(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new jr(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=kc(o.coordinates,p,_),b=hl(n.geometry(),u,p,_);if(!ul(u,p))return!1;for(const M of b)if(!Ws(M,v))return!1}if(o.type==="MultiPolygon"){const v=Ru(o.coordinates,p,_),b=hl(n.geometry(),u,p,_);if(!ul(u,p))return!1;for(const M of b)if(!zo(M,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=kc(o.coordinates,p,_),b=Fh(n.geometry(),u,p,_);if(!ul(u,p))return!1;for(const M of b)if(!Iu(M,v))return!1}if(o.type==="MultiPolygon"){const v=Ru(o.coordinates,p,_),b=Fh(n.geometry(),u,p,_);if(!ul(u,p))return!1;for(const M of b)if(!Ud(M,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Bc=class{constructor(a=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:n}=this,o=t[a];for(;a>0;){const u=a-1>>1,p=t[u];if(n(o,p)>=0)break;t[a]=p,a=u}t[a]=o}_down(a){const{data:t,compare:n}=this,o=this.length>>1,u=t[a];for(;a<o;){let p=1+(a<<1);const _=p+1;if(_<this.length&&n(t[_],t[p])<0&&(p=_),n(t[p],u)>=0)break;t[a]=t[p],a=p}t[a]=u}};function Oc(a,t,n=0,o=a.length-1,u=Lu){for(;o>n;){if(o-n>600){const b=o-n+1,M=t-n+1,C=Math.log(b),P=.5*Math.exp(2*C/3),k=.5*Math.sqrt(C*P*(b-P)/b)*(M-b/2<0?-1:1);Oc(a,t,Math.max(n,Math.floor(t-M*P/b+k)),Math.min(o,Math.floor(t+(b-M)*P/b+k)),u)}const p=a[t];let _=n,v=o;for(Po(a,n,t),u(a[o],p)>0&&Po(a,n,o);_<v;){for(Po(a,_,v),_++,v--;u(a[_],p)<0;)_++;for(;u(a[v],p)>0;)v--}u(a[n],p)===0?Po(a,n,v):(v++,Po(a,v,o)),v<=t&&(n=v+1),t<=v&&(o=v-1)}}function Po(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function Lu(a,t){return a<t?-1:a>t?1:0}function dl(a,t){if(a.length<=1)return[a];const n=[];let o,u;for(const p of a){const _=Uh(p);_!==0&&(p.area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),t>1)for(let p=0;p<n.length;p++)n[p].length<=t||(Oc(n[p],t,1,n[p].length-1,ku),n[p]=n[p].slice(0,t));return n}function ku(a,t){return t.area-a.area}function Uh(a){let t=0;for(let n,o,u=0,p=a.length,_=p-1;u<p;_=u++)n=a[u],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}const jh=1/298.257223563,Nh=jh*(2-jh),Bu=Math.PI/180;class Ou{constructor(t){const n=6378.137*Bu*1e3,o=Math.cos(t*Bu),u=1/(1-Nh*(1-o*o)),p=Math.sqrt(u);this.kx=n*p*o,this.ky=n*p*u*(1-Nh)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,p,_,v=1/0;for(let b=0;b<t.length-1;b++){let M=t[b][0],C=t[b][1],P=this.wrap(t[b+1][0]-M)*this.kx,k=(t[b+1][1]-C)*this.ky,F=0;P===0&&k===0||(F=(this.wrap(n[0]-M)*this.kx*P+(n[1]-C)*this.ky*k)/(P*P+k*k),F>1?(M=t[b+1][0],C=t[b+1][1]):F>0&&(M+=P/this.kx*F,C+=k/this.ky*F)),P=this.wrap(n[0]-M)*this.kx,k=(n[1]-C)*this.ky;const j=P*P+k*k;j<v&&(v=j,o=M,u=C,p=b,_=F)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Vh(a,t){return t[0]-a[0]}function ga(a){return a[1]-a[0]+1}function Ka(a,t){return a[1]>=a[0]&&a[1]<t}function li(a,t){if(a[0]>a[1])return[null,null];const n=ga(a);if(t){if(n===2)return[a,null];const u=Math.floor(n/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}if(n===1)return[a,null];const o=Math.floor(n/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function Fc(a,t){if(!Ka(t,a.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Yl(n,a[o]);return n}function Uc(a){const t=[1/0,1/0,-1/0,-1/0];for(const n of a)for(const o of n)Yl(t,o);return t}function Fu(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Wl(a,t,n){if(!Fu(a)||!Fu(t))return NaN;let o=0,u=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(u=a[1]-t[3]),a[3]<t[1]&&(u=t[1]-a[3]),n.distance([0,0],[o,u])}function Do(a,t,n){const o=n.pointOnLine(t,a);return n.distance(a,o.point)}function Js(a,t,n,o,u){const p=Math.min(Do(a,[n,o],u),Do(t,[n,o],u)),_=Math.min(Do(n,[a,t],u),Do(o,[a,t],u));return Math.min(p,_)}function Uu(a,t,n,o,u){if(!Ka(t,a.length)||!Ka(o,n.length))return 1/0;let p=1/0;for(let _=t[0];_<t[1];++_){const v=a[_],b=a[_+1];for(let M=o[0];M<o[1];++M){const C=n[M],P=n[M+1];if(Kl(v,b,C,P))return 0;p=Math.min(p,Js(v,b,C,P,u))}}return p}function Ql(a,t,n,o,u){if(!Ka(t,a.length)||!Ka(o,n.length))return NaN;let p=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(p=Math.min(p,u.distance(a[_],n[v])),p===0)return p;return p}function ju(a,t,n){if(Ws(a,t,!0))return 0;let o=1/0;for(const u of t){const p=u[0],_=u[u.length-1];if(p!==_&&(o=Math.min(o,Do(a,[_,p],n)),o===0))return o;const v=n.pointOnLine(u,a);if(o=Math.min(o,n.distance(a,v.point)),o===0)return o}return o}function Zh(a,t,n,o){if(!Ka(t,a.length))return NaN;for(let p=t[0];p<=t[1];++p)if(Ws(a[p],n,!0))return 0;let u=1/0;for(let p=t[0];p<t[1];++p){const _=a[p],v=a[p+1];for(const b of n)for(let M=0,C=b.length,P=C-1;M<C;P=M++){const k=b[P],F=b[M];if(Kl(_,v,k,F))return 0;u=Math.min(u,Js(_,v,k,F,o))}}return u}function eo(a,t){for(const n of a)for(const o of n)if(Ws(o,t,!0))return!0;return!1}function fl(a,t,n,o=1/0){const u=Uc(a),p=Uc(t);if(o!==1/0&&Wl(u,p,n)>=o)return o;if(ul(u,p)){if(eo(a,t))return 0}else if(eo(t,a))return 0;let _=1/0;for(const v of a)for(let b=0,M=v.length,C=M-1;b<M;C=b++){const P=v[C],k=v[b];for(const F of t)for(let j=0,H=F.length,Y=H-1;j<H;Y=j++){const te=F[Y],xe=F[j];if(Kl(P,k,te,xe))return 0;_=Math.min(_,Js(P,k,te,xe,n))}}return _}function jc(a,t,n,o,u,p){if(!p)return;const _=Wl(Fc(o,p),u,n);_<t&&a.push([_,p,[0,0]])}function Jl(a,t,n,o,u,p,_){if(!p||!_)return;const v=Wl(Fc(o,p),Fc(u,_),n);v<t&&a.push([v,p,_])}function Nr(a,t,n,o,u=1/0){let p=Math.min(o.distance(a[0],n[0][0]),u);if(p===0)return p;const _=new Bc([[0,[0,a.length-1],[0,0]]],Vh),v=Uc(n);for(;_.length>0;){const b=_.pop();if(b[0]>=p)continue;const M=b[1],C=t?50:100;if(ga(M)<=C){if(!Ka(M,a.length))return NaN;if(t){const P=Zh(a,M,n,o);if(isNaN(P)||P===0)return P;p=Math.min(p,P)}else for(let P=M[0];P<=M[1];++P){const k=ju(a[P],n,o);if(p=Math.min(p,k),p===0)return 0}}else{const P=li(M,t);jc(_,p,o,a,v,P[0]),jc(_,p,o,a,v,P[1])}}return p}function ec(a,t,n,o,u,p=1/0){let _=Math.min(p,u.distance(a[0],n[0]));if(_===0)return _;const v=new Bc([[0,[0,a.length-1],[0,n.length-1]]],Vh);for(;v.length>0;){const b=v.pop();if(b[0]>=_)continue;const M=b[1],C=b[2],P=t?50:100,k=o?50:100;if(ga(M)<=P&&ga(C)<=k){if(!Ka(M,a.length)&&Ka(C,n.length))return NaN;let F;if(t&&o)F=Uu(a,M,n,C,u),_=Math.min(_,F);else if(t&&!o){const j=a.slice(M[0],M[1]+1);for(let H=C[0];H<=C[1];++H)if(F=Do(n[H],j,u),_=Math.min(_,F),_===0)return _}else if(!t&&o){const j=n.slice(C[0],C[1]+1);for(let H=M[0];H<=M[1];++H)if(F=Do(a[H],j,u),_=Math.min(_,F),_===0)return _}else F=Ql(a,M,n,C,u),_=Math.min(_,F)}else{const F=li(M,t),j=li(C,o);Jl(v,_,u,a,n,F[0],j[0]),Jl(v,_,u,a,n,F[0],j[1]),Jl(v,_,u,a,n,F[1],j[0]),Jl(v,_,u,a,n,F[1],j[1])}}return _}function Nc(a){return a.type==="MultiPolygon"?a.coordinates.map((t=>({type:"Polygon",coordinates:t}))):a.type==="MultiLineString"?a.coordinates.map((t=>({type:"LineString",coordinates:t}))):a.type==="MultiPoint"?a.coordinates.map((t=>({type:"Point",coordinates:t}))):[a]}class to{constructor(t,n){this.type=Xe,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ka(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new to(o,o.features.map((u=>Nc(u.geometry))).flat());if(o.type==="Feature")return new to(o,Nc(o.geometry));if("type"in o&&"coordinates"in o)return new to(o,Nc(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const u=n.geometry(),p=u.flat().map((b=>Ks([b.x,b.y],n.canonical)));if(u.length===0)return NaN;const _=new Ou(p[0][1]);let v=1/0;for(const b of o){switch(b.type){case"Point":v=Math.min(v,ec(p,!1,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,ec(p,!1,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Nr(p,!1,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const u=n.geometry(),p=u.flat().map((b=>Ks([b.x,b.y],n.canonical)));if(u.length===0)return NaN;const _=new Ou(p[0][1]);let v=1/0;for(const b of o){switch(b.type){case"Point":v=Math.min(v,ec(p,!0,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,ec(p,!0,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Nr(p,!0,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const p=dl(u,0).map((b=>b.map((M=>M.map((C=>Ks([C.x,C.y],n.canonical))))))),_=new Ou(p[0][0][0][1]);let v=1/0;for(const b of o)for(const M of p){switch(b.type){case"Point":v=Math.min(v,Nr([b.coordinates],!1,M,_,v));break;case"LineString":v=Math.min(v,Nr(b.coordinates,!0,M,_,v));break;case"Polygon":v=Math.min(v,fl(M,b.coordinates,_,v))}if(v===0)return v}return v})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class tc{constructor(t){this.type=Bt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new tc(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?So(o,this.key):null}eachChild(){}outputDefined(){return!1}}const pl={"==":Rh,"!=":Ic,">":Au,"<":Lh,">=":Fd,"<=":Od,array:pa,at:ol,boolean:pa,case:ll,coalesce:$l,collator:Rc,format:Ao,image:Pu,in:Ys,"index-of":Ba,interpolate:ea,"interpolate-hcl":ea,"interpolate-lab":ea,length:Lc,let:Zl,literal:Br,match:qn,number:pa,"number-format":zu,object:pa,slice:Gl,step:nn,string:pa,"to-boolean":hn,"to-color":hn,"to-number":hn,"to-string":hn,var:sl,within:jr,distance:to,"global-state":tc};class or{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=or.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=_.filter((([M])=>!Array.isArray(M)||M.length===t.length-1));let b=null;for(const[M,C]of v){b=new Fr(n.registry,Io,n.path,null,n.scope);const P=[];let k=!1;for(let F=1;F<t.length;F++){const j=t[F],H=Array.isArray(M)?M[F-1]:M.type,Y=b.parse(j,1+P.length,H);if(!Y){k=!0;break}P.push(Y)}if(!k)if(Array.isArray(M)&&M.length!==P.length)b.error(`Expected ${M.length} arguments, but found ${P.length} instead.`);else{for(let F=0;F<P.length;F++){const j=Array.isArray(M)?M[F]:M.type,H=P[F];b.concat(F+1).checkSubtype(j,H.type)}if(b.errors.length===0)return new or(o,p,C,P)}}if(v.length===1)n.errors.push(...b.errors);else{const M=(v.length?v:_).map((([P])=>{return k=P,Array.isArray(k)?`(${k.map(Ei).join(", ")})`:`(${Ei(k.type)}...)`;var k})).join(" | "),C=[];for(let P=1;P<t.length;P++){const k=n.parse(t[P],1+C.length);if(!k)return null;C.push(Ei(k.type))}n.error(`Expected arguments of type ${M}, but found (${C.join(", ")}) instead.`)}return null}static register(t,n){or.definitions=n;for(const o in n)t[o]=or}}function Nu(a,[t,n,o,u]){t=t.evaluate(a),n=n.evaluate(a),o=o.evaluate(a);const p=u?u.evaluate(a):1,_=wi(t,n,o,p);if(_)throw new bi(_);return new $t(t/255,n/255,o/255,p,!1)}function Vu(a,t){return a in t}function ic(a,t){const n=t[a];return n===void 0?null:n}function ca(a){return{type:a}}function Io(a){if(a instanceof sl)return Io(a.boundExpression);if(a instanceof or&&a.name==="error"||a instanceof Rc||a instanceof jr||a instanceof to||a instanceof tc)return!1;const t=a instanceof hn||a instanceof pa;let n=!0;return a.eachChild((o=>{n=t?n&&Io(o):n&&o instanceof Br})),!!n&&Ma(a)&&ml(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ma(a){if(a instanceof or&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof jr||a instanceof to)return!1;let t=!0;return a.eachChild((n=>{t&&!Ma(n)&&(t=!1)})),t}function Vr(a){if(a instanceof or&&a.name==="feature-state")return!1;let t=!0;return a.eachChild((n=>{t&&!Vr(n)&&(t=!1)})),t}function ml(a,t){if(a instanceof or&&t.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild((o=>{n&&!ml(o,t)&&(n=!1)})),n}function nc(a){return{result:"success",value:a}}function ys(a){return{result:"error",value:a}}function Zr(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function io(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Vc(a){return!!a.expression&&a.expression.interpolated}function Gt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Gr(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&wt(a)===Gs}function jd(a){return a}function Oa(a,t){const n=a.stops&&typeof a.stops[0][0]=="object",o=n||!(n||a.property!==void 0),u=a.type||(Vc(t)?"exponential":"interval"),p=(function(C){switch(C.type){case"color":return $t.parse;case"padding":return un.parse;case"numberArray":return kn.parse;case"colorArray":return xn.parse;default:return null}})(t);if(p&&((a=ln({},a)).stops&&(a.stops=a.stops.map((C=>[C[0],p(C[1])]))),a.default=p(a.default?a.default:t.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const v=(function(C){switch(C){case"exponential":return ac;case"interval":return Gh;case"categorical":return Hr;case"identity":return Ro;default:throw new Error(`Unknown function type "${C}"`)}})(u);let b,M;if(u==="categorical"){b=Object.create(null);for(const C of a.stops)b[C[0]]=C[1];M=typeof a.stops[0][0]}if(n){const C={},P=[];for(let j=0;j<a.stops.length;j++){const H=a.stops[j],Y=H[0].zoom;C[Y]===void 0&&(C[Y]={zoom:Y,type:a.type,property:a.property,default:a.default,stops:[]},P.push(Y)),C[Y].stops.push([H[0].value,H[1]])}const k=[];for(const j of P)k.push([C[j].zoom,Oa(C[j],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:ea.interpolationFactor.bind(void 0,F),zoomStops:k.map((j=>j[0])),evaluate:({zoom:j},H)=>ac({stops:k,base:a.base},t,j).evaluate(j,H)}}if(o){const C=u==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:ea.interpolationFactor.bind(void 0,C),zoomStops:a.stops.map((P=>P[0])),evaluate:({zoom:P})=>v(a,t,P,b,M)}}return{kind:"source",evaluate(C,P){const k=P&&P.properties?P.properties[a.property]:void 0;return k===void 0?qr(a.default,t.default):v(a,t,k,b,M)}}}function qr(a,t,n){return a!==void 0?a:t!==void 0?t:n!==void 0?n:void 0}function Hr(a,t,n,o,u){return qr(typeof n===u?o[n]:void 0,a.default,t.default)}function Gh(a,t,n){if(Gt(n)!=="number")return qr(a.default,t.default);const o=a.stops.length;if(o===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[o-1][0])return a.stops[o-1][1];const u=Co(a.stops.map((p=>p[0])),n);return a.stops[u][1]}function ac(a,t,n){const o=a.base!==void 0?a.base:1;if(Gt(n)!=="number")return qr(a.default,t.default);const u=a.stops.length;if(u===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[u-1][0])return a.stops[u-1][1];const p=Co(a.stops.map((C=>C[0])),n),_=(function(C,P,k,F){const j=F-k,H=C-k;return j===0?0:P===1?H/j:(Math.pow(P,H)-1)/(Math.pow(P,j)-1)})(n,o,a.stops[p][0],a.stops[p+1][0]),v=a.stops[p][1],b=a.stops[p+1][1],M=Ur[t.type]||jd;return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),k=b.evaluate.apply(void 0,C);if(P!==void 0&&k!==void 0)return M(P,k,_,a.colorSpace)}}:M(v,b,_,a.colorSpace)}function Ro(a,t,n){switch(t.type){case"color":n=$t.parse(n);break;case"formatted":n=la.fromString(n.toString());break;case"resolvedImage":n=bn.fromString(n.toString());break;case"padding":n=un.parse(n);break;case"colorArray":n=xn.parse(n);break;case"numberArray":n=kn.parse(n);break;default:Gt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return qr(n,a.default,t.default)}or.register(pl,{error:[{kind:"error"},[bt],(a,[t])=>{throw new bi(t.evaluate(a))}],typeof:[bt,[Bt],(a,[t])=>Ei(wt(t.evaluate(a)))],"to-rgba":[Sa(Xe,4),[Zn],(a,[t])=>{const[n,o,u,p]=t.evaluate(a).rgb;return[255*n,255*o,255*u,p]}],rgb:[Zn,[Xe,Xe,Xe],Nu],rgba:[Zn,[Xe,Xe,Xe,Xe],Nu],has:{type:Rt,overloads:[[[bt],(a,[t])=>Vu(t.evaluate(a),a.properties())],[[bt,Gs],(a,[t,n])=>Vu(t.evaluate(a),n.evaluate(a))]]},get:{type:Bt,overloads:[[[bt],(a,[t])=>ic(t.evaluate(a),a.properties())],[[bt,Gs],(a,[t,n])=>ic(t.evaluate(a),n.evaluate(a))]]},"feature-state":[Bt,[bt],(a,[t])=>ic(t.evaluate(a),a.featureState||{})],properties:[Gs,[],a=>a.properties()],"geometry-type":[bt,[],a=>a.geometryType()],id:[Bt,[],a=>a.id()],zoom:[Xe,[],a=>a.globals.zoom],"heatmap-density":[Xe,[],a=>a.globals.heatmapDensity||0],elevation:[Xe,[],a=>a.globals.elevation||0],"line-progress":[Xe,[],a=>a.globals.lineProgress||0],accumulated:[Bt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Xe,ca(Xe),(a,t)=>{let n=0;for(const o of t)n+=o.evaluate(a);return n}],"*":[Xe,ca(Xe),(a,t)=>{let n=1;for(const o of t)n*=o.evaluate(a);return n}],"-":{type:Xe,overloads:[[[Xe,Xe],(a,[t,n])=>t.evaluate(a)-n.evaluate(a)],[[Xe],(a,[t])=>-t.evaluate(a)]]},"/":[Xe,[Xe,Xe],(a,[t,n])=>t.evaluate(a)/n.evaluate(a)],"%":[Xe,[Xe,Xe],(a,[t,n])=>t.evaluate(a)%n.evaluate(a)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(a,[t,n])=>Math.pow(t.evaluate(a),n.evaluate(a))],sqrt:[Xe,[Xe],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Xe,[Xe],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Xe,[Xe],(a,[t])=>Math.log(t.evaluate(a))],log2:[Xe,[Xe],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Xe,[Xe],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Xe,[Xe],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Xe,[Xe],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Xe,[Xe],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Xe,[Xe],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Xe,[Xe],(a,[t])=>Math.atan(t.evaluate(a))],min:[Xe,ca(Xe),(a,t)=>Math.min(...t.map((n=>n.evaluate(a))))],max:[Xe,ca(Xe),(a,t)=>Math.max(...t.map((n=>n.evaluate(a))))],abs:[Xe,[Xe],(a,[t])=>Math.abs(t.evaluate(a))],round:[Xe,[Xe],(a,[t])=>{const n=t.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[Xe,[Xe],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Xe,[Xe],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Rt,[bt,Bt],(a,[t,n])=>a.properties()[t.value]===n.value],"filter-id-==":[Rt,[Bt],(a,[t])=>a.id()===t.value],"filter-type-==":[Rt,[bt],(a,[t])=>a.geometryType()===t.value],"filter-<":[Rt,[bt,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Rt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Rt,[bt,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[Rt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Rt,[bt,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Rt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Rt,[bt,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Rt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Rt,[Bt],(a,[t])=>t.value in a.properties()],"filter-has-id":[Rt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Rt,[Sa(bt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Rt,[Sa(Bt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Rt,[bt,Sa(Bt)],(a,[t,n])=>n.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Rt,[bt,Sa(Bt)],(a,[t,n])=>(function(o,u,p,_){for(;p<=_;){const v=p+_>>1;if(u[v]===o)return!0;u[v]>o?_=v-1:p=v+1}return!1})(a.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(a,[t,n])=>t.evaluate(a)&&n.evaluate(a)],[ca(Rt),(a,t)=>{for(const n of t)if(!n.evaluate(a))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(a,[t,n])=>t.evaluate(a)||n.evaluate(a)],[ca(Rt),(a,t)=>{for(const n of t)if(n.evaluate(a))return!0;return!1}]]},"!":[Rt,[Rt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Rt,[bt],(a,[t])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(t.evaluate(a))}],upcase:[bt,[bt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[bt,[bt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[bt,ca(Bt),(a,t)=>t.map((n=>It(n.evaluate(a)))).join("")],"resolved-locale":[bt,[qs],(a,[t])=>t.evaluate(a).resolvedLocale()]});class rc{constructor(t,n,o){this.expression=t,this._warningHistory={},this._evaluator=new rl,this._defaultValue=n?(function(u){if(u.type==="color"&&Gr(u.default))return new $t(0,0,0,0);switch(u.type){case"color":return $t.parse(u.default)||null;case"padding":return un.parse(u.default)||null;case"numberArray":return kn.parse(u.default)||null;case"colorArray":return xn.parse(u.default)||null;case"variableAnchorOffsetCollection":return Gn.parse(u.default)||null;case"projectionDefinition":return Jn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,p,_){return this._globalState&&(t=ta(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,p,_){this._globalState&&(t=ta(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new bi(`Expected value to be one of ${Object.keys(this._enumValues).map((b=>JSON.stringify(b))).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function sc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in pl}function Lo(a,t,n){const o=new Fr(pl,Io,[],t?(function(p){const _={color:Zn,string:bt,number:Xe,enum:bt,boolean:Rt,formatted:Ir,padding:fs,numberArray:Rr,colorArray:Ta,projectionDefinition:To,resolvedImage:Bi,variableAnchorOffsetCollection:vn};return p.type==="array"?Sa(_[p.value]||Bt,p.length):_[p.type]})(t):void 0),u=o.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?nc(new rc(u,t,n)):ys(o.errors)}class gl{constructor(t,n,o){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Vr(n.expression),this.globalStateRefs=vs(n.expression),this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,p,_){return this._globalState&&(t=ta(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,_)}evaluate(t,n,o,u,p,_){return this._globalState&&(t=ta(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,p,_)}}class Fa{constructor(t,n,o,u,p){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Vr(n.expression),this.globalStateRefs=vs(n.expression),this.interpolationType=u,this._globalState=p}evaluateWithoutErrorHandling(t,n,o,u,p,_){return this._globalState&&(t=ta(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,_)}evaluate(t,n,o,u,p,_){return this._globalState&&(t=ta(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,p,_)}interpolationFactor(t,n,o){return this.interpolationType?ea.interpolationFactor(this.interpolationType,t,n,o):0}}function ko(a,t,n){const o=Lo(a,t,n);if(o.result==="error")return o;const u=o.value.expression,p=Ma(u);if(!p&&!Zr(t))return ys([new Ia("","data expressions not supported")]);const _=ml(u,["zoom"]);if(!_&&!io(t))return ys([new Ia("","zoom expressions not supported")]);const v=no(u);return v||_?v instanceof Ia?ys([v]):v instanceof ea&&!Vc(t)?ys([new Ia("",'"interpolate" expressions cannot be used with this property')]):nc(v?new Fa(p?"camera":"composite",o.value,v.labels,v instanceof ea?v.interpolation:void 0,n):new gl(p?"constant":"source",o.value,n)):ys([new Ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $r{constructor(t,n){this._parameters=t,this._specification=n,ln(this,Oa(this._parameters,this._specification))}static deserialize(t){return new $r(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function no(a){let t=null;if(a instanceof Zl)t=no(a.result);else if(a instanceof $l){for(const n of a.args)if(t=no(n),t)break}else(a instanceof nn||a instanceof ea)&&a.input instanceof or&&a.input.name==="zoom"&&(t=a);return t instanceof Ia||a.eachChild((n=>{const o=no(n);o instanceof Ia?t=o:!t&&o?t=new Ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Ia("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function vs(a,t=new Set){return a instanceof tc&&t.add(a.key),a.eachChild((n=>{vs(n,t)})),t}function ta(a,t){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:_,accumulated:v}=a??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:_,accumulated:v,globalState:t}}function _a(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!_a(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Xr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ya(a,t){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};_a(a)||(a=oc(a));const n=Lo(a,Xr,t);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,p)=>n.value.evaluate(o,u,{},p),needGeometry:Wa(a),getGlobalStateRefs:()=>vs(n.value.expression)}}function lr(a,t){return a<t?-1:a>t?1:0}function Wa(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Wa(a[t]))return!0;return!1}function oc(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?lc(a[1],a[2],"=="):t==="!="?Bn(lc(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?lc(a[1],a[2],t):t==="any"?(n=a.slice(1),["any"].concat(n.map(oc))):t==="all"?["all"].concat(a.slice(1).map(oc)):t==="none"?["all"].concat(a.slice(1).map(oc).map(Bn)):t==="in"?Zc(a[1],a.slice(2)):t==="!in"?Bn(Zc(a[1],a.slice(2))):t==="has"?Zu(a[1]):t!=="!has"||Bn(Zu(a[1]));var n}function lc(a,t,n){switch(a){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,a,t]}}function Zc(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",a,["literal",t.sort(lr)]]:["filter-in-small",a,["literal",t]]}}function Zu(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Bn(a){return["!",a]}function Oi(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let u="[";for(const p of a)u+=`${Oi(p)},`;return`${u}]`}const n=Object.keys(a).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${Oi(a[n[u]])},`;return`${o}}`}function ni(a){let t="";for(const n of Tt)t+=`/${Oi(a[n])}`;return t}function Yr(a){const t=a.value;return t?[new Ve(a.key,t,"constants have been deprecated as of v8")]:[]}function ai(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function xs(a){if(Array.isArray(a))return a.map(xs);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const n in a)t[n]=xs(a[n]);return t}return ai(a)}function On(a){const t=a.key,n=a.value,o=a.valueSpec||{},u=a.objectElementValidators||{},p=a.style,_=a.styleSpec,v=a.validateSpec;let b=[];const M=Gt(n);if(M!=="object")return[new Ve(t,n,`object expected, ${M} found`)];for(const C in n){const P=C.split(".")[0],k=So(o,P)||o["*"];let F;if(So(u,P))F=u[P];else if(So(o,P))F=v;else if(u["*"])F=u["*"];else{if(!o["*"]){b.push(new Ve(t,n[C],`unknown property "${C}"`));continue}F=v}b=b.concat(F({key:(t&&`${t}.`)+C,value:n[C],valueSpec:k,style:p,styleSpec:_,object:n,objectKey:C,validateSpec:v},n))}for(const C in o)u[C]||o[C].required&&o[C].default===void 0&&n[C]===void 0&&b.push(new Ve(t,n,`missing required property "${C}"`));return b}function cc(a){const t=a.value,n=a.valueSpec,o=a.style,u=a.styleSpec,p=a.key,_=a.arrayElementValidator||a.validateSpec;if(Gt(t)!=="array")return[new Ve(p,t,`array expected, ${Gt(t)} found`)];if(n.length&&t.length!==n.length)return[new Ve(p,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ve(p,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};u.$version<7&&(v.function=n.function),Gt(n.value)==="object"&&(v=n.value);let b=[];for(let M=0;M<t.length;M++)b=b.concat(_({array:t,arrayIndex:M,value:t[M],valueSpec:v,validateSpec:a.validateSpec,style:o,styleSpec:u,key:`${p}[${M}]`}));return b}function uc(a){const t=a.key,n=a.value,o=a.valueSpec;let u=Gt(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Ve(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Ve(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ve(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ao(a){const t=a.valueSpec,n=ai(a.value.type);let o,u,p,_={};const v=n!=="categorical"&&a.value.property===void 0,b=!v,M=Gt(a.value.stops)==="array"&&Gt(a.value.stops[0])==="array"&&Gt(a.value.stops[0][0])==="object",C=On({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Ve(F.key,F.value,'identity function may not have a "stops" property')];let j=[];const H=F.value;return j=j.concat(cc({key:F.key,value:H,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:P})),Gt(H)==="array"&&H.length===0&&j.push(new Ve(F.key,H,"array must have at least one stop")),j},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&v&&C.push(new Ve(a.key,a.value,'missing required property "property"')),n==="identity"||a.value.stops||C.push(new Ve(a.key,a.value,'missing required property "stops"')),n==="exponential"&&a.valueSpec.expression&&!Vc(a.valueSpec)&&C.push(new Ve(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(b&&!Zr(a.valueSpec)?C.push(new Ve(a.key,a.value,"property functions not supported")):v&&!io(a.valueSpec)&&C.push(new Ve(a.key,a.value,"zoom functions not supported"))),n!=="categorical"&&!M||a.value.property!==void 0||C.push(new Ve(a.key,a.value,'"property" property is required')),C;function P(F){let j=[];const H=F.value,Y=F.key;if(Gt(H)!=="array")return[new Ve(Y,H,`array expected, ${Gt(H)} found`)];if(H.length!==2)return[new Ve(Y,H,`array length 2 expected, length ${H.length} found`)];if(M){if(Gt(H[0])!=="object")return[new Ve(Y,H,`object expected, ${Gt(H[0])} found`)];if(H[0].zoom===void 0)return[new Ve(Y,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Ve(Y,H,"object stop key must have value")];if(p&&p>ai(H[0].zoom))return[new Ve(Y,H[0].zoom,"stop zoom values must appear in ascending order")];ai(H[0].zoom)!==p&&(p=ai(H[0].zoom),u=void 0,_={}),j=j.concat(On({key:`${Y}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:uc,value:k}}))}else j=j.concat(k({key:`${Y}[0]`,value:H[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},H));return sc(xs(H[1]))?j.concat([new Ve(`${Y}[1]`,H[1],"expressions are not allowed in function stops.")]):j.concat(F.validateSpec({key:`${Y}[1]`,value:H[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function k(F,j){const H=Gt(F.value),Y=ai(F.value),te=F.value!==null?F.value:j;if(o){if(H!==o)return[new Ve(F.key,te,`${H} stop domain type must match previous stop domain type ${o}`)]}else o=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Ve(F.key,te,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&n!=="categorical"){let xe=`number expected, ${H} found`;return Zr(t)&&n===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(F.key,te,xe)]}return n!=="categorical"||H!=="number"||isFinite(Y)&&Math.floor(Y)===Y?n!=="categorical"&&H==="number"&&u!==void 0&&Y<u?[new Ve(F.key,te,"stop domain values must appear in ascending order")]:(u=Y,n==="categorical"&&Y in _?[new Ve(F.key,te,"stop domain values must be unique")]:(_[Y]=!0,[])):[new Ve(F.key,te,`integer expected, found ${Y}`)]}}function Qa(a){const t=(a.expressionContext==="property"?ko:Lo)(xs(a.value),a.valueSpec);if(t.result==="error")return t.value.map((o=>new Ve(`${a.key}${o.key}`,a.value,o.message)));const n=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!n.outputDefined())return[new Ve(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Vr(n))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Vr(n))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ml(n,["zoom","feature-state"]))return[new Ve(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Ma(n))return[new Ve(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bs(a){const t=a.key,n=a.value,o=Gt(n);return o!=="string"?[new Ve(t,n,`color expected, ${o} found`)]:$t.parse(String(n))?[]:[new Ve(t,n,`color expected, "${n}" found`)]}function ws(a){const t=a.key,n=a.value,o=a.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(ai(n))===-1&&u.push(new Ve(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(ai(n))===-1&&u.push(new Ve(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function hc(a){return _a(xs(a.value))?Qa(ln({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ro(a)}function ro(a){const t=a.value,n=a.key;if(Gt(t)!=="array")return[new Ve(n,t,`array expected, ${Gt(t)} found`)];const o=a.styleSpec;let u,p=[];if(t.length<1)return[new Ve(n,t,"filter array must have at least 1 element")];switch(p=p.concat(ws({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),ai(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ai(t[1])==="$type"&&p.push(new Ve(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Ve(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Gt(t[1]),u!=="string"&&p.push(new Ve(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let _=2;_<t.length;_++)u=Gt(t[_]),ai(t[1])==="$type"?p=p.concat(ws({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new Ve(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)p=p.concat(ro({key:`${n}[${_}]`,value:t[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":u=Gt(t[1]),t.length!==2?p.push(new Ve(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new Ve(`${n}[1]`,t[1],`string expected, ${u} found`))}return p}function Kr(a,t){const n=a.key,o=a.validateSpec,u=a.style,p=a.styleSpec,_=a.value,v=a.objectKey,b=p[`${t}_${a.layerType}`];if(!b)return[];const M=v.match(/^(.*)-transition$/);if(t==="paint"&&M&&b[M[1]]&&b[M[1]].transition)return o({key:n,value:_,valueSpec:p.transition,style:u,styleSpec:p});const C=a.valueSpec||b[v];if(!C)return[new Ve(n,_,`unknown property "${v}"`)];let P;if(Gt(_)==="string"&&Zr(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(_)))return[new Ve(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const k=[];return a.layerType==="symbol"&&(v==="text-field"&&u&&!u.glyphs&&k.push(new Ve(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Gr(xs(_))&&ai(_.type)==="identity"&&k.push(new Ve(n,_,'"text-font" does not support identity functions'))),k.concat(o({key:a.key,value:_,valueSpec:C,style:u,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:v}))}function Ts(a){return Kr(a,"paint")}function Wr(a){return Kr(a,"layout")}function so(a){let t=[];const n=a.value,o=a.key,u=a.style,p=a.styleSpec;if(Gt(n)!=="object")return[new Ve(o,n,`object expected, ${Gt(n)} found`)];n.type||n.ref||t.push(new Ve(o,n,'either "type" or "ref" is required'));let _=ai(n.type);const v=ai(n.ref);if(n.id){const b=ai(n.id);for(let M=0;M<a.arrayIndex;M++){const C=u.layers[M];ai(C.id)===b&&t.push(new Ve(o,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach((M=>{M in n&&t.push(new Ve(o,n[M],`"${M}" is prohibited for ref layers`))})),u.layers.forEach((M=>{ai(M.id)===v&&(b=M)})),b?b.ref?t.push(new Ve(o,n.ref,"ref cannot reference another ref layer")):_=ai(b.type):t.push(new Ve(o,n.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(n.source){const b=u.sources&&u.sources[n.source],M=b&&ai(b.type);b?M==="vector"&&_==="raster"?t.push(new Ve(o,n.source,`layer "${n.id}" requires a raster source`)):M!=="raster-dem"&&_==="hillshade"||M!=="raster-dem"&&_==="color-relief"?t.push(new Ve(o,n.source,`layer "${n.id}" requires a raster-dem source`)):M==="raster"&&_!=="raster"?t.push(new Ve(o,n.source,`layer "${n.id}" requires a vector source`)):M!=="vector"||n["source-layer"]?M==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new Ve(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||M==="geojson"&&b.lineMetrics||t.push(new Ve(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ve(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ve(o,n.source,`source "${n.source}" not found`))}else t.push(new Ve(o,n,'missing required property "source"'));return t=t.concat(On({key:o,value:n,valueSpec:p.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:n,objectKey:"type"}),filter:hc,layout:b=>On({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":M=>Wr(ln({layerType:_},M))}}),paint:b=>On({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":M=>Ts(ln({layerType:_},M))}})}})),t}function Ja(a){const t=a.value,n=a.key,o=Gt(t);return o!=="string"?[new Ve(n,t,`string expected, ${o} found`)]:[]}const Hn={promoteId:function({key:a,value:t}){if(Gt(t)==="string")return Ja({key:a,value:t});{const n=[];for(const o in t)n.push(...Ja({key:`${a}.${o}`,value:t[o]}));return n}}};function Ss(a){const t=a.value,n=a.key,o=a.styleSpec,u=a.style,p=a.validateSpec;if(!t.type)return[new Ve(n,t,'"type" is required')];const _=ai(t.type);let v;switch(_){case"vector":case"raster":return v=On({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:Hn,validateSpec:p}),v;case"raster-dem":return v=(function(b){var M;const C=(M=b.sourceName)!==null&&M!==void 0?M:"",P=b.value,k=b.styleSpec,F=k.source_raster_dem,j=b.style;let H=[];const Y=Gt(P);if(P===void 0)return H;if(Y!=="object")return H.push(new Ve("source_raster_dem",P,`object expected, ${Y} found`)),H;const te=ai(P.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],se=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const ue in P)!te&&xe.includes(ue)?H.push(new Ve(ue,P[ue],`In "${C}": "${ue}" is only valid when "encoding" is set to "custom". ${se} encoding found`)):F[ue]?H=H.concat(b.validateSpec({key:ue,value:P[ue],valueSpec:F[ue],validateSpec:b.validateSpec,style:j,styleSpec:k})):H.push(new Ve(ue,P[ue],`unknown property "${ue}"`));return H})({sourceName:n,value:t,style:a.style,styleSpec:o,validateSpec:p}),v;case"geojson":if(v=On({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:Hn}),t.cluster)for(const b in t.clusterProperties){const[M,C]=t.clusterProperties[b],P=typeof M=="string"?[M,["accumulated"],["get",b]]:M;v.push(...Qa({key:`${n}.${b}.map`,value:C,expressionContext:"cluster-map"})),v.push(...Qa({key:`${n}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return On({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return On({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new Ve(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ws({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ms(a){const t=a.value,n=a.styleSpec,o=n.light,u=a.style;let p=[];const _=Gt(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new Ve("light",t,`object expected, ${_} found`)]),p;for(const v in t){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&o[b[1]]&&o[b[1]].transition?a.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:a.validateSpec,style:u,styleSpec:n}):o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)])}return p}function ia(a){const t=a.value,n=a.styleSpec,o=n.sky,u=a.style,p=Gt(t);if(t===void 0)return[];if(p!=="object")return[new Ve("sky",t,`object expected, ${p} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)]);return _}function dc(a){const t=a.value,n=a.styleSpec,o=n.terrain,u=a.style;let p=[];const _=Gt(t);if(t===void 0)return p;if(_!=="object")return p=p.concat([new Ve("terrain",t,`object expected, ${_} found`)]),p;for(const v in t)p=p.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)]);return p}function Bo(a){let t=[];const n=a.value,o=a.key;if(Array.isArray(n)){const u=[],p=[];for(const _ in n)n[_].id&&u.includes(n[_].id)&&t.push(new Ve(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),u.push(n[_].id),n[_].url&&p.includes(n[_].url)&&t.push(new Ve(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),p.push(n[_].url),t=t.concat(On({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return Ja({key:o,value:n})}function Gu(a){return t=a.value,t&&t.constructor===Object?[]:[new Ve(a.key,a.value,`object expected, ${Gt(a.value)} found`)];var t}const Gc={"*":()=>[],array:cc,boolean:function(a){const t=a.value,n=a.key,o=Gt(t);return o!=="boolean"?[new Ve(n,t,`boolean expected, ${o} found`)]:[]},number:uc,color:bs,constants:Yr,enum:ws,filter:hc,function:ao,layer:so,object:On,source:Ss,light:Ms,sky:ia,terrain:dc,projection:function(a){const t=a.value,n=a.styleSpec,o=n.projection,u=a.style,p=Gt(t);if(t===void 0)return[];if(p!=="object")return[new Ve("projection",t,`object expected, ${p} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(a){const t=a.key;let n=a.value;n=n instanceof String?n.valueOf():n;const o=Gt(n);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(o)?[]:[new Ve(t,n,`projection expected, invalid type "${o}" found`)]:[new Ve(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Ja,formatted:function(a){return Ja(a).length===0?[]:Qa(a)},resolvedImage:function(a){return Ja(a).length===0?[]:Qa(a)},padding:function(a){const t=a.key,n=a.value;if(Gt(n)==="array"){if(n.length<1||n.length>4)return[new Ve(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(a.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:a.validateSpec,valueSpec:o}));return u}return uc({key:t,value:n,valueSpec:{}})},numberArray:function(a){const t=a.key,n=a.value;if(Gt(n)==="array"){const o={type:"number"};if(n.length<1)return[new Ve(t,n,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<n.length;p++)u=u.concat(a.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:a.validateSpec,valueSpec:o}));return u}return uc({key:t,value:n,valueSpec:{}})},colorArray:function(a){const t=a.key,n=a.value;if(Gt(n)==="array"){if(n.length<1)return[new Ve(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(bs({key:`${t}[${u}]`,value:n[u]}));return o}return bs({key:t,value:n})},variableAnchorOffsetCollection:function(a){const t=a.key,n=a.value,o=Gt(n),u=a.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ve(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let _=0;_<n.length;_+=2)p=p.concat(ws({key:`${t}[${_}]`,value:n[_],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(cc({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:u}));return p},sprite:Bo,state:Gu};function qc(a){const t=a.value,n=a.valueSpec,o=a.styleSpec;return a.validateSpec=qc,n.expression&&Gr(ai(t))?ao(a):n.expression&&sc(xs(t))?Qa(a):n.type&&Gc[n.type]?Gc[n.type](a):On(ln({},a,{valueSpec:n.type?o[n.type]:n}))}function dn(a){const t=a.value,n=a.key,o=Ja(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ve(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ve(n,t,'"glyphs" url must include a "{range}" token'))),o}function Ua(a,t=be){let n=[];return n=n.concat(qc({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:qc,objectElementValidators:{glyphs:dn,"*":()=>[]}})),a.constants&&(n=n.concat(Yr({key:"constants",value:a.constants}))),_l(n)}function $n(a){return function(t){return a(Object.assign({},t,{validateSpec:qc}))}}function _l(a){return[].concat(a).sort(((t,n)=>t.line-n.line))}function er(a){return function(...t){return _l(a.apply(this,t))}}Ua.source=er($n(Ss)),Ua.sprite=er($n(Bo)),Ua.glyphs=er($n(dn)),Ua.light=er($n(Ms)),Ua.sky=er($n(ia)),Ua.terrain=er($n(dc)),Ua.state=er($n(Gu)),Ua.layer=er($n(so)),Ua.filter=er($n(hc)),Ua.paintProperty=er($n(Ts)),Ua.layoutProperty=er($n(Wr));const Sr=Ua,Qr=Sr.light,Nd=Sr.sky,qh=Sr.paintProperty,Hc=Sr.layoutProperty;function qu(a,t){let n=!1;if(t&&t.length)for(const o of t)a.fire(new Ue(new Error(o.message))),n=!0;return n}class tr{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let b=0;b<this.d*this.d;b++){const M=_[3+b],C=_[3+b+1];u.push(M===C?null:_.subarray(M,C))}const v=_[3+u.length+1];this.keys=_.subarray(_[3+u.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const p=o/n*t;this.min=-p,this.max=t+p}insert(t,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,p,_){this.cells[p].push(_)}query(t,n,o,u,p){const _=this.min,v=this.max;if(t<=_&&n<=_&&v<=o&&v<=u&&!p)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,n,o,u,this._queryCell,b,{},p),b}}_queryCell(t,n,o,u,p,_,v,b){const M=this.cells[p];if(M!==null){const C=this.keys,P=this.bboxes;for(let k=0;k<M.length;k++){const F=M[k];if(v[F]===void 0){const j=4*F;(b?b(P[j+0],P[j+1],P[j+2],P[j+3]):t<=P[j+2]&&n<=P[j+3]&&o>=P[j+0]&&u>=P[j+1])?(v[F]=!0,_.push(C[F])):v[F]=!1}}}}_forEachCell(t,n,o,u,p,_,v,b){const M=this._convertToCellCoord(t),C=this._convertToCellCoord(n),P=this._convertToCellCoord(o),k=this._convertToCellCoord(u);for(let F=M;F<=P;F++)for(let j=C;j<=k;j++){const H=this.d*j+F;if((!b||b(this._convertFromCellCoord(F),this._convertFromCellCoord(j),this._convertFromCellCoord(F+1),this._convertFromCellCoord(j+1)))&&p.call(this,t,n,o,u,H,_,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let _=0;_<t.length;_++){const v=t[_];u[3+_]=p,u.set(v,p),p+=v.length}return u[3+t.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+t.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new tr(t.buffer)}}const ja={};function ot(a,t,n={}){if(ja[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),ja[a]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}ot("Object",Object),ot("Set",Set),ot("TransferableGridIndex",tr),ot("Color",$t),ot("Error",Error),ot("AJAXError",re),ot("ResolvedImage",bn),ot("StylePropertyFunction",$r),ot("StyleExpression",rc,{omit:["_evaluator"]}),ot("ZoomDependentExpression",Fa),ot("ZoomConstantExpression",gl),ot("CompoundExpression",or,{omit:["_evaluate"]});for(const a in pl)pl[a]._classRegistryKey||ot(`Expression_${a}`,pl[a]);function $c(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Cs(a){return a.$name||a.constructor._classRegistryKey}function fc(a){return!(function(t){if(t===null||typeof t!="object")return!1;const n=Cs(t);return!(!n||n==="Object")})(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||$c(a)||xr(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function Jr(a,t){if(fc(a))return($c(a)||xr(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const p=[];for(const _ of a)p.push(Jr(_,t));return p}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const n=Cs(a);if(!n)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!ja[n])throw new Error(`${n} is not registered.`);const{klass:o}=ja[n],u=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in a){if(!a.hasOwnProperty(p)||ja[n].omit.indexOf(p)>=0)continue;const _=a[p];u[p]=ja[n].shallow.indexOf(p)>=0?_:Jr(_,t)}a instanceof Error&&(u.message=a.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function Es(a){if(fc(a))return a;if(Array.isArray(a))return a.map(Es);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=Cs(a)||"Object";if(!ja[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=ja[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(a);const o=Object.create(n.prototype);for(const u of Object.keys(a)){if(u==="$name")continue;const p=a[u];o[u]=ja[t].shallow.indexOf(u)>=0?p:Es(p)}return o}class Xc{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Xt={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function As(a){for(const t of a)if(vl(t.charCodeAt(0)))return!0;return!1}function oo(a){for(const t of a)if(!Oo(t.charCodeAt(0)))return!1;return!0}function Yc(a){const t=a.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const Hu=Yc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Oo(a){return!Hu.test(String.fromCodePoint(a))}const yl=Yc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function vl(a){return!(a!==746&&a!==747&&(a<4352||!(Xt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Xt["CJK Compatibility"](a)||Xt["CJK Strokes"](a)||!(!Xt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Xt["Enclosed CJK Letters and Months"](a)||Xt["Ideographic Description Characters"](a)||Xt.Kanbun(a)||Xt.Katakana(a)&&a!==12540||!(!Xt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Xt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Xt["Vertical Forms"](a)||Xt["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||yl.test(String.fromCodePoint(a)))))}function Fo(a){return!(vl(a)||(function(t){return!!(Xt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Xt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Xt["Letterlike Symbols"](t)||Xt["Number Forms"](t)||Xt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Xt["Control Pictures"](t)&&t!==9251||Xt["Optical Character Recognition"](t)||Xt["Enclosed Alphanumerics"](t)||Xt["Geometric Shapes"](t)||Xt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Xt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Xt["CJK Symbols and Punctuation"](t)||Xt.Katakana(t)||Xt["Private Use Area"](t)||Xt["CJK Compatibility Forms"](t)||Xt["Small Form Variants"](t)||Xt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(a))}const pc=Yc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Kc(a){return pc.test(String.fromCodePoint(a))}function lo(a,t){return!(!t&&Kc(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Xt.Khmer(a))}function mc(a){for(const t of a)if(Kc(t.charCodeAt(0)))return!0;return!1}const Ca=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Ca.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const n=a.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));t(n);const u=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class pi{constructor(t,n){this.isSupportedScript=$u,this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new Xc,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function $u(a){return(function(t,n){for(const o of t)if(!lo(o.charCodeAt(0),n))return!1;return!0})(a,Ca.getRTLTextPluginStatus()==="loaded")}class Mr{constructor(t,n,o){this.property=t,this.value=n,this.expression=(function(u,p,_){if(Gr(u))return new $r(u,p);if(sc(u)){const v=ko(u,p,_);if(v.result==="error")throw new Error(v.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return v.value}{let v=u;return p.type==="color"&&typeof u=="string"?v=$t.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?v=Gn.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(v=Jn.parse(u)):v=xn.parse(u):v=kn.parse(u):v=un.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}})(n===void 0?t.specification.default:n,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Cr{constructor(t,n){this.property=t,this.value=new Mr(t,void 0,n)}transitioned(t,n){return new gc(this.property,this.value,n,Ci({},t.transition,this.transition),t.now)}untransitioned(){return new gc(this.property,this.value,null,{},0)}}class Uo{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=n}getValue(t){return Qn(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Cr(this._values[t].property,this._globalState)),this._values[t].value=new Mr(this._values[t].property,n===null?void 0:Qn(n),this._globalState)}getTransition(t){return Qn(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Cr(this._values[t].property,this._globalState)),this._values[t].transition=Qn(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new Wc(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new Wc(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class gc{constructor(t,n,o,u,p){this.property=t,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,p=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(t,n,o);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),p,rt(v))}}return p}}class Wc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new yc(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class _c{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=n}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Qn(this._values[t].value)}setValue(t,n){this._values[t]=new Mr(this._values[t].property,n===null?void 0:Qn(n),this._globalState)}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new yc(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}}class Na{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class yc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class dt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=Ur[this.specification.type];return u?u(t,n,o):t}}class mt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new Na(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Na(this,{kind:"constant",value:void 0},t.parameters);const u=Ur[this.specification.type];if(u){const p=u(t.value.value,n.value.value,o);return new Na(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,n,o,u,p,_){return t.kind==="constant"?t.value:t.evaluate(n,o,u,p,_)}}class co extends mt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new Na(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u),_=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(_,_,_,n);return new Na(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Na(this,{kind:"constant",value:p},n)}return new Na(this,t.expression,n)}evaluate(t,n,o,u,p,_){if(t.kind==="source"){const v=t.evaluate(n,o,u,p,_);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Xu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(t.expression.evaluate(new pi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new pi(Math.floor(n.zoom),n)),t.expression.evaluate(new pi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class xl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class na{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Mr(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new Cr(o,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}ot("DataDrivenProperty",mt),ot("DataConstantProperty",dt),ot("CrossFadedDataDrivenProperty",co),ot("CrossFadedProperty",Xu),ot("ColorRampProperty",xl);const Va="-transition";class gn extends ct{constructor(t,n,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=ya(t.filter,o)),n.layout&&(this._unevaluatedLayout=new _c(n.layout,o)),n.paint)){this._transitionablePaint=new Uo(n.paint,o);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yc(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=ya(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())t.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}getPaintAffectingGlobalStateRefs(){var t;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const p of u.getGlobalStateRefs()){const _=(t=n.get(p))!==null&&t!==void 0?t:[];_.push({name:o,value:u.value}),n.set(p,_)}}return n}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Hc,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Va)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(qh,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(Va))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),nr(t,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(t,n,o,u,p={}){return(!p||p.validate!==!1)&&qu(this,t.call(Sr,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Na&&Zr(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Za={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class uo{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ti(a,t=1){let n=0,o=0;return{members:a.map((u=>{const p=Za[u.type].BYTES_PER_ELEMENT,_=n=va(n,Math.max(t,p)),v=u.components||1;return o=Math.max(o,p),n+=p*v,{name:u.name,type:u.type,components:v,offset:_}})),size:va(n,Math.max(o,t)),alignment:t}}function va(a,t){return Math.ceil(a/t)*t}class Ji extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}Ji.prototype.bytesPerElement=4,ot("StructArrayLayout2i4",Ji);class es extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,t}}es.prototype.bytesPerElement=6,ot("StructArrayLayout3i6",es);class Ea extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=p,t}}Ea.prototype.bytesPerElement=8,ot("StructArrayLayout4i8",Ea);class Nt extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,t}}Nt.prototype.bytesPerElement=12,ot("StructArrayLayout2i4i12",Nt);class mi extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=4*t,M=8*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[M+4]=u,this.uint8[M+5]=p,this.uint8[M+6]=_,this.uint8[M+7]=v,t}}mi.prototype.bytesPerElement=8,ot("StructArrayLayout2i4ub8",mi);class Pi extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}Pi.prototype.bytesPerElement=8,ot("StructArrayLayout2f8",Pi);class bl extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C){const P=this.length;return this.resize(P+1),this.emplace(P,t,n,o,u,p,_,v,b,M,C)}emplace(t,n,o,u,p,_,v,b,M,C,P){const k=10*t;return this.uint16[k+0]=n,this.uint16[k+1]=o,this.uint16[k+2]=u,this.uint16[k+3]=p,this.uint16[k+4]=_,this.uint16[k+5]=v,this.uint16[k+6]=b,this.uint16[k+7]=M,this.uint16[k+8]=C,this.uint16[k+9]=P,t}}bl.prototype.bytesPerElement=20,ot("StructArrayLayout10ui20",bl);class ho extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,u,p,_,v,b)}emplace(t,n,o,u,p,_,v,b,M){const C=8*t;return this.uint16[C+0]=n,this.uint16[C+1]=o,this.uint16[C+2]=u,this.uint16[C+3]=p,this.uint16[C+4]=_,this.uint16[C+5]=v,this.uint16[C+6]=b,this.uint16[C+7]=M,t}}ho.prototype.bytesPerElement=16,ot("StructArrayLayout8ui16",ho);class ts extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C,P,k){const F=this.length;return this.resize(F+1),this.emplace(F,t,n,o,u,p,_,v,b,M,C,P,k)}emplace(t,n,o,u,p,_,v,b,M,C,P,k,F){const j=12*t;return this.int16[j+0]=n,this.int16[j+1]=o,this.int16[j+2]=u,this.int16[j+3]=p,this.uint16[j+4]=_,this.uint16[j+5]=v,this.uint16[j+6]=b,this.uint16[j+7]=M,this.int16[j+8]=C,this.int16[j+9]=P,this.int16[j+10]=k,this.int16[j+11]=F,t}}ts.prototype.bytesPerElement=24,ot("StructArrayLayout4i4ui4i24",ts);class wl extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}wl.prototype.bytesPerElement=12,ot("StructArrayLayout3f12",wl);class m extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}m.prototype.bytesPerElement=4,ot("StructArrayLayout1ul4",m);class e extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,o,u,p,_,v,b,M)}emplace(t,n,o,u,p,_,v,b,M,C){const P=10*t,k=5*t;return this.int16[P+0]=n,this.int16[P+1]=o,this.int16[P+2]=u,this.int16[P+3]=p,this.int16[P+4]=_,this.int16[P+5]=v,this.uint32[k+3]=b,this.uint16[P+8]=M,this.uint16[P+9]=C,t}}e.prototype.bytesPerElement=20,ot("StructArrayLayout6i1ul2ui20",e);class r extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,t}}r.prototype.bytesPerElement=12,ot("StructArrayLayout2i2i2i12",r);class l extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,p)}emplace(t,n,o,u,p,_){const v=4*t,b=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=u,this.int16[b+6]=p,this.int16[b+7]=_,t}}l.prototype.bytesPerElement=16,ot("StructArrayLayout2f1f2i16",l);class d extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,_)}emplace(t,n,o,u,p,_,v){const b=16*t,M=4*t,C=8*t;return this.uint8[b+0]=n,this.uint8[b+1]=o,this.float32[M+1]=u,this.float32[M+2]=p,this.int16[C+6]=_,this.int16[C+7]=v,t}}d.prototype.bytesPerElement=16,ot("StructArrayLayout2ub2f2i16",d);class g extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,t}}g.prototype.bytesPerElement=6,ot("StructArrayLayout3ui6",g);class y extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te){const xe=this.length;return this.resize(xe+1),this.emplace(xe,t,n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te)}emplace(t,n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te,xe){const se=24*t,ue=12*t,Ce=48*t;return this.int16[se+0]=n,this.int16[se+1]=o,this.uint16[se+2]=u,this.uint16[se+3]=p,this.uint32[ue+2]=_,this.uint32[ue+3]=v,this.uint32[ue+4]=b,this.uint16[se+10]=M,this.uint16[se+11]=C,this.uint16[se+12]=P,this.float32[ue+7]=k,this.float32[ue+8]=F,this.uint8[Ce+36]=j,this.uint8[Ce+37]=H,this.uint8[Ce+38]=Y,this.uint32[ue+10]=te,this.int16[se+22]=xe,t}}y.prototype.bytesPerElement=48,ot("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class w extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te,xe,se,ue,Ce,Le,He,at,et,nt,gt,tt){const it=this.length;return this.resize(it+1),this.emplace(it,t,n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te,xe,se,ue,Ce,Le,He,at,et,nt,gt,tt)}emplace(t,n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te,xe,se,ue,Ce,Le,He,at,et,nt,gt,tt,it){const je=32*t,St=16*t;return this.int16[je+0]=n,this.int16[je+1]=o,this.int16[je+2]=u,this.int16[je+3]=p,this.int16[je+4]=_,this.int16[je+5]=v,this.int16[je+6]=b,this.int16[je+7]=M,this.uint16[je+8]=C,this.uint16[je+9]=P,this.uint16[je+10]=k,this.uint16[je+11]=F,this.uint16[je+12]=j,this.uint16[je+13]=H,this.uint16[je+14]=Y,this.uint16[je+15]=te,this.uint16[je+16]=xe,this.uint16[je+17]=se,this.uint16[je+18]=ue,this.uint16[je+19]=Ce,this.uint16[je+20]=Le,this.uint16[je+21]=He,this.uint16[je+22]=at,this.uint32[St+12]=et,this.float32[St+13]=nt,this.float32[St+14]=gt,this.uint16[je+30]=tt,this.uint16[je+31]=it,t}}w.prototype.bytesPerElement=64,ot("StructArrayLayout8i15ui1ul2f2ui64",w);class T extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}T.prototype.bytesPerElement=4,ot("StructArrayLayout1f4",T);class E extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[6*t+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}E.prototype.bytesPerElement=12,ot("StructArrayLayout1ui2f12",E);class A extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=4*t;return this.uint32[2*t+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,t}}A.prototype.bytesPerElement=8,ot("StructArrayLayout1ul2ui8",A);class I extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}I.prototype.bytesPerElement=4,ot("StructArrayLayout2ui4",I);class D extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}D.prototype.bytesPerElement=2,ot("StructArrayLayout1ui2",D);class O extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=p,t}}O.prototype.bytesPerElement=16,ot("StructArrayLayout4f16",O);class q extends uo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new pe(this.anchorPointX,this.anchorPointY)}}q.prototype.size=20;class K extends e{get(t){return new q(this,t)}}ot("CollisionBoxArray",K);class W extends uo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}W.prototype.size=48;class Q extends y{get(t){return new W(this,t)}}ot("PlacedSymbolArray",Q);class ee extends uo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ee.prototype.size=64;class ne extends w{get(t){return new ee(this,t)}}ot("SymbolInstanceArray",ne);class ie extends T{getoffsetX(t){return this.float32[1*t+0]}}ot("GlyphOffsetArray",ie);class ce extends es{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ot("SymbolLineVertexArray",ce);class de extends uo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}de.prototype.size=12;class ae extends E{get(t){return new de(this,t)}}ot("TextAnchorOffsetArray",ae);class me extends uo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}me.prototype.size=8;class ze extends A{get(t){return new me(this,t)}}ot("FeatureIndexArray",ze);class Ee extends Ji{}class Ae extends Ji{}class Pe extends Ji{}class Je extends Nt{}class Qe extends mi{}class qe extends Pi{}class lt extends bl{}class Ot extends ho{}class fi extends ts{}class Ui extends wl{}class Di extends m{}class Hi extends r{}class ji extends d{}class Fn extends g{}class $i extends I{}const Si=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ai}=Si;class qt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,u){const p=this.segments[this.segments.length-1];return t>qt.MAX_VERTEX_ARRAY_LENGTH&&Ri(`Max vertices per segment is ${qt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${qt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+t>qt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(n,o,u):p}createNewSegment(t,n,o){const u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new qt([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Un(a,t){return 256*(a=At(Math.floor(a),0,255))+At(Math.floor(t),0,255)}qt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ot("SegmentVector",qt);const cr=Ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),fo=Ti([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var is,jo,Tl,zs={exports:{}},po={exports:{}},Ga={exports:{}},Ps=(function(){if(Tl)return zs.exports;Tl=1;var a=(is||(is=1,po.exports=function(n,o){var u,p,_,v,b,M,C,P;for(p=n.length-(u=3&n.length),_=o,b=3432918353,M=461845907,P=0;P<p;)C=255&n.charCodeAt(P)|(255&n.charCodeAt(++P))<<8|(255&n.charCodeAt(++P))<<16|(255&n.charCodeAt(++P))<<24,++P,_=27492+(65535&(v=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*M+(((C>>>16)*M&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&n.charCodeAt(P+2))<<16;case 2:C^=(255&n.charCodeAt(P+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&n.charCodeAt(P)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*M+(((C>>>16)*M&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),po.exports),t=(jo||(jo=1,Ga.exports=function(n,o){for(var u,p=n.length,_=o^p,v=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:_^=(255&n.charCodeAt(v+2))<<16;case 2:_^=(255&n.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Ga.exports);return zs.exports=a,zs.exports.murmur3=a,zs.exports.murmur2=t,zs.exports})(),Er=_e(Ps);class Ds{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(wn(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=wn(t);let o=0,u=this.ids.length-1;for(;o<u;){const _=o+u>>1;this.ids[_]>=n?u=_:o=_+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return _n(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new Ds;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function wn(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Er(String(a))}function _n(a,t,n,o){for(;n<o;){const u=a[n+o>>1];let p=n-1,_=o+1;for(;;){do p++;while(a[p]<u);do _--;while(a[_]>u);if(p>=_)break;xa(a,p,_),xa(t,3*p,3*_),xa(t,3*p+1,3*_+1),xa(t,3*p+2,3*_+2)}_-n<o-_?(_n(a,t,n,_),n=_+1):(_n(a,t,_+1,o),o=_)}}function xa(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}ot("FeaturePositionMap",Ds);class Ni{constructor(t,n){this.gl=t.gl,this.location=n}}class Qc extends Ni{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Jc extends Ni{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Yu extends Ni{constructor(t,n){super(t,n),this.current=$t.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Hh=new Float32Array(16);function vc(a){return[Un(255*a.r,255*a.g),Un(255*a.b,255*a.a)]}class Sl{constructor(t,n,o){this.value=t,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Yu(t,n):new Qc(t,n)}}class qa{constructor(t,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,n){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(t,n,o,u){let p=null;u==="u_pattern_to"?p=this.patternTo:u==="u_pattern_from"?p=this.patternFrom:u==="u_dasharray_to"?p=this.dashTo:u==="u_dasharray_from"?p=this.dashFrom:u==="u_pixel_ratio_to"?p=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&t.set(p)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Jc(t,n):new Qc(t,n)}}class ns{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(t,n,o){const u=this.paintVertexArray.length,p=this.expression.evaluate(new pi(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(u,t,p)}updatePaintArray(t,n,o,u,p){const _=this.expression.evaluate(new pi(0,p),o,u);this._setPaintValue(t,n,_)}_setPaintValue(t,n,o){if(this.type==="color"){const u=vc(o);for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ur{constructor(t,n,o,u,p,_){this.expression=t,this.uniformNames=n.map((v=>`u_${v}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,n,o){const u=this.expression.evaluate(new pi(this.zoom,o),n,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new pi(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,u,p)}updatePaintArray(t,n,o,u,p){const _=this.expression.evaluate(new pi(this.zoom,p),o,u),v=this.expression.evaluate(new pi(this.zoom+1,p),o,u);this._setPaintValue(t,n,_,v)}_setPaintValue(t,n,o,u){if(this.type==="color"){const p=vc(o),_=vc(u);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=At(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new Qc(t,n)}}class as{constructor(t,n,o,u,p,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=_,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,this.getPositionIds(n),o)}updatePaintArray(t,n,o,u,p){this._setPaintValues(t,n,this.getPositionIds(o),p)}_setPaintValues(t,n,o,u){const p=this.getPositions(u);if(!p||!o)return;const _=p[o.min],v=p[o.mid],b=p[o.max];if(_&&v&&b)for(let M=t;M<n;M++)this.emplace(this.zoomInPaintVertexArray,M,v,_),this.emplace(this.zoomOutPaintVertexArray,M,v,b)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class mo extends as{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return cr.members}emplace(t,n,o,u){t.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class xc extends as{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return fo.members}emplace(t,n,o,u){t.emplace(n,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class No{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!o(p))continue;const _=t.paint.get(p);if(!(_ instanceof Na&&Zr(_.property.specification)))continue;const v=qf(p,t.type),b=_.value,M=_.property.specification.type,C=_.property.useIntegerZoom,P=_.property.specification["property-type"],k=P==="cross-faded"||P==="cross-faded-data-driven";if(b.kind==="constant")this.binders[p]=k?new qa(b.value,v):new Sl(b.value,v,M),u.push(`/u_${p}`);else if(b.kind==="source"||k){const F=eu(p,M,"source");this.binders[p]=k?p==="line-dasharray"?new xc(b,M,C,n,F,t.id):new mo(b,M,C,n,F,t.id):new ns(b,v,M,F),u.push(`/a_${p}`)}else{const F=eu(p,M,"composite");this.binders[p]=new ur(b,v,M,C,n,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof ns||n instanceof ur?n.maxValue:0}populatePaintArrays(t,n,o){for(const u in this.binders){const p=this.binders[u];(p instanceof ns||p instanceof ur||p instanceof as)&&p.populatePaintArray(t,n,o)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof qa&&u.setConstantPatternPositions(t,n)}}setConstantDashPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof qa&&u.setConstantDashPositions(t,n)}}updatePaintArrays(t,n,o,u,p){let _=!1;for(const v in t){const b=n.getPositions(v);for(const M of b){const C=o.feature(M.index);for(const P in this.binders){const k=this.binders[P];if((k instanceof ns||k instanceof ur||k instanceof as)&&k.expression.isStateDependent===!0){const F=u.paint.get(P);k.expression=F.value,k.updatePaintArray(M.start,M.end,C,t[v],p),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Sl||o instanceof qa)&&t.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ns||o instanceof ur)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof as){const u=o.getVertexAttributes();for(const p of u)t.push(p.name)}}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Sl||o instanceof qa||o instanceof ur)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Sl||p instanceof qa||p instanceof ur){for(const _ of p.uniformNames)if(n[_]){const v=p.getBinding(t,n[_],_);o.push({name:_,property:u,binding:v})}}}return o}setUniforms(t,n,o,u){for(const{name:p,property:_,binding:v}of n)this.binders[_].setUniform(v,u,o.get(_),p)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof as){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof ns||o instanceof ur)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof ns||o instanceof ur||o instanceof as)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof ns||n instanceof ur||n instanceof as)&&n.destroy()}}}class Ml{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new No(u,n,o);this.needsUpload=!1,this._featureMap=new Ds,this._bufferOffset=0}populatePaintArrays(t,n,o,u){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(t,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,n,p,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function qf(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function eu(a,t,n){const o={color:{source:Pi,composite:O},number:{source:T,composite:Pi}},u=(function(p){return{"line-pattern":{source:lt,composite:lt},"fill-pattern":{source:lt,composite:lt},"fill-extrusion-pattern":{source:lt,composite:lt},"line-dasharray":{source:Ot,composite:Ot}}[p]})(a);return u&&u[n]||o[t][n]}ot("ConstantBinder",Sl),ot("CrossFadedConstantBinder",qa),ot("SourceExpressionBinder",ns),ot("CrossFadedPatternBinder",mo),ot("CrossFadedDasharrayBinder",xc),ot("CompositeExpressionBinder",ur),ot("ProgramConfiguration",No,{omit:["_buffers"]}),ot("ProgramConfigurationSet",Ml);const $h=Math.pow(2,14)-1,Xh=-$h-1;function Cl(a){const t=_t/a.extent,n=a.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const _=u[p],v=Math.round(_.x*t),b=Math.round(_.y*t);_.x=At(v,Xh,$h),_.y=At(b,Xh,$h),(v<_.x||v>_.x+1||b<_.y||b>_.y+1)&&Ri("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Vo(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Cl(a):[]}}const Yh=-32768;function Hf(a,t,n,o,u){a.emplaceBack(Yh+8*t+o,Yh+8*n+u)}class Kh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new Ae,this.indexArray=new Fn,this.segments=new qt,this.programConfigurations=new Ml(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){const u=this.layers[0],p=[];let _=null,v=!1,b=u.type==="heatmap";if(u.type==="circle"){const C=u;_=C.layout.get("circle-sort-key"),v=!_.isConstant(),b=b||C.paint.get("circle-pitch-alignment")==="map"}const M=b?n.subdivisionGranularity.circle:1;for(const{feature:C,id:P,index:k,sourceLayerIndex:F}of t){const j=this.layers[0]._featureFilter.needGeometry,H=Vo(C,j);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),H,o))continue;const Y=v?_.evaluate(H,{},o):void 0,te={id:P,properties:C.properties,type:C.type,sourceLayerIndex:F,index:k,geometry:j?H.geometry:Cl(C),patterns:{},sortKey:Y};p.push(te)}v&&p.sort(((C,P)=>C.sortKey-P.sortKey));for(const C of p){const{geometry:P,index:k,sourceLayerIndex:F}=C,j=t[k].feature;this.addFeature(C,P,k,o,M),n.featureIndex.insert(j,P,k,F,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ai),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u,p=1){let _;switch(p){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const b of n)for(const M of b){const C=M.x,P=M.y;if(C<0||C>=_t||P<0||P>=_t)continue;const k=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),F=k.vertexLength;for(let j=0;j<v;j++)for(let H=0;H<v;H++)Hf(this.layoutVertexArray,C,P,_[H],_[j]);for(let j=0;j<v-1;j++)for(let H=0;H<v-1;H++){const Y=F+j*v+H,te=F+(j+1)*v+H;this.indexArray.emplaceBack(Y,te+1,Y+1),this.indexArray.emplaceBack(Y,te,te+1)}k.vertexLength+=v*v,k.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:u})}}function El(a,t){for(let n=0;n<a.length;n++)if(iu(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(iu(a,t[n]))return!0;return!!tu(a,t)}function Ku(a,t,n){return!!iu(a,t)||!!Wu(t,a,n)}function Vd(a,t){if(a.length===1)return Gd(t,a[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(iu(a,o[u]))return!0}for(let n=0;n<a.length;n++)if(Gd(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(tu(a,t[n]))return!0;return!1}function $f(a,t,n){if(a.length>1){if(tu(a,t))return!0;for(let o=0;o<t.length;o++)if(Wu(t[o],a,n))return!0}for(let o=0;o<a.length;o++)if(Wu(a[o],t,n))return!0;return!1}function tu(a,t){if(a.length===0||t.length===0)return!1;for(let n=0;n<a.length-1;n++){const o=a[n],u=a[n+1];for(let p=0;p<t.length-1;p++)if(Xf(o,u,t[p],t[p+1]))return!0}return!1}function Xf(a,t,n,o){return Xa(a,n,o)!==Xa(t,n,o)&&Xa(a,t,n)!==Xa(a,t,o)}function Wu(a,t,n){const o=n*n;if(t.length===1)return a.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(Zd(a,t[u-1],t[u])<o)return!0;return!1}function Zd(a,t,n){const o=t.distSqr(n);if(o===0)return a.distSqr(t);const u=((a.x-t.x)*(n.x-t.x)+(a.y-t.y)*(n.y-t.y))/o;return a.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Gd(a,t){let n,o,u,p=!1;for(let _=0;_<a.length;_++){n=a[_];for(let v=0,b=n.length-1;v<n.length;b=v++)o=n[v],u=n[b],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function iu(a,t){let n=!1;for(let o=0,u=a.length-1;o<a.length;u=o++){const p=a[o],_=a[u];p.y>t.y!=_.y>t.y&&t.x<(_.x-p.x)*(t.y-p.y)/(_.y-p.y)+p.x&&(n=!n)}return n}function qd(a,t,n){const o=n[0],u=n[2];if(a.x<o.x&&t.x<o.x||a.x>u.x&&t.x>u.x||a.y<o.y&&t.y<o.y||a.y>u.y&&t.y>u.y)return!1;const p=Xa(a,t,n[0]);return p!==Xa(a,t,n[1])||p!==Xa(a,t,n[2])||p!==Xa(a,t,n[3])}function fn(a,t,n){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(a)}function aa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Qu(a,t,n,o,u){if(!t[0]&&!t[1])return a;const p=pe.convert(t)._mult(u);n==="viewport"&&p._rotate(-o);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(p));return _}function Yf({queryGeometry:a,size:t},n){return Ku(a,n,t)}function Kf({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},p){return Ku(a,p,t*(n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function Wf({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},p){const _=n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera,v=t*(n.cameraToCenterDistance/_);return Ku(a,nu(p,n,o,u),v)}function Ju({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},p){return Ku(a,nu(p,n,o,u),t)}function Hd({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:p="map",pitchScale:_="map"},v){const b=p==="map"?_==="map"?Yf:Kf:_==="map"?Wf:Ju,M={queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u};for(const C of v)for(const P of C)if(b(M,P))return!0;return!1}function nu(a,t,n,o){const u=t.projectTileCoordinates(a.x,a.y,n,o).point;return new pe((.5*u.x+.5)*t.width,(.5*-u.y+.5)*t.height)}let $d,Qf;ot("CircleBucket",Kh,{omit:["layers"]});var Wh={get paint(){return Qf=Qf||new na({"circle-radius":new mt(be.paint_circle["circle-radius"]),"circle-color":new mt(be.paint_circle["circle-color"]),"circle-blur":new mt(be.paint_circle["circle-blur"]),"circle-opacity":new mt(be.paint_circle["circle-opacity"]),"circle-translate":new dt(be.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mt(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mt(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mt(be.paint_circle["circle-stroke-opacity"])})},get layout(){return $d=$d||new na({"circle-sort-key":new mt(be.layout_circle["circle-sort-key"])})}};class Xd extends gn{constructor(t,n){super(t,Wh,n)}createBucket(t){return new Kh(t)}queryRadius(t){const n=t;return fn("circle-radius",this,n)+fn("circle-stroke-width",this,n)+aa(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){const M=Qu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,_),C=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),P=this.paint.get("circle-pitch-scale"),k=this.paint.get("circle-pitch-alignment");let F,j;return k==="map"?(F=M,j=C*_):(F=(function(H,Y,te,xe){return H.map((se=>nu(se,Y,te,xe)))})(M,p,v,b),j=C),Hd({queryGeometry:F,size:j,transform:p,unwrappedTileID:v,getElevation:b,pitchAlignment:k,pitchScale:P},u)}}class Yd extends Kh{}let Kd;ot("HeatmapBucket",Yd,{omit:["layers"]});var Jf={get paint(){return Kd=Kd||new na({"heatmap-radius":new mt(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mt(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xl(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(be.paint_heatmap["heatmap-opacity"])})}};function eh(a,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return a.width=t,a.height=n,a.data=u,a}function Qh(a,{width:t,height:n},o){if(t===a.width&&n===a.height)return;const u=eh({},{width:t,height:n},o);th(a,u,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,n)},o),a.width=t,a.height=n,a.data=u.data}function th(a,t,n,o,u,p){if(u.width===0||u.height===0)return t;if(u.width>a.width||u.height>a.height||n.x>a.width-u.width||n.y>a.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<u.height;b++){const M=((n.y+b)*a.width+n.x)*p,C=((o.y+b)*t.width+o.x)*p;for(let P=0;P<u.width*p;P++)v[C+P]=_[M+P]}return t}class au{constructor(t,n){eh(this,t,1,n)}resize(t){Qh(this,t,1)}clone(){return new au({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){th(t,n,o,u,p,1)}}class Aa{constructor(t,n){eh(this,t,4,n)}resize(t){Qh(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Aa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){th(t,n,o,u,p,4)}setPixel(t,n,o){const u=4*(t*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function ih(a){const t={},n=a.resolution||256,o=a.clips?a.clips.length:1,u=a.image||new Aa({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(_,v,b)=>{t[a.evaluationKey]=b;const M=a.expression.evaluate(t);u.setPixel(_/4/n,v/4,M)};if(a.clips)for(let _=0,v=0;_<o;++_,v+=4*n)for(let b=0,M=0;b<n;b++,M+=4){const C=b/(n-1),{start:P,end:k}=a.clips[_];p(v,M,P*(1-C)+k*C)}else for(let _=0,v=0;_<n;_++,v+=4)p(0,v,_/(n-1));return u}ot("AlphaImage",au),ot("RGBAImage",Aa);const nh="big-fb";class ep extends gn{createBucket(t){return new Yd(t)}constructor(t,n){super(t,Jf,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ih({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(nh)&&this.heatmapFbos.delete(nh)}queryRadius(t){return fn("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:b}){return Hd({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,o)*_,transform:p,unwrappedTileID:v,getElevation:b},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Jh;var tp={get paint(){return Jh=Jh||new na({"hillshade-illumination-direction":new dt(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new dt(be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new dt(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new dt(be.paint_hillshade["hillshade-method"])})}};class Zo extends gn{constructor(t,n){super(t,tp,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(t.length,n.length,o.length,u.length);t=t.concat(Array(p-t.length).fill(t.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const _=n.map(Nn);return{directionRadians:t.map(Nn),altitudeRadians:_,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let ed;var Op={get paint(){return ed=ed||new na({"color-relief-opacity":new dt(be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new xl(be["paint_color-relief"]["color-relief-color"])})}};class td{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:p}=t,_=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(n&&n.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[u,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||xr(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,u,p,0,this.format,b.UNSIGNED_BYTE,t.data);else{const{x:M,y:C}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||xr(t)?b.texSubImage2D(b.TEXTURE_2D,0,M,C,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,M,C,u,p,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class go{constructor(t,n,o,u=1,p=1,_=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Ri(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const b=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<b;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(b,M)]=this.data[this._idx(b-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,b)]=this.data[this._idx(M,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<b;M++)for(let C=0;C<b;C++){const P=this.get(M,C);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return id(t,this.getUnpackVector())}getPixels(){return new Aa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const b=-n*this.dim,M=-o*this.dim;for(let C=_;C<v;C++)for(let P=u;P<p;P++)this.data[this._idx(P,C)]=t.data[this._idx(P+b,C+M)]}}function id(a,t){const n=t[0],o=t[1],u=t[2],p=t[3],_=Math.min(n,o,u),v=Math.round((a+p)/_);return{r:Math.floor(v*_/n)%256,g:Math.floor(v*_/o)%256,b:Math.floor(v*_/u)%256}}ot("DEMData",go);class ip extends gn{constructor(t,n){super(t,Op,n)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof gl&&o._styleExpression.expression instanceof ea){this.colorRampExpression=o;const _=o._styleExpression.expression;n.elevationStops=_.labels,n.colorStops=[];for(const v of n.elevationStops)n.colorStops.push(_.evaluate({globals:{elevation:v}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[$t.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const u={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(t-1);for(let _=0;_<n.elevationStops.length-.5;_+=p)u.elevationStops.push(n.elevationStops[Math.round(_)]),u.colorStops.push(n.colorStops[Math.round(_)]);return Ri(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),p=new Aa({width:u.colorStops.length,height:1}),_=new Aa({width:u.colorStops.length,height:1});for(let v=0;v<u.elevationStops.length;v++){const b=id(u.elevationStops[v],o);_.setPixel(0,v,new $t(b.r/255,b.g/255,b.b/255,1)),p.setPixel(0,v,u.colorStops[v])}return this.colorRampTextures={elevationTexture:new td(t,_,t.gl.RGBA),colorTexture:new td(t,p,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const nd=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:ah}=nd;function Xi(a,t,n){const o=n.patternDependencies;let u=!1;for(const p of t){const _=p.paint.get(`${a}-pattern`);_.isConstant()||(u=!0);const v=_.constantOr(null);v&&(u=!0,o[v.to]=!0,o[v.from]=!0)}return u}function Wd(a,t,n,o,u){const{zoom:p}=o,_=u.patternDependencies;for(const v of t){const b=v.paint.get(`${a}-pattern`).value;if(b.kind!=="constant"){let M=b.evaluate({zoom:p-1},n,{},u.availableImages),C=b.evaluate({zoom:p},n,{},u.availableImages),P=b.evaluate({zoom:p+1},n,{},u.availableImages);M=M&&M.name?M.name:M,C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,_[M]=!0,_[C]=!0,_[P]=!0,n.patterns[v.id]={min:M,mid:C,max:P}}}return n}function np(a,t,n,o,u){let p;if(u===(function(_,v,b,M){let C=0;for(let P=v,k=b-M;P<b;P+=M)C+=(_[k]-_[P])*(_[P+1]+_[k+1]),k=P;return C})(a,t,n,o)>0)for(let _=t;_<n;_+=o)p=tf(_/o|0,a[_],a[_+1],p);else for(let _=n-o;_>=t;_-=o)p=tf(_/o|0,a[_],a[_+1],p);return p&&pn(p,p.next)&&(Yi(p),p=p.next),p}function Al(a,t){if(!a)return a;t||(t=a);let n,o=a;do if(n=!1,o.steiner||!pn(o,o.next)&&zi(o.prev,o,o.next)!==0)o=o.next;else{if(Yi(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Go(a,t,n,o,u,p,_){if(!a)return;!_&&p&&(function(b,M,C,P){let k=b;do k.z===0&&(k.z=ad(k.x,k.y,M,C,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==b);k.prevZ.nextZ=null,k.prevZ=null,(function(F){let j,H=1;do{let Y,te=F;F=null;let xe=null;for(j=0;te;){j++;let se=te,ue=0;for(let Le=0;Le<H&&(ue++,se=se.nextZ,se);Le++);let Ce=H;for(;ue>0||Ce>0&&se;)ue!==0&&(Ce===0||!se||te.z<=se.z)?(Y=te,te=te.nextZ,ue--):(Y=se,se=se.nextZ,Ce--),xe?xe.nextZ=Y:F=Y,Y.prevZ=xe,xe=Y;te=se}xe.nextZ=null,H*=2}while(j>1)})(k)})(a,o,u,p);let v=a;for(;a.prev!==a.next;){const b=a.prev,M=a.next;if(p?ap(a,o,u,p):zl(a))t.push(b.i,a.i,M.i),Yi(a),a=M.next,v=M.next;else if((a=M)===v){_?_===1?Go(a=rp(Al(a),t),t,n,o,u,p,2):_===2&&rh(a,t,n,o,u,p):Go(Al(a),t,n,o,u,p,1);break}}}function zl(a){const t=a.prev,n=a,o=a.next;if(zi(t,n,o)>=0)return!1;const u=t.x,p=n.x,_=o.x,v=t.y,b=n.y,M=o.y,C=Math.min(u,p,_),P=Math.min(v,b,M),k=Math.max(u,p,_),F=Math.max(v,b,M);let j=o.next;for(;j!==t;){if(j.x>=C&&j.x<=k&&j.y>=P&&j.y<=F&&Pl(u,v,p,b,_,M,j.x,j.y)&&zi(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function ap(a,t,n,o){const u=a.prev,p=a,_=a.next;if(zi(u,p,_)>=0)return!1;const v=u.x,b=p.x,M=_.x,C=u.y,P=p.y,k=_.y,F=Math.min(v,b,M),j=Math.min(C,P,k),H=Math.max(v,b,M),Y=Math.max(C,P,k),te=ad(F,j,t,n,o),xe=ad(H,Y,t,n,o);let se=a.prevZ,ue=a.nextZ;for(;se&&se.z>=te&&ue&&ue.z<=xe;){if(se.x>=F&&se.x<=H&&se.y>=j&&se.y<=Y&&se!==u&&se!==_&&Pl(v,C,b,P,M,k,se.x,se.y)&&zi(se.prev,se,se.next)>=0||(se=se.prevZ,ue.x>=F&&ue.x<=H&&ue.y>=j&&ue.y<=Y&&ue!==u&&ue!==_&&Pl(v,C,b,P,M,k,ue.x,ue.y)&&zi(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;se&&se.z>=te;){if(se.x>=F&&se.x<=H&&se.y>=j&&se.y<=Y&&se!==u&&se!==_&&Pl(v,C,b,P,M,k,se.x,se.y)&&zi(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;ue&&ue.z<=xe;){if(ue.x>=F&&ue.x<=H&&ue.y>=j&&ue.y<=Y&&ue!==u&&ue!==_&&Pl(v,C,b,P,M,k,ue.x,ue.y)&&zi(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function rp(a,t){let n=a;do{const o=n.prev,u=n.next.next;!pn(o,u)&&sd(o,n,n.next,u)&&oh(o,u)&&oh(u,o)&&(t.push(o.i,n.i,u.i),Yi(n),Yi(n.next),n=a=u),n=n.next}while(n!==a);return Al(n)}function rh(a,t,n,o,u,p){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&op(_,v)){let b=ef(_,v);return _=Al(_,_.next),b=Al(b,b.next),Go(_,t,n,o,u,p,0),void Go(b,t,n,o,u,p,0)}v=v.next}_=_.next}while(_!==a)}function _o(a,t){let n=a.x-t.x;return n===0&&(n=a.y-t.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function sp(a,t){const n=(function(u,p){let _=p;const v=u.x,b=u.y;let M,C=-1/0;if(pn(u,_))return _;do{if(pn(u,_.next))return _.next;if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){const H=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(H<=v&&H>C&&(C=H,M=_.x<_.next.x?_:_.next,H===v))return M}_=_.next}while(_!==p);if(!M)return null;const P=M,k=M.x,F=M.y;let j=1/0;_=M;do{if(v>=_.x&&_.x>=k&&v!==_.x&&rd(b<F?v:C,b,k,F,b<F?C:v,b,_.x,_.y)){const H=Math.abs(b-_.y)/(v-_.x);oh(_,u)&&(H<j||H===j&&(_.x>M.x||_.x===M.x&&Qd(M,_)))&&(M=_,j=H)}_=_.next}while(_!==P);return M})(a,t);if(!n)return t;const o=ef(n,a);return Al(o,o.next),Al(n,n.next)}function Qd(a,t){return zi(a.prev,a,t.prev)<0&&zi(t.next,a,a.next)<0}function ad(a,t,n,o,u){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*u|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jd(a){let t=a,n=a;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==a);return n}function rd(a,t,n,o,u,p,_,v){return(u-_)*(t-v)>=(a-_)*(p-v)&&(a-_)*(o-v)>=(n-_)*(t-v)&&(n-_)*(p-v)>=(u-_)*(o-v)}function Pl(a,t,n,o,u,p,_,v){return!(a===_&&t===v)&&rd(a,t,n,o,u,p,_,v)}function op(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&sd(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1})(a,t)&&(oh(a,t)&&oh(t,a)&&(function(n,o){let u=n,p=!1;const _=(n.x+o.x)/2,v=(n.y+o.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p})(a,t)&&(zi(a.prev,a,t.prev)||zi(a,t.prev,t))||pn(a,t)&&zi(a.prev,a,a.next)>0&&zi(t.prev,t,t.next)>0)}function zi(a,t,n){return(t.y-a.y)*(n.x-t.x)-(t.x-a.x)*(n.y-t.y)}function pn(a,t){return a.x===t.x&&a.y===t.y}function sd(a,t,n,o){const u=Xn(zi(a,t,n)),p=Xn(zi(a,t,o)),_=Xn(zi(n,o,a)),v=Xn(zi(n,o,t));return u!==p&&_!==v||!(u!==0||!sh(a,n,t))||!(p!==0||!sh(a,o,t))||!(_!==0||!sh(n,a,o))||!(v!==0||!sh(n,t,o))}function sh(a,t,n){return t.x<=Math.max(a.x,n.x)&&t.x>=Math.min(a.x,n.x)&&t.y<=Math.max(a.y,n.y)&&t.y>=Math.min(a.y,n.y)}function Xn(a){return a>0?1:a<0?-1:0}function oh(a,t){return zi(a.prev,a,a.next)<0?zi(a,t,a.next)>=0&&zi(a,a.prev,t)>=0:zi(a,t,a.prev)<0||zi(a,a.next,t)<0}function ef(a,t){const n=Ha(a.i,a.x,a.y),o=Ha(t.i,t.x,t.y),u=a.next,p=t.prev;return a.next=t,t.prev=a,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function tf(a,t,n,o){const u=Ha(a,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Yi(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Ha(a,t,n){return{i:a,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class hr{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class lh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}lh.noSubdivision=new lh({fill:new hr(0,0),line:new hr(0,0),tile:new hr(0,0),stencil:new hr(0,0),circle:1}),ot("SubdivisionGranularityExpression",hr),ot("SubdivisionGranularitySetting",lh);const bc=-32768,ru=32767;class Fp{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=_t/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),u=0|Math.round(n),p=this._getKey(o,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,_),this._vertexBuffer.push(o,u),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(u,p){const _=[];for(let v=0;v<p.length;v+=3){const b=p[v],M=p[v+1],C=p[v+2],P=u[2*b],k=u[2*b+1];(u[2*M]-P)*(u[2*C+1]-k)-(u[2*M+1]-k)*(u[2*C]-P)>0?(_.push(b),_.push(C),_.push(M)):(_.push(b),_.push(M),_.push(C))}return _})(this._vertexBuffer,t);const n=[],o=t.length;for(let u=0;u<o;u+=3){const p=[t[u+0],t[u+1],t[u+2]],_=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let v=1/0,b=1/0,M=-1/0,C=-1/0;for(let H=0;H<3;H++){const Y=_[2*H],te=_[2*H+1];v=Math.min(v,Y),M=Math.max(M,Y),b=Math.min(b,te),C=Math.max(C,te)}if(v===M||b===C)continue;const P=Math.floor(v/this._granularityCellSize),k=Math.ceil(M/this._granularityCellSize),F=Math.floor(b/this._granularityCellSize),j=Math.ceil(C/this._granularityCellSize);if(P!==k||F!==j)for(let H=F;H<j;H++){const Y=this._scanlineGenerateVertexRingForCellRow(H,_,p);Is(this._vertexBuffer,Y,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const u=t*this._granularityCellSize,p=u+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const b=n[2*v],M=n[2*v+1],C=n[2*(v+1)%6],P=n[(2*(v+1)+1)%6],k=n[2*(v+2)%6],F=n[(2*(v+2)+1)%6],j=C-b,H=P-M,Y=j===0,te=H===0,xe=(u-M)/H,se=(p-M)/H,ue=Math.min(xe,se),Ce=Math.max(xe,se);if(!te&&(ue>=1||Ce<=0)||te&&(M<u||M>p)){P>=u&&P<=p&&_.push(o[(v+1)%3]);continue}!te&&ue>0&&_.push(this._vertexToIndex(b+j*ue,M+H*ue));const Le=b+j*Math.max(ue,0),He=b+j*Math.min(Ce,1);Y||this._generateIntraEdgeVertices(_,b,M,C,P,Le,He),!te&&Ce<1&&_.push(this._vertexToIndex(b+j*Ce,M+H*Ce)),(te||P>=u&&P<=p)&&_.push(o[(v+1)%3]),!te&&(P<=u||P>=p)&&this._generateInterEdgeVertices(_,b,M,C,P,k,F,He,u,p)}return _}_generateIntraEdgeVertices(t,n,o,u,p,_,v){const b=u-n,M=p-o,C=M===0,P=C?Math.min(n,u):Math.min(_,v),k=C?Math.max(n,u):Math.max(_,v),F=Math.floor(P/this._granularityCellSize)+1,j=Math.ceil(k/this._granularityCellSize)-1;if(C?n<u:_<v)for(let H=F;H<=j;H++){const Y=H*this._granularityCellSize;t.push(this._vertexToIndex(Y,o+M*(Y-n)/b))}else for(let H=j;H>=F;H--){const Y=H*this._granularityCellSize;t.push(this._vertexToIndex(Y,o+M*(Y-n)/b))}}_generateInterEdgeVertices(t,n,o,u,p,_,v,b,M,C){const P=p-o,k=_-u,F=v-p,j=(M-p)/F,H=(C-p)/F,Y=Math.min(j,H),te=Math.max(j,H),xe=u+k*Y;let se=Math.floor(Math.min(xe,b)/this._granularityCellSize)+1,ue=Math.ceil(Math.max(xe,b)/this._granularityCellSize)-1,Ce=b<xe;const Le=F===0;if(Le&&(v===M||v===C))return;if(Le||Y>=1||te<=0){const at=o-v,et=_+(n-_)*Math.min((M-v)/at,(C-v)/at);se=Math.floor(Math.min(et,b)/this._granularityCellSize)+1,ue=Math.ceil(Math.max(et,b)/this._granularityCellSize)-1,Ce=b<et}const He=P>0?C:M;if(Ce)for(let at=se;at<=ue;at++)t.push(this._vertexToIndex(at*this._granularityCellSize,He));else for(let at=ue;at>=se;at--)t.push(this._vertexToIndex(at*this._granularityCellSize,He))}_generateOutline(t){const n=[];for(const o of t){const u=ra(o,this._granularity,!0),p=this._pointArrayToIndices(u),_=[];for(let v=1;v<p.length;v++)_.push(p[v-1]),_.push(p[v]);n.push(_)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===bc&&(t[n+1]=-32767),o===ru&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,u,p,_){u>p!=(_===bc)?(t.push(n),t.push(o),t.push(this._vertexToIndex(u,_)),t.push(o),t.push(this._vertexToIndex(p,_)),t.push(this._vertexToIndex(u,_))):(t.push(o),t.push(n),t.push(this._vertexToIndex(u,_)),t.push(this._vertexToIndex(p,_)),t.push(o),t.push(this._vertexToIndex(u,_)))}_fillPoles(t,n,o){const u=this._vertexBuffer,p=_t,_=t.length;for(let v=2;v<_;v+=3){const b=t[v-2],M=t[v-1],C=t[v],P=u[2*b],k=u[2*b+1],F=u[2*M],j=u[2*M+1],H=u[2*C],Y=u[2*C+1];n&&(k===0&&j===0&&this._generatePoleQuad(t,b,M,P,F,bc),j===0&&Y===0&&this._generatePoleQuad(t,M,C,F,H,bc),Y===0&&k===0&&this._generatePoleQuad(t,C,b,H,P,bc)),o&&(k===p&&j===p&&this._generatePoleQuad(t,b,M,P,F,ru),j===p&&Y===p&&this._generatePoleQuad(t,M,C,F,H,ru),Y===p&&k===p&&this._generatePoleQuad(t,C,b,H,P,ru))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(v){const b=[],M=[];for(const C of v)if(C.length!==0){C!==v[0]&&b.push(M.length/2);for(let P=0;P<C.length;P++)M.push(C[P].x),M.push(C[P].y)}return{flattened:M,holeIndices:b}})(t);let p;this._initializeVertices(o);try{const v=(function(M,C,P=2){const k=C&&C.length,F=k?C[0]*P:M.length;let j=np(M,0,F,P,!0);const H=[];if(!j||j.next===j.prev)return H;let Y,te,xe;if(k&&(j=(function(se,ue,Ce,Le){const He=[];for(let at=0,et=ue.length;at<et;at++){const nt=np(se,ue[at]*Le,at<et-1?ue[at+1]*Le:se.length,Le,!1);nt===nt.next&&(nt.steiner=!0),He.push(Jd(nt))}He.sort(_o);for(let at=0;at<He.length;at++)Ce=sp(He[at],Ce);return Ce})(M,C,j,P)),M.length>80*P){Y=M[0],te=M[1];let se=Y,ue=te;for(let Ce=P;Ce<F;Ce+=P){const Le=M[Ce],He=M[Ce+1];Le<Y&&(Y=Le),He<te&&(te=He),Le>se&&(se=Le),He>ue&&(ue=He)}xe=Math.max(se-Y,ue-te),xe=xe!==0?32767/xe:0}return Go(j,H,P,Y,te,xe,0),H})(o,u),b=this._convertIndices(o,v);p=this._subdivideTrianglesScanline(b)}catch(v){console.error(v)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:_}}_convertIndices(t,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(t[2*n[u]],t[2*n[u]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const u=t[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function ch(a,t,n,o=!0){return new Fp(n,t).subdividePolygonInternal(a,o)}function ra(a,t,n=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],u=a[a.length-1],p=n&&(o.x!==u.x||o.y!==u.y);if(t<2)return p?[...a,a[0]]:[...a];const _=Math.floor(_t/t),v=[];v.push(new pe(a[0].x,a[0].y));const b=a.length,M=p?b:b-1;for(let C=0;C<M;C++){const P=a[C],k=C<b-1?a[C+1]:a[0],F=P.x,j=P.y,H=k.x,Y=k.y,te=F!==H,xe=j!==Y;if(!te&&!xe)continue;const se=H-F,ue=Y-j,Ce=Math.abs(se),Le=Math.abs(ue);let He=F,at=j;for(;;){const nt=se>0?(Math.floor(He/_)+1)*_:(Math.ceil(He/_)-1)*_,gt=ue>0?(Math.floor(at/_)+1)*_:(Math.ceil(at/_)-1)*_,tt=Math.abs(He-nt),it=Math.abs(at-gt),je=Math.abs(He-H),St=Math.abs(at-Y),zt=te?tt/Ce:Number.POSITIVE_INFINITY,xt=xe?it/Le:Number.POSITIVE_INFINITY;if((je<=tt||!te)&&(St<=it||!xe))break;if(zt<xt&&te||!xe){He=nt,at+=ue*zt;const ft=new pe(He,Math.round(at));v[v.length-1].x===ft.x&&v[v.length-1].y===ft.y||v.push(ft)}else{He+=se*xt,at=gt;const ft=new pe(Math.round(He),at);v[v.length-1].x===ft.x&&v[v.length-1].y===ft.y||v.push(ft)}}const et=new pe(H,Y);v[v.length-1].x===et.x&&v[v.length-1].y===et.y||v.push(et)}return v}function Is(a,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=a[2*t[0]];for(let b=1;b<t.length;b++){const M=a[2*t[b]];M<u&&(u=M,o=b)}const p=t.length;let _=o,v=(_+1)%p;for(;;){const b=_-1>=0?_-1:p-1,M=(v+1)%p,C=a[2*t[b]],P=a[2*t[M]],k=a[2*t[_]],F=a[2*t[_]+1],j=a[2*t[v]+1];let H=!1;if(C<P)H=!0;else if(C>P)H=!1;else{const Y=j-F,te=-(a[2*t[v]]-k),xe=F<j?1:-1;((C-k)*Y+(a[2*t[b]+1]-F)*te)*xe>((P-k)*Y+(a[2*t[M]+1]-F)*te)*xe&&(H=!0)}if(H){const Y=t[b],te=t[_],xe=t[v];Y!==te&&Y!==xe&&te!==xe&&n.push(xe,te,Y),_--,_<0&&(_=p-1)}else{const Y=t[M],te=t[_],xe=t[v];Y!==te&&Y!==xe&&te!==xe&&n.push(xe,te,Y),v++,v>=p&&(v=0)}if(b===M)break}}function nf(a,t,n,o,u,p,_,v,b){const M=u.length/2,C=_&&v&&b;if(M<qt.MAX_VERTEX_ARRAY_LENGTH){const P=t.prepareSegment(M,n,o),k=P.vertexLength;for(let H=0;H<p.length;H+=3)o.emplaceBack(k+p[H],k+p[H+1],k+p[H+2]);let F,j;P.vertexLength+=M,P.primitiveLength+=p.length/3,C&&(j=_.prepareSegment(M,n,v),F=j.vertexLength,j.vertexLength+=M);for(let H=0;H<u.length;H+=2)a(u[H],u[H+1]);if(C)for(let H=0;H<b.length;H++){const Y=b[H];for(let te=1;te<Y.length;te+=2)v.emplaceBack(F+Y[te-1],F+Y[te]);j.primitiveLength+=Y.length/2}}else(function(P,k,F,j,H,Y){const te=[];for(let Le=0;Le<j.length/2;Le++)te.push(-1);const xe={count:0};let se=0,ue=P.getOrCreateLatestSegment(k,F),Ce=ue.vertexLength;for(let Le=2;Le<H.length;Le+=3){const He=H[Le-2],at=H[Le-1],et=H[Le];let nt=te[He]<se,gt=te[at]<se,tt=te[et]<se;ue.vertexLength+((nt?1:0)+(gt?1:0)+(tt?1:0))>qt.MAX_VERTEX_ARRAY_LENGTH&&(ue=P.createNewSegment(k,F),se=xe.count,nt=!0,gt=!0,tt=!0,Ce=0);const it=ba(te,j,Y,xe,He,nt,ue),je=ba(te,j,Y,xe,at,gt,ue),St=ba(te,j,Y,xe,et,tt,ue);F.emplaceBack(Ce+it-se,Ce+je-se,Ce+St-se),ue.primitiveLength++}})(t,n,o,u,p,a),C&&(function(P,k,F,j,H,Y){const te=[];for(let Le=0;Le<j.length/2;Le++)te.push(-1);const xe={count:0};let se=0,ue=P.getOrCreateLatestSegment(k,F),Ce=ue.vertexLength;for(let Le=0;Le<H.length;Le++){const He=H[Le];for(let at=1;at<H[Le].length;at+=2){const et=He[at-1],nt=He[at];let gt=te[et]<se,tt=te[nt]<se;ue.vertexLength+((gt?1:0)+(tt?1:0))>qt.MAX_VERTEX_ARRAY_LENGTH&&(ue=P.createNewSegment(k,F),se=xe.count,gt=!0,tt=!0,Ce=0);const it=ba(te,j,Y,xe,et,gt,ue),je=ba(te,j,Y,xe,nt,tt,ue);F.emplaceBack(Ce+it-se,Ce+je-se),ue.primitiveLength++}}})(_,n,v,u,b,a),t.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function ba(a,t,n,o,u,p,_){if(p){const v=o.count;return n(t[2*u],t[2*u+1]),a[u]=o.count,o.count++,_.vertexLength++,v}return a[u]}class od{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Pe,this.indexArray=new Fn,this.indexArray2=new $i,this.programConfigurations=new Ml(t.layers,t.zoom),this.segments=new qt,this.segments2=new qt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasDependencies=Xi("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),_=[];for(const{feature:v,id:b,index:M,sourceLayerIndex:C}of t){const P=this.layers[0]._featureFilter.needGeometry,k=Vo(v,P);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),k,o))continue;const F=p?u.evaluate(k,{},o,n.availableImages):void 0,j={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:M,geometry:P?k.geometry:Cl(v),patterns:{},sortKey:F};_.push(j)}p&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:M,sourceLayerIndex:C}=v;if(this.hasDependencies){const P=Wd("fill",this.layers,v,{zoom:this.zoom},n);this.patternFeatures.push(P)}else this.addFeature(v,b,M,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[M].feature,b,M,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ah),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,p,_){for(const v of dl(n,500)){const b=ch(v,u,_.fill.getGranularityForZoomLevel(u.z)),M=this.layoutVertexArray;nf(((C,P)=>{M.emplaceBack(C,P)}),this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:p,canonical:u})}}let yo,Dl;ot("FillBucket",od,{omit:["layers","patternFeatures"]});var qo={get paint(){return Dl=Dl||new na({"fill-antialias":new dt(be.paint_fill["fill-antialias"]),"fill-opacity":new mt(be.paint_fill["fill-opacity"]),"fill-color":new mt(be.paint_fill["fill-color"]),"fill-outline-color":new mt(be.paint_fill["fill-outline-color"]),"fill-translate":new dt(be.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new co(be.paint_fill["fill-pattern"])})},get layout(){return yo=yo||new na({"fill-sort-key":new mt(be.layout_fill["fill-sort-key"])})}};class af extends gn{constructor(t,n){super(t,qo,n)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new od(t)}queryRadius(){return aa(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:u}){return Vd(Qu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const rf=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Rs=Ti([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lp}=rf;class Ls{constructor(t,n,o,u,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=u,this._values=p,t.readFields(uh,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,o=[];let u,p=1,_=0,v=0,b=0;for(;t.pos<n;){if(_<=0){const M=t.readVarint();p=7&M,_=M>>3}if(_--,p===1||p===2)v+=t.readSVarint(),b+=t.readSVarint(),p===1&&(u&&o.push(u),u=[]),u&&u.push(new pe(v,b));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let o=1,u=0,p=0,_=0,v=1/0,b=-1/0,M=1/0,C=-1/0;for(;t.pos<n;){if(u<=0){const P=t.readVarint();o=7&P,u=P>>3}if(u--,o===1||o===2)p+=t.readSVarint(),_+=t.readSVarint(),p<v&&(v=p),p>b&&(b=p),_<M&&(M=_),_>C&&(C=_);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,M,b,C]}toGeoJSON(t,n,o){const u=this.extent*Math.pow(2,o),p=this.extent*t,_=this.extent*n,v=this.loadGeometry();function b(k){return[360*(k.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+_)/u)*Math.PI))-90]}function M(k){return k.map(b)}let C;if(this.type===1){const k=[];for(const j of v)k.push(j[0]);const F=M(k);C=k.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const k=v.map(M);C=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=(function(j){const H=j.length;if(H<=1)return[j];const Y=[];let te,xe;for(let se=0;se<H;se++){const ue=hh(j[se]);ue!==0&&(xe===void 0&&(xe=ue<0),xe===ue<0?(te&&Y.push(te),te=[j[se]]):te&&te.push(j[se]))}return te&&Y.push(te),Y})(v),F=[];for(const j of k)F.push(j.map(M));C=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const P={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function uh(a,t,n){a===1?t.id=n.readVarint():a===2?(function(o,u){const p=o.readVarint()+o.pos;for(;o.pos<p;){const _=u._keys[o.readVarint()],v=u._values[o.readVarint()];u.properties[_]=v}})(n,t):a===3?t.type=n.readVarint():a===4&&(t._geometry=n.pos)}function hh(a){let t=0;for(let n,o,u=0,p=a.length,_=p-1;u<p;_=u++)n=a[u],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}Ls.types=["Unknown","Point","LineString","Polygon"];class wc{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(cp,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new Ls(this._pbf,n,this.extent,this._keys,this._values)}}function cp(a,t,n){a===15?t.version=n.readVarint():a===1?t.name=n.readString():a===5?t.extent=n.readVarint():a===2?t._features.push(n.pos):a===3?t._keys.push(n.readString()):a===4&&t._values.push((function(o){let u=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const _=o.readVarint()>>3;u=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class sf{constructor(t,n){this.layers=t.readFields(dh,{},n)}}function dh(a,t,n){if(a===3){const o=new wc(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}const ld=Math.pow(2,13);function Il(a,t,n,o,u,p,_,v){a.emplaceBack(t,n,2*Math.floor(o*ld)+_,u*ld*2,p*ld*2,Math.round(v))}class cd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new Je,this.centroidVertexArray=new Ee,this.indexArray=new Fn,this.programConfigurations=new Ml(t.layers,t.zoom),this.segments=new qt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.features=[],this.hasDependencies=Xi("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:_,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,M=Vo(u,b);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),M,o))continue;const C={id:p,sourceLayerIndex:v,index:_,geometry:b?M.geometry:Cl(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Wd("fill-extrusion",this.layers,C,{zoom:this.zoom},n)):this.addFeature(C,C.geometry,_,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,C.geometry,_,v,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Rs.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,p,_){for(const v of dl(n,500)){const b={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(b,u,t,v,_);const C=this.layoutVertexArray.length-M,P=Math.floor(b.x/b.sampleCount),k=Math.floor(b.y/b.sampleCount);for(let F=0;F<C;F++)this.centroidVertexArray.emplaceBack(P,k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:p,canonical:u})}processPolygon(t,n,o,u,p){if(u.length<1||Mi(u[0]))return;for(const P of u)P.length!==0&&Up(t,P);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=p.fill.getGranularityForZoomLevel(n.z),b=Ls.types[o.type]==="Polygon";for(const P of u){if(P.length===0||Mi(P))continue;const k=ra(P,v,b);this._generateSideFaces(k,_)}if(!b)return;const M=ch(u,n,v,!1),C=this.layoutVertexArray;nf(((P,k)=>{Il(C,P,k,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let u=1;u<t.length;u++){const p=t[u],_=t[u-1];if(jp(p,_))continue;n.segment.vertexLength+4>qt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=p.sub(_)._perp()._unit(),b=_.dist(p);o+b>32768&&(o=0),Il(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,0,o),Il(this.layoutVertexArray,p.x,p.y,v.x,v.y,0,1,o),o+=b,Il(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Il(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o);const M=n.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function Up(a,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function jp(a,t){return a.x===t.x&&(a.x<0||a.x>_t)||a.y===t.y&&(a.y<0||a.y>_t)}function Mi(a){return a.every((t=>t.x<0))||a.every((t=>t.x>_t))||a.every((t=>t.y<0))||a.every((t=>t.y>_t))}let Ki;ot("FillExtrusionBucket",cd,{omit:["layers","features"]});var ci={get paint(){return Ki=Ki||new na({"fill-extrusion-opacity":new dt(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mt(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new co(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mt(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mt(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class hi extends gn{constructor(t,n){super(t,ci,n)}createBucket(t){return new cd(t)}queryRadius(){return aa(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_,pixelPosMatrix:v}){const b=Qu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,_),M=this.paint.get("fill-extrusion-height").evaluate(n,o),C=this.paint.get("fill-extrusion-base").evaluate(n,o),P=(function(F,j){const H=[];for(const Y of F){const te=[Y.x,Y.y,0,1];wa(te,te,j),H.push(new pe(te[0]/te[3],te[1]/te[3]))}return H})(b,v),k=(function(F,j,H,Y){const te=[],xe=[],se=Y[8]*j,ue=Y[9]*j,Ce=Y[10]*j,Le=Y[11]*j,He=Y[8]*H,at=Y[9]*H,et=Y[10]*H,nt=Y[11]*H;for(const gt of F){const tt=[],it=[];for(const je of gt){const St=je.x,zt=je.y,xt=Y[0]*St+Y[4]*zt+Y[12],ft=Y[1]*St+Y[5]*zt+Y[13],Yt=Y[2]*St+Y[6]*zt+Y[14],en=Y[3]*St+Y[7]*zt+Y[15],yn=Yt+Ce,oa=en+Le,_r=xt+He,Pa=ft+at,an=Yt+et,yi=en+nt,tn=new pe((xt+se)/oa,(ft+ue)/oa);tn.z=yn/oa,tt.push(tn);const Sn=new pe(_r/yi,Pa/yi);Sn.z=an/yi,it.push(Sn)}te.push(tt),xe.push(it)}return[te,xe]})(u,C,M,v);return(function(F,j,H){let Y=1/0;Vd(H,j)&&(Y=dr(H,j[0]));for(let te=0;te<j.length;te++){const xe=j[te],se=F[te];for(let ue=0;ue<xe.length-1;ue++){const Ce=xe[ue],Le=[Ce,xe[ue+1],se[ue+1],se[ue],Ce];El(H,Le)&&(Y=Math.min(Y,dr(H,Le)))}}return Y!==1/0&&Y})(k[0],k[1],P)}}function gi(a,t){return a.x*t.x+a.y*t.y}function dr(a,t){if(a.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const p=t[n],_=a[0],v=u.sub(o),b=p.sub(o),M=_.sub(o),C=gi(v,v),P=gi(v,b),k=gi(b,b),F=gi(M,v),j=gi(M,b),H=C*k-P*P,Y=(k*F-P*j)/H,te=(C*j-P*F)/H,xe=o.z*(1-Y-te)+u.z*Y+p.z*te;if(isFinite(xe))return xe}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Rl=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:su}=Rl,of=Ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ho}=of,jn=Math.cos(Math.PI/180*37.5),$o=Math.pow(2,14)/.5;class Xo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Qe,this.layoutVertexArray2=new qe,this.indexArray=new Fn,this.programConfigurations=new Ml(t.layers,t.zoom),this.segments=new qt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasDependencies=Xi("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),_=[];for(const{feature:v,id:b,index:M,sourceLayerIndex:C}of t){const P=this.layers[0]._featureFilter.needGeometry,k=Vo(v,P);if(!this.layers[0]._featureFilter.filter(new pi(this.zoom),k,o))continue;const F=p?u.evaluate(k,{},o):void 0,j={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:M,geometry:P?k.geometry:Cl(v),patterns:{},dashes:{},sortKey:F};_.push(j)}p&&_.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of _){const{geometry:b,index:M,sourceLayerIndex:C}=v;this.hasDependencies?(Xi("line",this.layers,n)?Wd("line",this.layers,v,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,v,this.zoom,n),this.patternFeatures.push(v)):this.addFeature(v,b,M,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(t[M].feature,b,M,C,this.index)}}update(t,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(t,n,o,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ho)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,su),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,p,_,v){const b=this.layers[0].layout,M=b.get("line-join").evaluate(t,{}),C=b.get("line-cap"),P=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const F of n)this.addLine(F,t,M,C,P,k,u,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:p,dashPositions:_,canonical:u})}addLine(t,n,o,u,p,_,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ra(t,v?b.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<t.length-1;se++)this.totalDistance+=t[se].dist(t[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Ls.types[n.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let P=0;for(;P<C-1&&t[P].equals(t[P+1]);)P++;if(C<(M?3:2))return;o==="bevel"&&(p=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let j,H,Y,te,xe;this.e1=this.e2=-1,M&&(j=t[C-2],xe=t[P].sub(j)._unit()._perp());for(let se=P;se<C;se++){if(Y=se===C-1?M?t[P+1]:void 0:t[se+1],Y&&t[se].equals(Y))continue;xe&&(te=xe),j&&(H=j),j=t[se],xe=Y?Y.sub(j)._unit()._perp():te,te=te||xe;let ue=te.add(xe);ue.x===0&&ue.y===0||ue._unit();const Ce=te.x*xe.x+te.y*xe.y,Le=ue.x*xe.x+ue.y*xe.y,He=Le!==0?1/Le:1/0,at=2*Math.sqrt(2-2*Le),et=Le<jn&&H&&Y,nt=te.x*xe.y-te.y*xe.x>0;if(et&&se>P){const it=j.dist(H);if(it>2*k){const je=j.sub(j.sub(H)._mult(k/it)._round());this.updateDistance(H,je),this.addCurrentVertex(je,te,0,0,F),H=je}}const gt=H&&Y;let tt=gt?o:M?"butt":u;if(gt&&tt==="round"&&(He<_?tt="miter":He<=2&&(tt="fakeround")),tt==="miter"&&He>p&&(tt="bevel"),tt==="bevel"&&(He>2&&(tt="flipbevel"),He<p&&(tt="miter")),H&&this.updateDistance(H,j),tt==="miter")ue._mult(He),this.addCurrentVertex(j,ue,0,0,F);else if(tt==="flipbevel"){if(He>100)ue=xe.mult(-1);else{const it=He*te.add(xe).mag()/te.sub(xe).mag();ue._perp()._mult(it*(nt?-1:1))}this.addCurrentVertex(j,ue,0,0,F),this.addCurrentVertex(j,ue.mult(-1),0,0,F)}else if(tt==="bevel"||tt==="fakeround"){const it=-Math.sqrt(He*He-1),je=nt?it:0,St=nt?0:it;if(H&&this.addCurrentVertex(j,te,je,St,F),tt==="fakeround"){const zt=Math.round(180*at/Math.PI/20);for(let xt=1;xt<zt;xt++){let ft=xt/zt;if(ft!==.5){const en=ft-.5;ft+=ft*en*(ft-1)*((1.0904+Ce*(Ce*(3.55645-1.43519*Ce)-3.2452))*en*en+(.848013+Ce*(.215638*Ce-1.06021)))}const Yt=xe.sub(te)._mult(ft)._add(te)._unit()._mult(nt?-1:1);this.addHalfVertex(j,Yt.x,Yt.y,!1,nt,0,F)}}Y&&this.addCurrentVertex(j,xe,-je,-St,F)}else if(tt==="butt")this.addCurrentVertex(j,ue,0,0,F);else if(tt==="square"){const it=H?1:-1;this.addCurrentVertex(j,ue,it,it,F)}else tt==="round"&&(H&&(this.addCurrentVertex(j,te,0,0,F),this.addCurrentVertex(j,te,1,1,F,!0)),Y&&(this.addCurrentVertex(j,xe,-1,-1,F,!0),this.addCurrentVertex(j,xe,0,0,F)));if(et&&se<C-1){const it=j.dist(Y);if(it>2*k){const je=j.add(Y.sub(j)._mult(k/it)._round());this.updateDistance(j,je),this.addCurrentVertex(je,xe,0,0,F),j=je}}}}addCurrentVertex(t,n,o,u,p,_=!1){const v=n.y*u-n.x,b=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,p),this.addHalfVertex(t,v,b,_,!0,-u,p),this.distance>$o/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,p,_))}addHalfVertex({x:t,y:n},o,u,p,_,v,b){const M=.5*(this.lineClips?this.scaledDistance*($o-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),b.primitiveLength++),_?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}hasLineDasharray(t){for(const n of t){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,n,o,u){for(const p of t){const _=p.paint.get("line-dasharray");if(!_||_.value.kind==="constant")continue;const v=p.layout.get("line-cap")==="round",b={dasharray:_.value.evaluate({zoom:o-1},n,{}),round:v},M={dasharray:_.value.evaluate({zoom:o},n,{}),round:v},C={dasharray:_.value.evaluate({zoom:o+1},n,{}),round:v},P=`${b.dasharray.join(",")},${b.round}`,k=`${M.dasharray.join(",")},${M.round}`,F=`${C.dasharray.join(",")},${C.round}`;u.dashDependencies[P]=b,u.dashDependencies[k]=M,u.dashDependencies[F]=C,n.dashes[p.id]={min:P,mid:k,max:F}}}}let ud,fr;ot("LineBucket",Xo,{omit:["layers","patternFeatures"]});var Tc={get paint(){return fr=fr||new na({"line-opacity":new mt(be.paint_line["line-opacity"]),"line-color":new mt(be.paint_line["line-color"]),"line-translate":new dt(be.paint_line["line-translate"]),"line-translate-anchor":new dt(be.paint_line["line-translate-anchor"]),"line-width":new mt(be.paint_line["line-width"]),"line-gap-width":new mt(be.paint_line["line-gap-width"]),"line-offset":new mt(be.paint_line["line-offset"]),"line-blur":new mt(be.paint_line["line-blur"]),"line-dasharray":new co(be.paint_line["line-dasharray"]),"line-pattern":new co(be.paint_line["line-pattern"]),"line-gradient":new xl(be.paint_line["line-gradient"])})},get layout(){return ud=ud||new na({"line-cap":new dt(be.layout_line["line-cap"]),"line-join":new mt(be.layout_line["line-join"]),"line-miter-limit":new dt(be.layout_line["line-miter-limit"]),"line-round-limit":new dt(be.layout_line["line-round-limit"]),"line-sort-key":new mt(be.layout_line["line-sort-key"])})}};class fh extends mt{possiblyEvaluate(t,n){return n=new pi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=Ci({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let za;class lf extends gn{constructor(t,n){super(t,Tc,n),this.gradientVersion=0,za||(za=new fh(Tc.paint.properties["line-width"].specification),za.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof nn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=za.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xo(t)}queryRadius(t){const n=t,o=ph(fn("line-width",this,n),fn("line-gap-width",this,n)),u=fn("line-offset",this,n);return o/2+Math.abs(u)+aa(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:_}){const v=Qu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,_),b=_/2*ph(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),M=this.paint.get("line-offset").evaluate(n,o);return M&&(u=(function(C,P){const k=[];for(let F=0;F<C.length;F++){const j=C[F],H=[];for(let Y=0;Y<j.length;Y++){const te=j[Y-1],xe=j[Y],se=j[Y+1],ue=Y===0?new pe(0,0):xe.sub(te)._unit()._perp(),Ce=Y===j.length-1?new pe(0,0):se.sub(xe)._unit()._perp(),Le=ue._add(Ce)._unit(),He=Le.x*Ce.x+Le.y*Ce.y;He!==0&&Le._mult(1/He),H.push(Le._mult(P)._add(xe))}k.push(H)}return k})(u,M*_)),(function(C,P,k){for(let F=0;F<P.length;F++){const j=P[F];if(C.length>=3){for(let H=0;H<j.length;H++)if(iu(C,j[H]))return!0}if($f(C,j,k))return!0}return!1})(v,u,b)}isTileClipped(){return!0}}function ph(a,t){return t>0?t+2*a:a}const up=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hd=Ti([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dd=Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yo=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ua=Ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ll(a,t,n){return a.sections.forEach((o=>{o.text=(function(u,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),Ca.applyArabicShaping&&(u=Ca.applyArabicShaping(u)),u})(o.text,t,n)})),a}Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ti([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const vo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Wi=24;const mh=4294967296,fd=1/mh,cf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Sc{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),p=u>>3,_=this.pos;this.type=7&u,t(p,n,this),this.pos===_&&this.skip(u)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*mh;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*mh;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,(function(p,_,v){const b=v.buf;let M,C;if(C=b[v.pos++],M=(112&C)>>4,C<128||(C=b[v.pos++],M|=(127&C)<<3,C<128)||(C=b[v.pos++],M|=(127&C)<<10,C<128)||(C=b[v.pos++],M|=(127&C)<<17,C<128)||(C=b[v.pos++],M|=(127&C)<<24,C<128)||(C=b[v.pos++],M|=(1&C)<<31,C<128))return kl(p,M,_);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&cf?cf.decode(this.buf.subarray(n,t)):(function(o,u,p){let _="",v=u;for(;v<p;){const b=o[v];let M,C,P,k=null,F=b>239?4:b>223?3:b>191?2:1;if(v+F>p)break;F===1?b<128&&(k=b):F===2?(M=o[v+1],(192&M)==128&&(k=(31&b)<<6|63&M,k<=127&&(k=null))):F===3?(M=o[v+1],C=o[v+2],(192&M)==128&&(192&C)==128&&(k=(15&b)<<12|(63&M)<<6|63&C,(k<=2047||k>=55296&&k<=57343)&&(k=null))):F===4&&(M=o[v+1],C=o[v+2],P=o[v+3],(192&M)==128&&(192&C)==128&&(192&P)==128&&(k=(15&b)<<18|(63&M)<<12|(63&C)<<6|63&P,(k<=65535||k>=1114112)&&(k=null))),k===null?(k=65533,F=1):k>65535&&(k-=65536,_+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),_+=String.fromCharCode(k),v+=F}return _})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*fd),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*fd),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,o){let u,p;if(n>=0?(u=n%4294967296|0,p=n/4294967296|0):(u=~(-n%4294967296),p=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(_,v,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)})(u,0,o),(function(_,v){const b=(7&_)<<4;v.buf[v.pos++]|=b|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))})(p,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(u,p,_){for(let v,b,M=0;M<p.length;M++){if(v=p.charCodeAt(M),v>55295&&v<57344){if(!b){v>56319||M+1===p.length?(u[_++]=239,u[_++]=191,u[_++]=189):b=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(u[_++]=239,u[_++]=191,u[_++]=189,b=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _})(this.buf,t,this.pos);const o=this.pos-n;o>=128&&pr(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,n){this.pos++;const o=this.pos;t(n,this);const u=this.pos-o;u>=128&&pr(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(t,n,o){this.writeTag(t,2),this.writeRawMessage(n,o)}writePackedVarint(t,n){n.length&&this.writeMessage(t,hp,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,mr,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,Np,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,dp,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,fp,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,Bl,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,pd,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,uf,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,ou,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function kl(a,t,n){return n?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function pr(a,t,n){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=a;u--)n.buf[u+o]=n.buf[u]}function hp(a,t){for(let n=0;n<a.length;n++)t.writeVarint(a[n])}function mr(a,t){for(let n=0;n<a.length;n++)t.writeSVarint(a[n])}function dp(a,t){for(let n=0;n<a.length;n++)t.writeFloat(a[n])}function fp(a,t){for(let n=0;n<a.length;n++)t.writeDouble(a[n])}function Np(a,t){for(let n=0;n<a.length;n++)t.writeBoolean(a[n])}function Bl(a,t){for(let n=0;n<a.length;n++)t.writeFixed32(a[n])}function pd(a,t){for(let n=0;n<a.length;n++)t.writeSFixed32(a[n])}function uf(a,t){for(let n=0;n<a.length;n++)t.writeFixed64(a[n])}function ou(a,t){for(let n=0;n<a.length;n++)t.writeSFixed64(a[n])}function pp(a,t,n){a===1&&n.readMessage(mp,t)}function mp(a,t,n){if(a===3){const{id:o,bitmap:u,width:p,height:_,left:v,top:b,advance:M}=n.readMessage(gp,{});t.push({id:o,bitmap:new au({width:p+6,height:_+6},u),metrics:{width:p,height:_,left:v,top:b,advance:M}})}}function gp(a,t,n){a===1?t.id=n.readVarint():a===2?t.bitmap=n.readBytes():a===3?t.width=n.readVarint():a===4?t.height=n.readVarint():a===5?t.left=n.readSVarint():a===6?t.top=n.readSVarint():a===7&&(t.advance=n.readVarint())}function hf(a){let t=0,n=0;for(const _ of a)t+=_.w*_.h,n=Math.max(n,_.w);a.sort(((_,v)=>v.h-_.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,p=0;for(const _ of a)for(let v=o.length-1;v>=0;v--){const b=o[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===b.w&&_.h===b.h){const M=o.pop();M&&v<o.length&&(o[v]=M)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(o.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}class lu{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:_,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class md{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(n,u,p);const{w:_,h:v}=hf(p),b=new Aa({width:_||1,height:v||1});for(const M in t){const C=t[M],P=o[M].paddedRect;Aa.copy(C.data,b,{x:0,y:0},{x:P.x+1,y:P.y+1},C.data)}for(const M in n){const C=n[M],P=u[M].paddedRect,k=P.x+1,F=P.y+1,j=C.data.width,H=C.data.height;Aa.copy(C.data,b,{x:0,y:0},{x:k,y:F},C.data),Aa.copy(C.data,b,{x:0,y:H-1},{x:k,y:F-1},{width:j,height:1}),Aa.copy(C.data,b,{x:0,y:0},{x:k,y:F+H},{width:j,height:1}),Aa.copy(C.data,b,{x:j-1,y:0},{x:k-1,y:F},{width:1,height:H}),Aa.copy(C.data,b,{x:0,y:0},{x:k+j,y:F},{width:1,height:H})}this.image=b,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const p=t[u],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(_),n[u]=new lu(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,p]=t.tl;o.update(n.data,void 0,{x:u,y:p})}}var Ol;ot("ImagePosition",lu),ot("ImageAtlas",md),z.ao=void 0,(Ol=z.ao||(z.ao={}))[Ol.none=0]="none",Ol[Ol.horizontal=1]="horizontal",Ol[Ol.vertical=2]="vertical",Ol[Ol.horizontalOnly=3]="horizontalOnly";class gh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const u=new gh;return u.scale=t||1,u.fontStack=n,u.verticalAlign=o||"bottom",u}static forImage(t,n){const o=new gh;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class cu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new cu;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;n+=u&&Fo(u)&&!vo[t[o+1]]||p&&Fo(p)&&!vo[t[o-1]]||!vo[t[o]]?t[o]:vo[t[o]]}return n})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&yh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&yh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new cu;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,o=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if(p.imageName){const _=t[p.imageName];if(!_)continue;const v=_.displaySize;n=Math.max(n,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(gh.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Ri("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(gh.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _h(a,t,n,o,u,p,_,v,b,M,C,P,k,F,j){const H=cu.fromFeature(a,u);let Y;P===z.ao.vertical&&H.verticalizePunctuation();const{processBidirectionalText:te,processStyledBidirectionalText:xe}=Ca;if(te&&H.sections.length===1){Y=[];const Ce=te(H.toString(),_d(H,M,p,t,o,F));for(const Le of Ce){const He=new cu;He.text=Le,He.sections=H.sections;for(let at=0;at<Le.length;at++)He.sectionIndex.push(0);Y.push(He)}}else if(xe){Y=[];const Ce=xe(H.text,H.sectionIndex,_d(H,M,p,t,o,F));for(const Le of Ce){const He=new cu;He.text=Le[0],He.sectionIndex=Le[1],He.sections=H.sections,Y.push(He)}}else Y=(function(Ce,Le){const He=[],at=Ce.text;let et=0;for(const nt of Le)He.push(Ce.substring(et,nt)),et=nt;return et<at.length&&He.push(Ce.substring(et,at.length)),He})(H,_d(H,M,p,t,o,F));const se=[],ue={positionedLines:se,text:H.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1};return(function(Ce,Le,He,at,et,nt,gt,tt,it,je,St,zt){let xt=0,ft=0,Yt=0,en=0;const yn=tt==="right"?1:tt==="left"?0:.5,oa=Wi/zt;let _r=0;for(const yi of et){yi.trim();const tn=yi.getMaxScale(),Sn={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[_r]=Sn;const Mn=Sn.positionedGlyphs;let Cn=0;if(!yi.length()){ft+=nt,++_r;continue}const Pr=yp(at,yi,oa);for(let ha=0;ha<yi.length();ha++){const Kn=yi.getSection(ha),Wn=yi.getSectionIndex(ha),En=yi.getCharCode(ha),An=Vi(it,St,En);let Qi;if(Kn.imageName){if(Ce.iconsInText=!0,Kn.scale=Kn.scale*oa,Qi=Vp(Kn,An,tn,Pr,at),!Qi)continue;Cn=Math.max(Cn,Qi.imageOffset)}else if(Qi=_f(Kn,En,An,Pr,Le,He),!Qi)continue;const{rect:yr,metrics:Qo,baselineOffset:ls}=Qi;Mn.push({glyph:En,imageName:Kn.imageName,x:xt,y:ft+ls+-17,vertical:An,scale:Kn.scale,fontStack:Kn.fontStack,sectionIndex:Wn,metrics:Qo,rect:yr}),An?(Ce.verticalizable=!0,xt+=(Kn.imageName?Qo.advance:Wi)*Kn.scale+je):xt+=Qo.advance*Kn.scale+je}Mn.length!==0&&(Yt=Math.max(xt-je,Yt),vp(Mn,0,Mn.length-1,yn)),xt=0,Sn.lineOffset=Math.max(Cn,(tn-1)*Wi);const Yn=nt*tn+Cn;ft+=Yn,en=Math.max(Yn,en),++_r}const{horizontalAlign:Pa,verticalAlign:an}=hu(gt);(function(yi,tn,Sn,Mn,Cn,Pr,Yn,ha,Kn){const Wn=(tn-Sn)*Cn;let En=0;En=Pr!==Yn?-ha*Mn- -17:-Mn*Kn*Yn+.5*Yn;for(const An of yi)for(const Qi of An.positionedGlyphs)Qi.x+=Wn,Qi.y+=En})(Ce.positionedLines,yn,Pa,an,Yt,en,nt,ft,et.length),Ce.top+=-an*ft,Ce.bottom=Ce.top+ft,Ce.left+=-Pa*Yt,Ce.right=Ce.left+Yt})(ue,t,n,o,Y,_,v,b,P,M,k,j),!(function(Ce){for(const Le of Ce)if(Le.positionedGlyphs.length!==0)return!1;return!0})(se)&&ue}const yh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},gd={40:!0};function df(a,t,n,o,u,p){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*Wi/p+u:0}{const _=n[t.fontStack],v=_&&_[a];return v?v.metrics.advance*t.scale+u:0}}function ff(a,t,n,o){const u=Math.pow(a-t,2);return o?a<t?u/2:2*u:u+Math.abs(n)*n}function _p(a,t,n){let o=0;return a===10&&(o-=1e4),n&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function pf(a,t,n,o,u,p){let _=null,v=ff(t,n,u,p);for(const b of o){const M=ff(t-b.x,n,u,p)+b.badness;M<=v&&(_=b,v=M)}return{index:a,x:t,priorBreak:_,badness:v}}function mf(a){return a?mf(a.priorBreak).concat(a.index):[]}function _d(a,t,n,o,u,p){if(!a)return[];const _=[],v=(function(P,k,F,j,H,Y){let te=0;for(let xe=0;xe<P.length();xe++){const se=P.getSection(xe);te+=df(P.getCharCode(xe),se,j,H,k,Y)}return te/Math.max(1,Math.ceil(te/F))})(a,t,n,o,u,p),b=a.text.indexOf("")>=0;let M=0;for(let P=0;P<a.length();P++){const k=a.getSection(P),F=a.getCharCode(P);if(yh[F]||(M+=df(F,k,o,u,t,p)),P<a.length()-1){const j=!((C=F)<11904)&&(!!Xt["CJK Compatibility Forms"](C)||!!Xt["CJK Compatibility"](C)||!!Xt["CJK Strokes"](C)||!!Xt["CJK Symbols and Punctuation"](C)||!!Xt["Enclosed CJK Letters and Months"](C)||!!Xt["Halfwidth and Fullwidth Forms"](C)||!!Xt["Ideographic Description Characters"](C)||!!Xt["Vertical Forms"](C)||yl.test(String.fromCodePoint(C)));(uu[F]||j||k.imageName||P!==a.length()-2&&gd[a.getCharCode(P+1)])&&_.push(pf(P+1,M,v,_,_p(F,a.getCharCode(P+1),j&&b),!1))}}var C;return mf(pf(a.length(),M,v,_,0,!0))}function hu(a){let t=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function yp(a,t,n){const o=t.getMaxScale()*Wi,{maxImageWidth:u,maxImageHeight:p}=t.getMaxImageSize(a),_=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:_}}function gf(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function Vi(a,t,n){return!(a===z.ao.horizontal||!t&&!vl(n)||t&&(yh[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function _f(a,t,n,o,u,p){const _=p[a.fontStack],v=(function(M,C,P,k){if(M&&M.rect)return M;const F=C[P.fontStack],j=F&&F[k];return j?{rect:null,metrics:j.metrics}:null})(_&&_[t],u,a,t);if(v===null)return null;let b;if(n)b=o.verticalLineContentWidth-a.scale*Wi;else{const M=gf(a.verticalAlign);b=(o.horizontalLineContentHeight-a.scale*Wi)*M}return{rect:v.rect,metrics:v.metrics,baselineOffset:b}}function Vp(a,t,n,o,u){const p=u[a.imageName];if(!p)return null;const _=p.paddedRect,v=p.displaySize,b={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]};let M;if(t)M=o.verticalLineContentWidth-v[1]*a.scale;else{const C=gf(a.verticalAlign);M=(o.horizontalLineContentHeight-v[1]*a.scale)*C}return{rect:_,metrics:b,baselineOffset:M,imageOffset:(t?v[0]:v[1])*a.scale-Wi*n}}function vp(a,t,n,o){if(o===0)return;const u=a[n],p=(a[n].x+u.metrics.advance*u.scale)*o;for(let _=t;_<=n;_++)a[_].x-=p}function Zp(a,t,n){const{horizontalAlign:o,verticalAlign:u}=hu(n),p=t[0]-a.displaySize[0]*o,_=t[1]-a.displaySize[1]*u;return{image:a,top:_,bottom:_+a.displaySize[1],left:p,right:p+a.displaySize[0]}}function xp(a){var t,n;let o=a.left,u=a.top,p=a.right-o,_=a.bottom-u;const v=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(n=a.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",M=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&p/_<M||v==="proportional"){const C=Math.ceil(_*M);o*=C/p,p=C}}else if(v==="proportional"&&b==="stretchOnly"&&M!==0&&p/_>M){const C=Math.ceil(p/M);u*=C/_,_=C}return{x1:o,y1:u,x2:o+p,y2:u+_}}function bp(a,t,n,o,u,p){const _=a.image;let v;if(_.content){const Y=_.content,te=_.pixelRatio||1;v=[Y[0]/te,Y[1]/te,_.displaySize[0]-Y[2]/te,_.displaySize[1]-Y[3]/te]}const b=t.left*p,M=t.right*p;let C,P,k,F;n==="width"||n==="both"?(F=u[0]+b-o[3],P=u[0]+M+o[1]):(F=u[0]+(b+M-_.displaySize[0])/2,P=F+_.displaySize[0]);const j=t.top*p,H=t.bottom*p;return n==="height"||n==="both"?(C=u[1]+j-o[0],k=u[1]+H+o[2]):(C=u[1]+(j+H-_.displaySize[1])/2,k=C+_.displaySize[1]),{image:_,top:C,right:P,bottom:k,left:F,collisionPadding:v}}const rs=128,Ar=32640;function yd(a,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new pi(a+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=a;)p++;p=Math.max(0,p-1);let _=p;for(;_<o.length&&o[_]<a+1;)_++;_=Math.min(o.length-1,_);const v=o[p],b=o[_];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:b,minSize:n.evaluate(new pi(v)),maxSize:n.evaluate(new pi(b)),interpolationType:u}}}function du(a,t,n){let o="never";const u=a.get(t);return u?o=u:a.get(n)&&(o="always"),o}const yf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ks(a,t,n,o,u,p,_,v,b,M,C,P,k){const F=v?Math.min(Ar,Math.round(v[0])):0,j=v?Math.min(Ar,Math.round(v[1])):0;a.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),p,_,(F<<1)+(b?1:0),j,16*M,16*C,256*P,256*k)}function ss(a,t,n){a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n)}function vh(a){for(const t of a.sections)if(mc(t.text))return!0;return!1}class vf{constructor(t){this.layoutVertexArray=new fi,this.indexArray=new Fn,this.programConfigurations=t,this.segments=new qt,this.dynamicLayoutVertexArray=new Ui,this.opacityVertexArray=new Di,this.hasVisibleVertices=!1,this.placedSymbolArray=new Q}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,up.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,hd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,yf,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ot("SymbolBuffers",vf);class vd{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new qt,this.collisionVertexArray=new ji}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,dd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ot("CollisionBuffers",vd);class Mc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yd(this.zoom,n["text-size"]),this.iconSizeData=yd(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=du(o,"text-overlap","text-allow-overlap")!=="never"||du(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((_=>z.ao[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new vf(new Ml(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new vf(new Ml(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new ie,this.lineVertexArray=new ce,this.symbolInstances=new ne,this.textAnchorOffsets=new ae}calculateGlyphDependencies(t,n,o,u,p){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||u)&&p){const v=vo[t.charAt(_)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],p=u.layout,_=p.get("text-font"),v=p.get("text-field"),b=p.get("icon-image"),M=(v.value.kind!=="constant"||v.value.value instanceof la&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),C=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,P=p.get("symbol-sort-key");if(this.features=[],!M&&!C)return;const k=n.iconDependencies,F=n.glyphDependencies,j=n.availableImages,H=new pi(this.zoom);for(const{feature:Y,id:te,index:xe,sourceLayerIndex:se}of t){const ue=u._featureFilter.needGeometry,Ce=Vo(Y,ue);if(!u._featureFilter.filter(H,Ce,o))continue;let Le,He;if(ue||(Ce.geometry=Cl(Y)),M){const et=u.getValueAndResolveTokens("text-field",Ce,o,j),nt=la.factory(et),gt=this.hasRTLText=this.hasRTLText||vh(nt);(!gt||Ca.getRTLTextPluginStatus()==="unavailable"||gt&&Ca.isParsed())&&(Le=Ll(nt,u,Ce))}if(C){const et=u.getValueAndResolveTokens("icon-image",Ce,o,j);He=et instanceof bn?et:bn.fromString(et)}if(!Le&&!He)continue;const at=this.sortFeaturesByKey?P.evaluate(Ce,{},o):void 0;if(this.features.push({id:te,text:Le,icon:He,index:xe,sourceLayerIndex:se,geometry:Ce.geometry,properties:Y.properties,type:Ls.types[Y.type],sortKey:at}),He&&(k[He.name]=!0),Le){const et=_.evaluate(Ce,{},o).join(","),nt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(z.ao.vertical)>=0;for(const gt of Le.sections)if(gt.image)k[gt.image.name]=!0;else{const tt=As(Le.toString()),it=gt.fontStack||et,je=F[it]=F[it]||{};this.calculateGlyphDependencies(gt.text,je,nt,this.allowVerticalPlacement,tt)}}}p.get("symbol-placement")==="line"&&(this.features=(function(Y){const te={},xe={},se=[];let ue=0;function Ce(et){se.push(Y[et]),ue++}function Le(et,nt,gt){const tt=xe[et];return delete xe[et],xe[nt]=tt,se[tt].geometry[0].pop(),se[tt].geometry[0]=se[tt].geometry[0].concat(gt[0]),tt}function He(et,nt,gt){const tt=te[nt];return delete te[nt],te[et]=tt,se[tt].geometry[0].shift(),se[tt].geometry[0]=gt[0].concat(se[tt].geometry[0]),tt}function at(et,nt,gt){const tt=gt?nt[0][nt[0].length-1]:nt[0][0];return`${et}:${tt.x}:${tt.y}`}for(let et=0;et<Y.length;et++){const nt=Y[et],gt=nt.geometry,tt=nt.text?nt.text.toString():null;if(!tt){Ce(et);continue}const it=at(tt,gt),je=at(tt,gt,!0);if(it in xe&&je in te&&xe[it]!==te[je]){const St=He(it,je,gt),zt=Le(it,je,se[St].geometry);delete te[it],delete xe[je],xe[at(tt,se[zt].geometry,!0)]=zt,se[St].geometry=null}else it in xe?Le(it,je,gt):je in te?He(it,je,gt):(Ce(et),te[it]=ue-1,xe[je]=ue-1)}return se.filter((et=>et.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Y,te)=>Y.sortKey-te.sortKey))}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),p=t.dist(n[t.segment]);const _={};for(let v=t.segment+1;v<n.length;v++)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:u},v<n.length-1&&(u+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,p,_,v,b,M,C,P,k){const F=t.indexArray,j=t.layoutVertexArray,H=t.segments.prepareSegment(4*n.length,j,F,this.canOverlap?_.sortKey:void 0),Y=this.glyphOffsetArray.length,te=H.vertexLength,xe=this.allowVerticalPlacement&&v===z.ao.vertical?Math.PI/2:0,se=_.text&&_.text.sections;for(let ue=0;ue<n.length;ue++){const{tl:Ce,tr:Le,bl:He,br:at,tex:et,pixelOffsetTL:nt,pixelOffsetBR:gt,minFontScaleX:tt,minFontScaleY:it,glyphOffset:je,isSDF:St,sectionIndex:zt}=n[ue],xt=H.vertexLength,ft=je[1];ks(j,b.x,b.y,Ce.x,ft+Ce.y,et.x,et.y,o,St,nt.x,nt.y,tt,it),ks(j,b.x,b.y,Le.x,ft+Le.y,et.x+et.w,et.y,o,St,gt.x,nt.y,tt,it),ks(j,b.x,b.y,He.x,ft+He.y,et.x,et.y+et.h,o,St,nt.x,gt.y,tt,it),ks(j,b.x,b.y,at.x,ft+at.y,et.x+et.w,et.y+et.h,o,St,gt.x,gt.y,tt,it),ss(t.dynamicLayoutVertexArray,b,xe),F.emplaceBack(xt,xt+2,xt+1),F.emplaceBack(xt+1,xt+2,xt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(je[0]),ue!==n.length-1&&zt===n[ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,_,_.index,{imagePositions:{},canonical:k,formattedSection:se&&se[zt]})}t.placedSymbolArray.emplaceBack(b.x,b.y,Y,this.glyphOffsetArray.length-Y,te,M,C,b.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],v,0,!1,0,P)}_addCollisionDebugVertex(t,n,o,u,p,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,p,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,u,p,_,v){const b=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),M=b.vertexLength,C=p.layoutVertexArray,P=p.collisionVertexArray,k=v.anchorX,F=v.anchorY;this._addCollisionDebugVertex(C,P,_,k,F,new pe(t,n)),this._addCollisionDebugVertex(C,P,_,k,F,new pe(o,n)),this._addCollisionDebugVertex(C,P,_,k,F,new pe(o,u)),this._addCollisionDebugVertex(C,P,_,k,F,new pe(t,u)),b.vertexLength+=4;const j=p.indexArray;j.emplaceBack(M,M+1),j.emplaceBack(M+1,M+2),j.emplaceBack(M+2,M+3),j.emplaceBack(M+3,M),b.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let p=t;p<n;p++){const _=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,u?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vd(Hi,Yo.members,$i),this.iconCollisionBox=new vd(Hi,Yo.members,$i);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,p,_,v,b,M){const C={};for(let P=n;P<o;P++){const k=t.get(P);C.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.textFeatureIndex=k.featureIndex;break}for(let P=u;P<p;P++){const k=t.get(P);C.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.verticalTextFeatureIndex=k.featureIndex;break}for(let P=_;P<v;P++){const k=t.get(P);C.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.iconFeatureIndex=k.featureIndex;break}for(let P=b;P<M;P++){const k=t.get(P);C.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},C.verticalIconFeatureIndex=k.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+2,p+1),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);u.push(0|Math.round(n*b.anchorX+o*b.anchorY)),p.push(b.featureIndex)}return _.sort(((v,b)=>u[v]-u[b]||p[b]-p[v])),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,p,_)=>{u>=0&&_.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let xf,bf;ot("SymbolBucket",Mc,{omit:["layers","collisionBoxArray","features","compareText"]}),Mc.MAX_GLYPHS=65535,Mc.addDynamicAttributes=ss;var wf={get paint(){return bf=bf||new na({"icon-opacity":new mt(be.paint_symbol["icon-opacity"]),"icon-color":new mt(be.paint_symbol["icon-color"]),"icon-halo-color":new mt(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new mt(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mt(be.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new mt(be.paint_symbol["text-opacity"]),"text-color":new mt(be.paint_symbol["text-color"],{runtimeType:Zn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new mt(be.paint_symbol["text-halo-color"]),"text-halo-width":new mt(be.paint_symbol["text-halo-width"]),"text-halo-blur":new mt(be.paint_symbol["text-halo-blur"]),"text-translate":new dt(be.paint_symbol["text-translate"]),"text-translate-anchor":new dt(be.paint_symbol["text-translate-anchor"])})},get layout(){return xf=xf||new na({"symbol-placement":new dt(be.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mt(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new mt(be.layout_symbol["icon-size"]),"icon-text-fit":new dt(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new mt(be.layout_symbol["icon-image"]),"icon-rotate":new mt(be.layout_symbol["icon-rotate"]),"icon-padding":new mt(be.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(be.layout_symbol["icon-keep-upright"]),"icon-offset":new mt(be.layout_symbol["icon-offset"]),"icon-anchor":new mt(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(be.layout_symbol["text-rotation-alignment"]),"text-field":new mt(be.layout_symbol["text-field"]),"text-font":new mt(be.layout_symbol["text-font"]),"text-size":new mt(be.layout_symbol["text-size"]),"text-max-width":new mt(be.layout_symbol["text-max-width"]),"text-line-height":new dt(be.layout_symbol["text-line-height"]),"text-letter-spacing":new mt(be.layout_symbol["text-letter-spacing"]),"text-justify":new mt(be.layout_symbol["text-justify"]),"text-radial-offset":new mt(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new mt(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new mt(be.layout_symbol["text-anchor"]),"text-max-angle":new dt(be.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(be.layout_symbol["text-writing-mode"]),"text-rotate":new mt(be.layout_symbol["text-rotate"]),"text-padding":new dt(be.layout_symbol["text-padding"]),"text-keep-upright":new dt(be.layout_symbol["text-keep-upright"]),"text-transform":new mt(be.layout_symbol["text-transform"]),"text-offset":new mt(be.layout_symbol["text-offset"]),"text-allow-overlap":new dt(be.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(be.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(be.layout_symbol["text-ignore-placement"]),"text-optional":new dt(be.layout_symbol["text-optional"])})}};class xd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ot("FormatSectionOverride",xd,{omit:["defaultValue"]});class xh extends gn{constructor(t,n){super(t,wf,n)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const p=this.layout.get(t).evaluate(n,{},o,u),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||sc(_.value)||!p?p:(function(v,b){return b.replace(/{([^{}]+)}/g,((M,C)=>v&&C in v?String(v[C]):""))})(n.properties,p)}createBucket(t){return new Mc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of wf.paint.overridableProperties){if(!xh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new xd(n),u=new rc(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new gl("source",u):new Fa("composite",u,n.value.zoomStops),this.paint._values[t]=new Na(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&xh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=wf.paint.properties[n];let p=!1;const _=v=>{for(const b of v)if(u.overrides&&u.overrides.hasOverride(b))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof la)_(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const v=M=>{p||(M instanceof Br&&wt(M.value)===Ir?_(M.value.sections):M instanceof Ao?_(M.sections):M.eachChild(v))},b=o.value;b._styleExpression&&v(b._styleExpression.expression)}return p}}let Tf;var Gp={get paint(){return Tf=Tf||new na({"background-color":new dt(be.paint_background["background-color"]),"background-pattern":new Xu(be.paint_background["background-pattern"]),"background-opacity":new dt(be.paint_background["background-opacity"])})}};class Sf extends gn{constructor(t,n){super(t,Gp,n)}}let bd;var qp={get paint(){return bd=bd||new na({"raster-opacity":new dt(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(be.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(be.paint_raster["raster-saturation"]),"raster-contrast":new dt(be.paint_raster["raster-contrast"]),"raster-resampling":new dt(be.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(be.paint_raster["raster-fade-duration"])})}};class Hp extends gn{constructor(t,n){super(t,qp,n)}}class bh extends gn{constructor(t,n){super(t,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class $p{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const wp={once:!0},ii=63710088e-1;class xo{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xo(Qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return ii*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof xo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new xo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new xo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wh=2*Math.PI*ii;function wd(a){return wh*Math.cos(a*Math.PI/180)}function Mf(a){return(180+a)/360}function Td(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function fu(a,t){return a/wd(t)}function pu(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Tp(a,t){return a*wd(pu(t))}class mu{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=xo.convert(t);return new mu(Mf(o.lng),Td(o.lat),fu(n,o.lat))}toLngLat(){return new xo(360*this.x-180,pu(this.y))}toAltitude(){return Tp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wh*(t=pu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Sp(a,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Cf{constructor(t,n,o){if(!(function(u,p,_){return!(u<0||u>25||_<0||_>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))})(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=_i(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(_=this.y,v=this.z,b=Sp(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),M=Sp(256*(p+1),256*(_+1),v),b[0]+","+b[1]+","+M[0]+","+M[1]);var p,_,v,b,M;const C=(function(P,k,F){let j,H="";for(let Y=P;Y>0;Y--)j=1<<Y-1,H+=(k&j?1:0)+(F&j?2:0);return H})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new pe((t.x*n-this.x)*_t,(t.y*n-this.y)*_t)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ef{constructor(t,n){this.wrap=t,this.canonical=n,this.key=_i(t,n.z,n.z,n.x,n.y)}}class gr{constructor(t,n,o,u,p){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Cf(o,+u,+p),this.key=_i(n,t,o,u,p)}clone(){return new gr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new gr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?_i(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):_i(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-t.canonical.z;return!(n<0)&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new gr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new gr(n,this.wrap,n,o,u),new gr(n,this.wrap,n,o+1,u),new gr(n,this.wrap,n,o,u+1),new gr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new gr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new gr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ef(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new mu(t.x-this.wrap,t.y))}}function _i(a,t,n,o,u){(a*=2)<0&&(a=-1*a-1);const p=1<<n;return(p*p*a+p*u+o).toString(36)+n.toString(36)+t.toString(36)}function Cc(a,t){return t?a.properties[t]:a.id}ot("CanonicalTileID",Cf),ot("OverscaledTileID",gr,{omit:["terrainRttPosMatrix32f"]});class Tn{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new Tn;return n.extend(t(new pe(this.minX,this.minY))),n.extend(t(new pe(this.maxX,this.minY))),n.extend(t(new pe(this.minX,this.maxY))),n.extend(t(new pe(this.maxX,this.maxY))),n}static fromPoints(t){const n=new Tn;for(const o of t)n.extend(o);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Mp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Af{constructor(t,n,o,u,p){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Cp{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new tr(_t,16,0),this.grid3D=new tr(_t,16,0),this.featureIndexArray=new ze,this.promoteId=n}insert(t,n,o,u,p,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const b=_?this.grid3D:this.grid;for(let M=0;M<n.length;M++){const C=n[M],P=[1/0,1/0,-1/0,-1/0];for(let k=0;k<C.length;k++){const F=C[k];P[0]=Math.min(P[0],F.x),P[1]=Math.min(P[1],F.y),P[2]=Math.max(P[2],F.x),P[3]=Math.max(P[3],F.y)}P[0]<_t&&P[1]<_t&&P[2]>=0&&P[3]>=0&&b.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new sf(new Sc(this.rawTileData)).layers,this.sourceLayerCoder=new Mp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const p=t.params,_=_t/t.tileSize/t.scale,v=ya(p.filter,p.globalState),b=t.queryGeometry,M=t.queryPadding*_,C=Tn.fromPoints(b),P=this.grid.query(C.minX-M,C.minY-M,C.maxX+M,C.maxY+M),k=Tn.fromPoints(t.cameraQueryGeometry).expandBy(M),F=this.grid3D.query(k.minX,k.minY,k.maxX,k.maxY,((Y,te,xe,se)=>(function(ue,Ce,Le,He,at){for(const nt of ue)if(Ce<=nt.x&&Le<=nt.y&&He>=nt.x&&at>=nt.y)return!0;const et=[new pe(Ce,Le),new pe(Ce,at),new pe(He,at),new pe(He,Le)];if(ue.length>2){for(const nt of et)if(iu(ue,nt))return!0}for(let nt=0;nt<ue.length-1;nt++)if(qd(ue[nt],ue[nt+1],et))return!0;return!1})(t.cameraQueryGeometry,Y-M,te-M,xe+M,se+M)));for(const Y of F)P.push(Y);P.sort(zf);const j={};let H;for(let Y=0;Y<P.length;Y++){const te=P[Y];if(te===H)continue;H=te;const xe=this.featureIndexArray.get(te);let se=null;this.loadMatchingFeature(j,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,v,p.layers,p.availableImages,n,o,u,((ue,Ce,Le)=>(se||(se=Cl(ue)),Ce.queryIntersectsFeature({queryGeometry:b,feature:ue,featureState:Le,geometry:se,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return j}loadMatchingFeature(t,n,o,u,p,_,v,b,M,C,P){const k=this.bucketLayerIDs[n];if(_&&!k.some((Y=>_.has(Y))))return;const F=this.sourceLayerCoder.decode(o),j=this.vtLayers[F].feature(u);if(p.needGeometry){const Y=Vo(j,!0);if(!p.filter(new pi(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!p.filter(new pi(this.tileID.overscaledZ),j))return;const H=this.getId(j,F);for(let Y=0;Y<k.length;Y++){const te=k[Y];if(_&&!_.has(te))continue;const xe=b[te];if(!xe)continue;let se={};H&&C&&(se=C.getState(xe.sourceLayer||"_geojsonTileLayer",H));const ue=Ci({},M[te]);ue.paint=Sd(ue.paint,xe.paint,j,se,v),ue.layout=Sd(ue.layout,xe.layout,j,se,v);const Ce=!P||P(j,xe,se);if(!Ce)continue;const Le=new Af(j,this.z,this.x,this.y,H);Le.layer=ue;let He=t[te];He===void 0&&(He=t[te]=[]),He.push({featureIndex:u,feature:Le,intersectionZ:Ce})}}lookupSymbolFeatures(t,n,o,u,p,_,v,b){const M={};this.loadVTLayers();const C=ya(p.filterSpec,p.globalState);for(const P of t)this.loadMatchingFeature(M,o,u,P,C,_,v,b,n);return M}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function Sd(a,t,n,o,u){return ir(a,((p,_)=>{const v=t instanceof yc?t.get(_):null;return v&&v.evaluate?v.evaluate(n,o,u):v}))}function zf(a,t){return t-a}function Th(a,t,n,o,u){const p=[];for(let _=0;_<a.length;_++){const v=a[_];let b;for(let M=0;M<v.length-1;M++){let C=v[M],P=v[M+1];C.x<t&&P.x<t||(C.x<t?C=new pe(t,C.y+(t-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<t&&(P=new pe(t,C.y+(t-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<n&&P.y<n||(C.y<n?C=new pe(C.x+(n-C.y)/(P.y-C.y)*(P.x-C.x),n)._round():P.y<n&&(P=new pe(C.x+(n-C.y)/(P.y-C.y)*(P.x-C.x),n)._round()),C.x>=o&&P.x>=o||(C.x>=o?C=new pe(o,C.y+(o-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=o&&(P=new pe(o,C.y+(o-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=u&&P.y>=u||(C.y>=u?C=new pe(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round():P.y>=u&&(P=new pe(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round()),b&&C.equals(b[b.length-1])||(b=[C],p.push(b)),b.push(P)))))}}return p}ot("FeatureIndex",Cp,{omit:["rawTileData","sourceLayerCoder"]});class Ko extends pe{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Ko(this.x,this.y,this.angle,this.segment)}}function Pf(a,t,n,o,u){if(t.segment===void 0||n===0)return!0;let p=t,_=t.segment+1,v=0;for(;v>-n/2;){if(_--,_<0)return!1;v-=a[_].dist(p),p=a[_]}v+=a[_].dist(a[_+1]),_++;const b=[];let M=0;for(;v<n/2;){const C=a[_],P=a[_+1];if(!P)return!1;let k=a[_-1].angleTo(C)-C.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:k}),M+=k;v-b[0].distance>o;)M-=b.shift().angleDelta;if(M>u)return!1;_++,v+=C.dist(P)}return!0}function Md(a){let t=0;for(let n=0;n<a.length-1;n++)t+=a[n].dist(a[n+1]);return t}function Cd(a,t,n){return a?.6*t*n:0}function Ep(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function Ap(a,t,n,o,u,p){const _=Cd(n,u,p),v=Ep(n,o)*p;let b=0;const M=Md(a)/2;for(let C=0;C<a.length-1;C++){const P=a[C],k=a[C+1],F=P.dist(k);if(b+F>M){const j=(M-b)/F,H=Ur.number(P.x,k.x,j),Y=Ur.number(P.y,k.y,j),te=new Ko(H,Y,k.angleTo(P),C);return te._round(),!_||Pf(a,te,v,_,t)?te:void 0}b+=F}}function Xp(a,t,n,o,u,p,_,v,b){const M=Cd(o,p,_),C=Ep(o,u),P=C*_,k=a[0].x===0||a[0].x===b||a[0].y===0||a[0].y===b;return t-P<t/4&&(t=P+t/4),Df(a,k?t/2*v%t:(C/2+2*p)*_*v%t,t,M,n,P,k,!1,b)}function Df(a,t,n,o,u,p,_,v,b){const M=p/2,C=Md(a);let P=0,k=t-n,F=[];for(let j=0;j<a.length-1;j++){const H=a[j],Y=a[j+1],te=H.dist(Y),xe=Y.angleTo(H);for(;k+n<P+te;){k+=n;const se=(k-P)/te,ue=Ur.number(H.x,Y.x,se),Ce=Ur.number(H.y,Y.y,se);if(ue>=0&&ue<b&&Ce>=0&&Ce<b&&k-M>=0&&k+M<=C){const Le=new Ko(ue,Ce,xe,j);Le._round(),o&&!Pf(a,Le,p,o,u)||F.push(Le)}}P+=te}return v||F.length||_||(F=Df(a,P/2,n,o,u,p,_,!0,b)),F}function zp(a,t,n,o){const u=[],p=a.image,_=p.pixelRatio,v=p.paddedRect.w-2,b=p.paddedRect.h-2;let M={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const C=p.stretchX||[[0,v]],P=p.stretchY||[[0,b]],k=(je,St)=>je+St[1]-St[0],F=C.reduce(k,0),j=P.reduce(k,0),H=v-F,Y=b-j;let te=0,xe=F,se=0,ue=j,Ce=0,Le=H,He=0,at=Y;if(p.content&&o){const je=p.content,St=je[2]-je[0],zt=je[3]-je[1];(p.textFitWidth||p.textFitHeight)&&(M=xp(a)),te=Ed(C,0,je[0]),se=Ed(P,0,je[1]),xe=Ed(C,je[0],je[2]),ue=Ed(P,je[1],je[3]),Ce=je[0]-te,He=je[1]-se,Le=St-xe,at=zt-ue}const et=M.x1,nt=M.y1,gt=M.x2-et,tt=M.y2-nt,it=(je,St,zt,xt)=>{const ft=Sh(je.stretch-te,xe,gt,et),Yt=Mh(je.fixed-Ce,Le,je.stretch,F),en=Sh(St.stretch-se,ue,tt,nt),yn=Mh(St.fixed-He,at,St.stretch,j),oa=Sh(zt.stretch-te,xe,gt,et),_r=Mh(zt.fixed-Ce,Le,zt.stretch,F),Pa=Sh(xt.stretch-se,ue,tt,nt),an=Mh(xt.fixed-He,at,xt.stretch,j),yi=new pe(ft,en),tn=new pe(oa,en),Sn=new pe(oa,Pa),Mn=new pe(ft,Pa),Cn=new pe(Yt/_,yn/_),Pr=new pe(_r/_,an/_),Yn=t*Math.PI/180;if(Yn){const Wn=Math.sin(Yn),En=Math.cos(Yn),An=[En,-Wn,Wn,En];yi._matMult(An),tn._matMult(An),Mn._matMult(An),Sn._matMult(An)}const ha=je.stretch+je.fixed,Kn=St.stretch+St.fixed;return{tl:yi,tr:tn,bl:Mn,br:Sn,tex:{x:p.paddedRect.x+1+ha,y:p.paddedRect.y+1+Kn,w:zt.stretch+zt.fixed-ha,h:xt.stretch+xt.fixed-Kn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cn,pixelOffsetBR:Pr,minFontScaleX:Le/_/gt,minFontScaleY:at/_/tt,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const je=Wo(C,H,F),St=Wo(P,Y,j);for(let zt=0;zt<je.length-1;zt++){const xt=je[zt],ft=je[zt+1];for(let Yt=0;Yt<St.length-1;Yt++)u.push(it(xt,St[Yt],ft,St[Yt+1]))}}else u.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return u}function Ed(a,t,n){let o=0;for(const u of a)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function Wo(a,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of a){const _=o[o.length-1];o.push({fixed:u-_.stretch,stretch:_.stretch}),o.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return o.push({fixed:t+1,stretch:n}),o}function Sh(a,t,n,o){return a/t*n+o}function Mh(a,t,n,o){return a-t*n/o}ot("Anchor",Ko);class gu{constructor(t,n,o,u,p,_,v,b,M,C){var P;if(this.boxStartIndex=t.length,M){let k=_.top,F=_.bottom;const j=_.collisionPadding;j&&(k-=j[1],F+=j[3]);let H=F-k;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const k=!((P=_.image)===null||P===void 0)&&P.content&&(_.image.textFitWidth||_.image.textFitHeight)?xp(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};k.y1=k.y1*v-b[0],k.y2=k.y2*v+b[2],k.x1=k.x1*v-b[3],k.x2=k.x2*v+b[1];const F=_.collisionPadding;if(F&&(k.x1-=F[0]*v,k.y1-=F[1]*v,k.x2+=F[2]*v,k.y2+=F[3]*v),C){const j=new pe(k.x1,k.y1),H=new pe(k.x2,k.y1),Y=new pe(k.x1,k.y2),te=new pe(k.x2,k.y2),xe=C*Math.PI/180;j._rotate(xe),H._rotate(xe),Y._rotate(xe),te._rotate(xe),k.x1=Math.min(j.x,H.x,Y.x,te.x),k.x2=Math.max(j.x,H.x,Y.x,te.x),k.y1=Math.min(j.y,H.y,Y.y,te.y),k.y2=Math.max(j.y,H.y,Y.y,te.y)}t.emplaceBack(n.x,n.y,k.x1,k.y1,k.x2,k.y2,o,u,p)}this.boxEndIndex=t.length}}class Yp{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const p=t-1>>1,_=n[p];if(o(u,_)>=0)break;n[t]=_,t=p}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,p=n[t];for(;t<u;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(n[v],n[_])<0&&(_=v),o(n[_],p)>=0)break;n[t]=n[_],t=_}n[t]=p}}function Kp(a,t=1,n=!1){const o=Tn.fromPoints(a[0]),u=Math.min(o.width(),o.height());let p=u/2;const _=new Yp([],Pp),{minX:v,minY:b,maxX:M,maxY:C}=o;if(u===0)return new pe(v,b);for(let F=v;F<M;F+=u)for(let j=b;j<C;j+=u)_.push(new Fl(F+p,j+p,p,a));let P=(function(F){let j=0,H=0,Y=0;const te=F[0];for(let xe=0,se=te.length,ue=se-1;xe<se;ue=xe++){const Ce=te[xe],Le=te[ue],He=Ce.x*Le.y-Le.x*Ce.y;H+=(Ce.x+Le.x)*He,Y+=(Ce.y+Le.y)*He,j+=3*He}return new Fl(H/j,Y/j,0,F)})(a),k=_.length;for(;_.length;){const F=_.pop();(F.d>P.d||!P.d)&&(P=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-P.d<=t||(p=F.h/2,_.push(new Fl(F.p.x-p,F.p.y-p,p,a)),_.push(new Fl(F.p.x+p,F.p.y-p,p,a)),_.push(new Fl(F.p.x-p,F.p.y+p,p,a)),_.push(new Fl(F.p.x+p,F.p.y+p,p,a)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function Pp(a,t){return t.max-a.max}function Fl(a,t,n,o){this.p=new pe(a,t),this.h=n,this.d=(function(u,p){let _=!1,v=1/0;for(let b=0;b<p.length;b++){const M=p[b];for(let C=0,P=M.length,k=P-1;C<P;k=C++){const F=M[C],j=M[k];F.y>u.y!=j.y>u.y&&u.x<(j.x-F.x)*(u.y-F.y)/(j.y-F.y)+F.x&&(_=!_),v=Math.min(v,Zd(u,F,j))}}return(_?1:-1)*Math.sqrt(v)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var sa;z.aE=void 0,(sa=z.aE||(z.aE={}))[sa.center=1]="center",sa[sa.left=2]="left",sa[sa.right=3]="right",sa[sa.top=4]="top",sa[sa.bottom=5]="bottom",sa[sa["top-left"]=6]="top-left",sa[sa["top-right"]=7]="top-right",sa[sa["bottom-left"]=8]="bottom-left",sa[sa["bottom-right"]=9]="bottom-right";const If=Number.POSITIVE_INFINITY;function zr(a,t){return t[1]!==If?(function(n,o,u){let p=0,_=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,_]})(a,t[0],t[1]):(function(n,o){let u=0,p=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=o;break;case"right":u=-o}return[u,p]})(a,t[0])}function Ad(a,t,n){var o;const u=a.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(p){const v=p.values,b=[];for(let M=0;M<v.length;M+=2){const C=b[M]=v[M],P=v[M+1].map((k=>k*Wi));C.startsWith("top")?P[1]-=7:C.startsWith("bottom")&&(P[1]+=7),b[M+1]=P}return new Gn(b)}const _=u.get("text-variable-anchor");if(_){let v;v=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*Wi,If]:u.get("text-offset").evaluate(t,{},n).map((M=>M*Wi));const b=[];for(const M of _)b.push(M,zr(M,v));return new Gn(b)}return null}function zd(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dp(a,t,n,o,u,p,_,v,b,M,C,P){let k=p.textMaxSize.evaluate(t,{});k===void 0&&(k=_);const F=a.layers[0].layout,j=F.get("icon-offset").evaluate(t,{},C),H=_u(n.horizontal),Y=_/24,te=a.tilePixelRatio*Y,xe=a.tilePixelRatio*k/24,se=a.tilePixelRatio*v,ue=a.tilePixelRatio*F.get("symbol-spacing"),Ce=F.get("text-padding")*a.tilePixelRatio,Le=(function(zt,xt,ft,Yt=1){const en=zt.get("icon-padding").evaluate(xt,{},ft),yn=en&&en.values;return[yn[0]*Yt,yn[1]*Yt,yn[2]*Yt,yn[3]*Yt]})(F,t,C,a.tilePixelRatio),He=F.get("text-max-angle")/180*Math.PI,at=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",et=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",nt=F.get("symbol-placement"),gt=ue/2,tt=F.get("icon-text-fit");let it;o&&tt!=="none"&&(a.allowVerticalPlacement&&n.vertical&&(it=bp(o,n.vertical,tt,F.get("icon-text-fit-padding"),j,Y)),H&&(o=bp(o,H,tt,F.get("icon-text-fit-padding"),j,Y)));const je=C?P.line.getGranularityForZoomLevel(C.z):1,St=(zt,xt)=>{xt.x<0||xt.x>=_t||xt.y<0||xt.y>=_t||(function(ft,Yt,en,yn,oa,_r,Pa,an,yi,tn,Sn,Mn,Cn,Pr,Yn,ha,Kn,Wn,En,An,Qi,yr,Qo,ls,vu){const Ec=ft.addToLineVertexArray(Yt,en);let Jo,el,Ac,xu,Ah=0,i=0,s=0,c=0,f=-1,x=-1;const S={};let R=Er("");if(ft.allowVerticalPlacement&&yn.vertical){const Ft=an.layout.get("text-rotate").evaluate(Qi,{},ls)+90;Ac=new gu(yi,Yt,tn,Sn,Mn,yn.vertical,Cn,Pr,Yn,Ft),Pa&&(xu=new gu(yi,Yt,tn,Sn,Mn,Pa,Kn,Wn,Yn,Ft))}if(oa){const Ft=an.layout.get("icon-rotate").evaluate(Qi,{}),ht=an.layout.get("icon-text-fit")!=="none",jt=zp(oa,Ft,Qo,ht),Vt=Pa?zp(Pa,Ft,Qo,ht):void 0;el=new gu(yi,Yt,tn,Sn,Mn,oa,Kn,Wn,!1,Ft),Ah=4*jt.length;const si=ft.iconSizeData;let Da=null;si.kind==="source"?(Da=[rs*an.layout.get("icon-size").evaluate(Qi,{})],Da[0]>Ar&&Ri(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):si.kind==="composite"&&(Da=[rs*yr.compositeIconSizes[0].evaluate(Qi,{},ls),rs*yr.compositeIconSizes[1].evaluate(Qi,{},ls)],(Da[0]>Ar||Da[1]>Ar)&&Ri(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,jt,Da,An,En,Qi,z.ao.none,Yt,Ec.lineStartIndex,Ec.lineLength,-1,ls),f=ft.icon.placedSymbolArray.length-1,Vt&&(i=4*Vt.length,ft.addSymbols(ft.icon,Vt,Da,An,En,Qi,z.ao.vertical,Yt,Ec.lineStartIndex,Ec.lineLength,-1,ls),x=ft.icon.placedSymbolArray.length-1)}const $=Object.keys(yn.horizontal);for(const Ft of $){const ht=yn.horizontal[Ft];if(!Jo){R=Er(ht.text);const Vt=an.layout.get("text-rotate").evaluate(Qi,{},ls);Jo=new gu(yi,Yt,tn,Sn,Mn,ht,Cn,Pr,Yn,Vt)}const jt=ht.positionedLines.length===1;if(s+=Rf(ft,Yt,ht,_r,an,Yn,Qi,ha,Ec,yn.vertical?z.ao.horizontal:z.ao.horizontalOnly,jt?$:[Ft],S,f,yr,ls),jt)break}yn.vertical&&(c+=Rf(ft,Yt,yn.vertical,_r,an,Yn,Qi,ha,Ec,z.ao.vertical,["vertical"],S,x,yr,ls));const he=Jo?Jo.boxStartIndex:ft.collisionBoxArray.length,Ie=Jo?Jo.boxEndIndex:ft.collisionBoxArray.length,Ze=Ac?Ac.boxStartIndex:ft.collisionBoxArray.length,Ye=Ac?Ac.boxEndIndex:ft.collisionBoxArray.length,Re=el?el.boxStartIndex:ft.collisionBoxArray.length,Oe=el?el.boxEndIndex:ft.collisionBoxArray.length,vt=xu?xu.boxStartIndex:ft.collisionBoxArray.length,Lt=xu?xu.boxEndIndex:ft.collisionBoxArray.length;let ri=-1;const Me=(Ft,ht)=>Ft&&Ft.circleDiameter?Math.max(Ft.circleDiameter,ht):ht;ri=Me(Jo,ri),ri=Me(Ac,ri),ri=Me(el,ri),ri=Me(xu,ri);const ve=ri>-1?1:0;ve&&(ri*=vu/Wi),ft.glyphOffsetArray.length>=Mc.MAX_GLYPHS&&Ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qi.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,Qi.sortKey);const De=Ad(an,Qi,ls),[$e,Pt]=(function(Ft,ht){const jt=Ft.length,Vt=ht==null?void 0:ht.values;if((Vt==null?void 0:Vt.length)>0)for(let si=0;si<Vt.length;si+=2){const Da=Vt[si+1];Ft.emplaceBack(z.aE[Vt[si]],Da[0],Da[1])}return[jt,Ft.length]})(ft.textAnchorOffsets,De);ft.symbolInstances.emplaceBack(Yt.x,Yt.y,S.right>=0?S.right:-1,S.center>=0?S.center:-1,S.left>=0?S.left:-1,S.vertical||-1,f,x,R,he,Ie,Ze,Ye,Re,Oe,vt,Lt,tn,s,c,Ah,i,ve,0,Cn,ri,$e,Pt)})(a,xt,zt,n,o,u,it,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,te,[Ce,Ce,Ce,Ce],at,b,se,Le,et,j,t,p,M,C,_)};if(nt==="line")for(const zt of Th(t.geometry,0,0,_t,_t)){const xt=ra(zt,je),ft=Xp(xt,ue,He,n.vertical||H,o,24,xe,a.overscaling,_t);for(const Yt of ft)H&&os(a,H.text,gt,Yt)||St(xt,Yt)}else if(nt==="line-center"){for(const zt of t.geometry)if(zt.length>1){const xt=ra(zt,je),ft=Ap(xt,He,n.vertical||H,o,24,xe);ft&&St(xt,ft)}}else if(t.type==="Polygon")for(const zt of dl(t.geometry,0)){const xt=Kp(zt,16);St(ra(zt[0],je,!0),new Ko(xt.x,xt.y,0))}else if(t.type==="LineString")for(const zt of t.geometry){const xt=ra(zt,je);St(xt,new Ko(xt[0].x,xt[0].y,0))}else if(t.type==="Point")for(const zt of t.geometry)for(const xt of zt)St([xt],new Ko(xt.x,xt.y,0))}function Rf(a,t,n,o,u,p,_,v,b,M,C,P,k,F,j){const H=(function(xe,se,ue,Ce,Le,He,at,et){const nt=Ce.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,gt=[];for(const tt of se.positionedLines)for(const it of tt.positionedGlyphs){if(!it.rect)continue;const je=it.rect||{};let St=4,zt=!0,xt=1,ft=0;const Yt=(Le||et)&&it.vertical,en=it.metrics.advance*it.scale/2;if(et&&se.verticalizable&&(ft=tt.lineOffset/2-(it.imageName?-(Wi-it.metrics.width*it.scale)/2:(it.scale-1)*Wi)),it.imageName){const Wn=at[it.imageName];zt=Wn.sdf,xt=Wn.pixelRatio,St=1/xt}const yn=Le?[it.x+en,it.y]:[0,0];let oa=Le?[0,0]:[it.x+en+ue[0],it.y+ue[1]-ft],_r=[0,0];Yt&&(_r=oa,oa=[0,0]);const Pa=it.metrics.isDoubleResolution?2:1,an=(it.metrics.left-St)*it.scale-en+oa[0],yi=(-it.metrics.top-St)*it.scale+oa[1],tn=an+je.w/Pa*it.scale/xt,Sn=yi+je.h/Pa*it.scale/xt,Mn=new pe(an,yi),Cn=new pe(tn,yi),Pr=new pe(an,Sn),Yn=new pe(tn,Sn);if(Yt){const Wn=new pe(-en,en- -17),En=-Math.PI/2,An=12-en,Qi=new pe(22-An,-(it.imageName?An:0)),yr=new pe(..._r);Mn._rotateAround(En,Wn)._add(Qi)._add(yr),Cn._rotateAround(En,Wn)._add(Qi)._add(yr),Pr._rotateAround(En,Wn)._add(Qi)._add(yr),Yn._rotateAround(En,Wn)._add(Qi)._add(yr)}if(nt){const Wn=Math.sin(nt),En=Math.cos(nt),An=[En,-Wn,Wn,En];Mn._matMult(An),Cn._matMult(An),Pr._matMult(An),Yn._matMult(An)}const ha=new pe(0,0),Kn=new pe(0,0);gt.push({tl:Mn,tr:Cn,bl:Pr,br:Yn,tex:je,writingMode:se.writingMode,glyphOffset:yn,sectionIndex:it.sectionIndex,isSDF:zt,pixelOffsetTL:ha,pixelOffsetBR:Kn,minFontScaleX:0,minFontScaleY:0})}return gt})(0,n,v,u,p,_,o,a.allowVerticalPlacement),Y=a.textSizeData;let te=null;Y.kind==="source"?(te=[rs*u.layout.get("text-size").evaluate(_,{})],te[0]>Ar&&Ri(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(te=[rs*F.compositeTextSizes[0].evaluate(_,{},j),rs*F.compositeTextSizes[1].evaluate(_,{},j)],(te[0]>Ar||te[1]>Ar)&&Ri(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,H,te,v,p,_,M,t,b.lineStartIndex,b.lineLength,k,j);for(const xe of C)P[xe]=a.text.placedSymbolArray.length-1;return 4*H.length}function _u(a){for(const t in a)return a[t];return null}function os(a,t,n,o){const u=a.compareText;if(t in u){const p=u[t];for(let _=p.length-1;_>=0;_--)if(o.dist(p[_])<n)return!0}else u[t]=[];return u[t].push(o),!1}const Lf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=Lf[15&o];if(!p)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new yu(v,_,p,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=Lf.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Bs(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:v}=this,b=[0,p.length-1,0],M=[];for(;b.length;){const C=b.pop()||0,P=b.pop()||0,k=b.pop()||0;if(P-k<=v){for(let Y=k;Y<=P;Y++){const te=_[2*Y],xe=_[2*Y+1];te>=t&&te<=o&&xe>=n&&xe<=u&&M.push(p[Y])}continue}const F=k+P>>1,j=_[2*F],H=_[2*F+1];j>=t&&j<=o&&H>=n&&H<=u&&M.push(p[F]),(C===0?t<=j:n<=H)&&(b.push(k),b.push(F-1),b.push(1-C)),(C===0?o>=j:u>=H)&&(b.push(F+1),b.push(P),b.push(1-C))}return M}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:_}=this,v=[0,u.length-1,0],b=[],M=o*o;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,k=v.pop()||0;if(P-k<=_){for(let Y=k;Y<=P;Y++)kf(p[2*Y],p[2*Y+1],t,n)<=M&&b.push(u[Y]);continue}const F=k+P>>1,j=p[2*F],H=p[2*F+1];kf(j,H,t,n)<=M&&b.push(u[F]),(C===0?t-o<=j:n-o<=H)&&(v.push(k),v.push(F-1),v.push(1-C)),(C===0?t+o>=j:n+o>=H)&&(v.push(F+1),v.push(P),v.push(1-C))}return b}}function Bs(a,t,n,o,u,p){if(u-o<=n)return;const _=o+u>>1;Ip(a,t,_,o,u,p),Bs(a,t,n,o,_-1,1-p),Bs(a,t,n,_+1,u,1-p)}function Ip(a,t,n,o,u,p){for(;u>o;){if(u-o>600){const M=u-o+1,C=n-o+1,P=Math.log(M),k=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*k*(M-k)/M)*(C-M/2<0?-1:1);Ip(a,t,n,Math.max(o,Math.floor(n-C*k/M+F)),Math.min(u,Math.floor(n+(M-C)*k/M+F)),p)}const _=t[2*n+p];let v=o,b=u;for(Ch(a,t,o,n),t[2*u+p]>_&&Ch(a,t,o,u);v<b;){for(Ch(a,t,v,b),v++,b--;t[2*v+p]<_;)v++;for(;t[2*b+p]>_;)b--}t[2*o+p]===_?Ch(a,t,o,b):(b++,Ch(a,t,b,u)),b<=n&&(o=b+1),n<=b&&(u=b-1)}}function Ch(a,t,n,o){Ul(a,n,o),Ul(t,2*n,2*o),Ul(t,2*n+1,2*o+1)}function Ul(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function kf(a,t,n,o){const u=a-n,p=t-o;return u*u+p*p}var Bf;z.cx=void 0,(Bf=z.cx||(z.cx={})).create="create",Bf.load="load",Bf.fullLoad="fullLoad";let Pd=null,Eh=[];const Of=1e3/60,Ff="loadTime",Uf="fullLoadTime",Wp={mark(a){performance.mark(a)},frame(a){const t=a;Pd!=null&&Eh.push(t-Pd),Pd=t},clearMetrics(){Pd=null,Eh=[],performance.clearMeasures(Ff),performance.clearMeasures(Uf);for(const a in z.cx)performance.clearMarks(z.cx[a])},getPerformanceMetrics(){performance.measure(Ff,z.cx.create,z.cx.load),performance.measure(Uf,z.cx.create,z.cx.fullLoad);const a=performance.getEntriesByName(Ff)[0].duration,t=performance.getEntriesByName(Uf)[0].duration,n=Eh.length,o=1/(Eh.reduce(((p,_)=>p+_),0)/n/1e3),u=Eh.filter((p=>p>Of)).reduce(((p,_)=>p+(_-Of)/Of),0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};z.$=_t,z.A=Mt,z.B=function([a,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(n),y:a*Math.sin(t)*Math.sin(n),z:a*Math.cos(n)}},z.C=Ur,z.D=dt,z.E=ct,z.F=pi,z.G=Nd,z.H=function(a){if(wo==null){const t=a.navigator?a.navigator.userAgent:null;wo=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return wo},z.I=lu,z.J=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new $p((()=>this.process())),this.subscription=Ns(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=ar(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise(((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=t?Ns(t.signal,"abort",(()=>{p==null||p.unsubscribe(),delete this.resolveRejects[u];const b={id:u,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)}),wp):null;this.resolveRejects[u]={resolve:b=>{p==null||p.unsubscribe(),n(b)},reject:b=>{p==null||p.unsubscribe(),o(b)}};const _=[],v=Object.assign(Object.assign({},a),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Jr(a.data,_)});this.target.postMessage(v,{transfer:_})}))}receive(a){const t=a.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(ar(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return h(this,void 0,void 0,(function*(){if(t.type==="<response>"){const u=this.resolveRejects[a];return delete this.resolveRejects[a],u?void(t.error?u.reject(Es(t.error)):u.resolve(Es(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Es(t.data),o=new AbortController;this.abortControllers[a]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(a,null,u)}catch(u){this.completeTask(a,u)}}))}completeTask(a,t,n){const o=[];delete this.abortControllers[a];const u={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Jr(t):null,data:Jr(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},z.K=X,z.L=function(){var a=new Mt(16);return Mt!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},z.M=function(a,t,n){var o,u,p,_,v,b,M,C,P,k,F,j,H=n[0],Y=n[1],te=n[2];return t===a?(a[12]=t[0]*H+t[4]*Y+t[8]*te+t[12],a[13]=t[1]*H+t[5]*Y+t[9]*te+t[13],a[14]=t[2]*H+t[6]*Y+t[10]*te+t[14],a[15]=t[3]*H+t[7]*Y+t[11]*te+t[15]):(u=t[1],p=t[2],_=t[3],v=t[4],b=t[5],M=t[6],C=t[7],P=t[8],k=t[9],F=t[10],j=t[11],a[0]=o=t[0],a[1]=u,a[2]=p,a[3]=_,a[4]=v,a[5]=b,a[6]=M,a[7]=C,a[8]=P,a[9]=k,a[10]=F,a[11]=j,a[12]=o*H+v*Y+P*te+t[12],a[13]=u*H+b*Y+k*te+t[13],a[14]=p*H+M*Y+F*te+t[14],a[15]=_*H+C*Y+j*te+t[15]),a},z.N=function(a,t,n){var o=n[0],u=n[1],p=n[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*u,a[5]=t[5]*u,a[6]=t[6]*u,a[7]=t[7]*u,a[8]=t[8]*p,a[9]=t[9]*p,a[10]=t[10]*p,a[11]=t[11]*p,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},z.O=function(a,t,n){var o=t[0],u=t[1],p=t[2],_=t[3],v=t[4],b=t[5],M=t[6],C=t[7],P=t[8],k=t[9],F=t[10],j=t[11],H=t[12],Y=t[13],te=t[14],xe=t[15],se=n[0],ue=n[1],Ce=n[2],Le=n[3];return a[0]=se*o+ue*v+Ce*P+Le*H,a[1]=se*u+ue*b+Ce*k+Le*Y,a[2]=se*p+ue*M+Ce*F+Le*te,a[3]=se*_+ue*C+Ce*j+Le*xe,a[4]=(se=n[4])*o+(ue=n[5])*v+(Ce=n[6])*P+(Le=n[7])*H,a[5]=se*u+ue*b+Ce*k+Le*Y,a[6]=se*p+ue*M+Ce*F+Le*te,a[7]=se*_+ue*C+Ce*j+Le*xe,a[8]=(se=n[8])*o+(ue=n[9])*v+(Ce=n[10])*P+(Le=n[11])*H,a[9]=se*u+ue*b+Ce*k+Le*Y,a[10]=se*p+ue*M+Ce*F+Le*te,a[11]=se*_+ue*C+Ce*j+Le*xe,a[12]=(se=n[12])*o+(ue=n[13])*v+(Ce=n[14])*P+(Le=n[15])*H,a[13]=se*u+ue*b+Ce*k+Le*Y,a[14]=se*p+ue*M+Ce*F+Le*te,a[15]=se*_+ue*C+Ce*j+Le*xe,a},z.P=pe,z.Q=function(a,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in a&&(n[u]=a[u])}return n},z.R=Aa,z.S=xo,z.T=td,z.U=Td,z.V=Mf,z.W=Zi,z.X=Ii,z.Y=Us,z.Z=gr,z._=h,z.a=Z,z.a$=da,z.a0=function(a,t){var n,o,u,p,_;if(!a)return t??{};if(!t)return a;let v=Object.assign({},a);if(t.removeAll&&(v={removeAll:!0}),t.remove){const b=new Set(t.remove);v.add&&(v.add=v.add.filter((C=>!b.has(C.id)))),v.update&&(v.update=v.update.filter((C=>!b.has(C.id))));const M=new Set(((n=a.add)!==null&&n!==void 0?n:[]).map((C=>C.id)));t.remove=t.remove.filter((C=>!M.has(C)))}if(t.remove){const b=new Set(v.remove?v.remove.concat(t.remove):t.remove);v.remove=Array.from(b.values())}if(t.add){const b=v.add?v.add.concat(t.add):t.add,M=new Map(b.map((C=>[C.id,C])));v.add=Array.from(M.values())}if(t.update){const b=new Map((o=v.update)===null||o===void 0?void 0:o.map((M=>[M.id,M])));for(const M of t.update){const C=(u=b.get(M.id))!==null&&u!==void 0?u:{id:M.id};M.newGeometry&&(C.newGeometry=M.newGeometry),M.addOrUpdateProperties&&(C.addOrUpdateProperties=((p=C.addOrUpdateProperties)!==null&&p!==void 0?p:[]).concat(M.addOrUpdateProperties)),M.removeProperties&&(C.removeProperties=((_=C.removeProperties)!==null&&_!==void 0?_:[]).concat(M.removeProperties)),M.removeAllProperties&&(C.removeAllProperties=!0),b.set(M.id,C)}v.update=Array.from(b.values())}return v.remove&&v.add&&(v.remove=v.remove.filter((b=>v.add.findIndex((M=>M.id===b))===-1))),v},z.a1=mu,z.a2=Tn,z.a3=25,z.a4=Cf,z.a5=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const o of a){const u=window.document.createElement("source");Se(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}}))},z.a6=Ve,z.a7=function(){return ui++},z.a8=K,z.a9=Mc,z.aA=function(a){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of a)t=Math.min(t,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[t,n,o,u]},z.aB=Wi,z.aC=oi,z.aD=function(a,t,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const p=u?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(p){const _=Math.sin(p),v=Math.cos(p);n=[n[0]*v-n[1]*_,n[0]*_+n[1]*v]}return[u?n[0]:oi(t,n[0],a.zoom),u?n[1]:oi(t,n[1],a.zoom)]},z.aF=du,z.aG=zd,z.aH=hu,z.aI=yu,z.aJ=Ti,z.aK=lh,z.aL=Ee,z.aM=qt,z.aN=Fn,z.aO=Qt,z.aP=Vs,z.aQ=Tp,z.aR=In,z.aS=Dn,z.aT=function(a){var t=new Mt(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},z.aU=function(a,t,n){return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],a},z.aV=function(a,t){var n=t[0],o=t[1],u=t[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),a[0]=t[0]*p,a[1]=t[1]*p,a[2]=t[2]*p,a},z.aW=xi,z.aX=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},z.aY=function(a,t,n){return a[0]=t[0]*n[0],a[1]=t[1]*n[1],a[2]=t[2]*n[2],a[3]=t[3]*n[3],a},z.aZ=Dt,z.a_=function(a,t,n){const o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return o===0?null:(-(a[0]*n[0]+a[1]*n[1]+a[2]*n[2])-n[3])/o},z.aa=ya,z.ab=Vo,z.ac=Af,z.ad=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,u,p)=>{const _=u||p;return t[o]=!_||_.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},z.ae=Nn,z.af=function(a){return Math.pow(2,a)},z.ag=vi,z.ah=At,z.ai=85.051129,z.aj=fu,z.ak=function(a){return Math.log(a)/Math.LN2},z.al=function(a){var t=a[0],n=a[1];return t*t+n*n},z.am=function(a,t){const n=[];for(const o in a)o in t||n.push(o);return n},z.an=function(a,t){let n=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:_}=a,v=u?At(ea.interpolationFactor(u,t,p,_),0,1):0;a.kind==="camera"?o=Ur.number(a.minSize,a.maxSize,v):n=v}return{uSizeT:n,uSize:o}},z.ap=function(a,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return a.kind==="source"?o/rs:a.kind==="composite"?Ur.number(o/rs,u/rs,n):t},z.aq=function(a,t){var n=t[0],o=t[1],u=t[2],p=t[3],_=t[4],v=t[5],b=t[6],M=t[7],C=t[8],P=t[9],k=t[10],F=t[11],j=t[12],H=t[13],Y=t[14],te=t[15],xe=n*v-o*_,se=n*b-u*_,ue=n*M-p*_,Ce=o*b-u*v,Le=o*M-p*v,He=u*M-p*b,at=C*H-P*j,et=C*Y-k*j,nt=C*te-F*j,gt=P*Y-k*H,tt=P*te-F*H,it=k*te-F*Y,je=xe*it-se*tt+ue*gt+Ce*nt-Le*et+He*at;return je?(a[0]=(v*it-b*tt+M*gt)*(je=1/je),a[1]=(u*tt-o*it-p*gt)*je,a[2]=(H*He-Y*Le+te*Ce)*je,a[3]=(k*Le-P*He-F*Ce)*je,a[4]=(b*nt-_*it-M*et)*je,a[5]=(n*it-u*nt+p*et)*je,a[6]=(Y*ue-j*He-te*se)*je,a[7]=(C*He-k*ue+F*se)*je,a[8]=(_*tt-v*nt+M*at)*je,a[9]=(o*nt-n*tt-p*at)*je,a[10]=(j*Le-H*ue+te*xe)*je,a[11]=(P*ue-C*Le-F*xe)*je,a[12]=(v*et-_*gt-b*at)*je,a[13]=(n*gt-o*et+u*at)*je,a[14]=(H*se-j*Ce-Y*xe)*je,a[15]=(C*Ce-P*se+k*xe)*je,a):null},z.ar=st,z.as=function(a){var t=a[0],n=a[1];return Math.sqrt(t*t+n*n)},z.at=function(a){return a[0]=0,a[1]=0,a},z.au=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a},z.av=ss,z.aw=wa,z.ax=function(a,t,n,o){const u=t.y-a.y,p=t.x-a.x,_=o.y-n.y,v=o.x-n.x,b=_*p-v*u;if(b===0)return null;const M=(v*(a.y-n.y)-_*(a.x-n.x))/b;return new pe(a.x+M*p,a.y+M*u)},z.ay=Th,z.az=El,z.b=xr,z.b$=class extends l{},z.b0=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a[3]=t[3]*n,a},z.b1=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},z.b2=Ef,z.b3=_i,z.b4=function(a,t,n,o,u){var p=1/Math.tan(t/2);if(a[0]=p/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=p,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,u!=null&&u!==1/0){var _=1/(o-u);a[10]=(u+o)*_,a[14]=2*u*o*_}else a[10]=-1,a[14]=-2*o;return a},z.b5=function(a){var t=new Mt(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},z.b6=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],_=t[1],v=t[2],b=t[3],M=t[4],C=t[5],P=t[6],k=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*u+M*o,a[1]=_*u+C*o,a[2]=v*u+P*o,a[3]=b*u+k*o,a[4]=M*u-p*o,a[5]=C*u-_*o,a[6]=P*u-v*o,a[7]=k*u-b*o,a},z.b7=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[4],_=t[5],v=t[6],b=t[7],M=t[8],C=t[9],P=t[10],k=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=p*u+M*o,a[5]=_*u+C*o,a[6]=v*u+P*o,a[7]=b*u+k*o,a[8]=M*u-p*o,a[9]=C*u-_*o,a[10]=P*u-v*o,a[11]=k*u-b*o,a},z.b8=function(){const a=new Float32Array(16);return vi(a),a},z.b9=function(){const a=new Float64Array(16);return vi(a),a},z.bA=function(a,t){const n=fe(a,360),o=fe(t,360),u=o-n,p=o>n?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},z.bB=function(a){return a[0]=0,a[1]=0,a[2]=0,a},z.bC=function(a,t,n,o){const u=Math.sqrt(a*a+t*t),p=Math.sqrt(n*n+o*o);a/=u,t/=u,n/=p,o/=p;const _=Math.acos(a*n+t*o);return-t*n+a*o>0?_:-_},z.bD=function(a,t){const n=fe(a,2*Math.PI),o=fe(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},z.bE=function(){const a={},t=be.$version;for(const n in be.$root){const o=be.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(a[n]=u)}}return a},z.bF=Xc,z.bG=le,z.bH=function a(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!a(t[o],n[o]))return!1;return!0}return t===n},z.bI=function(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=Zt(a[n],t[a[n].ref]));return a},z.bJ=function(a,t){if(a.type==="custom")return new bh(a,t);switch(a.type){case"background":return new Sf(a,t);case"circle":return new Xd(a,t);case"color-relief":return new ip(a,t);case"fill":return new af(a,t);case"fill-extrusion":return new hi(a,t);case"heatmap":return new ep(a,t);case"hillshade":return new Zo(a,t);case"line":return new lf(a,t);case"raster":return new Hp(a,t);case"symbol":return new xh(a,t)}},z.bK=Qn,z.bL=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let n=[];try{if(!pt(a.version,t.version))return[{command:"setStyle",args:[t]}];pt(a.center,t.center)||n.push({command:"setCenter",args:[t.center]}),pt(a.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),pt(a.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),pt(a.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),pt(a.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),pt(a.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),pt(a.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),pt(a.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),pt(a.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),pt(a.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),pt(a.light,t.light)||n.push({command:"setLight",args:[t.light]}),pt(a.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),pt(a.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),pt(a.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(_,v,b,M){let C;for(C in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(v,C)||sn(C,b,M));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(_,C)?pt(_[C],v[C])||(_[C].type==="geojson"&&v[C].type==="geojson"&&Vn(_,v,C)?Ut(b,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):on(C,v,b,M)):Li(C,v,b))})(a.sources,t.sources,u,o);const p=[];a.layers&&a.layers.forEach((_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):p.push(_)})),n=n.concat(u),(function(_,v,b){v=v||[];const M=(_=_||[]).map(ki),C=v.map(ki),P=_.reduce(mn,{}),k=v.reduce(mn,{}),F=M.slice(),j=Object.create(null);let H,Y,te,xe,se;for(let ue=0,Ce=0;ue<M.length;ue++)H=M[ue],Object.prototype.hasOwnProperty.call(k,H)?Ce++:(Ut(b,{command:"removeLayer",args:[H]}),F.splice(F.indexOf(H,Ce),1));for(let ue=0,Ce=0;ue<C.length;ue++)H=C[C.length-1-ue],F[F.length-1-ue]!==H&&(Object.prototype.hasOwnProperty.call(P,H)?(Ut(b,{command:"removeLayer",args:[H]}),F.splice(F.lastIndexOf(H,F.length-Ce),1)):Ce++,xe=F[F.length-ue],Ut(b,{command:"addLayer",args:[k[H],xe]}),F.splice(F.length-ue,0,H),j[H]=!0);for(let ue=0;ue<C.length;ue++)if(H=C[ue],Y=P[H],te=k[H],!j[H]&&!pt(Y,te))if(pt(Y.source,te.source)&&pt(Y["source-layer"],te["source-layer"])&&pt(Y.type,te.type)){for(se in Ln(Y.layout,te.layout,b,H,null,"setLayoutProperty"),Ln(Y.paint,te.paint,b,H,null,"setPaintProperty"),pt(Y.filter,te.filter)||Ut(b,{command:"setFilter",args:[H,te.filter]}),pt(Y.minzoom,te.minzoom)&&pt(Y.maxzoom,te.maxzoom)||Ut(b,{command:"setLayerZoomRange",args:[H,te.minzoom,te.maxzoom]}),Y)Object.prototype.hasOwnProperty.call(Y,se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&(se.indexOf("paint.")===0?Ln(Y[se],te[se],b,H,se.slice(6),"setPaintProperty"):pt(Y[se],te[se])||Ut(b,{command:"setLayerProperty",args:[H,se,te[se]]}));for(se in te)Object.prototype.hasOwnProperty.call(te,se)&&!Object.prototype.hasOwnProperty.call(Y,se)&&se!=="layout"&&se!=="paint"&&se!=="filter"&&se!=="metadata"&&se!=="minzoom"&&se!=="maxzoom"&&(se.indexOf("paint.")===0?Ln(Y[se],te[se],b,H,se.slice(6),"setPaintProperty"):pt(Y[se],te[se])||Ut(b,{command:"setLayerProperty",args:[H,se,te[se]]}))}else Ut(b,{command:"removeLayer",args:[H]}),xe=F[F.lastIndexOf(H)+1],Ut(b,{command:"addLayer",args:[te,xe]})})(p,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},z.bM=function(a){const t=[],n=a.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},z.bN=ir,z.bO=nr,z.bP=class extends Ni{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},z.bQ=Yu,z.bR=class extends Ni{constructor(a,t){super(a,t),this.current=Hh}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},z.bS=Jc,z.bT=class extends Ni{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},z.bU=class extends Ni{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},z.bV=Jt,z.bW=function(a,t){var n=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=n,a[2]=0,a[3]=-n,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},z.bX=function(a,t,n){var o=t[0],u=t[1],p=t[2];return a[0]=o*n[0]+u*n[3]+p*n[6],a[1]=o*n[1]+u*n[4]+p*n[7],a[2]=o*n[2]+u*n[5]+p*n[8],a},z.bY=function(a,t,n,o,u,p,_){var v=1/(t-n),b=1/(o-u),M=1/(p-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(t+n)*v,a[13]=(u+o)*b,a[14]=(_+p)*M,a[15]=1,a},z.bZ=class extends Ni{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let n=0;n<a.length;n++)t[4*n]=a[n].r,t[4*n+1]=a[n].g,t[4*n+2]=a[n].b,t[4*n+3]=a[n].a;this.gl.uniform4fv(this.location,t)}}},z.b_=class extends Ni{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},z.ba=function(){return new Float64Array(16)},z.bb=function(a,t,n){const o=new Float64Array(4);return Fe(o,a,t-90,n),o},z.bc=function(a,t,n,o){var u,p,_,v,b,M=t[0],C=t[1],P=t[2],k=t[3],F=n[0],j=n[1],H=n[2],Y=n[3];return(p=M*F+C*j+P*H+k*Y)<0&&(p=-p,F=-F,j=-j,H=-H,Y=-Y),1-p>di?(u=Math.acos(p),_=Math.sin(u),v=Math.sin((1-o)*u)/_,b=Math.sin(o*u)/_):(v=1-o,b=o),a[0]=v*M+b*F,a[1]=v*C+b*j,a[2]=v*P+b*H,a[3]=v*k+b*Y,a},z.bd=function(a){const t=new Float64Array(9);var n,o,u,p,_,v,b,M,C,P,k,F,j,H,Y,te,xe,se;P=(u=(o=a)[0])*(b=u+u),k=(p=o[1])*b,j=(_=o[2])*b,H=_*(M=p+p),te=(v=o[3])*b,xe=v*M,se=v*(C=_+_),(n=t)[0]=1-(F=p*M)-(Y=_*C),n[3]=k-se,n[6]=j+xe,n[1]=k+se,n[4]=1-P-Y,n[7]=H-te,n[2]=j-xe,n[5]=H+te,n[8]=1-P-F;const ue=Vs(-Math.asin(At(t[2],-1,1)));let Ce,Le;return Math.hypot(t[5],t[8])<.001?(Ce=0,Le=-Vs(Math.atan2(t[3],t[4]))):(Ce=Vs(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Le=Vs(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Ce,pitch:ue+90,bearing:Le}},z.be=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},z.bf=$t,z.bg=Qc,z.bh=bc,z.bi=ru,z.bj=hr,z.bk=Ge,z.bl=rt,z.bm=Jn,z.bn=function(a,t,n,o,u){return Ge(o,u,At((a-t)/(n-t),0,1))},z.bo=fe,z.bp=function(){return new Float64Array(3)},z.bq=function(a,t,n,o){return a[0]=t[0]+n[0]*o,a[1]=t[1]+n[1]*o,a[2]=t[2]+n[2]*o,a},z.br=Fe,z.bs=function(a,t,n){var o=n[0],u=n[1],p=n[2],_=n[3],v=t[0],b=t[1],M=t[2],C=u*M-p*b,P=p*v-o*M,k=o*b-u*v;return a[0]=v+_*(C+=C)+u*(k+=k)-p*(P+=P),a[1]=b+_*P+p*C-o*k,a[2]=M+_*k+o*P-u*C,a},z.bt=function(a,t,n){const o=(u=[a[0],a[1],a[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((C=u[8])*(_=u[4])-(v=u[5])*(M=u[7]))+u[1]*(-C*(p=u[3])+v*(b=u[6]))+u[2]*(M*p-_*b);var u,p,_,v,b,M,C;if(o===0)return null;const P=xi([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),k=xi([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),F=xi([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),j=In([],P,-a[3]);return Dn(j,j,In([],k,-t[3])),Dn(j,j,In([],F,-n[3])),In(j,j,1/o),j},z.bu=ii,z.bv=function(){return new Float64Array(4)},z.bw=function(a,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),p[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),p[2]=u[2],a[0]=p[0]+n[0],a[1]=p[1]+n[1],a[2]=p[2]+n[2],a},z.bx=function(a,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[0],p[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),p[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),a[0]=p[0]+n[0],a[1]=p[1]+n[1],a[2]=p[2]+n[2],a},z.by=function(a,t,n,o){var u=[],p=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],p[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),p[1]=u[1],p[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),a[0]=p[0]+n[0],a[1]=p[1]+n[1],a[2]=p[2]+n[2],a},z.bz=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],_=t[1],v=t[2],b=t[3],M=t[8],C=t[9],P=t[10],k=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*u-M*o,a[1]=_*u-C*o,a[2]=v*u-P*o,a[3]=b*u-k*o,a[8]=p*o+M*u,a[9]=_*o+C*u,a[10]=v*o+P*u,a[11]=b*o+k*u,a},z.c=ye,z.c0=ua,z.c1=class extends g{},z.c2=nh,z.c3=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},z.c4=ih,z.c5=function(a,t,n){var o=t[0],u=t[1],p=t[2],_=n[3]*o+n[7]*u+n[11]*p+n[15];return a[0]=(n[0]*o+n[4]*u+n[8]*p+n[12])/(_=_||1),a[1]=(n[1]*o+n[5]*u+n[9]*p+n[13])/_,a[2]=(n[2]*o+n[6]*u+n[10]*p+n[14])/_,a},z.c6=class extends Ea{},z.c7=class extends D{},z.c8=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},z.c9=function(a,t){var n=a[0],o=a[1],u=a[2],p=a[3],_=a[4],v=a[5],b=a[6],M=a[7],C=a[8],P=a[9],k=a[10],F=a[11],j=a[12],H=a[13],Y=a[14],te=a[15],xe=t[0],se=t[1],ue=t[2],Ce=t[3],Le=t[4],He=t[5],at=t[6],et=t[7],nt=t[8],gt=t[9],tt=t[10],it=t[11],je=t[12],St=t[13],zt=t[14],xt=t[15];return Math.abs(n-xe)<=di*Math.max(1,Math.abs(n),Math.abs(xe))&&Math.abs(o-se)<=di*Math.max(1,Math.abs(o),Math.abs(se))&&Math.abs(u-ue)<=di*Math.max(1,Math.abs(u),Math.abs(ue))&&Math.abs(p-Ce)<=di*Math.max(1,Math.abs(p),Math.abs(Ce))&&Math.abs(_-Le)<=di*Math.max(1,Math.abs(_),Math.abs(Le))&&Math.abs(v-He)<=di*Math.max(1,Math.abs(v),Math.abs(He))&&Math.abs(b-at)<=di*Math.max(1,Math.abs(b),Math.abs(at))&&Math.abs(M-et)<=di*Math.max(1,Math.abs(M),Math.abs(et))&&Math.abs(C-nt)<=di*Math.max(1,Math.abs(C),Math.abs(nt))&&Math.abs(P-gt)<=di*Math.max(1,Math.abs(P),Math.abs(gt))&&Math.abs(k-tt)<=di*Math.max(1,Math.abs(k),Math.abs(tt))&&Math.abs(F-it)<=di*Math.max(1,Math.abs(F),Math.abs(it))&&Math.abs(j-je)<=di*Math.max(1,Math.abs(j),Math.abs(je))&&Math.abs(H-St)<=di*Math.max(1,Math.abs(H),Math.abs(St))&&Math.abs(Y-zt)<=di*Math.max(1,Math.abs(Y),Math.abs(zt))&&Math.abs(te-xt)<=di*Math.max(1,Math.abs(te),Math.abs(xt))},z.cA=function(a,t){Z.REGISTERED_PROTOCOLS[a]=t},z.cB=function(a){delete Z.REGISTERED_PROTOCOLS[a]},z.cC=function(a,t){const n={};for(let u=0;u<a.length;u++){const p=t&&t[a[u].id]||ni(a[u]);t&&(t[a[u].id]=p);let _=n[p];_||(_=n[p]=[]),_.push(a[u])}const o=[];for(const u in n)o.push(n[u]);return o},z.cD=ot,z.cE=Mp,z.cF=Cp,z.cG=md,z.cH=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=_t/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new pi(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new pi(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new pi(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:C}=a.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new pi(M),a.canonical),o["text-size"].possiblyEvaluate(new pi(C),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:C}=a.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new pi(M),a.canonical),o["icon-size"].possiblyEvaluate(new pi(C),a.canonical)]}const p=n.get("text-line-height")*Wi,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),b=n.get("text-size");for(const M of a.bucket.features){const C=n.get("text-font").evaluate(M,{},a.canonical).join(","),P=b.evaluate(M,{},a.canonical),k=u.layoutTextSize.evaluate(M,{},a.canonical),F=u.layoutIconSize.evaluate(M,{},a.canonical),j={horizontal:{},vertical:void 0},H=M.text;let Y,te=[0,0];if(H){const ue=H.toString(),Ce=n.get("text-letter-spacing").evaluate(M,{},a.canonical)*Wi,Le=oo(ue)?Ce:0,He=n.get("text-anchor").evaluate(M,{},a.canonical),at=Ad(t,M,a.canonical);if(!at){const tt=n.get("text-radial-offset").evaluate(M,{},a.canonical);te=tt?zr(He,[tt*Wi,If]):n.get("text-offset").evaluate(M,{},a.canonical).map((it=>it*Wi))}let et=_?"center":n.get("text-justify").evaluate(M,{},a.canonical);const nt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(M,{},a.canonical)*Wi:1/0,gt=()=>{a.bucket.allowVerticalPlacement&&As(ue)&&(j.vertical=_h(H,a.glyphMap,a.glyphPositions,a.imagePositions,C,nt,p,He,"left",Le,te,z.ao.vertical,!0,k,P))};if(!_&&at){const tt=new Set;if(et==="auto")for(let je=0;je<at.values.length;je+=2)tt.add(zd(at.values[je]));else tt.add(et);let it=!1;for(const je of tt)if(!j.horizontal[je])if(it)j.horizontal[je]=j.horizontal[0];else{const St=_h(H,a.glyphMap,a.glyphPositions,a.imagePositions,C,nt,p,"center",je,Le,te,z.ao.horizontal,!1,k,P);St&&(j.horizontal[je]=St,it=St.positionedLines.length===1)}gt()}else{et==="auto"&&(et=zd(He));const tt=_h(H,a.glyphMap,a.glyphPositions,a.imagePositions,C,nt,p,He,et,Le,te,z.ao.horizontal,!1,k,P);tt&&(j.horizontal[et]=tt),gt(),As(ue)&&_&&v&&(j.vertical=_h(H,a.glyphMap,a.glyphPositions,a.imagePositions,C,nt,p,He,et,Le,te,z.ao.vertical,!1,k,P))}}let xe=!1;if(M.icon&&M.icon.name){const ue=a.imageMap[M.icon.name];ue&&(Y=Zp(a.imagePositions[M.icon.name],n.get("icon-offset").evaluate(M,{},a.canonical),n.get("icon-anchor").evaluate(M,{},a.canonical)),xe=!!ue.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=xe:a.bucket.sdfIcons!==xe&&Ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==a.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const se=_u(j.horizontal)||j.vertical;a.bucket.iconsInText=!!se&&se.iconsInText,(se||Y)&&Dp(a.bucket,M,j,Y,a.imageMap,u,k,F,te,xe,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},z.cI=od,z.cJ=cd,z.cK=Xo,z.cL=sf,z.cM=Sc,z.cN=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},z.cO=function(a,t,n,o,u){return h(this,void 0,void 0,(function*(){if(Ii())try{return yield Us(a,t,n,o,u)}catch{}return(function(p,_,v,b,M){const C=p.width,P=p.height;Dr&&js||(Dr=new OffscreenCanvas(C,P),js=Dr.getContext("2d",{willReadFrequently:!0})),Dr.width=C,Dr.height=P,js.drawImage(p,0,0,C,P);const k=js.getImageData(_,v,b,M);return js.clearRect(0,0,C,P),k.data})(a,t,n,o,u)}))},z.cP=go,z.cQ=_e,z.cR=wc,z.cS=Ls,z.cT=Lo,z.cU=function(a,t){const n=new Map;if(a!=null)if(a.type==="Feature")n.set(Cc(a,t),a);else for(const o of a.features)n.set(Cc(o,t),o);return n},z.cV=function(a,t){if(a==null)return!0;if(a.type==="Feature")return Cc(a,t)!=null;if(a.type==="FeatureCollection"){const n=new Set;for(const o of a.features){const u=Cc(o,t);if(u==null||n.has(u))return!1;n.add(u)}return!0}return!1},z.cW=function(a,t,n){var o,u,p,_;if(t.removeAll&&a.clear(),t.remove)for(const v of t.remove)a.delete(v);if(t.add)for(const v of t.add){const b=Cc(v,n);b!=null&&a.set(b,v)}if(t.update)for(const v of t.update){let b=a.get(v.id);if(b==null)continue;const M=!v.removeAllProperties&&(((o=v.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=v.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0);if((v.newGeometry||v.removeAllProperties||M)&&(b=Object.assign({},b),a.set(v.id,b),M&&(b.properties=Object.assign({},b.properties))),v.newGeometry&&(b.geometry=v.newGeometry),v.removeAllProperties)b.properties={};else if(((p=v.removeProperties)===null||p===void 0?void 0:p.length)>0)for(const C of v.removeProperties)Object.prototype.hasOwnProperty.call(b.properties,C)&&delete b.properties[C];if(((_=v.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(const{key:C,value:P}of v.addOrUpdateProperties)b.properties[C]=P}},z.cX=Ca,z.ca=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},z.cb=a=>a.type==="symbol",z.cc=a=>a.type==="circle",z.cd=a=>a.type==="heatmap",z.ce=a=>a.type==="line",z.cf=a=>a.type==="fill",z.cg=a=>a.type==="fill-extrusion",z.ch=a=>a.type==="hillshade",z.ci=a=>a.type==="color-relief",z.cj=a=>a.type==="raster",z.ck=a=>a.type==="background",z.cl=a=>a.type==="custom",z.cm=ut,z.cn=function(a,t,n){const o=Ct(t.x-n.x,t.y-n.y),u=Ct(a.x-n.x,a.y-n.y);var p,_;return Vs(Math.atan2(o[0]*u[1]-o[1]*u[0],(p=o)[0]*(_=u)[0]+p[1]*_[1]))},z.co=Et,z.cp=function(a,t){return hs[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},z.cq=function(a,t){return us[t]&&"touches"in a},z.cr=function(a){return us[a]||hs[a]},z.cs=function(a,t,n){var o=t[0],u=t[1];return a[0]=n[0]*o+n[4]*u+n[12],a[1]=n[1]*o+n[5]*u+n[13],a},z.ct=function(a,t){const{x:n,y:o}=mu.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||n<0||n>=1)},z.cu=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},z.cv=class extends es{},z.cw=Wp,z.cy=function(a){return a.message===ds},z.cz=re,z.d=Se,z.e=Ci,z.f=a=>h(void 0,void 0,void 0,(function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),z.g=G,z.h=a=>new Promise(((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=rr}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(u):rr})),z.i=ar,z.j=(a,t)=>ge(Ci(a,{type:"json"}),t),z.k=Ue,z.l=Ke,z.m=ge,z.n=(a,t)=>ge(Ci(a,{type:"arrayBuffer"}),t),z.o=function(a){return new Sc(a).readFields(pp,[])},z.p=hf,z.q=au,z.r=na,z.s=Ns,z.t=Uo,z.u=Xt,z.v=be,z.w=Ri,z.x=Qr,z.y=qu,z.z=Sr})),J("worker",["./shared"],(function(z){class h{constructor(Z,G){this.keyCache={},Z&&this.replace(Z,G)}replace(Z,G){this._layerConfigs={},this._layers={},this.update(Z,[],G)}update(Z,G,X){for(const le of Z){this._layerConfigs[le.id]=le;const ge=this._layers[le.id]=z.bJ(le,X);ge._featureFilter=z.aa(ge.filter,X),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of G)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const re=z.cC(Object.values(this._layerConfigs),this.keyCache);for(const le of re){const ge=le.map((ct=>this._layers[ct.id])),Se=ge[0];if(Se.visibility==="none")continue;const we=Se.source||"";let Be=this.familiesBySource[we];Be||(Be=this.familiesBySource[we]={});const Ke=Se.sourceLayer||"_geojsonTileLayer";let Ue=Be[Ke];Ue||(Ue=Be[Ke]=[]),Ue.push(ge)}}}class pe{constructor(Z){const G={},X=[];for(const Se in Z){const we=Z[Se],Be=G[Se]={};for(const Ke in we){const Ue=we[+Ke];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const ct={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};X.push(ct),Be[Ke]={rect:ct,metrics:Ue.metrics}}}const{w:re,h:le}=z.p(X),ge=new z.q({width:re||1,height:le||1});for(const Se in Z){const we=Z[Se];for(const Be in we){const Ke=we[+Be];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Ue=G[Se][Be].rect;z.q.copy(Ke.bitmap,ge,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},Ke.bitmap)}}this.image=ge,this.positions=G}}z.cD("GlyphAtlas",pe);class _e{constructor(Z){this.tileID=new z.Z(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,G,X,re,le){return z._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new z.a8;const ge=new z.cE(Object.keys(Z.layers).sort()),Se=new z.cF(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const we={},Be={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:X,subdivisionGranularity:le},Ke=G.familiesBySource[this.source];for(const Ve in Ke){const ln=Z.layers[Ve];if(!ln)continue;ln.version===1&&z.w(`Vector tile source "${this.source}" layer "${Ve}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ia=ge.encode(Ve),Zs=[];for(let cn=0;cn<ln.length;cn++){const Xe=ln.feature(cn),bt=Se.getId(Xe,Ve);Zs.push({feature:Xe,id:bt,index:cn,sourceLayerIndex:Ia})}for(const cn of Ke[Ve]){const Xe=cn[0];Xe.source!==this.source&&z.w(`layer.source = ${Xe.source} does not equal this.source = ${this.source}`),Xe.minzoom&&this.zoom<Math.floor(Xe.minzoom)||Xe.maxzoom&&this.zoom>=Xe.maxzoom||Xe.visibility!=="none"&&(We(cn,this.zoom,X),(we[Xe.id]=Xe.createBucket({index:Se.bucketLayerIDs.length,layers:cn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ia,sourceID:this.source})).populate(Zs,Be,this.tileID.canonical),Se.bucketLayerIDs.push(cn.map((bt=>bt.id))))}}const Ue=z.bN(Be.glyphDependencies,(Ve=>Object.keys(Ve).map(Number)));this.inFlightDependencies.forEach((Ve=>Ve==null?void 0:Ve.abort())),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(Ue).length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),ct=re.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},Ve)}const be=Object.keys(Be.iconDependencies);let Tt=Promise.resolve({});if(be.length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),Tt=re.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},Ve)}const Zt=Object.keys(Be.patternDependencies);let pt=Promise.resolve({});if(Zt.length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),pt=re.sendAsync({type:"GI",data:{icons:Zt,source:this.source,tileID:this.tileID,type:"patterns"}},Ve)}const Ut=Be.dashDependencies;let Li=Promise.resolve({});if(Object.keys(Ut).length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),Li=re.sendAsync({type:"GDA",data:{dashes:Ut}},Ve)}const[sn,on,Vn,Ln]=yield Promise.all([ct,Tt,pt,Li]),ki=new pe(sn),mn=new z.cG(on,Vn);for(const Ve in we){const ln=we[Ve];ln instanceof z.a9?(We(ln.layers,this.zoom,X),z.cH({bucket:ln,glyphMap:sn,glyphPositions:ki.positions,imageMap:on,imagePositions:mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Be.subdivisionGranularity})):ln.hasDependencies&&(ln instanceof z.cI||ln instanceof z.cJ||ln instanceof z.cK)&&(We(ln.layers,this.zoom,X),ln.addFeatures(Be,this.tileID.canonical,mn.patternPositions,Ln))}return this.status="done",{buckets:Object.values(we).filter((Ve=>!Ve.isEmpty())),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ki.image,imageAtlas:mn,dashPositions:Ln,glyphMap:this.returnDependencies?sn:null,iconMap:this.returnDependencies?on:null,glyphPositions:this.returnDependencies?ki.positions:null}}))}}function We(ye,Z,G){const X=new z.F(Z);for(const re of ye)re.recalculate(X,G)}class ke{constructor(Z,G,X){this.actor=Z,this.layerIndex=G,this.availableImages=X,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,G){return z._(this,void 0,void 0,(function*(){const X=yield z.n(Z.request,G);try{return{vectorTile:new z.cL(new z.cM(X.data)),rawData:X.data,cacheControl:X.cacheControl,expires:X.expires}}catch(re){const le=new Uint8Array(X.data);let ge=`Unable to parse the tile at ${Z.request.url}, `;throw ge+=le[0]===31&&le[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${re.message}`,new Error(ge)}}))}loadTile(Z){return z._(this,void 0,void 0,(function*(){const G=Z.uid,X=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new z.cN(Z.request),re=new _e(Z);this.loading[G]=re;const le=new AbortController;re.abort=le;try{const ge=yield this.loadVectorTile(Z,le);if(delete this.loading[G],!ge)return null;const Se=ge.rawData,we={};ge.expires&&(we.expires=ge.expires),ge.cacheControl&&(we.cacheControl=ge.cacheControl);const Be={};if(X){const Ue=X.finish();Ue&&(Be.resourceTiming=JSON.parse(JSON.stringify(Ue)))}re.vectorTile=ge.vectorTile;const Ke=re.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);this.loaded[G]=re,this.fetching[G]={rawTileData:Se,cacheControl:we,resourceTiming:Be};try{const Ue=yield Ke;return z.e({rawTileData:Se.slice(0)},Ue,we,Be)}finally{delete this.fetching[G]}}catch(ge){throw delete this.loading[G],re.status="done",this.loaded[G]=re,ge}}))}reloadTile(Z){return z._(this,void 0,void 0,(function*(){const G=Z.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const X=this.loaded[G];if(X.showCollisionBoxes=Z.showCollisionBoxes,X.status==="parsing"){const re=yield X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);let le;if(this.fetching[G]){const{rawTileData:ge,cacheControl:Se,resourceTiming:we}=this.fetching[G];delete this.fetching[G],le=z.e({rawTileData:ge.slice(0)},re,Se,we)}else le=re;return le}if(X.status==="done"&&X.vectorTile)return X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity)}))}abortTile(Z){return z._(this,void 0,void 0,(function*(){const G=this.loading,X=Z.uid;G&&G[X]&&G[X].abort&&(G[X].abort.abort(),delete G[X])}))}removeTile(Z){return z._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]}))}}class Ne{constructor(){this.loaded={}}loadTile(Z){return z._(this,void 0,void 0,(function*(){const{uid:G,encoding:X,rawImageData:re,redFactor:le,greenFactor:ge,blueFactor:Se,baseShift:we}=Z,Be=re.width+2,Ke=re.height+2,Ue=z.b(re)?new z.R({width:Be,height:Ke},yield z.cO(re,-1,-1,Be,Ke)):re,ct=new z.cP(G,Ue,X,le,ge,Se,we);return this.loaded=this.loaded||{},this.loaded[G]=ct,ct}))}removeTile(Z){const G=this.loaded,X=Z.uid;G&&G[X]&&delete G[X]}}var Te,ti,kt=(function(){if(ti)return Te;function ye(G,X){if(G.length!==0){Z(G[0],X);for(var re=1;re<G.length;re++)Z(G[re],!X)}}function Z(G,X){for(var re=0,le=0,ge=0,Se=G.length,we=Se-1;ge<Se;we=ge++){var Be=(G[ge][0]-G[we][0])*(G[we][1]+G[ge][1]),Ke=re+Be;le+=Math.abs(re)>=Math.abs(Be)?re-Ke+Be:Be-Ke+re,re=Ke}re+le>=0!=!!X&&G.reverse()}return ti=1,Te=function G(X,re){var le,ge=X&&X.type;if(ge==="FeatureCollection")for(le=0;le<X.features.length;le++)G(X.features[le],re);else if(ge==="GeometryCollection")for(le=0;le<X.geometries.length;le++)G(X.geometries[le],re);else if(ge==="Feature")G(X.geometry,re);else if(ge==="Polygon")ye(X.coordinates,re);else if(ge==="MultiPolygon")for(le=0;le<X.coordinates.length;le++)ye(X.coordinates[le],re);return X}})(),Zi=z.cQ(kt);class Ii extends z.cS{constructor(Z,G){super(new z.cM,0,G,[],[]),this.feature=Z,this.type=Z.type,this.properties=Z.tags?Z.tags:{},"id"in Z&&(typeof Z.id=="string"?this.id=parseInt(Z.id,10):typeof Z.id!="number"||isNaN(Z.id)||(this.id=Z.id))}loadGeometry(){const Z=[],G=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const X of G){const re=[];for(const le of X)re.push(new z.P(le[0],le[1]));Z.push(re)}return Z}}class di extends z.cR{constructor(Z,G){super(new z.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=G?G.version:1,this.extent=G?G.extent:4096,this.length=Z.length,this.features=Z}feature(Z){return new Ii(this.features[Z],this.extent)}}function Mt(ye,Z){Z.writeVarintField(15,ye.version||1),Z.writeStringField(1,ye.name||""),Z.writeVarintField(5,ye.extent||4096);const G={keys:[],values:[],keycache:{},valuecache:{}};for(let le=0;le<ye.length;le++)G.feature=ye.feature(le),Z.writeMessage(2,Jt,G);const X=G.keys;for(const le of X)Z.writeStringField(3,le);const re=G.values;for(const le of re)Z.writeMessage(4,Dn,le)}function Jt(ye,Z){if(!ye.feature)return;const G=ye.feature;G.id!==void 0&&Z.writeVarintField(1,G.id),Z.writeMessage(2,vi,ye),Z.writeVarintField(3,G.type),Z.writeMessage(4,Pn,G)}function vi(ye,Z){var G;for(const X in(G=ye.feature)==null?void 0:G.properties){let re=ye.feature.properties[X],le=ye.keycache[X];if(re===null)continue;le===void 0&&(ye.keys.push(X),le=ye.keys.length-1,ye.keycache[X]=le),Z.writeVarint(le),typeof re!="string"&&typeof re!="boolean"&&typeof re!="number"&&(re=JSON.stringify(re));const ge=typeof re+":"+re;let Se=ye.valuecache[ge];Se===void 0&&(ye.values.push(re),Se=ye.values.length-1,ye.valuecache[ge]=Se),Z.writeVarint(Se)}}function ei(ye,Z){return(Z<<3)+(7&ye)}function Dt(ye){return ye<<1^ye>>31}function Pn(ye,Z){const G=ye.loadGeometry(),X=ye.type;let re=0,le=0;for(const ge of G){let Se=1;X===1&&(Se=ge.length),Z.writeVarint(ei(1,Se));const we=X===3?ge.length-1:ge.length;for(let Be=0;Be<we;Be++){Be===1&&X!==1&&Z.writeVarint(ei(2,we-1));const Ke=ge[Be].x-re,Ue=ge[Be].y-le;Z.writeVarint(Dt(Ke)),Z.writeVarint(Dt(Ue)),re+=Ke,le+=Ue}ye.type===3&&Z.writeVarint(ei(7,1))}}function Dn(ye,Z){const G=typeof ye;G==="string"?Z.writeStringField(1,ye):G==="boolean"?Z.writeBooleanField(7,ye):G==="number"&&(ye%1!=0?Z.writeDoubleField(3,ye):ye<0?Z.writeSVarintField(6,ye):Z.writeVarintField(5,ye))}const In={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},xi=Math.fround||(Gi=new Float32Array(1),ye=>(Gi[0]=+ye,Gi[0]));var Gi;class da{constructor(Z){this.options=Object.assign(Object.create(In),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:G,minZoom:X,maxZoom:re}=this.options;G&&console.time("total time");const le=`prepare ${Z.length} points`;G&&console.time(le),this.points=Z;const ge=[];for(let we=0;we<Z.length;we++){const Be=Z[we];if(!Be.geometry)continue;const[Ke,Ue]=Be.geometry.coordinates,ct=xi(Fe(Ke)),be=xi(st(Ue));ge.push(ct,be,1/0,we,-1,1),this.options.reduce&&ge.push(0)}let Se=this.trees[re+1]=this._createTree(ge);G&&console.timeEnd(le);for(let we=re;we>=X;we--){const Be=+Date.now();Se=this.trees[we]=this._createTree(this._cluster(Se,we)),G&&console.log("z%d: %d clusters in %dms",we,Se.numItems,+Date.now()-Be)}return G&&console.timeEnd("total time"),this}getClusters(Z,G){let X=((Z[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,Z[1]));let le=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)X=-180,le=180;else if(X>le){const Ue=this.getClusters([X,re,180,ge],G),ct=this.getClusters([-180,re,le,ge],G);return Ue.concat(ct)}const Se=this.trees[this._limitZoom(G)],we=Se.range(Fe(X),st(ge),Fe(le),st(re)),Be=Se.data,Ke=[];for(const Ue of we){const ct=this.stride*Ue;Ke.push(Be[ct+5]>1?wa(Be,ct,this.clusterProps):this.points[Be[ct+3]])}return Ke}getChildren(Z){const G=this._getOriginId(Z),X=this._getOriginZoom(Z),re="No cluster with the specified id.",le=this.trees[X];if(!le)throw new Error(re);const ge=le.data;if(G*this.stride>=ge.length)throw new Error(re);const Se=this.options.radius/(this.options.extent*Math.pow(2,X-1)),we=le.within(ge[G*this.stride],ge[G*this.stride+1],Se),Be=[];for(const Ke of we){const Ue=Ke*this.stride;ge[Ue+4]===Z&&Be.push(ge[Ue+5]>1?wa(ge,Ue,this.clusterProps):this.points[ge[Ue+3]])}if(Be.length===0)throw new Error(re);return Be}getLeaves(Z,G,X){const re=[];return this._appendLeaves(re,Z,G=G||10,X=X||0,0),re}getTile(Z,G,X){const re=this.trees[this._limitZoom(Z)],le=Math.pow(2,Z),{extent:ge,radius:Se}=this.options,we=Se/ge,Be=(X-we)/le,Ke=(X+1+we)/le,Ue={features:[]};return this._addTileFeatures(re.range((G-we)/le,Be,(G+1+we)/le,Ke),re.data,G,X,le,Ue),G===0&&this._addTileFeatures(re.range(1-we/le,Be,1,Ke),re.data,le,X,le,Ue),G===le-1&&this._addTileFeatures(re.range(0,Be,we/le,Ke),re.data,-1,X,le,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(Z){let G=this._getOriginZoom(Z)-1;for(;G<=this.options.maxZoom;){const X=this.getChildren(Z);if(G++,X.length!==1)break;Z=X[0].properties.cluster_id}return G}_appendLeaves(Z,G,X,re,le){const ge=this.getChildren(G);for(const Se of ge){const we=Se.properties;if(we&&we.cluster?le+we.point_count<=re?le+=we.point_count:le=this._appendLeaves(Z,we.cluster_id,X,re,le):le<re?le++:Z.push(Se),Z.length===X)break}return le}_createTree(Z){const G=new z.aI(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<Z.length;X+=this.stride)G.add(Z[X],Z[X+1]);return G.finish(),G.data=Z,G}_addTileFeatures(Z,G,X,re,le,ge){for(const Se of Z){const we=Se*this.stride,Be=G[we+5]>1;let Ke,Ue,ct;if(Be)Ke=Rn(G,we,this.clusterProps),Ue=G[we],ct=G[we+1];else{const Zt=this.points[G[we+3]];Ke=Zt.properties;const[pt,Ut]=Zt.geometry.coordinates;Ue=Fe(pt),ct=st(Ut)}const be={type:1,geometry:[[Math.round(this.options.extent*(Ue*le-X)),Math.round(this.options.extent*(ct*le-re))]],tags:Ke};let Tt;Tt=Be||this.options.generateId?G[we+3]:this.points[G[we+3]].id,Tt!==void 0&&(be.id=Tt),ge.features.push(be)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,G){const{radius:X,extent:re,reduce:le,minPoints:ge}=this.options,Se=X/(re*Math.pow(2,G)),we=Z.data,Be=[],Ke=this.stride;for(let Ue=0;Ue<we.length;Ue+=Ke){if(we[Ue+2]<=G)continue;we[Ue+2]=G;const ct=we[Ue],be=we[Ue+1],Tt=Z.within(we[Ue],we[Ue+1],Se),Zt=we[Ue+5];let pt=Zt;for(const Ut of Tt){const Li=Ut*Ke;we[Li+2]>G&&(pt+=we[Li+5])}if(pt>Zt&&pt>=ge){let Ut,Li=ct*Zt,sn=be*Zt,on=-1;const Vn=(Ue/Ke<<5)+(G+1)+this.points.length;for(const Ln of Tt){const ki=Ln*Ke;if(we[ki+2]<=G)continue;we[ki+2]=G;const mn=we[ki+5];Li+=we[ki]*mn,sn+=we[ki+1]*mn,we[ki+4]=Vn,le&&(Ut||(Ut=this._map(we,Ue,!0),on=this.clusterProps.length,this.clusterProps.push(Ut)),le(Ut,this._map(we,ki)))}we[Ue+4]=Vn,Be.push(Li/pt,sn/pt,1/0,Vn,-1,pt),le&&Be.push(on)}else{for(let Ut=0;Ut<Ke;Ut++)Be.push(we[Ue+Ut]);if(pt>1)for(const Ut of Tt){const Li=Ut*Ke;if(!(we[Li+2]<=G)){we[Li+2]=G;for(let sn=0;sn<Ke;sn++)Be.push(we[Li+sn])}}}}return Be}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,G,X){if(Z[G+5]>1){const ge=this.clusterProps[Z[G+6]];return X?Object.assign({},ge):ge}const re=this.points[Z[G+3]].properties,le=this.options.map(re);return X&&le===re?Object.assign({},le):le}}function wa(ye,Z,G){return{type:"Feature",id:ye[Z+3],properties:Rn(ye,Z,G),geometry:{type:"Point",coordinates:[(X=ye[Z],360*(X-.5)),Ct(ye[Z+1])]}};var X}function Rn(ye,Z,G){const X=ye[Z+5],re=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,le=ye[Z+6],ge=le===-1?{}:Object.assign({},G[le]);return Object.assign(ge,{cluster:!0,cluster_id:ye[Z+3],point_count:X,point_count_abbreviated:re})}function Fe(ye){return ye/360+.5}function st(ye){const Z=Math.sin(ye*Math.PI/180),G=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return G<0?0:G>1?1:G}function Ct(ye){const Z=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function _t(ye,Z,G,X){let re=X;const le=Z+(G-Z>>1);let ge,Se=G-Z;const we=ye[Z],Be=ye[Z+1],Ke=ye[G],Ue=ye[G+1];for(let ct=Z+3;ct<G;ct+=3){const be=oi(ye[ct],ye[ct+1],we,Be,Ke,Ue);if(be>re)ge=ct,re=be;else if(be===re){const Tt=Math.abs(ct-le);Tt<Se&&(ge=ct,Se=Tt)}}re>X&&(ge-Z>3&&_t(ye,Z,ge,X),ye[ge+2]=re,G-ge>3&&_t(ye,ge,G,X))}function oi(ye,Z,G,X,re,le){let ge=re-G,Se=le-X;if(ge!==0||Se!==0){const we=((ye-G)*ge+(Z-X)*Se)/(ge*ge+Se*Se);we>1?(G=re,X=le):we>0&&(G+=ge*we,X+=Se*we)}return ge=ye-G,Se=Z-X,ge*ge+Se*Se}function fe(ye,Z,G,X){const re={id:ye??null,type:Z,geometry:G,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Ge(re,G);else if(Z==="Polygon")Ge(re,G[0]);else if(Z==="MultiLineString")for(const le of G)Ge(re,le);else if(Z==="MultiPolygon")for(const le of G)Ge(re,le[0]);return re}function Ge(ye,Z){for(let G=0;G<Z.length;G+=3)ye.minX=Math.min(ye.minX,Z[G]),ye.minY=Math.min(ye.minY,Z[G+1]),ye.maxX=Math.max(ye.maxX,Z[G]),ye.maxY=Math.max(ye.maxY,Z[G+1])}function rt(ye,Z,G,X){if(!Z.geometry)return;const re=Z.geometry.coordinates;if(re&&re.length===0)return;const le=Z.geometry.type,ge=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let Se=[],we=Z.id;if(G.promoteId?we=Z.properties[G.promoteId]:G.generateId&&(we=X||0),le==="Point")ut(re,Se);else if(le==="MultiPoint")for(const Be of re)ut(Be,Se);else if(le==="LineString")Et(re,Se,ge,!1);else if(le==="MultiLineString"){if(G.lineMetrics){for(const Be of re)Se=[],Et(Be,Se,ge,!1),ye.push(fe(we,"LineString",Se,Z.properties));return}At(re,Se,ge,!1)}else if(le==="Polygon")At(re,Se,ge,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(const Be of Z.geometry.geometries)rt(ye,{id:we,geometry:Be,properties:Z.properties},G,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Be of re){const Ke=[];At(Be,Ke,ge,!0),Se.push(Ke)}}ye.push(fe(we,le,Se,Z.properties))}function ut(ye,Z){Z.push(Qt(ye[0]),Ci(ye[1]),0)}function Et(ye,Z,G,X){let re,le,ge=0;for(let we=0;we<ye.length;we++){const Be=Qt(ye[we][0]),Ke=Ci(ye[we][1]);Z.push(Be,Ke,0),we>0&&(ge+=X?(re*Ke-Be*le)/2:Math.sqrt(Math.pow(Be-re,2)+Math.pow(Ke-le,2))),re=Be,le=Ke}const Se=Z.length-3;Z[2]=1,_t(Z,0,Se,G),Z[Se+2]=1,Z.size=Math.abs(ge),Z.start=0,Z.end=Z.size}function At(ye,Z,G,X){for(let re=0;re<ye.length;re++){const le=[];Et(ye[re],le,G,X),Z.push(le)}}function Qt(ye){return ye/360+.5}function Ci(ye){const Z=Math.sin(ye*Math.PI/180),G=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return G<0?0:G>1?1:G}function ui(ye,Z,G,X,re,le,ge,Se){if(X/=Z,le>=(G/=Z)&&ge<X)return ye;if(ge<G||le>=X)return null;const we=[];for(const Be of ye){const Ke=Be.geometry;let Ue=Be.type;const ct=re===0?Be.minX:Be.minY,be=re===0?Be.maxX:Be.maxY;if(ct>=G&&be<X){we.push(Be);continue}if(be<G||ct>=X)continue;let Tt=[];if(Ue==="Point"||Ue==="MultiPoint")ir(Ke,Tt,G,X,re);else if(Ue==="LineString")nr(Ke,Tt,G,X,re,!1,Se.lineMetrics);else if(Ue==="MultiLineString")qi(Ke,Tt,G,X,re,!1);else if(Ue==="Polygon")qi(Ke,Tt,G,X,re,!0);else if(Ue==="MultiPolygon")for(const Zt of Ke){const pt=[];qi(Zt,pt,G,X,re,!0),pt.length&&Tt.push(pt)}if(Tt.length){if(Se.lineMetrics&&Ue==="LineString"){for(const Zt of Tt)we.push(fe(Be.id,Ue,Zt,Be.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(Tt.length===1?(Ue="LineString",Tt=Tt[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=Tt.length===3?"Point":"MultiPoint"),we.push(fe(Be.id,Ue,Tt,Be.tags))}}return we.length?we:null}function ir(ye,Z,G,X,re){for(let le=0;le<ye.length;le+=3){const ge=ye[le+re];ge>=G&&ge<=X&&Ri(Z,ye[le],ye[le+1],ye[le+2])}}function nr(ye,Z,G,X,re,le,ge){let Se=Qn(ye);const we=re===0?Xa:ar;let Be,Ke,Ue=ye.start;for(let pt=0;pt<ye.length-3;pt+=3){const Ut=ye[pt],Li=ye[pt+1],sn=ye[pt+2],on=ye[pt+3],Vn=ye[pt+4],Ln=re===0?Ut:Li,ki=re===0?on:Vn;let mn=!1;ge&&(Be=Math.sqrt(Math.pow(Ut-on,2)+Math.pow(Li-Vn,2))),Ln<G?ki>G&&(Ke=we(Se,Ut,Li,on,Vn,G),ge&&(Se.start=Ue+Be*Ke)):Ln>X?ki<X&&(Ke=we(Se,Ut,Li,on,Vn,X),ge&&(Se.start=Ue+Be*Ke)):Ri(Se,Ut,Li,sn),ki<G&&Ln>=G&&(Ke=we(Se,Ut,Li,on,Vn,G),mn=!0),ki>X&&Ln<=X&&(Ke=we(Se,Ut,Li,on,Vn,X),mn=!0),!le&&mn&&(ge&&(Se.end=Ue+Be*Ke),Z.push(Se),Se=Qn(ye)),ge&&(Ue+=Be)}let ct=ye.length-3;const be=ye[ct],Tt=ye[ct+1],Zt=re===0?be:Tt;Zt>=G&&Zt<=X&&Ri(Se,be,Tt,ye[ct+2]),ct=Se.length-3,le&&ct>=3&&(Se[ct]!==Se[0]||Se[ct+1]!==Se[1])&&Ri(Se,Se[0],Se[1],Se[2]),Se.length&&Z.push(Se)}function Qn(ye){const Z=[];return Z.size=ye.size,Z.start=ye.start,Z.end=ye.end,Z}function qi(ye,Z,G,X,re,le){for(const ge of ye)nr(ge,Z,G,X,re,le,!1)}function Ri(ye,Z,G,X){ye.push(Z,G,X)}function Xa(ye,Z,G,X,re,le){const ge=(le-Z)/(X-Z);return Ri(ye,le,G+(re-G)*ge,1),ge}function ar(ye,Z,G,X,re,le){const ge=(le-G)/(re-G);return Ri(ye,Z+(X-Z)*ge,le,1),ge}function wo(ye,Z){const G=[];for(let X=0;X<ye.length;X++){const re=ye[X],le=re.type;let ge;if(le==="Point"||le==="MultiPoint"||le==="LineString")ge=xr(re.geometry,Z);else if(le==="MultiLineString"||le==="Polygon"){ge=[];for(const Se of re.geometry)ge.push(xr(Se,Z))}else if(le==="MultiPolygon"){ge=[];for(const Se of re.geometry){const we=[];for(const Be of Se)we.push(xr(Be,Z));ge.push(we)}}G.push(fe(re.id,le,ge,re.tags))}return G}function xr(ye,Z){const G=[];G.size=ye.size,ye.start!==void 0&&(G.start=ye.start,G.end=ye.end);for(let X=0;X<ye.length;X+=3)G.push(ye[X]+Z,ye[X+1],ye[X+2]);return G}function rr(ye,Z){if(ye.transformed)return ye;const G=1<<ye.z,X=ye.x,re=ye.y;for(const le of ye.features){const ge=le.geometry,Se=le.type;if(le.geometry=[],Se===1)for(let we=0;we<ge.length;we+=2)le.geometry.push(Us(ge[we],ge[we+1],Z,G,X,re));else for(let we=0;we<ge.length;we++){const Be=[];for(let Ke=0;Ke<ge[we].length;Ke+=2)Be.push(Us(ge[we][Ke],ge[we][Ke+1],Z,G,X,re));le.geometry.push(Be)}}return ye.transformed=!0,ye}function Us(ye,Z,G,X,re,le){return[Math.round(G*(ye*X-re)),Math.round(G*(Z*X-le))]}function Dr(ye,Z,G,X,re){const le=Z===re.maxZoom?0:re.tolerance/((1<<Z)*re.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:G,y:X,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Se of ye)js(ge,Se,le,re);return ge}function js(ye,Z,G,X){const re=Z.geometry,le=Z.type,ge=[];if(ye.minX=Math.min(ye.minX,Z.minX),ye.minY=Math.min(ye.minY,Z.minY),ye.maxX=Math.max(ye.maxX,Z.maxX),ye.maxY=Math.max(ye.maxY,Z.maxY),le==="Point"||le==="MultiPoint")for(let Se=0;Se<re.length;Se+=3)ge.push(re[Se],re[Se+1]),ye.numPoints++,ye.numSimplified++;else if(le==="LineString")Ns(ge,re,ye,G,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(let Se=0;Se<re.length;Se++)Ns(ge,re[Se],ye,G,le==="Polygon",Se===0);else if(le==="MultiPolygon")for(let Se=0;Se<re.length;Se++){const we=re[Se];for(let Be=0;Be<we.length;Be++)Ns(ge,we[Be],ye,G,!0,Be===0)}if(ge.length){let Se=Z.tags||null;if(le==="LineString"&&X.lineMetrics){Se={};for(const Be in Z.tags)Se[Be]=Z.tags[Be];Se.mapbox_clip_start=re.start/re.size,Se.mapbox_clip_end=re.end/re.size}const we={geometry:ge,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Se};Z.id!==null&&(we.id=Z.id),ye.features.push(we)}}function Ns(ye,Z,G,X,re,le){const ge=X*X;if(X>0&&Z.size<(re?ge:X))return void(G.numPoints+=Z.length/3);const Se=[];for(let we=0;we<Z.length;we+=3)(X===0||Z[we+2]>ge)&&(G.numSimplified++,Se.push(Z[we],Z[we+1])),G.numPoints++;re&&(function(we,Be){let Ke=0;for(let Ue=0,ct=we.length,be=ct-2;Ue<ct;be=Ue,Ue+=2)Ke+=(we[Ue]-we[be])*(we[Ue+1]+we[be+1]);if(Ke>0===Be)for(let Ue=0,ct=we.length;Ue<ct/2;Ue+=2){const be=we[Ue],Tt=we[Ue+1];we[Ue]=we[ct-2-Ue],we[Ue+1]=we[ct-1-Ue],we[ct-2-Ue]=be,we[ct-1-Ue]=Tt}})(Se,le),ye.push(Se)}const Nn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vs{constructor(Z,G){const X=(G=this.options=(function(le,ge){for(const Se in ge)le[Se]=ge[Se];return le})(Object.create(Nn),G)).debug;if(X&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let re=(function(le,ge){const Se=[];if(le.type==="FeatureCollection")for(let we=0;we<le.features.length;we++)rt(Se,le.features[we],ge,we);else rt(Se,le.type==="Feature"?le:{geometry:le},ge);return Se})(Z,G);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=(function(le,ge){const Se=ge.buffer/ge.extent;let we=le;const Be=ui(le,1,-1-Se,Se,0,-1,2,ge),Ke=ui(le,1,1-Se,2+Se,0,-1,2,ge);return(Be||Ke)&&(we=ui(le,1,-Se,1+Se,0,-1,2,ge)||[],Be&&(we=wo(Be,1).concat(we)),Ke&&(we=we.concat(wo(Ke,-1)))),we})(re,G),re.length&&this.splitTile(re,0,0,0),X&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,G,X,re,le,ge,Se){const we=[Z,G,X,re],Be=this.options,Ke=Be.debug;for(;we.length;){re=we.pop(),X=we.pop(),G=we.pop(),Z=we.pop();const Ue=1<<G,ct=us(G,X,re);let be=this.tiles[ct];if(!be&&(Ke>1&&console.time("creation"),be=this.tiles[ct]=Dr(Z,G,X,re,Be),this.tileCoords.push({z:G,x:X,y:re}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,X,re,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));const mn=`z${G}`;this.stats[mn]=(this.stats[mn]||0)+1,this.total++}if(be.source=Z,le==null){if(G===Be.indexMaxZoom||be.numPoints<=Be.indexMaxPoints)continue}else{if(G===Be.maxZoom||G===le)continue;if(le!=null){const mn=le-G;if(X!==ge>>mn||re!==Se>>mn)continue}}if(be.source=null,Z.length===0)continue;Ke>1&&console.time("clipping");const Tt=.5*Be.buffer/Be.extent,Zt=.5-Tt,pt=.5+Tt,Ut=1+Tt;let Li=null,sn=null,on=null,Vn=null,Ln=ui(Z,Ue,X-Tt,X+pt,0,be.minX,be.maxX,Be),ki=ui(Z,Ue,X+Zt,X+Ut,0,be.minX,be.maxX,Be);Z=null,Ln&&(Li=ui(Ln,Ue,re-Tt,re+pt,1,be.minY,be.maxY,Be),sn=ui(Ln,Ue,re+Zt,re+Ut,1,be.minY,be.maxY,Be),Ln=null),ki&&(on=ui(ki,Ue,re-Tt,re+pt,1,be.minY,be.maxY,Be),Vn=ui(ki,Ue,re+Zt,re+Ut,1,be.minY,be.maxY,Be),ki=null),Ke>1&&console.timeEnd("clipping"),we.push(Li||[],G+1,2*X,2*re),we.push(sn||[],G+1,2*X,2*re+1),we.push(on||[],G+1,2*X+1,2*re),we.push(Vn||[],G+1,2*X+1,2*re+1)}}getTile(Z,G,X){Z=+Z,G=+G,X=+X;const re=this.options,{extent:le,debug:ge}=re;if(Z<0||Z>24)return null;const Se=1<<Z,we=us(Z,G=G+Se&Se-1,X);if(this.tiles[we])return rr(this.tiles[we],le);ge>1&&console.log("drilling down to z%d-%d-%d",Z,G,X);let Be,Ke=Z,Ue=G,ct=X;for(;!Be&&Ke>0;)Ke--,Ue>>=1,ct>>=1,Be=this.tiles[us(Ke,Ue,ct)];return Be&&Be.source?(ge>1&&(console.log("found parent tile z%d-%d-%d",Ke,Ue,ct),console.time("drilling down")),this.splitTile(Be.source,Ke,Ue,ct,Z,G,X),ge>1&&console.timeEnd("drilling down"),this.tiles[we]?rr(this.tiles[we],le):null):null}}function us(ye,Z,G){return 32*((1<<ye)*G+Z)+ye}class hs extends ke{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,G){return z._(this,void 0,void 0,(function*(){const X=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const re=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!re)return null;const le=new di(re.features,{version:2,extent:z.$});let ge=(function(Se){const we=new z.cM;return(function(Be,Ke){for(const Ue in Be.layers)Ke.writeMessage(3,Mt,Be.layers[Ue])})(Se,we),we.finish()})(le);return ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),{vectorTile:le,rawData:ge.buffer}}))}loadData(Z){return z._(this,void 0,void 0,(function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const X=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new z.cN(Z.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest);const re=yield this._pendingData;this._geoJSONIndex=Z.cluster?new da((function({superclusterOptions:ge,clusterProperties:Se}){if(!Se||!ge)return ge;const we={},Be={},Ke={accumulated:null,zoom:0},Ue={properties:null},ct=Object.keys(Se);for(const be of ct){const[Tt,Zt]=Se[be],pt=z.cT(Zt),Ut=z.cT(typeof Tt=="string"?[Tt,["accumulated"],["get",be]]:Tt);we[be]=pt.value,Be[be]=Ut.value}return ge.map=be=>{Ue.properties=be;const Tt={};for(const Zt of ct)Tt[Zt]=we[Zt].evaluate(Ke,Ue);return Tt},ge.reduce=(be,Tt)=>{Ue.properties=Tt;for(const Zt of ct)Ke.accumulated=be[Zt],be[Zt]=Be[Zt].evaluate(Ke,Ue)},ge})(Z)).load(re.features):(function(ge,Se){return new Vs(ge,Se)})(re,Z.geojsonVtOptions),this.loaded={};const le={data:re};if(X){const ge=X.finish();ge&&(le.resourceTiming={},le.resourceTiming[Z.source]=JSON.parse(JSON.stringify(ge)))}return le}catch(re){if(delete this._pendingRequest,z.cy(re))return{abandoned:!0};throw re}}))}getData(){return z._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Z){const G=this.loaded;return G&&G[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,G){return z._(this,void 0,void 0,(function*(){let X=yield this.loadGeoJSON(Z,G);if(delete this._pendingRequest,typeof X!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(Zi(X,!0),Z.filter){const re=z.cT(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map((ge=>`${ge.key}: ${ge.message}`)).join(", "));X={type:"FeatureCollection",features:X.features.filter((ge=>re.value.evaluate({zoom:0},ge)))}}return X}))}loadGeoJSON(Z,G){return z._(this,void 0,void 0,(function*(){const{promoteId:X}=Z;if(Z.request){const re=yield z.j(Z.request,G);return this._dataUpdateable=z.cV(re.data,X)?z.cU(re.data,X):void 0,re.data}if(typeof Z.data=="string")try{const re=JSON.parse(Z.data);return this._dataUpdateable=z.cV(re,X)?z.cU(re,X):void 0,re}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return z.cW(this._dataUpdateable,Z.dataDiff,X),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Z){return z._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class ds{constructor(Z){this.self=Z,this.actor=new z.J(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(G,X)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=X},this.self.addProtocol=z.cA,this.self.removeProtocol=z.cB,this.self.registerRTLTextPlugin=G=>{z.cX.setMethods(G)},this.actor.registerMessageHandler("LDT",((G,X)=>this._getDEMWorkerSource(G,X.source).loadTile(X))),this.actor.registerMessageHandler("RDT",((G,X)=>z._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(G,X.source).removeTile(X)})))),this.actor.registerMessageHandler("GCEZ",((G,X)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,X.type,X.source).getClusterExpansionZoom(X)})))),this.actor.registerMessageHandler("GCC",((G,X)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,X.type,X.source).getClusterChildren(X)})))),this.actor.registerMessageHandler("GCL",((G,X)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,X.type,X.source).getClusterLeaves(X)})))),this.actor.registerMessageHandler("LD",((G,X)=>this._getWorkerSource(G,X.type,X.source).loadData(X))),this.actor.registerMessageHandler("GD",((G,X)=>this._getWorkerSource(G,X.type,X.source).getData())),this.actor.registerMessageHandler("LT",((G,X)=>this._getWorkerSource(G,X.type,X.source).loadTile(X))),this.actor.registerMessageHandler("RT",((G,X)=>this._getWorkerSource(G,X.type,X.source).reloadTile(X))),this.actor.registerMessageHandler("AT",((G,X)=>this._getWorkerSource(G,X.type,X.source).abortTile(X))),this.actor.registerMessageHandler("RMT",((G,X)=>this._getWorkerSource(G,X.type,X.source).removeTile(X))),this.actor.registerMessageHandler("RS",((G,X)=>z._(this,void 0,void 0,(function*(){if(!this.workerSources[G]||!this.workerSources[G][X.type]||!this.workerSources[G][X.type][X.source])return;const re=this.workerSources[G][X.type][X.source];delete this.workerSources[G][X.type][X.source],re.removeSource!==void 0&&re.removeSource(X)})))),this.actor.registerMessageHandler("RM",(G=>z._(this,void 0,void 0,(function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],this.globalStates.delete(G)})))),this.actor.registerMessageHandler("SR",((G,X)=>z._(this,void 0,void 0,(function*(){this.referrer=X})))),this.actor.registerMessageHandler("SRPS",((G,X)=>this._syncRTLPluginState(G,X))),this.actor.registerMessageHandler("IS",((G,X)=>z._(this,void 0,void 0,(function*(){this.self.importScripts(X)})))),this.actor.registerMessageHandler("SI",((G,X)=>this._setImages(G,X))),this.actor.registerMessageHandler("UL",((G,X)=>z._(this,void 0,void 0,(function*(){this._getLayerIndex(G).update(X.layers,X.removedIds,this._getGlobalState(G))})))),this.actor.registerMessageHandler("UGS",((G,X)=>z._(this,void 0,void 0,(function*(){const re=this._getGlobalState(G);for(const le in X)re[le]=X[le]})))),this.actor.registerMessageHandler("SL",((G,X)=>z._(this,void 0,void 0,(function*(){this._getLayerIndex(G).replace(X,this._getGlobalState(G))}))))}_getGlobalState(Z){let G=this.globalStates.get(Z);return G||(G={},this.globalStates.set(Z,G)),G}_setImages(Z,G){return z._(this,void 0,void 0,(function*(){this.availableImages[Z]=G;for(const X in this.workerSources[Z]){const re=this.workerSources[Z][X];for(const le in re)re[le].availableImages=G}}))}_syncRTLPluginState(Z,G){return z._(this,void 0,void 0,(function*(){return yield z.cX.syncState(G,this.self.importScripts)}))}_getAvailableImages(Z){let G=this.availableImages[Z];return G||(G=[]),G}_getLayerIndex(Z){let G=this.layerIndexes[Z];return G||(G=this.layerIndexes[Z]=new h),G}_getWorkerSource(Z,G,X){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][G]||(this.workerSources[Z][G]={}),!this.workerSources[Z][G][X]){const re={sendAsync:(le,ge)=>(le.targetMapId=Z,this.actor.sendAsync(le,ge))};switch(G){case"vector":this.workerSources[Z][G][X]=new ke(re,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][G][X]=new hs(re,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][G][X]=new this.externalWorkerSourceTypes[G](re,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][G][X]}_getDEMWorkerSource(Z,G){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][G]||(this.demWorkerSources[Z][G]=new Ne),this.demWorkerSources[Z][G]}}return z.i(self)&&(self.worker=new ds(self)),ds})),J("index",["exports","./shared"],(function(z,h){var pe="5.8.0";function _e(){var m=new h.A(4);return h.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let We,ke;const Ne={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,r){const l=requestAnimationFrame((g=>{d(),e(g)})),{unsubscribe:d}=h.s(m.signal,"abort",(()=>{d(),cancelAnimationFrame(l),r(h.c())}),!1)},frameAsync(m){return new Promise(((e,r)=>{this.frame(m,e,r)}))},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(We||(We=document.createElement("a")),We.href=m,We.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ke==null&&(ke=matchMedia("(prefers-reduced-motion: reduce)")),ke.matches)}};class Te{static testProp(e){if(!Te.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in Te.docStyle)return e[r];return e[0]}static create(e,r,l){const d=window.document.createElement(e);return r!==void 0&&(d.className=r),l&&l.appendChild(d),d}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){Te.docStyle&&Te.selectProp&&(Te.userSelect=Te.docStyle[Te.selectProp],Te.docStyle[Te.selectProp]="none")}static enableDrag(){Te.docStyle&&Te.selectProp&&(Te.docStyle[Te.selectProp]=Te.userSelect)}static setTransform(e,r){e.style[Te.transformProp]=r}static addEventListener(e,r,l,d={}){e.addEventListener(r,l,"passive"in d?d:d.capture)}static removeEventListener(e,r,l,d={}){e.removeEventListener(r,l,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Te.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Te.suppressClickInternal,!0)}),0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,l){const d=r.boundingClientRect;return new h.P((l.clientX-d.left)/r.x-e.clientLeft,(l.clientY-d.top)/r.y-e.clientTop)}static mousePos(e,r){const l=Te.getScale(e);return Te.getPoint(e,l,r)}static touchPos(e,r){const l=[],d=Te.getScale(e);for(let g=0;g<r.length;g++)l.push(Te.getPoint(e,d,r[g]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const d of l)d.remove();return Te.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const l of r)Te.removeAttributes(l),Te.clean(l)}static removeAttributes(e){for(const{name:r,value:l}of e.attributes)Te.isPossiblyDangerous(r,l)&&e.removeAttribute(r)}}Te.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Te.selectProp=Te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Te.transformProp=Te.testProp(["transform","WebkitTransform"]);const ti={supported:!1,testSupport:function(m){!Ii&&Zi&&(di?Mt(m):kt=m)}};let kt,Zi,Ii=!1,di=!1;function Mt(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Zi),m.isContextLost())return;ti.supported=!0}catch{}m.deleteTexture(e),Ii=!0}var Jt;typeof document<"u"&&(Zi=document.createElement("img"),Zi.onload=()=>{kt&&Mt(kt),kt=null,di=!0},Zi.onerror=()=>{Ii=!0,kt=null},Zi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let e,r,l,d;m.resetRequestQueue=()=>{e=[],r=0,l=0,d={}},m.addThrottleControl=T=>{const E=l++;return d[E]=T,E},m.removeThrottleControl=T=>{delete d[T],y()},m.getImage=(T,E,A=!0)=>new Promise(((I,D)=>{ti.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),h.e(T,{type:"image"}),e.push({abortController:E,requestParameters:T,supportImageRefresh:A,state:"queued",onError:O=>{D(O)},onSuccess:O=>{I(O)}}),y()}));const g=T=>h._(this,void 0,void 0,(function*(){T.state="running";const{requestParameters:E,supportImageRefresh:A,onError:I,onSuccess:D,abortController:O}=T,q=A===!1&&!h.i(self)&&!h.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce(((Q,ee)=>Q&&ee==="accept"),!0));r++;const K=q?w(E,O):h.m(E,O);try{const Q=yield K;delete T.abortController,T.state="completed",Q.data instanceof HTMLImageElement||h.b(Q.data)?D(Q):Q.data&&D({data:yield(W=Q.data,typeof createImageBitmap=="function"?h.f(W):h.h(W)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete T.abortController,I(Q)}finally{r--,y()}var W})),y=()=>{const T=(()=>{for(const E of Object.keys(d))if(d[E]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=r;E<T&&e.length>0;E++){const A=e.shift();A.abortController.signal.aborted?E--:g(A)}},w=(T,E)=>new Promise(((A,I)=>{const D=new Image,O=T.url,q=T.credentials;q&&q==="include"?D.crossOrigin="use-credentials":(q&&q==="same-origin"||!h.d(O))&&(D.crossOrigin="anonymous"),E.signal.addEventListener("abort",(()=>{D.src="",I(h.c())})),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,A({data:D})},D.onerror=()=>{D.onerror=D.onload=null,E.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=O}))})(Jt||(Jt={})),Jt.resetRequestQueue();class vi{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ei(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:l,url:d}of m){const g=`${l}${d}`;r.indexOf(g)===-1&&(r.push(g),e.push({id:l,url:d}))}}return e}function Dt(m,e,r){try{const l=new URL(m);return l.pathname+=`${e}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Pn(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Dn extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let l=!0;const d=r.data||r.spriteData;return this._validateStretch(r.stretchX,d&&d.width)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,d&&d.height)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,r){if(!e)return!0;let l=0;for(const d of e){if(d[0]<l||d[1]<d[0]||r<d[1])return!1;l=d[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const l=r.spriteData,d=l&&l.width||r.data.width,g=l&&l.height||r.data.height;return!(e[0]<0||d<e[0]||e[1]<0||g<e[1]||e[2]<0||d<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,l=!0){const d=this.getImage(e);if(l&&(d.data.width!==r.data.width||d.data.height!==r.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=d.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((r,l)=>{let d=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(d=!1);this.isLoaded()||d?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})}))}_getImagesForIds(e){const r={};for(const l of e){let d=this.getImage(l);d||(this.fire(new h.l("styleimagemissing",{id:l})),d=this.getImage(l)),d?r[l]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],l=this.getImage(e);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const d={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new h.I(d,l);this.patterns[e]={bin:d,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:r,h:l}=h.p(e),d=this.atlasImage;d.resize({width:r||1,height:l||1});for(const g in this.patterns){const{bin:y}=this.patterns[g],w=y.x+1,T=y.y+1,E=this.getImage(g).data,A=E.width,I=E.height;h.R.copy(E,d,{x:0,y:0},{x:w,y:T},{width:A,height:I}),h.R.copy(E,d,{x:0,y:I-1},{x:w,y:T-1},{width:A,height:1}),h.R.copy(E,d,{x:0,y:0},{x:w,y:T+I},{width:A,height:1}),h.R.copy(E,d,{x:A-1,y:0},{x:w-1,y:T},{width:1,height:I}),h.R.copy(E,d,{x:0,y:0},{x:w+A,y:T},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||h.w(`Image with ID: "${r}" was not found`),Pn(l)&&this.updateImage(r,l)}}}const In=1e20;function xi(m,e,r,l,d,g,y,w,T){for(let E=e;E<e+l;E++)Gi(m,r*g+E,g,d,y,w,T);for(let E=r;E<r+d;E++)Gi(m,E*g+e,1,l,y,w,T)}function Gi(m,e,r,l,d,g,y){g[0]=0,y[0]=-In,y[1]=In,d[0]=m[e];for(let w=1,T=0,E=0;w<l;w++){d[w]=m[e+w*r];const A=w*w;do{const I=g[T];E=(d[w]-d[I]+A-I*I)/(w-I)/2}while(E<=y[T]&&--T>-1);T++,g[T]=w,y[T]=E,y[T+1]=In}for(let w=0,T=0;w<l;w++){for(;y[T+1]<w;)T++;const E=g[T],A=w-E;m[e+w*r]=d[E]+A*A}}class da{constructor(e,r,l){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=l}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const r=[];for(const g in e)for(const y of e[g])r.push(this._getAndCacheGlyphsPromise(g,y));const l=yield Promise.all(r),d={};for(const{stack:g,id:y,glyph:w}of l)d[g]||(d[g]={}),d[g][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return d}))}_getAndCacheGlyphsPromise(e,r){return h._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=l.glyphs[r];if(d!==void 0)return{stack:e,id:r,glyph:d};if(d=this._tinySDF(l,e,r),d)return l.glyphs[r]=d,{stack:e,id:r,glyph:d};const g=Math.floor(r/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[g])return{stack:e,id:r,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[g]){const w=da.loadGlyphRange(e,g,this.url,this.requestManager);l.requests[g]=w}const y=yield l.requests[g];for(const w in y)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=y[+w]);return l.ranges[g]=!0,{stack:e,id:r,glyph:y[r]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||h.u["CJK Unified Ideographs"](e)||h.u["Hangul Syllables"](e)||h.u.Hiragana(e)||h.u.Katakana(e)||h.u["CJK Symbols and Punctuation"](e)||h.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,l){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(l))return;let g=e.tinySDF;if(!g){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),g=e.tinySDF=new da.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:d,fontWeight:w})}const y=g.draw(String.fromCharCode(l));return{id:l,bitmap:new h.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}da.loadGlyphRange=function(m,e,r,l){return h._(this,void 0,void 0,(function*(){const d=256*e,g=d+255,y=l.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${d}-${g}`),"Glyphs"),w=yield h.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${g}`);const T={};for(const E of h.o(w.data))T[E.id]=E;return T}))},da.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=r,this.lang=w;const T=this.size=m+4*e,E=this._createCanvas(T),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${g} ${m}px ${d}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(m),y=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),E=w+2*this.buffer,A=T+2*this.buffer,I=Math.max(E*A,0),D=new Uint8ClampedArray(I),O={data:D,width:E,height:A,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return O;const{ctx:q,buffer:K,gridInner:W,gridOuter:Q}=this;this.lang&&(q.lang=this.lang),q.clearRect(K,K,w,T),q.fillText(m,K,K+y);const ee=q.getImageData(K,K,w,T);Q.fill(In,0,I),W.fill(0,0,I);for(let ne=0;ne<T;ne++)for(let ie=0;ie<w;ie++){const ce=ee.data[4*(ne*w+ie)+3]/255;if(ce===0)continue;const de=(ne+K)*E+ie+K;if(ce===1)Q[de]=0,W[de]=In;else{const ae=.5-ce;Q[de]=ae>0?ae*ae:0,W[de]=ae<0?ae*ae:0}}xi(Q,0,0,E,A,E,this.f,this.v,this.z),xi(W,K,K,w,T,E,this.f,this.v,this.z);for(let ne=0;ne<I;ne++){const ie=Math.sqrt(Q[ne])-Math.sqrt(W[ne]);D[ne]=Math.round(255-255*(ie/this.radius+this.cutoff))}return O}};class wa{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,r){return h.B(e.expression.evaluate(r))}interpolate(e,r,l){return{x:h.C.number(e.x,r.x,l),y:h.C.number(e.y,r.y,l),z:h.C.number(e.z,r.z,l)}}}let Rn;class Fe extends h.E{constructor(e){super(),Rn=Rn||new h.r({anchor:new h.D(h.v.light.anchor),position:new wa,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.t(Rn,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(h.x,e,r))for(const l in e){const d=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),d):this._transitionable.setValue(l,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l){return(!l||l.validate!==!1)&&h.y(this,e.call(h.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const st=new h.r({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Ct extends h.E{constructor(e){super(),this._transitionable=new h.t(st,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.F(0))}setSky(e,r={}){if(!this._validate(h.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const d=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),d):this._transitionable.setValue(l,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l={}){return(l==null?void 0:l.validate)!==!1&&h.y(this,e.call(h.z,h.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class _t{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const l=e.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,r)),this.dashEntry[l]}getDashRanges(e,r,l){const d=[];let g=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,w=!0;d.push({left:g,right:y,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let E=1;E<e.length;E++){w=!w;const A=e[E];g=T*l,T+=A,y=T*l,d.push({left:g,right:y,isDash:w,zeroLength:A===0})}return d}addRoundDash(e,r,l){const d=r/2;for(let g=-l;g<=l;g++){const y=this.width*(this.nextRow+l+g);let w=0,T=e[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=e[++w]);const A=Math.abs(E-T.left),I=Math.abs(E-T.right),D=Math.min(A,I);let O;const q=g/l*(d+1);if(T.isDash){const K=d-Math.abs(q);O=Math.sqrt(D*D+K*K)}else O=d-Math.sqrt(D*D+q*q);this.data[y+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],E=e[w+1];T.zeroLength?e.splice(w,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(w,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const d=this.width*this.nextRow;let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const T=Math.abs(w-y.left),E=Math.abs(w-y.right),A=Math.min(T,E);this.data[d+w]=Math.max(0,Math.min(255,(y.isDash?A:-A)+128))}}addDash(e,r){const l=r?7:0,d=2*l+1;if(this.nextRow+d>this.height)return h.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<e.length;w++)g+=e[w];if(g!==0){const w=this.width/g,T=this.getDashRanges(e,this.width,w);r?this.addRoundDash(T,w,l):this.addRegularDash(T)}const y={y:this.nextRow+l,height:2*l,width:g};return this.nextRow+=d,this.dirty=!0,y}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const oi="maplibre_preloaded_worker_pool";class fe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<fe.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[oi]}numActive(){return Object.keys(this.active).length}}const Ge=Math.floor(Ne.hardwareConcurrency/2);let rt,ut;function Et(){return rt||(rt=new fe),rt}fe.workerCount=h.H(globalThis)?Math.max(Math.min(Ge,3),1):1;class At{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let d=0;d<l.length;d++){const g=new h.J(l[d],r);g.name=`Worker ${d}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const l=[];for(const d of this.actors)l.push(d.sendAsync({type:e,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const l of this.actors)l.registerMessageHandler(e,r)}}function Qt(){return ut||(ut=new At(Et(),h.K),ut.registerMessageHandler("GR",((m,e,r)=>h.m(e,r)))),ut}function Ci(m,e){const r=h.L();return h.M(r,r,[1,1,0]),h.N(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?h.O(r,r,m.calculatePosMatrix(e.toUnwrapped())):r}function ui(m,e,r,l,d,g,y){var w;const T=(function(D,O,q){if(D)for(const K of D){const W=O[K];if(W&&W.source===q&&W.type==="fill-extrusion")return!0}else for(const K in O){const W=O[K];if(W.source===q&&W.type==="fill-extrusion")return!0}return!1})((w=d==null?void 0:d.layers)!==null&&w!==void 0?w:null,e,m.id),E=g.maxPitchScaleFactor(),A=m.tilesIn(l,E,T);A.sort(ir);const I=[];for(const D of A)I.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,r,m._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,d,g,E,Ci(m.transform,D.tileID),y?(O,q)=>y(D.tileID,O,q):void 0)});return(function(D,O){for(const q in D)for(const K of D[q])nr(K,O);return D})((function(D){const O={},q={};for(const K of D){const W=K.queryResults,Q=K.wrappedTileID,ee=q[Q]=q[Q]||{};for(const ne in W){const ie=W[ne],ce=ee[ne]=ee[ne]||{},de=O[ne]=O[ne]||[];for(const ae of ie)ce[ae.featureIndex]||(ce[ae.featureIndex]=!0,de.push(ae))}}return O})(I),m)}function ir(m,e){const r=m.tileID,l=e.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function nr(m,e){const r=m.feature,l=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function Qn(m,e,r){return h._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield h.j(e.transformRequest(m.url,"Source"),r)).data:yield Ne.frameAsync(r),!l)return null;const d=h.Q(h.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(d.vectorLayerIds=l.vector_layers.map((g=>g.id))),d}))}class qi{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.S?new h.S(e.lng,e.lat):h.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.S?new h.S(e.lng,e.lat):h.S.convert(e),this}extend(e){const r=this._sw,l=this._ne;let d,g;if(e instanceof h.S)d=e,g=e;else{if(!(e instanceof qi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qi.convert(e)):this.extend(h.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.S.convert(e)):this;if(d=e._sw,g=e._ne,!d||!g)return this}return r||l?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new h.S(d.lng,d.lat),this._ne=new h.S(g.lng,g.lat)),this}getCenter(){return new h.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.S(this.getWest(),this.getNorth())}getSouthEast(){return new h.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=h.S.convert(e);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){return e instanceof qi?e:e&&new qi(e)}static fromLngLat(e,r=0){const l=360*r/40075017,d=l/Math.cos(Math.PI/180*e.lat);return new qi(new h.S(e.lng-d,e.lat-l),new h.S(e.lng+d,e.lat+l))}adjustAntiMeridian(){const e=new h.S(this._sw.lng,this._sw.lat),r=new h.S(this._ne.lng,this._ne.lat);return new qi(e,e.lng>r.lng?new h.S(r.lng+360,r.lat):r)}}class Ri{constructor(e,r,l){this.bounds=qi.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),l=Math.floor(h.V(this.bounds.getWest())*r),d=Math.floor(h.U(this.bounds.getNorth())*r),g=Math.ceil(h.V(this.bounds.getEast())*r),y=Math.ceil(h.U(this.bounds.getSouth())*r);return e.x>=l&&e.x<g&&e.y>=d&&e.y<y}}class Xa extends h.E{constructor(e,r,l,d){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.Q(r,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new Ri(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,y)=>{e.reloadPromise={resolve:g,reject:y}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:d,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ar extends h.E{constructor(e,r,l,d){super(),this.id=e,this.dispatcher=l,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},r),h.e(this,h.Q(r,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(h.e(this,r),r.bounds&&(this.tileBounds=new Ri(r.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(r))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Jt.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const d=this.map.painter.context,g=d.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new h.T(d,y,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class wo extends ar{constructor(e,r,l,d){super(e,r,l,d),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield Jt.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const g=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const y=h.b(g)&&h.W()?g:yield this.readImageNow(g),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.X()){const r=e.width+2,l=e.height+2;try{return new h.R({width:r,height:l},yield h.Y(e,-1,-1,r,l))}catch{}}return Ne.getImageData(e,1)}))}_getNeighboringTiles(e){const r=e.canonical,l=Math.pow(2,r.z),d=(r.x-1+l)%l,g=r.x===0?e.wrap-1:e.wrap,y=(r.x+1+l)%l,w=r.x+1===l?e.wrap+1:e.wrap,T={};return T[new h.Z(e.overscaledZ,g,r.z,d,r.y).key]={backfilled:!1},T[new h.Z(e.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(T[new h.Z(e.overscaledZ,g,r.z,d,r.y-1).key]={backfilled:!1},T[new h.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new h.Z(e.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<l&&(T[new h.Z(e.overscaledZ,g,r.z,d,r.y+1).key]={backfilled:!1},T[new h.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new h.Z(e.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),T}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class xr extends h.E{constructor(e,r,l,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=l.getActor(),this.setEventedParent(d),this._data=r.data,this._options=h.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:h.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:h.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(h.$/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=h.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((r=>r.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return h._(this,void 0,void 0,(function*(){const e=new qi,r=yield this.getData();let l;switch(r.type){case"FeatureCollection":l=r.features.map((d=>this.getCoordinatesFromGeometry(d.geometry))).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(r.geometry);break;default:l=this.getCoordinatesFromGeometry(r)}if(l.length==0)return e;for(let d=0;d<l.length-1;d+=2)e.extend([l[d],l[d+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:l}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:r}=this._pendingWorkerUpdate;if(!e&&!r)return void h.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const l=h.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(l.request=this.map._requestManager.transformRequest(Ne.resolveURL(e),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):r&&(l.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));this._data=d.data;let g=null;d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&h.e(y,{resourceTiming:g}),this.fire(new h.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(d))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return h._(this,void 0,void 0,(function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:r,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,r==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class rr extends h.E{constructor(e,r,l,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=r}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Jt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new h.k(r))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(h.a1.fromLngLat);var l;return this.tileID=(function(d){const g=h.a2.fromPoints(d),y=g.width(),w=g.height(),T=Math.max(y,w),E=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),A=Math.pow(2,E);return new h.a4(E,Math.floor((g.minX+g.maxX)/2*A),Math.floor((g.minY+g.maxY)/2*A))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new h.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:l,maxX:d,maxY:g}=h.a2.fromPoints(e),y={};for(let w=0;w<=h.a3;w++){const T=Math.pow(2,w),E=Math.floor(r*T),A=Math.floor(l*T),I=Math.floor(d*T),D=Math.floor(g*T);y[w]={minTileX:E,minTileY:A,maxTileX:I,maxTileY:D}}return y}}class Us extends rr{constructor(e,r,l,d){super(e,r,l,d),this.roundZoom=!0,this.type="video",this.options=r}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield h.a5(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new h.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new h.k(new h.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Dr extends rr{constructor(e,r,l,d){super(e,r,l,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((y=>typeof y!="number"))))||this.fire(new h.k(new h.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.a6(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new h.k(new h.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(r,this.canvas,l.RGBA,{premultiply:!0});let d=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const js={},Ns=m=>{switch(m){case"geojson":return xr;case"image":return rr;case"raster":return ar;case"raster-dem":return wo;case"vector":return Xa;case"video":return Us;case"canvas":return Dr}return js[m]},Nn="RTLPluginLoaded";class Vs extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ne.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Nn))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let us=null;function hs(){return us||(us=new Vs),us}class ds{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a7(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(d,g){const y={};if(!g)return y;for(const w of d){const T=w.layerIds.map((E=>g.getLayer(E))).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((E=>T.filter((A=>A.id===E))[0])));for(const E of T)y[E.id]=w}}return y})(e.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const g=this.buckets[d];if(g instanceof h.a9){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const g=this.buckets[d];if(g instanceof h.a9&&g.hasRTLText){this.hasRTLText=!0,hs().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const g=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(d).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new h.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const d=this.buckets[l];d.uploadPending()&&d.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,l,d,g,y,w,T,E,A,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:g,scale:y,tileSize:this.tileSize,pixelPosMatrix:A,transform:T,params:w,queryPadding:this.queryPadding*E,getElevation:I},e,r,l):{}}querySourceFeatures(e,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const d=l.loadVTLayers(),g=r&&r.sourceLayer?r.sourceLayer:"",y=d._geojsonTileLayer||d[g];if(!y)return;const w=h.aa(r==null?void 0:r.filter,r==null?void 0:r.globalState),{z:T,x:E,y:A}=this.tileID.canonical,I={z:T,x:E,y:A};for(let D=0;D<y.length;D++){const O=y.feature(D);if(w.needGeometry){const W=h.ab(O,!0);if(!w.filter(new h.F(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!w.filter(new h.F(this.tileID.overscaledZ),O))continue;const q=l.getId(O,g),K=new h.ac(O,T,E,A,q);K.tile=I,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const l=h.ad(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let d=!1;if(this.expirationTime>l)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const g=this.expirationTime-r;g?this.expirationTime=l+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const g=this.buckets[d],y=g.layers[0].sourceLayer||"_geojsonTileLayer",w=l[y],T=e[y];if(!w||!T||Object.keys(T).length===0)continue;g.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const E=r&&r.style&&r.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ne.now()+e}setDependencies(e,r){const l={};for(const d of r)l[d]=!0;this.dependencies[e]=l}hasDependency(e,r){for(const l of e){const d=this.dependencies[l];if(d){for(const g of r)if(d[g])return!0}}return!1}}class ye{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,l){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const g={value:r,timeout:void 0};if(l!==void 0&&(g.timeout=setTimeout((()=>{this.remove(e,g)}),l)),this.data[d].push(g),this.order.push(d),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const l=e.wrapped().key,d=r===void 0?0:this.data[l].indexOf(r),g=this.data[l][d];return this.data[l].splice(d,1),g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(g.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const l in this.data)for(const d of this.data[l])e(d.value)||r.push(d);for(const l of r)this.remove(l.value.tileID,l)}}class Z{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,l){const d=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},h.e(this.stateChanges[e][d],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==d&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const g in this.state[e][d])l[g]||(this.deletedStates[e][d][g]=null)}else for(const g in l)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][g]===null&&delete this.deletedStates[e][d][g]}removeFeatureState(e,r,l){if(this.deletedStates[e]===null)return;const d=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&r!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][l]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(l in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][l]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,r){const l=String(r),d=h.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][r];if(g===null)return{};for(const y in g)delete d[y]}return d}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const l={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const g={};for(const y in this.stateChanges[d])this.state[d][y]||(this.state[d][y]={}),h.e(this.state[d][y],this.stateChanges[d][y]),g[y]=this.state[d][y];l[d]=g}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const g={};if(this.deletedStates[d]===null)for(const y in this.state[d])g[y]={},this.state[d][y]={};else for(const y in this.deletedStates[d]){if(this.deletedStates[d][y]===null)this.state[d][y]={};else for(const w of Object.keys(this.deletedStates[d][y]))delete this.state[d][y][w];g[y]=this.state[d][y]}l[d]=l[d]||{},h.e(l[d],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const d in e)e[d].setFeatureState(l,r)}}const G=89.25;function X(m,e){const r=h.ah(e.lat,-h.ai,h.ai);return new h.P(h.V(e.lng)*m,h.U(r)*m)}function re(m,e){return new h.a1(e.x/m,e.y/m).toLngLat()}function le(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(h.ae(90-m.pitch)),Math.tan(h.ae(G-m.pitch)))}function ge(m,e){const r=m.canonical,l=e/h.af(r.z),d=r.x+Math.pow(2,r.z)*m.wrap,g=h.ag(new Float64Array(16));return h.M(g,g,[d*l,r.y*l,0]),h.N(g,g,[l/h.$,l/h.$,1]),g}function Se(m,e,r,l,d){const g=h.a1.fromLngLat(m,e),y=d*h.aj(1,m.lat),w=y*Math.cos(h.ae(r)),T=Math.sqrt(y*y-w*w),E=T*Math.sin(h.ae(-l)),A=T*Math.cos(h.ae(-l));return new h.a1(g.x+E,g.y+A,g.z+w)}function we(m,e,r){const l=e.intersectsFrustum(m);if(!r||l===0)return l;const d=e.intersectsPlane(r);return d===0?0:l===2&&d===2?2:1}function Be(m,e,r){let l=0;const d=(r-e)/10;for(let g=0;g<10;g++)l+=d*Math.pow(Math.cos(e+(g+.5)/10*(r-e)),m);return l}function Ke(m,e){return function(r,l,d,g,y){const w=2*((m-1)/h.ak(Math.cos(h.ae(G-y))/Math.cos(h.ae(G)))-1),T=Math.acos(d/g),E=2*Be(w-1,0,h.ae(y/2)),A=Math.min(h.ae(G),T+h.ae(y/2)),I=Be(w-1,Math.min(A,T-h.ae(y/2)),A),D=Math.atan(l/d),O=Math.hypot(l,d);let q=r;return q+=h.ak(g/O/Math.max(.5,Math.cos(h.ae(y/2)))),q+=w*h.ak(Math.cos(D))/2,q-=h.ak(Math.max(1,I/E/e))/2,q}}const Ue=Ke(9.314,3);function ct(m,e){const r=(e.roundZoom?Math.round:Math.floor)(m.zoom+h.ak(m.tileSize/e.tileSize));return Math.max(0,r)}function be(m,e){const r=m.getCameraFrustum(),l=m.getClippingPlane(),d=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=h.a1.fromLngLat(m.center,m.elevation);d.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const y=m.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(m,e),T=ct(m,e),E=e.minzoom||0,A=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,I=Math.min(Math.max(0,T),A),D=Math.pow(2,I),O=[D*d.x,D*d.y,0],q=[D*g.x,D*g.y,0],K=Math.hypot(g.x-d.x,g.y-d.y),W=Math.abs(g.z-d.z),Q=Math.hypot(K,W),ee=ce=>({zoom:0,x:0,y:0,wrap:ce,fullyVisible:!1}),ne=[],ie=[];if(m.renderWorldCopies&&y.allowWorldCopies())for(let ce=1;ce<=3;ce++)ne.push(ee(-ce)),ne.push(ee(ce));for(ne.push(ee(0));ne.length>0;){const ce=ne.pop(),de=ce.x,ae=ce.y;let me=ce.fullyVisible;const ze={x:de,y:ae,z:ce.zoom},Ee=y.getTileBoundingVolume(ze,ce.wrap,m.elevation,e);if(!me){const Qe=we(r,Ee,l);if(Qe===0)continue;me=Qe===2}const Ae=y.distanceToTile2d(d.x,d.y,ze,Ee);let Pe=T;w&&(Pe=(e.calculateTileZoom||Ue)(m.zoom+h.ak(m.tileSize/e.tileSize),Ae,W,Q,m.fov)),Pe=(e.roundZoom?Math.round:Math.floor)(Pe),Pe=Math.max(0,Pe);const Je=Math.min(Pe,A);if(ce.wrap=y.getWrap(g,ze,ce.wrap),ce.zoom>=Je){if(ce.zoom<E)continue;const Qe=I-ce.zoom,qe=O[0]-.5-(de<<Qe),lt=O[1]-.5-(ae<<Qe),Ot=e.reparseOverscaled?Math.max(ce.zoom,Pe):ce.zoom;ie.push({tileID:new h.Z(ce.zoom===A?Ot:ce.zoom,ce.wrap,ce.zoom,de,ae),distanceSq:h.al([q[0]-.5-de,q[1]-.5-ae]),tileDistanceToCamera:Math.sqrt(qe*qe+lt*lt)})}else for(let Qe=0;Qe<4;Qe++)ne.push({zoom:ce.zoom+1,x:(de<<1)+Qe%2,y:(ae<<1)+(Qe>>1),wrap:ce.wrap,fullyVisible:me})}return ie.sort(((ce,de)=>ce.distanceSq-de.distanceSq)).map((ce=>ce.tileID))}const Tt=h.a2.fromPoints([new h.P(0,0),new h.P(h.$,h.$)]);class Zt extends h.E{constructor(e,r,l){super(),this.id=e,this.dispatcher=l,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,g,y,w)=>{const T=new(Ns(g.type))(d,g,y,w);if(T.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${T.id}`);return T})(e,r,l,this),this._tiles={},this._cache=new ye(0,(d=>this._unloadTile(d))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Z,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,l){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,l)}catch(d){e.state="errored",d.status!==404?this._source.fire(new h.k(d,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(pt).map((e=>e.key))}getRenderableIds(e){const r=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&r.push(this._tiles[l]);return e?r.sort(((l,d)=>{const g=l.tileID,y=d.tileID,w=new h.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),T=new h.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x})).map((l=>l.tileID.key)):r.map((l=>l.tileID)).sort(pt).map((l=>l.key))}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return h._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,e,r))}))}_tileLoaded(e,r,l){e.timeAdded=Ne.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let d=0;d<r.length;d++){const g=r[d];if(e.neighboringTiles&&e.neighboringTiles[g]){const y=this.getTileByID(g);l(e,y),l(y,e)}}function l(d,g){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let y=g.tileID.canonical.x-d.tileID.canonical.x;const w=g.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),E=g.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),g.dem&&d.dem&&(d.dem.backfillBorder(g.dem,y,w),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r){const l=Object.values(e),d=this._getLoadedDescendents(l),g={};for(const y of l){const w=d[y.key];if(!(w!=null&&w.length)){g[y.key]=y;continue}const T=y.overscaledZ+Zt.maxUnderzooming,E=w.filter((D=>D.tileID.overscaledZ<=T));if(!E.length){g[y.key]=y;continue}const A=Math.min(...E.map((D=>D.tileID.overscaledZ))),I=E.filter((D=>D.tileID.overscaledZ===A)).map((D=>D.tileID));for(const D of I)r[D.key]=D;this._areDescendentsComplete(I,A,y.overscaledZ)||(g[y.key]=y)}return g}_getLoadedDescendents(e){var r;const l={};for(const d in this._tiles){const g=this._tiles[d];if(g.hasData())for(const y of e)g.tileID.isChildOf(y)&&(l[r=y.key]||(l[r]=[])).push(g)}return l}_areDescendentsComplete(e,r,l){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===r:Math.pow(4,r-l)===e.length}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=r?l:null}for(let l=e.overscaledZ-1;l>=r;l--){const d=e.scaledTo(l),g=this._getLoadedTile(d);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const l={};for(const d in this._tiles){const g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),l[g.tileID.key]=g}this._tiles=l;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(e,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new h.Z(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(l=be(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((E=>this._source.hasTile(E))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const d=ct(e,this._source),g=Math.max(d-Zt.maxOverzooming,this._source.minzoom),y=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const w=this._updateRetainedTiles(l,d);Ut(this._source.type)&&!r&&this._updateFadingTiles(w,g);for(const E in w)this._tiles[E].clearFadeHold();const T=h.am(this._tiles,w);for(const E of T){const A=this._tiles[E];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}_addTerrainIdealTiles(e){const r=[];for(const l of e)if(l.canonical.z>this._source.minzoom){const d=l.scaledTo(l.canonical.z-1);r.push(d);const g=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));r.push(g)}return e.concat(r)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var l;const d={},g={},y=Math.max(r-Zt.maxOverzooming,this._source.minzoom);let w={};for(const T of e){const E=this._addTile(T);d[T.key]=T,E.hasData()||(w[T.key]=T)}w=this._retainLoadedChildren(w,d);for(const T in w){const E=w[T];let A=this._tiles[T],I=A==null?void 0:A.wasRequested();for(let D=E.overscaledZ-1;D>=y;--D){const O=E.scaledTo(D);if(g[O.key])break;if(g[O.key]=!0,A=this.getTile(O),!A&&I&&(A=this._addTile(O)),A){const q=A.hasData();if((q||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||I)&&(d[O.key]=O),I=A.wasRequested(),q)break}}}return d}_updateFadingTiles(e,r){const l={},d={},g=Object.keys(e),y=Ne.now();for(const w of g){const T=e[w],E=this._tiles[w];if(!E||E.fadeEndTime!==0&&E.fadeEndTime<=y)continue;const A=this.findLoadedParent(T,r),I=this.findLoadedSibling(T),D=A||I||null;D&&(this._addTile(D.tileID),l[D.tileID.key]=D.tileID),d[w]=T}this._retainLoadedChildren(d,e);for(const w in l)e[w]||(this._coveredTiles[w]=!0,e[w]=l[w])}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let l,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){l=this._loadedParentTiles[d.key];break}r.push(d.key);const g=d.scaledTo(d.overscaledZ-1);if(l=this._getLoadedTile(g),l)break;d=g}for(const g of r)this._loadedParentTiles[g]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,l=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=l}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const l=r;return r||(r=new ds(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,l||this._source.fire(new h.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=r.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some((l=>l.equals(this._tiles[r].tileID.canonical)))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,l){const d=[],g=this.transform;if(!g)return d;const y=g.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?g.getCameraQueryGeometry(e):e,T=O=>g.screenPointToMercatorCoordinate(O,this.terrain),E=this.transformBbox(e,T,!y),A=this.transformBbox(w,T,!y),I=this.getIds(),D=h.a2.fromPoints(A);for(let O=0;O<I.length;O++){const q=this._tiles[I[O]];if(q.holdingForFade())continue;const K=y?[q.tileID]:[q.tileID.unwrapTo(-1),q.tileID.unwrapTo(0)],W=Math.pow(2,g.zoom-q.tileID.overscaledZ),Q=r*q.queryPadding*h.$/q.tileSize/W;for(const ee of K){const ne=D.map((ie=>ee.getTilePoint(new h.a1(ie.x,ie.y))));if(ne.expandBy(Q),ne.intersects(Tt)){const ie=E.map((de=>ee.getTilePoint(de))),ce=A.map((de=>ee.getTilePoint(de)));d.push({tile:q,tileID:y?ee:ee.unwrapTo(0),queryGeometry:ie,cameraQueryGeometry:ce,scale:W})}}}return d}transformBbox(e,r,l){let d=e.map(r);if(l){const g=h.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const y=g.map(r);h.a2.fromPoints(d).covers(y)||(d=d.map((w=>w.x>.5?new h.a1(w.x-1,w.y,w.z):w)))}return d}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Ut(this._source.type)){const e=Ne.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,l){this._state.updateState(e=e||"_geojsonTileLayer",r,l)}removeFeatureState(e,r,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,l)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,l){const d=this._tiles[e];d&&d.setDependencies(r,l)}reloadTilesForDependencies(e,r){for(const l in this._tiles)this._tiles[l].hasDependency(e,r)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,r)))}}function pt(m,e){const r=Math.abs(2*m.wrap)-+(m.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||l-r||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function Ut(m){return m==="raster"||m==="image"||m==="video"}Zt.maxOverzooming=10,Zt.maxUnderzooming=3;class Li{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ah(e,0,1);let r=1,l=this._distances[r];const d=e*this.paddedLength+this.padding;for(;l<d&&r<this._distances.length;)l=this._distances[++r];const g=r-1,y=this._distances[g],w=l-y,T=w>0?(d-y)/w:0;return this.points[g].mult(1-T).add(this.points[r].mult(T))}}function sn(m,e){let r=!0;return m==="always"||m!=="never"&&e!=="never"||(r=!1),r}class on{constructor(e,r,l){const d=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(r/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)d.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,l,d,g){this._forEachCell(r,l,d,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g)}insertCircle(e,r,l,d){this._forEachCell(r-d,l-d,r+d,l+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(l),this.circles.push(d)}_insertBoxCell(e,r,l,d,g,y){this.boxCells[g].push(y)}_insertCircleCell(e,r,l,d,g,y){this.circleCells[g].push(y)}_query(e,r,l,d,g,y,w){if(l<0||e>this.width||d<0||r>this.height)return[];const T=[];if(e<=0&&r<=0&&this.width<=l&&this.height<=d){if(g)return[{key:null,x1:e,y1:r,x2:l,y2:d}];for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const A=this.circles[3*E],I=this.circles[3*E+1],D=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:A-D,y1:I-D,x2:A+D,y2:I+D})}}else this._forEachCell(e,r,l,d,this._queryCell,T,{hitTest:g,overlapMode:y,seenUids:{box:{},circle:{}}},w);return T}query(e,r,l,d){return this._query(e,r,l,d,!1,null)}hitTest(e,r,l,d,g,y){return this._query(e,r,l,d,!0,g,y).length>0}hitTestCircle(e,r,l,d,g){const y=e-l,w=e+l,T=r-l,E=r+l;if(w<0||y>this.width||E<0||T>this.height)return!1;const A=[];return this._forEachCell(y,T,w,E,this._queryCellCircle,A,{hitTest:!0,overlapMode:d,circle:{x:e,y:r,radius:l},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(e,r,l,d,g,y,w,T){const{seenUids:E,hitTest:A,overlapMode:I}=w,D=this.boxCells[g];if(D!==null){const q=this.bboxes;for(const K of D)if(!E.box[K]){E.box[K]=!0;const W=4*K,Q=this.boxKeys[K];if(e<=q[W+2]&&r<=q[W+3]&&l>=q[W+0]&&d>=q[W+1]&&(!T||T(Q))&&(!A||!sn(I,Q.overlapMode))&&(y.push({key:Q,x1:q[W],y1:q[W+1],x2:q[W+2],y2:q[W+3]}),A))return!0}}const O=this.circleCells[g];if(O!==null){const q=this.circles;for(const K of O)if(!E.circle[K]){E.circle[K]=!0;const W=3*K,Q=this.circleKeys[K];if(this._circleAndRectCollide(q[W],q[W+1],q[W+2],e,r,l,d)&&(!T||T(Q))&&(!A||!sn(I,Q.overlapMode))){const ee=q[W],ne=q[W+1],ie=q[W+2];if(y.push({key:Q,x1:ee-ie,y1:ne-ie,x2:ee+ie,y2:ne+ie}),A)return!0}}}return!1}_queryCellCircle(e,r,l,d,g,y,w,T){const{circle:E,seenUids:A,overlapMode:I}=w,D=this.boxCells[g];if(D!==null){const q=this.bboxes;for(const K of D)if(!A.box[K]){A.box[K]=!0;const W=4*K,Q=this.boxKeys[K];if(this._circleAndRectCollide(E.x,E.y,E.radius,q[W+0],q[W+1],q[W+2],q[W+3])&&(!T||T(Q))&&!sn(I,Q.overlapMode))return y.push(!0),!0}}const O=this.circleCells[g];if(O!==null){const q=this.circles;for(const K of O)if(!A.circle[K]){A.circle[K]=!0;const W=3*K,Q=this.circleKeys[K];if(this._circlesCollide(q[W],q[W+1],q[W+2],E.x,E.y,E.radius)&&(!T||T(Q))&&!sn(I,Q.overlapMode))return y.push(!0),!0}}}_forEachCell(e,r,l,d,g,y,w,T){const E=this._convertToXCellCoord(e),A=this._convertToYCellCoord(r),I=this._convertToXCellCoord(l),D=this._convertToYCellCoord(d);for(let O=E;O<=I;O++)for(let q=A;q<=D;q++)if(g.call(this,e,r,l,d,this.xCellCount*q+O,y,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,l,d,g,y){const w=d-e,T=g-r,E=l+y;return E*E>w*w+T*T}_circleAndRectCollide(e,r,l,d,g,y,w){const T=(y-d)/2,E=Math.abs(e-(d+T));if(E>T+l)return!1;const A=(w-g)/2,I=Math.abs(r-(g+A));if(I>A+l)return!1;if(E<=T||I<=A)return!0;const D=E-T,O=I-A;return D*D+O*O<=l*l}}function Vn(m,e,r){const l=h.L();if(!m){const{vecSouth:I,vecEast:D}=ki(e),O=_e();O[0]=D[0],O[1]=D[1],O[2]=I[0],O[3]=I[1],d=O,(A=(y=(g=O)[0])*(E=g[3])-(T=g[2])*(w=g[1]))&&(d[0]=E*(A=1/A),d[1]=-w*A,d[2]=-T*A,d[3]=y*A),l[0]=O[0],l[1]=O[1],l[4]=O[2],l[5]=O[3]}var d,g,y,w,T,E,A;return h.N(l,l,[1/r,1/r,1]),l}function Ln(m,e,r,l){if(m){const d=h.L();if(!e){const{vecSouth:g,vecEast:y}=ki(r);d[0]=y[0],d[1]=y[1],d[4]=g[0],d[5]=g[1]}return h.N(d,d,[l,l,1]),d}return r.pixelsToClipSpaceMatrix}function ki(m){const e=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),d=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),y=h.ar();y[0]=-d*l*r-g*e,y[1]=-g*l*r+d*e;const w=h.as(y);w<1e-9?h.at(y):h.au(y,y,1/w);const T=h.ar();T[0]=d*l*e-g*r,T[1]=g*l*e+d*r;const E=h.as(T);return E<1e-9?h.at(T):h.au(T,T,1/E),{vecEast:T,vecSouth:y}}function mn(m,e,r,l){let d;l?(d=[m,e,l(m,e),1],h.aw(d,d,r)):(d=[m,e,0,1],Rr(d,d,r));const g=d[3];return{point:new h.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Ve(m,e){return .5+m/e*.5}function ln(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Ia(m,e,r,l,d,g,y,w,T,E,A,I,D){const O=r?m.textSizeData:m.iconSizeData,q=h.an(O,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],W=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();const Q=m.lineVertexArray,ee=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,ne=e.transform.width/e.transform.height;let ie=!1;for(let ce=0;ce<ee.length;ce++){const de=ee.get(ce);if(de.hidden||de.writingMode===h.ao.vertical&&!ie){Ta(de.numGlyphs,W);continue}ie=!1;const ae=new h.P(de.anchorX,de.anchorY),me={getElevation:D,pitchedLabelPlaneMatrix:l,lineVertexArray:Q,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ae,unwrappedTileID:T,width:E,height:A,translation:I},ze=Gs(de.anchorX,de.anchorY,me);if(!ln(ze.point,K)){Ta(de.numGlyphs,W);continue}const Ee=Ve(e.transform.cameraToCenterDistance,ze.signedDistanceFromCamera),Ae=h.ap(O,q,de),Pe=g?Ae*e.transform.getPitchedTextCorrection(de.anchorX,de.anchorY,T)/Ee:Ae*Ee,Je=Xe({projectionContext:me,pitchedLabelPlaneMatrixInverse:d,symbol:de,fontSize:Pe,flip:!1,keepUpright:y,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:w});ie=Je.useVertical,(Je.notEnoughRoom||ie||Je.needsFlipping&&Xe({projectionContext:me,pitchedLabelPlaneMatrixInverse:d,symbol:de,fontSize:Pe,flip:!0,keepUpright:y,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:w}).notEnoughRoom)&&Ta(de.numGlyphs,W)}r?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function Zs(m,e,r,l,d,g,y,w){const T=g.glyphStartIndex+g.numGlyphs,E=g.lineStartIndex,A=g.lineStartIndex+g.lineLength,I=e.getoffsetX(g.glyphStartIndex),D=e.getoffsetX(T-1),O=Ir(m*I,r,l,d,g.segment,E,A,w,y);if(!O)return null;const q=Ir(m*D,r,l,d,g.segment,E,A,w,y);return q?w.projectionCache.anyProjectionOccluded?null:{first:O,last:q}:null}function cn(m,e,r,l){return m===h.ao.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*l?{useVertical:!0}:(m===h.ao.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function Xe(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:d,flip:g,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:T,aspectRatio:E,rotateToLine:A}=m,I=d/24,D=l.lineOffsetX*I,O=l.lineOffsetY*I;let q;if(l.numGlyphs>1){const K=l.glyphStartIndex+l.numGlyphs,W=l.lineStartIndex,Q=l.lineStartIndex+l.lineLength,ee=Zs(I,w,D,O,g,l,A,e);if(!ee)return{notEnoughRoom:!0};const ne=To(ee.first.point.x,ee.first.point.y,e,r),ie=To(ee.last.point.x,ee.last.point.y,e,r);if(y&&!g){const ce=cn(l.writingMode,ne,ie,E);if(ce)return ce}q=[ee.first];for(let ce=l.glyphStartIndex+1;ce<K-1;ce++){const de=Ir(I*w.getoffsetX(ce),D,O,g,l.segment,W,Q,e,A);if(!de)return{notEnoughRoom:!0};q.push(de)}q.push(ee.last)}else{if(y&&!g){const W=Zn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Q=l.lineStartIndex+l.segment+1,ee=new h.P(e.lineVertexArray.getx(Q),e.lineVertexArray.gety(Q)),ne=Zn(ee.x,ee.y,e),ie=ne.signedDistanceFromCamera>0?ne.point:bt(e.tileAnchorPoint,ee,W,1,e),ce=To(W.x,W.y,e,r),de=To(ie.x,ie.y,e,r),ae=cn(l.writingMode,ce,de,E);if(ae)return ae}const K=Ir(I*w.getoffsetX(l.glyphStartIndex),D,O,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,A);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};q=[K]}for(const K of q)h.av(T,K.point,K.angle);return{}}function bt(m,e,r,l,d){const g=m.add(m.sub(e)._unit()),y=Zn(g.x,g.y,d).point,w=r.sub(y);return r.add(w._mult(l/w.mag()))}function Rt(m,e,r){const l=e.projectionCache;if(l.projections[m])return l.projections[m];const d=new h.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=Zn(d.x,d.y,e);if(g.signedDistanceFromCamera>0)return l.projections[m]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const y=m-r.direction;return bt(r.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),d,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Zn(m,e,r){const l=m+r.translation[0],d=e+r.translation[1];let g;return r.pitchWithMap?(g=mn(l,d,r.pitchedLabelPlaneMatrix,r.getElevation),g.isOccluded=!1):(g=r.transform.projectTileCoordinates(l,d,r.unwrappedTileID,r.getElevation),g.point.x=(.5*g.point.x+.5)*r.width,g.point.y=(.5*-g.point.y+.5)*r.height),g}function To(m,e,r,l){if(r.pitchWithMap){const d=[m,e,0,1];return h.aw(d,d,l),r.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:1-e/r.height*2}}function Gs(m,e,r){return r.transform.projectTileCoordinates(m,e,r.unwrappedTileID,r.getElevation)}function Bt(m,e,r){return m._unit()._perp()._mult(e*r)}function qs(m,e,r,l,d,g,y,w,T){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];const E=r.add(e);if(m+T.direction<l||m+T.direction>=d)return w.projectionCache.offsets[m]=E,E;const A=Rt(m+T.direction,w,T),I=Bt(A.sub(r),y,T.direction),D=r.add(I),O=A.add(I);return w.projectionCache.offsets[m]=h.ax(g,E,D,O)||E,w.projectionCache.offsets[m]}function Ir(m,e,r,l,d,g,y,w,T){const E=l?m-e:m+e;let A=E>0?1:-1,I=0;l&&(A*=-1,I=Math.PI),A<0&&(I+=Math.PI);let D,O=A>0?g+d:g+d+1;w.projectionCache.cachedAnchorPoint?D=w.projectionCache.cachedAnchorPoint:(D=Zn(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=D);let q,K,W=D,Q=D,ee=0,ne=0;const ie=Math.abs(E),ce=[];let de;for(;ee+ne<=ie;){if(O+=A,O<g||O>=y)return null;ee+=ne,Q=W,K=q;const ze={absOffsetX:ie,direction:A,distanceFromAnchor:ee,previousVertex:Q};if(W=Rt(O,w,ze),r===0)ce.push(Q),de=W.sub(Q);else{let Ee;const Ae=W.sub(Q);Ee=Ae.mag()===0?Bt(Rt(O+A,w,ze).sub(W),r,A):Bt(Ae,r,A),K||(K=Q.add(Ee)),q=qs(O,Ee,W,g,y,K,r,w,ze),ce.push(K),de=q.sub(K)}ne=de.mag()}const ae=de._mult((ie-ee)/ne)._add(K||Q),me=I+Math.atan2(W.y-Q.y,W.x-Q.x);return ce.push(ae),{point:ae,angle:T?me:0,path:ce}}const fs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ta(m,e){for(let r=0;r<m;r++){const l=e.length;e.resize(l+4),e.float32.set(fs,3*l)}}function Rr(m,e,r){const l=e[0],d=e[1];return m[0]=r[0]*l+r[4]*d+r[12],m[1]=r[1]*l+r[5]*d+r[13],m[3]=r[3]*l+r[7]*d+r[15],m}const Bi=100;class vn{constructor(e,r=new on(e.width+200,e.height+200,25),l=new on(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Bi,this.screenBottomBoundary=e.height+Bi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,l,d,g,y,w,T,E,A,I,D){const O=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],g,A,D),q=l*O.perspectiveRatio;let K;if(y||w)K=this._projectCollisionBox(e,q,d,g,y,w,T,O,A,I,D);else{const de=O.x+(I?I.x*q:0),ae=O.y+(I?I.y*q:0);K={allPointsOccluded:!1,box:[de+e.x1*q,ae+e.y1*q,de+e.x2*q,ae+e.y2*q]}}const[W,Q,ee,ne]=K.box,ie=y?K.allPointsOccluded:O.isOccluded;let ce=ie;return ce||(ce=O.perspectiveRatio<this.perspectiveRatioCutoff),ce||(ce=!this.isInsideGrid(W,Q,ee,ne)),ce||r!=="always"&&this.grid.hitTest(W,Q,ee,ne,r,E)?{box:[W,Q,ee,ne],placeable:!1,offscreen:!1,occluded:ie}:{box:[W,Q,ee,ne],placeable:!0,offscreen:this.isOffscreen(W,Q,ee,ne),occluded:ie}}placeCollisionCircles(e,r,l,d,g,y,w,T,E,A,I,D,O,q){const K=[],W=new h.P(r.anchorX,r.anchorY),Q=this.getPerspectiveRatio(W.x,W.y,y,q),ee=(E?g*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,y)/Q:g*Q)/h.aB,ne={getElevation:q,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:O},ie=Zs(ee,d,r.lineOffsetX*ee,r.lineOffsetY*ee,!1,r,!1,ne);let ce=!1,de=!1,ae=!0;if(ie){const me=.5*I*Q+D,ze=new h.P(-100,-100),Ee=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Ae=new Li,Pe=ie.first,Je=ie.last;let Qe=[];for(let Ot=Pe.path.length-1;Ot>=1;Ot--)Qe.push(Pe.path[Ot]);for(let Ot=1;Ot<Je.path.length;Ot++)Qe.push(Je.path[Ot]);const qe=2.5*me;if(E){const Ot=this.projectPathToScreenSpace(Qe,ne);Qe=Ot.some((fi=>fi.signedDistanceFromCamera<=0))?[]:Ot.map((fi=>fi.point))}let lt=[];if(Qe.length>0){const Ot=Qe[0].clone(),fi=Qe[0].clone();for(let Ui=1;Ui<Qe.length;Ui++)Ot.x=Math.min(Ot.x,Qe[Ui].x),Ot.y=Math.min(Ot.y,Qe[Ui].y),fi.x=Math.max(fi.x,Qe[Ui].x),fi.y=Math.max(fi.y,Qe[Ui].y);lt=Ot.x>=ze.x&&fi.x<=Ee.x&&Ot.y>=ze.y&&fi.y<=Ee.y?[Qe]:fi.x<ze.x||Ot.x>Ee.x||fi.y<ze.y||Ot.y>Ee.y?[]:h.ay([Qe],ze.x,ze.y,Ee.x,Ee.y)}for(const Ot of lt){Ae.reset(Ot,.25*me);let fi=0;fi=Ae.length<=.5*me?1:Math.ceil(Ae.paddedLength/qe)+1;for(let Ui=0;Ui<fi;Ui++){const Di=Ui/Math.max(fi-1,1),Hi=Ae.lerp(Di),ji=Hi.x+Bi,Fn=Hi.y+Bi;K.push(ji,Fn,me,0);const $i=ji-me,Si=Fn-me,Ai=ji+me,qt=Fn+me;if(ae=ae&&this.isOffscreen($i,Si,Ai,qt),de=de||this.isInsideGrid($i,Si,Ai,qt),e!=="always"&&this.grid.hitTestCircle(ji,Fn,me,e,A)&&(ce=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ce}}}}return{circles:!T&&ce||!de||Q<this.perspectiveRatioCutoff?[]:K,offscreen:ae,collisionDetected:ce}}projectPathToScreenSpace(e,r){const l=(function(d,g){const y=h.L();return h.aq(y,g.pitchedLabelPlaneMatrix),d.map((w=>{const T=mn(w.x,w.y,y,g.getElevation),E=g.transform.projectTileCoordinates(T.point.x,T.point.y,g.unwrappedTileID,g.getElevation);return E.point.x=(.5*E.point.x+.5)*g.width,E.point.y=(.5*-E.point.y+.5)*g.height,E}))})(e,r);return(function(d){let g=0,y=0,w=0,T=0;for(let E=0;E<d.length;E++)d[E].isOccluded?(w=E+1,T=0):(T++,T>y&&(y=T,g=w));return d.slice(g,g+y)})(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new h.a2;for(const I of e){const D=new h.P(I.x+Bi,I.y+Bi);l.extend(D),r.push(D)}const{minX:d,minY:g,maxX:y,maxY:w}=l,T=this.grid.query(d,g,y,w).concat(this.ignoredGrid.query(d,g,y,w)),E={},A={};for(const I of T){const D=I.key;if(E[D.bucketInstanceId]===void 0&&(E[D.bucketInstanceId]={}),E[D.bucketInstanceId][D.featureIndex])continue;const O=[new h.P(I.x1,I.y1),new h.P(I.x2,I.y1),new h.P(I.x2,I.y2),new h.P(I.x1,I.y2)];h.az(r,O)&&(E[D.bucketInstanceId][D.featureIndex]=!0,A[D.bucketInstanceId]===void 0&&(A[D.bucketInstanceId]=[]),A[D.bucketInstanceId].push(D.featureIndex))}return A}insertCollisionBox(e,r,l,d,g,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:y,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,l,d,g,y){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:g,collisionGroupID:y,overlapMode:r};for(let E=0;E<e.length;E+=4)w.insertCircle(T,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,r,l,d,g){if(g){let y;d?(y=[e,r,d(e,r),1],h.aw(y,y,g)):(y=[e,r,0,1],Rr(y,y,g));const w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+Bi,y:(-y[1]/w+1)/2*this.transform.height+Bi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const y=this.transform.projectTileCoordinates(e,r,l,d);return{x:(y.point.x+1)/2*this.transform.width+Bi,y:(1-y.point.y)/2*this.transform.height+Bi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,l,d){const g=this.transform.projectTileCoordinates(e,r,l,d);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,r,l,d){return l<Bi||e>=this.screenRightBoundary||d<Bi||r>this.screenBottomBoundary}isInsideGrid(e,r,l,d){return l>=0&&e<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=h.ag([]);return h.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,l,d,g,y,w,T,E,A,I){let D=1,O=0,q=0,K=1;const W=e.anchorPointX+w[0],Q=e.anchorPointY+w[1];if(y&&!g){const Qe=this.projectAndGetPerspectiveRatio(W+1,Q,d,E,I),qe=Qe.x-T.x,lt=Math.atan((Qe.y-T.y)/qe)+(qe<0?Math.PI:0),Ot=Math.sin(lt),fi=Math.cos(lt);D=fi,O=Ot,q=-Ot,K=fi}else if(!y&&g){const Qe=ki(this.transform);D=Qe.vecEast[0],O=Qe.vecEast[1],q=Qe.vecSouth[0],K=Qe.vecSouth[1]}let ee=T.x,ne=T.y,ie=r;g&&(ee=W,ne=Q,ie=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),ie*=this.transform.getPitchedTextCorrection(W,Q,d),A||(ie*=h.ah(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),A&&(ee+=D*A.x*ie+q*A.y*ie,ne+=O*A.x*ie+K*A.y*ie);const ce=e.x1*ie,de=e.x2*ie,ae=(ce+de)/2,me=e.y1*ie,ze=e.y2*ie,Ee=(me+ze)/2,Ae=[{offsetX:ce,offsetY:me},{offsetX:ae,offsetY:me},{offsetX:de,offsetY:me},{offsetX:de,offsetY:Ee},{offsetX:de,offsetY:ze},{offsetX:ae,offsetY:ze},{offsetX:ce,offsetY:ze},{offsetX:ce,offsetY:Ee}];let Pe=[];for(const{offsetX:Qe,offsetY:qe}of Ae)Pe.push(new h.P(ee+D*Qe+q*qe,ne+O*Qe+K*qe));let Je=!1;if(g){const Qe=Pe.map((qe=>this.projectAndGetPerspectiveRatio(qe.x,qe.y,d,E,I)));Je=Qe.some((qe=>!qe.isOccluded)),Pe=Qe.map((qe=>new h.P(qe.x,qe.y)))}else Je=!0;return{box:h.aA(Pe),allPointsOccluded:!Je}}}class Sa{constructor(e,r,l,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):d&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Ei{constructor(e,r,l,d,g){this.text=new Sa(e?e.text:null,r,l,g),this.icon=new Sa(e?e.icon:null,r,d,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hs{constructor(e,r,l){this.text=e,this.icon=r,this.skipFade=l}}class Lr{constructor(e,r,l,d,g){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=d,this.tileID=g}}class wu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[e]}}function ps(m,e,r,l,d){const{horizontalAlign:g,verticalAlign:y}=h.aH(m);return new h.P(-(g-.5)*e+l[0]*d,-(y-.5)*r+l[1]*d)}class ms{constructor(e,r,l,d,g){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new vn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new wu(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(l,d)=>r.getElevation(e,l,d):null}getBucketParts(e,r,l,d){const g=l.getBucket(r),y=l.latestFeatureIndex;if(!g||!y||r.id!==g.layerIds[0])return;const w=l.collisionBoxArray,T=g.layers[0].layout,E=g.layers[0].paint,A=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),I=l.tileSize/h.$,D=l.tileID.toUnwrapped(),O=T.get("text-rotation-alignment")==="map",q=h.aC(l,1,this.transform.zoom),K=h.aD(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),W=h.aD(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),Q=Vn(O,this.transform,q);this.retainedQueryData[g.bucketInstanceId]=new Lr(g.bucketInstanceId,y,g.sourceLayerIndex,g.index,l.tileID);const ee={bucket:g,layout:T,translationText:K,translationIcon:W,unwrappedTileID:D,pitchedLabelPlaneMatrix:Q,scale:A,textPixelRatio:I,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:h.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(d)for(const ne of g.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:ce,symbolInstanceEnd:de}=ne;e.push({sortKey:ie,symbolInstanceStart:ce,symbolInstanceEnd:de,parameters:ee})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(e,r,l,d,g,y,w,T,E,A,I,D,O,q,K,W,Q,ee,ne,ie){const ce=h.aE[e.textAnchor],de=[e.textOffset0,e.textOffset1],ae=ps(ce,l,d,de,g),me=this.collisionIndex.placeCollisionBox(r,D,T,E,A,w,y,W,I.predicate,ne,ae,ie);if((!ee||this.collisionIndex.placeCollisionBox(ee,D,T,E,A,w,y,Q,I.predicate,ne,ae,ie).placeable)&&me.placeable){let ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:de,width:l,height:d,anchor:ce,textBoxScale:g,prevAnchor:ze},this.markUsedJustification(q,ce,O,K),q.allowVerticalPlacement&&(this.markUsedOrientation(q,K,O),this.placedOrientations[O.crossTileID]=K),{shift:ae,placedGlyphBoxes:me}}}placeLayerBucketPart(e,r,l){const{bucket:d,layout:g,translationText:y,translationIcon:w,unwrappedTileID:T,pitchedLabelPlaneMatrix:E,textPixelRatio:A,holdingForFade:I,collisionBoxArray:D,partiallyEvaluatedTextSize:O,collisionGroup:q}=e.parameters,K=g.get("text-optional"),W=g.get("icon-optional"),Q=h.aF(g,"text-overlap","text-allow-overlap"),ee=Q==="always",ne=h.aF(g,"icon-overlap","icon-allow-overlap"),ie=ne==="always",ce=g.get("text-rotation-alignment")==="map",de=g.get("text-pitch-alignment")==="map",ae=g.get("icon-text-fit")!=="none",me=g.get("symbol-z-order")==="viewport-y",ze=ee&&(ie||!d.hasIconData()||W),Ee=ie&&(ee||!d.hasTextData()||K);!d.collisionArrays&&D&&d.deserializeCollisionBoxes(D);const Ae=this.retainedQueryData[d.bucketInstanceId].tileID,Pe=this._getTerrainElevationFunc(Ae),Je=this.transform.getFastPathSimpleProjectionMatrix(Ae),Qe=(qe,lt,Ot)=>{var fi,Ui;if(r[qe.crossTileID])return;if(I)return void(this.placements[qe.crossTileID]=new Hs(!1,!1,!1));let Di=!1,Hi=!1,ji=!0,Fn=null,$i={box:null,placeable:!1,offscreen:null,occluded:!1},Si={placeable:!1},Ai=null,qt=null,Un=null,cr=0,fo=0,is=0;lt.textFeatureIndex?cr=lt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(cr=qe.featureIndex),lt.verticalTextFeatureIndex&&(fo=lt.verticalTextFeatureIndex);const jo=lt.textBox;if(jo){const Ga=wn=>{let _n=h.ao.horizontal;if(d.allowVerticalPlacement&&!wn&&this.prevPlacement){const xa=this.prevPlacement.placedOrientations[qe.crossTileID];xa&&(this.placedOrientations[qe.crossTileID]=xa,_n=xa,this.markUsedOrientation(d,_n,qe))}return _n},Ps=(wn,_n)=>{if(d.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const xa of d.writingModes)if(xa===h.ao.vertical?($i=_n(),Si=$i):$i=wn(),$i&&$i.placeable)break}else $i=wn()},Er=qe.textAnchorOffsetStartIndex,Ds=qe.textAnchorOffsetEndIndex;if(Ds===Er){const wn=(_n,xa)=>{const Ni=this.collisionIndex.placeCollisionBox(_n,Q,A,Ae,T,de,ce,y,q.predicate,Pe,void 0,Je);return Ni&&Ni.placeable&&(this.markUsedOrientation(d,xa,qe),this.placedOrientations[qe.crossTileID]=xa),Ni};Ps((()=>wn(jo,h.ao.horizontal)),(()=>{const _n=lt.verticalTextBox;return d.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&_n?wn(_n,h.ao.vertical):{box:null,offscreen:null}})),Ga($i&&$i.placeable)}else{let wn=h.aE[(Ui=(fi=this.prevPlacement)===null||fi===void 0?void 0:fi.variableOffsets[qe.crossTileID])===null||Ui===void 0?void 0:Ui.anchor];const _n=(Ni,Qc,Jc)=>{const Yu=Ni.x2-Ni.x1,Hh=Ni.y2-Ni.y1,vc=qe.textBoxScale,Sl=ae&&ne==="never"?Qc:null;let qa=null,ns=Q==="never"?1:2,ur="never";wn&&ns++;for(let as=0;as<ns;as++){for(let mo=Er;mo<Ds;mo++){const xc=d.textAnchorOffsets.get(mo);if(wn&&xc.textAnchor!==wn)continue;const No=this.attemptAnchorPlacement(xc,Ni,Yu,Hh,vc,ce,de,A,Ae,T,q,ur,qe,d,Jc,y,w,Sl,Pe);if(No&&(qa=No.placedGlyphBoxes,qa&&qa.placeable))return Di=!0,Fn=No.shift,qa}wn?wn=null:ur=Q}return l&&!qa&&(qa={box:this.collisionIndex.placeCollisionBox(jo,"always",A,Ae,T,de,ce,y,q.predicate,Pe,void 0,Je).box,offscreen:!1,placeable:!1,occluded:!1}),qa};Ps((()=>_n(jo,lt.iconBox,h.ao.horizontal)),(()=>{const Ni=lt.verticalTextBox;return d.allowVerticalPlacement&&(!$i||!$i.placeable)&&qe.numVerticalGlyphVertices>0&&Ni?_n(Ni,lt.verticalIconBox,h.ao.vertical):{box:null,occluded:!0,offscreen:null}})),$i&&(Di=$i.placeable,ji=$i.offscreen);const xa=Ga($i&&$i.placeable);if(!Di&&this.prevPlacement){const Ni=this.prevPlacement.variableOffsets[qe.crossTileID];Ni&&(this.variableOffsets[qe.crossTileID]=Ni,this.markUsedJustification(d,Ni.anchor,qe,xa))}}}if(Ai=$i,Di=Ai&&Ai.placeable,ji=Ai&&Ai.offscreen,qe.useRuntimeCollisionCircles&&qe.centerJustifiedTextSymbolIndex>=0){const Ga=d.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Ps=h.ap(d.textSizeData,O,Ga),Er=g.get("text-padding");qt=this.collisionIndex.placeCollisionCircles(Q,Ga,d.lineVertexArray,d.glyphOffsetArray,Ps,T,E,l,de,q.predicate,qe.collisionCircleDiameter,Er,y,Pe),qt.circles.length&&qt.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Di=ee||qt.circles.length>0&&!qt.collisionDetected,ji=ji&&qt.offscreen}if(lt.iconFeatureIndex&&(is=lt.iconFeatureIndex),lt.iconBox){const Ga=Ps=>this.collisionIndex.placeCollisionBox(Ps,ne,A,Ae,T,de,ce,w,q.predicate,Pe,ae&&Fn?Fn:void 0,Je);Si&&Si.placeable&&lt.verticalIconBox?(Un=Ga(lt.verticalIconBox),Hi=Un.placeable):(Un=Ga(lt.iconBox),Hi=Un.placeable),ji=ji&&Un.offscreen}const Tl=K||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,zs=W||qe.numIconVertices===0;Tl||zs?zs?Tl||(Hi=Hi&&Di):Di=Hi&&Di:Hi=Di=Hi&&Di;const po=Hi&&Un.placeable;if(Di&&Ai.placeable&&this.collisionIndex.insertCollisionBox(Ai.box,Q,g.get("text-ignore-placement"),d.bucketInstanceId,Si&&Si.placeable&&fo?fo:cr,q.ID),po&&this.collisionIndex.insertCollisionBox(Un.box,ne,g.get("icon-ignore-placement"),d.bucketInstanceId,is,q.ID),qt&&Di&&this.collisionIndex.insertCollisionCircles(qt.circles,Q,g.get("text-ignore-placement"),d.bucketInstanceId,cr,q.ID),l&&this.storeCollisionData(d.bucketInstanceId,Ot,lt,Ai,Un,qt),qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new Hs((Di||ze)&&!(Ai!=null&&Ai.occluded),(Hi||Ee)&&!(Un!=null&&Un.occluded),ji||d.justReloaded),r[qe.crossTileID]=!0};if(me){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let lt=qe.length-1;lt>=0;--lt){const Ot=qe[lt];Qe(d.symbolInstances.get(Ot),d.collisionArrays[Ot],Ot)}}else for(let qe=e.symbolInstanceStart;qe<e.symbolInstanceEnd;qe++)Qe(d.symbolInstances.get(qe),d.collisionArrays[qe],qe);d.justReloaded=!1}storeCollisionData(e,r,l,d,g,y){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?T=w.get(r):(T={text:null,icon:null},w.set(r,T)),l.textBox&&(T.text=d.box),l.iconBox&&(T.icon=g.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)w.push(y.circles[T+0]-Bi),w.push(y.circles[T+1]-Bi),w.push(y.circles[T+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,r,l,d){let g;g=d===h.ao.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.aG(r)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:l.crossTileID)}markUsedOrientation(e,r,l){const d=r===h.ao.horizontal||r===h.ao.horizontalOnly?r:0,g=r===h.ao.vertical?r:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of y)e.text.placedSymbolArray.get(w).placedOrientation=d;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(e):1,g=r?r.opacities:{},y=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const T in this.placements){const E=this.placements[T],A=g[T];A?(this.opacities[T]=new Ei(A,d,E.text,E.icon),l=l||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[T]=new Ei(null,d,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const T in g){const E=g[T];if(!this.opacities[T]){const A=new Ei(E,d,!1,!1);A.isHidden()||(this.opacities[T]=A,l=l||E.text.placed||E.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const l={};for(const d of r){const g=d.getBucket(e);g&&d.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,d.tileID,l,d.collisionBoxArray)}}updateBucketOpacities(e,r,l,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],y=g.layout,w=new Ei(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),E=y.get("icon-allow-overlap"),A=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=y.get("text-rotation-alignment")==="map",D=y.get("text-pitch-alignment")==="map",O=y.get("icon-text-fit")!=="none",q=new Ei(null,0,T&&(E||!e.hasIconData()||y.get("icon-optional")),E&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const K=(Q,ee,ne)=>{for(let ie=0;ie<ee/4;ie++)Q.opacityVertexArray.emplaceBack(ne);Q.hasVisibleVertices=Q.hasVisibleVertices||ne!==gs},W=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Q=0;Q<e.symbolInstances.length;Q++){const ee=e.symbolInstances.get(Q),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ie,crossTileID:ce}=ee;let de=this.opacities[ce];l[ce]?de=w:de||(de=q,this.opacities[ce]=de),l[ce]=!0;const ae=ee.numIconVertices>0,me=this.placedOrientations[ee.crossTileID],ze=me===h.ao.vertical,Ee=me===h.ao.horizontal||me===h.ao.horizontalOnly;if(ne>0||ie>0){const Pe=Pc(de.text);K(e.text,ne,ze?gs:Pe),K(e.text,ie,Ee?gs:Pe);const Je=de.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach((lt=>{lt>=0&&(e.text.placedSymbolArray.get(lt).hidden=Je||ze?1:0)})),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Je||Ee?1:0);const Qe=this.variableOffsets[ee.crossTileID];Qe&&this.markUsedJustification(e,Qe.anchor,ee,me);const qe=this.placedOrientations[ee.crossTileID];qe&&(this.markUsedJustification(e,"left",ee,qe),this.markUsedOrientation(e,qe,ee))}if(ae){const Pe=Pc(de.icon),Je=!(O&&ee.verticalPlacedIconSymbolIndex&&ze);ee.placedIconSymbolIndex>=0&&(K(e.icon,ee.numIconVertices,Je?Pe:gs),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=de.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,ee.numVerticalIconVertices,Je?gs:Pe),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}const Ae=W&&W.has(Q)?W.get(Q):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Pe=e.collisionArrays[Q];if(Pe){let Je=new h.P(0,0);if(Pe.textBox||Pe.verticalTextBox){let Qe=!0;if(A){const qe=this.variableOffsets[ce];qe?(Je=ps(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale),I&&Je._rotate(D?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Qe=!1}if(Pe.textBox||Pe.verticalTextBox){let qe;Pe.textBox&&(qe=ze),Pe.verticalTextBox&&(qe=Ee),Tu(e.textCollisionBox.collisionVertexArray,de.text.placed,!Qe||qe,Ae.text,Je.x,Je.y)}}if(Pe.iconBox||Pe.verticalIconBox){const Qe=!!(!Ee&&Pe.verticalIconBox);let qe;Pe.iconBox&&(qe=Qe),Pe.verticalIconBox&&(qe=!Qe),Tu(e.iconCollisionBox.collisionVertexArray,de.icon.placed,qe,Ae.icon,O?Je.x:0,O?Je.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Tu(m,e,r,l,d,g){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-Bi,w=l[1]-Bi,T=l[2]-Bi,E=l[3]-Bi;m.emplaceBack(e?1:0,r?1:0,d||0,g||0,y,w),m.emplaceBack(e?1:0,r?1:0,d||0,g||0,T,w),m.emplaceBack(e?1:0,r?1:0,d||0,g||0,T,E),m.emplaceBack(e?1:0,r?1:0,d||0,g||0,y,E)}const jl=Math.pow(2,25),Nl=Math.pow(2,24),Ra=Math.pow(2,17),Ya=Math.pow(2,16),Dh=Math.pow(2,9),kd=Math.pow(2,8),Su=Math.pow(2,1);function Pc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,r=Math.floor(127*m.opacity);return r*jl+e*Nl+r*Ra+e*Ya+r*Dh+e*kd+r*Su+e}const gs=0;class Mu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,l,d,g){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(y,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort(((w,T)=>w.sortKey-T.sortKey)));this._currentPartIndex<y.length;)if(r.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class La{constructor(e,r,l,d,g,y,w,T){this.placement=new ms(e,r,y,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,r,l){const d=Ne.now(),g=()=>!this._forceFullPlacement&&Ne.now()-d>2;for(;this._currentPlacementIndex>=0;){const y=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Mu(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const $s=512/h.$/2;class Dc{constructor(e,r,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const d=new Map;for(let g=0;g<r.length;g++){const y=r.get(g),w=y.key,T=d.get(w);T?T.push(y):d.set(w,[y])}for(const[g,y]of d){const w={positions:y.map((T=>({x:Math.floor(T.anchorX*$s),y:Math.floor(T.anchorY*$s)}))),crossTileIDs:y.map((T=>T.crossTileID))};if(w.positions.length>128){const T=new h.aI(w.positions.length,16,Uint16Array);for(const{x:E,y:A}of w.positions)T.add(E,A);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[g]=w}}getScaledCoordinates(e,r){const{x:l,y:d,z:g}=this.tileID.canonical,{x:y,y:w,z:T}=r.canonical,E=$s/Math.pow(2,T-g),A=(w*h.$+e.anchorY)*E,I=d*h.$*$s;return{x:Math.floor((y*h.$+e.anchorX)*E-l*h.$*$s),y:Math.floor(A-I)}}findMatches(e,r,l){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let g=0;g<e.length;g++){const y=e.get(g);if(y.crossTileID)continue;const w=this._symbolsByKey[y.key];if(!w)continue;const T=this.getScaledCoordinates(y,r);if(w.index){const E=w.index.range(T.x-d,T.y-d,T.x+d,T.y+d).sort();for(const A of E){const I=w.crossTileIDs[A];if(!l[I]){l[I]=!0,y.crossTileID=I;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const A=w.positions[E],I=w.crossTileIDs[E];if(Math.abs(A.x-T.x)<=d&&Math.abs(A.y-T.y)<=d&&!l[I]){l[I]=!0,y.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Vl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class il{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const l in this.indexes){const d=this.indexes[l],g={};for(const y in d){const w=d[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),g[w.tileID.key]=w}this.indexes[l]=g}this.lng=e}addBucket(e,r,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<r.symbolInstances.length;g++)r.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const y=this.indexes[g];if(Number(g)>e.overscaledZ)for(const w in y){const T=y[w];T.tileID.isChildOf(e)&&T.findMatches(r.symbolInstances,e,d)}else{const w=y[e.scaledTo(Number(g)).key];w&&w.findMatches(r.symbolInstances,e,d)}}for(let g=0;g<r.symbolInstances.length;g++){const y=r.symbolInstances.get(g);y.crossTileID||(y.crossTileID=l.generate(),d[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Dc(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const l of r.getCrossTileIDsLists())for(const d of l)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let r=!1;for(const l in this.indexes){const d=this.indexes[l];for(const g in d)e[d[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,d[g]),delete d[g],r=!0)}return r}}class So{constructor(){this.layerIndexes={},this.crossTileIDs=new Vl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,l){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new il);let g=!1;const y={};d.handleWrapJump(l);for(const w of r){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(w.tileID,T,this.crossTileIDs)&&(g=!0),y[T.bucketInstanceId]=!0)}return d.removeStaleBuckets(y)&&(g=!0),g}pruneUnusedLayers(e){const r={};e.forEach((l=>{r[l]=!0}));for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var nl="void main() {fragColor=vec4(1.0);}";const fa={prelude:Ht(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ht("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ht("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ht(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ht(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ht(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ht(nl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ht(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ht(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ht("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ht("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ht("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ht(nl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ht(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ht(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ht(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ht(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ht(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ht(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ht(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ht(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ht(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Ht(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ht(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ht(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ht(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ht("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ht("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ht("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ht("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ht(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ht("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ht(m,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),d=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=g?g.concat(d):d,w={};return{fragmentSource:m=m.replace(r,((T,E,A,I,D)=>(w[D]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${A} ${I} ${D};
#else
uniform ${A} ${I} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${A} ${I} ${D} = u_${D};
#endif
`))),vertexSource:e=e.replace(r,((T,E,A,I,D)=>{const O=I==="float"?"vec2":"vec4",q=D.match(/color/)?"color":O;return w[D]?E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${A} ${O} a_${D};
out ${A} ${I} ${D};
#else
uniform ${A} ${I} u_${D};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${A} ${I} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${q}(a_${D}, u_${D}_t);
#else
    ${A} ${I} ${D} = u_${D};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${A} ${O} a_${D};
#else
uniform ${A} ${I} u_${D};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${I} ${D} = a_${D};
#else
    ${A} ${I} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${A} ${I} ${D} = unpack_mix_${q}(a_${D}, u_${D}_t);
#else
    ${A} ${I} ${D} = u_${D};
#endif
`})),staticAttributes:l,staticUniforms:y}}class Xs{constructor(e,r,l){this.vertexBuffer=e,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _s=h.aJ([{name:"a_pos",type:"Int16",components:2}]);const br="#define PROJECTION_MERCATOR",Mo="mercator";class $t{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Mo}get shaderDefine(){return br}get shaderPreludeCode(){return fa.projectionMercator}get vertexShaderPreludeCode(){return fa.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,l,d,g){if(this._cachedMesh)return this._cachedMesh;const y=new h.aL;y.emplaceBack(0,0),y.emplaceBack(h.$,0),y.emplaceBack(0,h.$),y.emplaceBack(h.$,h.$);const w=e.createVertexBuffer(y,_s.members),T=h.aM.simpleSegment(0,0,4,2),E=new h.aN;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const A=e.createIndexBuffer(E);return this._cachedMesh=new Xs(w,A,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class kr{constructor(e=0,r=0,l=0,d=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=l,this.right=d}interpolate(e,r,l){return r.top!=null&&e.top!=null&&(this.top=h.C.number(e.top,r.top,l)),r.bottom!=null&&e.bottom!=null&&(this.bottom=h.C.number(e.bottom,r.bottom,l)),r.left!=null&&e.left!=null&&(this.left=h.C.number(e.left,r.left,l)),r.right!=null&&e.right!=null&&(this.right=h.C.number(e.right,r.right,l)),this}getCenter(e,r){const l=h.ah((this.left+e-this.right)/2,0,e),d=h.ah((this.top+r-this.bottom)/2,0,r);return new h.P(l,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new kr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function sr(m,e){if(!m.renderWorldCopies||m.lngRange)return;const r=e.lng-m.center.lng;e.lng+=r>180?-360:r<-180?360:0}function al(m){return Math.max(0,Math.floor(m))}class la{constructor(e,r,l,d,g,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=al(this._zoom),this._scale=h.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new kr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=al(this._zoom),this._scale=h.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new kr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=h.aO(e,-180,180)*Math.PI/180;var l,d,g,y,w,T,E,A,I;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=_e(),l=this._rotationMatrix,g=-this._bearingInRadians,y=(d=this._rotationMatrix)[0],w=d[1],T=d[2],E=d[3],A=Math.sin(g),I=Math.cos(g),l[0]=y*I+T*A,l[1]=w*I+E*A,l[2]=y*-A+T*I,l[3]=w*-A+E*I)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=h.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aP(this._fovInRadians)}setFov(e){e=h.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=h.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=h.af(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,l){this._unmodified=!1,this._edgeInsets.interpolate(e,r,l),this._constrain(),this._calcMatrices()}resize(e,r,l=!0){this._width=e,this._height=r,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new qi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-h.ai,h.ai])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:l,minY:d,maxX:g,maxY:y}=h.a2.fromPoints(r).extend(e);return[new h.P(l,d),new h.P(g,d),new h.P(g,y),new h.P(l,y),new h.P(l,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=h.ag(new Float64Array(16));h.N(e,e,[this._width/2,-this._height/2,1]),h.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=h.ag(new Float64Array(16)),h.N(e,e,[1,-1,1]),h.M(e,e,[-1,-1,0]),h.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,l,d){const g=l!==void 0?l:this.bearing,y=d=d!==void 0?d:this.pitch,w=h.a1.fromLngLat(e,r),T=-Math.cos(h.ae(y)),E=Math.sin(h.ae(y)),A=E*Math.sin(h.ae(g)),I=-E*Math.cos(h.ae(g));let D=this.elevation;const O=r-D;let q;T*O>=0||Math.abs(T)<.1?(q=1e4,D=r+q*T):q=-O/T;let K,W,Q=h.aQ(1,w.y),ee=0;do{if(ee+=1,ee>10)break;W=q/Q,K=new h.a1(w.x+A*W,w.y+I*W),Q=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(q-W*Q)>1e-12);return{center:K.toLngLat(),elevation:D,zoom:h.ak(this.height/2/Math.tan(this.fovInRadians/2)/W/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=h.aj(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/r,d=h.a1.fromLngLat(this.center,this.elevation),g=Se(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),h.aQ(g.z,d.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=h.aj(1,this.center.lat)*this.worldSize;return Se(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/h.$,1/r/h.$]}}class un{constructor(e,r){this.min=e,this.max=r,this.center=h.aR([],h.aS([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=h.aT(this.min),d=h.aT(this.max);for(let g=0;g<r.length;g++)l[g]=r[g]?this.min[g]:this.center[g],d[g]=r[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new un(l,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let l=0;l<e.planes.length;l++){const d=this.intersectsPlane(e.planes[l]);if(d===0)return 0;d===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],l=e[3];for(let d=0;d<3;d++)e[d]>0?(r+=e[d]*this.min[d],l+=e[d]*this.max[d]):(l+=e[d]*this.min[d],r+=e[d]*this.max[d]);return r>=0?2:l<0?0:1}}class kn{distanceToTile2d(e,r,l,d){const g=d.distanceX([e,r]),y=d.distanceY([e,r]);return Math.hypot(g,y)}getWrap(e,r,l){return l}getTileBoundingVolume(e,r,l,d){var g,y;let w=0,T=0;if(d!=null&&d.terrain){const A=new h.Z(e.z,r,e.z,e.x,e.y),I=d.terrain.getMinMaxElevation(A);w=(g=I.minElevation)!==null&&g!==void 0?g:Math.min(0,l),T=(y=I.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}const E=1<<e.z;return new un([r+e.x/E,e.y/E,w],[r+(e.x+1)/E,(e.y+1)/E,T])}allowVariableZoom(e,r){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=h.ah(78.5-l/2,0,60);return!!r.terrain||e.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class xn{constructor(e,r,l){this.points=e,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(e,r=1,l=0,d,g){const y=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((D=>(function(O,q,K,W){const Q=h.aw([],O,q),ee=1/Q[3]/K*W;return h.aY(Q,Q,[ee,ee,1/Q[3],ee])})(D,e,r,w)));d&&(function(D,O,q,K){const W=K?4:0,Q=K?0:4;let ee=0;const ne=[],ie=[];for(let ae=0;ae<4;ae++){const me=h.aU([],D[ae+Q],D[ae+W]),ze=h.aZ(me);h.aR(me,me,1/ze),ne.push(ze),ie.push(me)}for(let ae=0;ae<4;ae++){const me=h.a_(D[ae+W],ie[ae],q);ee=me!==null&&me>=0?Math.max(ee,me):Math.max(ee,ne[ae])}const ce=(function(ae,me){const ze=h.aU([],ae[me[0]],ae[me[1]]),Ee=h.aU([],ae[me[2]],ae[me[1]]),Ae=[0,0,0,0];return h.aV(Ae,h.aW([],ze,Ee)),Ae[3]=-h.aX(Ae,ae[me[0]]),Ae})(D,O),de=(function(ae,me){const ze=h.a$(ae),Ee=h.b0([],ae,1/ze),Ae=h.aU([],me,h.aR([],Ee,h.aX(me,Ee))),Pe=h.a$(Ae);if(Pe>0){const Je=Math.sqrt(1-Ee[3]*Ee[3]),Qe=h.aR([],Ee,-Ee[3]),qe=h.aS([],Qe,h.aR([],Ae,Je/Pe));return h.b1(me,qe)}return null})(q,ce);if(de!==null){const ae=de/h.aX(ie[0],ce);ee=Math.min(ee,ae)}for(let ae=0;ae<4;ae++){const me=Math.min(ee,ne[ae]);D[ae+Q]=[D[ae+W][0]+ie[ae][0]*me,D[ae+W][1]+ie[ae][1]*me,D[ae+W][2]+ie[ae][2]*me,1]}})(T,y[0],d,g);const E=y.map((D=>{const O=h.aU([],T[D[0]],T[D[1]]),q=h.aU([],T[D[2]],T[D[1]]),K=h.aV([],h.aW([],O,q)),W=-h.aX(K,T[D[1]]);return K.concat(W)})),A=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],I=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const D of T)for(let O=0;O<3;O++)A[O]=Math.min(A[O],D[O]),I[O]=Math.max(I[O],D[O]);return new xn(T,E,new un(A,I))}}class bi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,l,d,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new la({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,w)=>this.getConstrained(y,w)},e,r,l,d,g),this._coveringTilesDetailsProvider=new kn}clone(){const e=new bi;return e.apply(this),e}apply(e,r,l){this._helper.apply(e,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new h.b2(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new h.P(0,0)),d=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,d.x,g.x,y.x)),T=Math.floor(Math.max(l.x,d.x,g.x,y.x)),E=1;for(let A=w-E;A<=T+E;A++)A!==0&&r.push(new h.b2(A,e))}return r}getCameraFrustum(){return xn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,r){const l=h.aj(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(r,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=h.a1.fromLngLat(e),w=new h.a1(y.x-(d.x-g.x),y.y-(d.y-g.y));this.setCenter(w==null?void 0:w.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(h.a1.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(h.a1.fromLngLat(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const l=r||0,d=[e.x,e.y,0,1],g=[e.x,e.y,1,1];h.aw(d,d,this._pixelMatrixInverse),h.aw(g,g,this._pixelMatrixInverse);const y=d[3],w=g[3],T=d[1]/y,E=g[1]/w,A=d[2]/y,I=g[2]/w,D=A===I?0:(l-A)/(I-A);return new h.a1(h.C.number(d[0]/y,g[0]/w,D)/this.worldSize,h.C.number(T,E,D)/this.worldSize,l)}coordinatePoint(e,r=0,l=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,r,1];return h.aw(d,d,l),new h.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-le(this));return new qi().extend(this.screenPointToLocation(new h.P(0,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-le(this)}calculatePosMatrix(e,r=!1,l){var d;const g=(d=e.key)!==null&&d!==void 0?d:h.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=r?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(g)){const E=y.get(g);return l?E.f32:E.f64}const w=ge(e,this.worldSize);h.O(w,r?this._alignedProjMatrix:this._viewProjMatrix,w);const T={f64:w,f32:new Float32Array(w)};return y.set(g,T),l?T.f32:T.f64}calculateFogMatrix(e){const r=e.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const d=ge(e,this.worldSize);return h.O(d,this._fogMatrix,d),l.set(r,new Float32Array(d)),l.get(r)}getConstrained(e,r){r=h.ah(+r,this.minZoom,this.maxZoom);const l={center:new h.S(e.lng,e.lat),zoom:r};let d=this._helper._lngRange;if(!this._helper._renderWorldCopies&&d===null){const ne=179.9999999999;d=[-ne,ne]}const g=this.tileSize*h.af(l.zoom);let y=0,w=g,T=0,E=g,A=0,I=0;const{x:D,y:O}=this.size;if(this._helper._latRange){const ne=this._helper._latRange;y=h.U(ne[1])*g,w=h.U(ne[0])*g,w-y<O&&(A=O/(w-y))}d&&(T=h.aO(h.V(d[0])*g,0,g),E=h.aO(h.V(d[1])*g,0,g),E<T&&(E+=g),E-T<D&&(I=D/(E-T)));const{x:q,y:K}=X(g,e);let W,Q;const ee=Math.max(I||0,A||0);if(ee){const ne=new h.P(I?(E+T)/2:q,A?(w+y)/2:K);return l.center=re(g,ne).wrap(),l.zoom+=h.ak(ee),l}if(this._helper._latRange){const ne=O/2;K-ne<y&&(Q=y+ne),K+ne>w&&(Q=w-ne)}if(d){const ne=(T+E)/2;let ie=q;this._helper._renderWorldCopies&&(ie=h.aO(q,ne-g/2,ne+g/2));const ce=D/2;ie-ce<T&&(W=T+ce),ie+ce>E&&(W=E-ce)}if(W!==void 0||Q!==void 0){const ne=new h.P(W??q,Q??K);l.center=re(g,ne).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,r,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,d)}_calculateNearFarZIfNeeded(e,r,l){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-d*this._helper._pixelPerMeter/Math.cos(r),y=d<0?g:e,w=Math.PI/2+this.pitchInRadians,T=h.ae(this.fov)*(Math.abs(Math.cos(h.ae(this.roll)))*this.height+Math.abs(Math.sin(h.ae(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(T)*y/Math.sin(h.ah(Math.PI-w-T,.01,Math.PI-.01)),A=le(this),I=Math.atan(A/this._helper.cameraToCenterDistance),D=h.ae(.75),O=I>D?2*I*(.5+l.y/(2*A)):D,q=Math.sin(O)*y/Math.sin(h.ah(Math.PI-w-O,.01,Math.PI-.01)),K=Math.min(E,q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*K+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=X(this.worldSize,this.center),l=r.x,d=r.y;this._helper._pixelPerMeter=h.aj(1,this.center.lat)*this.worldSize;const g=h.ae(Math.min(this.pitch,G)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let w;this._calculateNearFarZIfNeeded(y,g,e),w=new Float64Array(16),h.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=h.b5(w),h.N(w,w,[1,-1,1]),h.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),h.b6(w,w,-this.rollInRadians),h.b7(w,w,this.pitchInRadians),h.b6(w,w,-this.bearingInRadians),h.M(w,w,[-l,-d,0]),this._mercatorMatrix=h.N([],w,[this.worldSize,this.worldSize,this.worldSize]),h.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),h.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=h.aq([],w);const T=[0,0,-1,1];h.aw(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),h.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,h.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.M(this._fogMatrix,this._fogMatrix,[-l,-d,0]),h.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const E=this._helper._width%2/2,A=this._helper._height%2/2,I=Math.cos(this.bearingInRadians),D=Math.sin(-this.bearingInRadians),O=l-Math.round(l)+I*E+D*A,q=d-Math.round(d)+I*A+D*E,K=new Float64Array(w);if(h.M(K,K,[O>.5?O-1:O,q>.5?q-1:q,0]),this._alignedProjMatrix=K,w=h.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new h.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.aw(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=h.aj(1,this.center.lat)*this.worldSize;return Se(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const l=h.a1.fromLngLat(e),d=[l.x*this.worldSize,l.y*this.worldSize,r,1];return h.aw(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:d}=e,g=this._helper.getMercatorTileCoordinates(r),y=r?this.calculatePosMatrix(r,l,!0):null;let w;return w=r&&r.terrainRttPosMatrix32f&&d?r.terrainRttPosMatrix32f:y||h.b8(),{mainMatrix:w,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,l){return 1}transformLightDirection(e){return h.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,l,d){const g=this.calculatePosMatrix(l);let y;d?(y=[e,r,d(e,r),1],h.aw(y,y,g)):(y=[e,r,0,1],Rr(y,y,g));const w=y[3];return{point:new h.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const l=h.a1.fromLngLat(e,r),d=l.meterInMercatorCoordinateUnits(),g=h.b9();return h.M(g,g,[l.x,l.y,l.z]),h.b6(g,g,Math.PI),h.b7(g,g,Math.PI/2),h.N(g,g,[-d,d,d]),g}getProjectionDataForCustomLayer(e=!0){const r=new h.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),d=ge(r,this.worldSize);h.O(d,this._viewProjMatrix,d),l.tileMercatorCoords=[0,0,1,1];const g=[h.$,h.$,this.worldSize/this._helper.pixelsPerMeter],y=h.ba();return h.N(y,d,g),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Cu(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Gn(m){if(m.useSlerp)if(m.k<1){const e=h.bb(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=h.bb(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);h.bc(l,e,r,m.k);const d=h.bd(l);m.tr.setRoll(d.roll),m.tr.setPitch(d.pitch),m.tr.setBearing(d.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(h.C.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(h.C.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(h.C.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function bn(m,e,r,l,d){const g=d.padding,y=X(d.worldSize,r.getNorthWest()),w=X(d.worldSize,r.getNorthEast()),T=X(d.worldSize,r.getSouthEast()),E=X(d.worldSize,r.getSouthWest()),A=h.ae(-l),I=y.rotate(A),D=w.rotate(A),O=T.rotate(A),q=E.rotate(A),K=new h.P(Math.max(I.x,D.x,q.x,O.x),Math.max(I.y,D.y,q.y,O.y)),W=new h.P(Math.min(I.x,D.x,q.x,O.x),Math.min(I.y,D.y,q.y,O.y)),Q=K.sub(W),ee=(d.width-(g.left+g.right+e.left+e.right))/Q.x,ne=(d.height-(g.top+g.bottom+e.top+e.bottom))/Q.y;if(ne<0||ee<0)return void Cu();const ie=Math.min(h.ak(d.scale*Math.min(ee,ne)),m.maxZoom),ce=h.P.convert(m.offset),de=new h.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(h.ae(l)),ae=ce.add(de).mult(d.scale/h.af(ie));return{center:re(d.worldSize,y.add(T).div(2).sub(ae)),zoom:ie,bearing:l}}class Jn{get useGlobeControls(){return!1}handlePanInertia(e,r){const l=e.mag(),d=Math.abs(le(r));return{easingOffset:e.mult(Math.min(.75*d/l,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,l){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,r,l,d,g){return bn(e,r,l,d,g)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(h.S.convert(r.center))}handleEaseTo(e,r){const l=e.zoom,d=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},w=r.zoom!==void 0,T=!e.isPaddingEqual(r.padding);let E=!1;const A=w?+r.zoom:e.zoom;let I=e.centerPoint.add(r.offsetAsPoint);const D=e.screenPointToLocation(I),{center:O,zoom:q}=e.getConstrained(h.S.convert(r.center||D),A??l);sr(e,O);const K=X(e.worldSize,D),W=X(e.worldSize,O).sub(K),Q=h.af(q-l);return E=q!==l,{easeFunc:ee=>{if(E&&e.setZoom(h.C.number(l,q,ee)),h.be(g,y)||Gn({startEulerAngles:g,endEulerAngles:y,tr:e,k:ee,useSlerp:g.roll!=y.roll}),T&&(e.interpolatePadding(d,r.padding,ee),I=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const ne=h.af(e.zoom-l),ie=q>l?Math.min(2,Q):Math.max(.5,Q),ce=Math.pow(ie,1-ee),de=re(e.worldSize,K.add(W.mult(ee*ce)).mult(ne));e.setLocationAtPoint(e.renderWorldCopies?de.wrap():de,I)}},isZooming:E,elevationCenter:O}}handleFlyTo(e,r){const l=r.zoom!==void 0,d=e.zoom,g=e.getConstrained(h.S.convert(r.center||r.locationAtOffset),l?+r.zoom:d),y=g.center,w=g.zoom;sr(e,y);const T=X(e.worldSize,r.locationAtOffset),E=X(e.worldSize,y).sub(T),A=E.mag(),I=h.af(w-d);let D;if(r.minZoom!==void 0){const O=Math.min(+r.minZoom,d,w),q=e.getConstrained(y,O).zoom;D=h.af(q-d)}return{easeFunc:(O,q,K,W)=>{e.setZoom(O===1?w:d+h.ak(q));const Q=O===1?y:re(e.worldSize,T.add(E.mult(K)).mult(q));e.setLocationAtPoint(e.renderWorldCopies?Q.wrap():Q,W)},scaleOfZoom:I,targetCenter:y,scaleOfMinZoom:D,pixelPathLength:A}}}class wi{constructor(e,r,l){this.blendFunction=e,this.blendColor=r,this.mask=l}}wi.Replace=[1,0],wi.disabled=new wi(wi.Replace,h.bf.transparent,[!1,!1,!1,!1]),wi.unblended=new wi(wi.Replace,h.bf.transparent,[!0,!0,!0,!0]),wi.alphaBlended=new wi([1,771],h.bf.transparent,[!0,!0,!0,!0]);const ka=2305;class wt{constructor(e,r,l){this.enable=e,this.mode=r,this.frontFace=l}}wt.disabled=new wt(!1,1029,ka),wt.backCCW=new wt(!0,1029,ka),wt.frontCCW=new wt(!0,1028,ka);class It{constructor(e,r,l){this.func=e,this.mask=r,this.range=l}}It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);const Br=7680;class Kt{constructor(e,r,l,d,g,y){this.test=e,this.ref=r,this.mask=l,this.fail=d,this.depthFail=g,this.pass=y}}Kt.disabled=new Kt({func:519,mask:0},0,0,Br,Br,Br);const pa=new WeakMap;function wr(m){var e;if(pa.has(m))return pa.get(m);{const r=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return pa.set(m,r),r}}class hn{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const d=new h.aL;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const g=new h.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Xs(r.createVertexBuffer(d,_s.members),r.createIndexBuffer(g),h.aM.simpleSegment(0,0,d.length,g.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),wr(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const l=this._cachedRenderContext.context,d=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:h.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,d.TRIANGLES,It.disabled,Kt.disabled,wi.unblended,wt.disabled,((g,y)=>({u_input:g,u_output_expected:y}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&wr(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const g=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&wr(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=hn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const Or=h.$/128;function rl(m,e){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,l=r+(m.generateBorders?2:0),d=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=l+1,y=d+1,w=m.generateBorders?-1:0,T=m.generateBorders||m.extendToNorthPole?-1:0,E=r+(m.generateBorders?1:0),A=r+(m.generateBorders||m.extendToSouthPole?1:0),I=g*y,D=l*d*6,O=g*y>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const q=O||e==="32bit",K=new Int16Array(2*I);let W=0;for(let ne=T;ne<=A;ne++)for(let ie=w;ie<=E;ie++){let ce=ie/r*h.$;ie===-1&&(ce=-Or),ie===r+1&&(ce=h.$+Or);let de=ne/r*h.$;ne===-1&&(de=m.extendToNorthPole?h.bh:-Or),ne===r+1&&(de=m.extendToSouthPole?h.bi:h.$+Or),K[W++]=ce,K[W++]=de}const Q=q?new Uint32Array(D):new Uint16Array(D);let ee=0;for(let ne=0;ne<d;ne++)for(let ie=0;ie<l;ie++){const ce=ie+1+ne*g,de=ie+(ne+1)*g,ae=ie+1+(ne+1)*g;Q[ee++]=ie+ne*g,Q[ee++]=de,Q[ee++]=ce,Q[ee++]=ce,Q[ee++]=de,Q[ee++]=ae}return{vertices:K.buffer.slice(0),indices:Q.buffer.slice(0),uses32bitIndices:q}}const Fr=new h.aK({fill:new h.bj(128,2),line:new h.bj(512,0),tile:new h.bj(128,32),stencil:new h.bj(128,1),circle:3});class Zl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return fa.projectionGlobe}get vertexShaderPreludeCode(){return fa.projectionMercator.vertexSource}get subdivisionGranularity(){return Fr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new hn(e));const r=h.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(r,l),g=Ne.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=g);const y=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bl(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,l,d,g){const y=(g==="stencil"?Fr.stencil:Fr.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:r.y===0&&d,extendToSouthPole:r.y===(1<<r.z)-1&&d})}_getMesh(e,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const d=(function(g,y){const w=rl(y,"16bit"),T=h.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),E=h.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Xs(g.createVertexBuffer(T,_s.members),g.createIndexBuffer(E),h.aM.simpleSegment(0,0,T.length,E.length))})(e,r);return this._tileMeshCache[l]=d,d}recalculate(e){}hasTransition(){const e=Ne.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const sl=new h.r({type:new h.D(h.v.projection.type)});class ol extends h.E{constructor(e){super(),this._transitionable=new h.t(sl,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.F(0)),this._mercatorProjection=new $t,this._verticalPerspectiveProjection=new Zl}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof h.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,l,d,g){return this.currentProjection.getMeshFromTileID(e,r,l,d,g)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ys(m){const e=ll(m.worldSize,m.center.lat);return 2*Math.PI*e}function Ba(m,e,r,l,d){const g=1/(1<<d),y=e/h.$*g+l*g,w=h.bo((m/h.$*g+r*g)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,E=Math.cos(T),A=new Float64Array(3);return A[0]=Math.sin(w)*E,A[1]=Math.sin(T),A[2]=Math.cos(w)*E,A}function qn(m){return(function(e,r){const l=Math.cos(r),d=new Float64Array(3);return d[0]=Math.sin(e)*l,d[1]=Math.sin(r),d[2]=Math.cos(e)*l,d})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function ll(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Gl(m){const e=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const l=m[0]/r,d=Math.acos(m[2]/r),g=(l>0?d:-d)/Math.PI*180;return new h.S(h.aO(g,-180,180),e)}return new h.S(0,e)}function Co(m){return Math.cos(m*Math.PI/180)}function nn(m,e){const r=Co(m),l=Co(e);return h.ak(l/r)}function Ih(m,e){const r=m.rotate(e.bearingInRadians),l=e.zoom+nn(e.center.lat,0),d=h.bk(1/Co(e.center.lat),1/Co(Math.min(Math.abs(e.center.lat),60)),h.bn(l,7,3,0,1)),g=360/Ys({worldSize:e.worldSize,center:{lat:e.center.lat}});return new h.S(e.center.lng-r.x*g*d,h.ah(e.center.lat+r.y*g,-h.ai,h.ai))}function ql(m){const e=.5*m,r=Math.sin(e),l=Math.cos(e);return Math.log(r+l)-Math.log(l-r)}function Eu(m,e,r,l){const d=m.lat+r*l;if(Math.abs(r)>1){const g=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,y=Math.abs(m.lat+r)*Math.PI/180,w=ql(g+l*(y-g)),T=ql(g),E=ql(y);return new h.S(m.lng+e*((w-T)/(E-T)),d)}return new h.S(m.lng+e*l,d)}class Bd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,l,d){const g=`${e.z}_${e.x}_${e.y}_${d!=null&&d.terrain?"t":""}`,y=this._cache.get(g);if(y)return y;const w=this._cachePrevious.get(g);if(w)return this._cache.set(g,w),w;const T=this._boundingVolumeFactory(e,r,l,d);return this._cache.set(g,T),this._hadAnyChanges=!0,T}}class cl{constructor(e,r,l,d){this.min=l,this.max=d,this.points=e,this.planes=r}static fromAabb(e,r){const l=[];for(let d=0;d<8;d++)l.push([1&~d?e[0]:r[0],(d>>1&1)==1?r[1]:e[1],(d>>2&1)==1?r[2]:e[2]]);return new cl(l,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,l){const d=h.br([],l[0],l[1],l[2]),g=h.bs([],[r[0],0,0],d),y=h.bs([],[0,r[1],0],d),w=h.bs([],[0,0,r[2]],d),T=[...e],E=[...e];for(let I=0;I<8;I++)for(let D=0;D<3;D++){const O=e[D]+g[D]*(1&~I?-1:1)+y[D]*((I>>1&1)==1?1:-1)+w[D]*((I>>2&1)==1?1:-1);T[D]=Math.min(T[D],O),E[D]=Math.max(E[D],O)}const A=[];for(let I=0;I<8;I++){const D=[...e];h.aS(D,D,h.aR([],g,1&~I?-1:1)),h.aS(D,D,h.aR([],y,(I>>1&1)==1?1:-1)),h.aS(D,D,h.aR([],w,(I>>2&1)==1?1:-1)),A.push(D)}return new cl(A,[[...g,-h.aX(g,A[0])],[...y,-h.aX(y,A[0])],[...w,-h.aX(w,A[0])],[-g[0],-g[1],-g[2],-h.aX(g,A[7])],[-y[0],-y[1],-y[2],-h.aX(y,A[7])],[-w[0],-w[1],-w[2],-h.aX(w,A[7])]],T,E)}intersectsFrustum(e){let r=!0;const l=this.points.length,d=this.planes.length,g=e.planes.length,y=e.points.length;for(let w=0;w<g;w++){const T=e.planes[w];let E=0;for(let A=0;A<l;A++){const I=this.points[A];T[0]*I[0]+T[1]*I[1]+T[2]*I[2]+T[3]>=0&&E++}if(E===0)return 0;E<l&&(r=!1)}if(r)return 2;for(let w=0;w<d;w++){const T=this.planes[w];let E=0;for(let A=0;A<y;A++){const I=e.points[A];T[0]*I[0]+T[1]*I[1]+T[2]*I[2]+T[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let l=0;for(let d=0;d<r;d++){const g=this.points[d];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&l++}return l===r?2:l===0?0:1}}function ea(m,e,r){const l=m-e;return l<0?-l:Math.max(0,l-r)}function Hl(m,e,r,l,d){const g=m-r;let y;return y=g<0?Math.min(-g,1+g-d):g>1?Math.min(Math.max(g-d,0),1-g):0,Math.max(y,ea(e,l,d))}class Ur{constructor(){this._boundingVolumeCache=new Bd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,l,d){const g=1<<l.z,y=1/g,w=l.x/g,T=l.y/g;let E=2;return E=Math.min(E,Hl(e,r,w,T,y)),E=Math.min(E,Hl(e,r,w+.5,-T-y,y)),E=Math.min(E,Hl(e,r,w+.5,2-T-y,y)),E}getWrap(e,r,l){const d=1<<r.z,g=1/d,y=r.x/d,w=ea(e.x,y,g),T=ea(e.x,y-1,g),E=ea(e.x,y+1,g),A=Math.min(w,T,E);return A===E?1:A===T?-1:0}allowVariableZoom(e,r){return ct(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,l,d){return this._boundingVolumeCache.getTileBoundingVolume(e,r,l,d)}_computeTileBoundingVolume(e,r,l,d){var g,y;let w=0,T=0;if(d!=null&&d.terrain){const E=new h.Z(e.z,r,e.z,e.x,e.y),A=d.terrain.getMinMaxElevation(E);w=(g=A.minElevation)!==null&&g!==void 0?g:Math.min(0,l),T=(y=A.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}if(w/=h.bu,T/=h.bu,w+=1,T+=1,e.z<=0)return cl.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return cl.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{const E=[Ba(0,0,e.x,e.y,e.z),Ba(h.$,0,e.x,e.y,e.z),Ba(h.$,h.$,e.x,e.y,e.z),Ba(0,h.$,e.x,e.y,e.z)],A=[];for(const Ae of E)A.push(h.aR([],Ae,T));if(T!==w)for(const Ae of E)A.push(h.aR([],Ae,w));e.y===0&&A.push([0,1,0]),e.y===(1<<e.z)-1&&A.push([0,-1,0]);const I=[1,1,1],D=[-1,-1,-1];for(const Ae of A)for(let Pe=0;Pe<3;Pe++)I[Pe]=Math.min(I[Pe],Ae[Pe]),D[Pe]=Math.max(D[Pe],Ae[Pe]);const O=Ba(h.$/2,h.$/2,e.x,e.y,e.z),q=h.aW([],[0,1,0],O);h.aV(q,q);const K=h.aW([],O,q);h.aV(K,K);const W=h.aW([],E[2],E[1]);h.aV(W,W);const Q=h.aW([],E[0],E[3]);h.aV(Q,Q),A.push(h.aR([],O,T)),e.y>=(1<<e.z)/2&&A.push(h.aR([],Ba(h.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&A.push(h.aR([],Ba(h.$/2,h.$,e.x,e.y,e.z),T));const ee=$l(O,A),ne=$l(K,A),ie=[-O[0],-O[1],-O[2],ee.max],ce=[O[0],O[1],O[2],-ee.min],de=[-K[0],-K[1],-K[2],ne.max],ae=[K[0],K[1],K[2],-ne.min],me=[...W,0],ze=[...Q,0],Ee=[];return e.y===0?Ee.push(h.bt(ze,me,ie),h.bt(ze,me,ce)):Ee.push(h.bt(de,me,ie),h.bt(de,me,ce),h.bt(de,ze,ie),h.bt(de,ze,ce)),e.y===(1<<e.z)-1?Ee.push(h.bt(ze,me,ie),h.bt(ze,me,ce)):Ee.push(h.bt(ae,me,ie),h.bt(ae,me,ce),h.bt(ae,ze,ie),h.bt(ae,ze,ce)),new cl(Ee,[ie,ce,de,ae,me,ze],I,D)}}}function $l(m,e){let r=1/0,l=-1/0;for(const d of e){const g=h.aX(m,d);r=Math.min(r,g),l=Math.max(l,g)}return{min:r,max:l}}class Xl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=h.bv(),this._projectionMatrix=h.b9(),this._globeViewProjMatrix32f=h.b8(),this._globeViewProjMatrixNoCorrection=h.b9(),this._globeViewProjMatrixNoCorrectionInverted=h.b9(),this._globeProjMatrixInverted=h.b9(),this._cameraPosition=h.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new la({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new Ur}clone(){const e=new Xl;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=h.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:l}=e,d=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,l=this.cameraToCenterDistance/e,d=Math.sin(r)*l,g=Math.cos(r)*l+1,y=1/Math.sqrt(d*d+g*g)*1;let w=-d,T=g;const E=Math.sqrt(w*w+T*T);w/=E,T/=E;const A=[0,w,T];h.bw(A,A,[0,0,0],-this.bearingInRadians),h.bx(A,A,[0,0,0],-1*this.center.lat*Math.PI/180),h.by(A,A,[0,0,0],this.center.lng*Math.PI/180);const I=1/h.aZ(A);return h.aR(A,A,I),[...A,-y*I]}isLocationOccluded(e){return!this.isSurfacePointVisible(qn(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,d=Math.cos(l),g=[Math.sin(r)*d,Math.sin(l),Math.cos(r)*d],y=[g[2],0,-g[0]],w=[0,0,0];h.aW(w,y,g),h.aV(y,y),h.aV(w,w);const T=[0,0,0];return h.aV(T,[y[0]*e[0]+w[0]*e[1]+g[0]*e[2],y[1]*e[0]+w[1]*e[1]+g[1]*e[2],y[2]*e[0]+w[2]*e[1]+g[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,l){const d=(function(w,T,E){const A=1/(1<<E.z);return new h.a1(w/h.$*A+E.x*A,T/h.$*A+E.y*A)})(e,r,l.canonical),g=(y=d.y,[h.bo(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,r,l,d){const g=l.canonical,y=Ba(e,r,g.x,g.y,g.z),w=1+(d?d(e,r):0)/h.bu,T=[y[0]*w,y[1]*w,y[2]*w,1];h.aw(T,T,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,A=E[0]*y[0]+E[1]*y[1]+E[2]*y[2]+E[3]<0;return{point:new h.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:A}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ll(this.worldSize,this.center.lat),r=h.ba(),l=h.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),h.b4(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;r[8]=2*-d.x/this._helper._width,r[9]=2*d.y/this._helper._height,this._projectionMatrix=h.b5(r),this._globeProjMatrixInverted=h.ba(),h.aq(this._globeProjMatrixInverted,r),h.M(r,r,[0,0,-this.cameraToCenterDistance]),h.b6(r,r,this.rollInRadians),h.b7(r,r,-this.pitchInRadians),h.b6(r,r,this.bearingInRadians),h.M(r,r,[0,0,-e]);const g=h.bp();g[0]=e,g[1]=e,g[2]=e,h.b7(l,r,this.center.lat*Math.PI/180),h.bz(l,l,-this.center.lng*Math.PI/180),h.N(l,l,g),this._globeViewProjMatrixNoCorrection=l,h.b7(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bz(r,r,-this.center.lng*Math.PI/180),h.N(r,r,g),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=h.ba(),h.aq(this._globeViewProjMatrixNoCorrectionInverted,l);const y=h.bp();this._cameraPosition=h.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,h.bw(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),h.bx(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),h.bw(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),h.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bx(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),h.by(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=h.b5(this._globeViewProjMatrixNoCorrectionInverted);h.N(w,w,[1,1,-1]),this._cachedFrustum=xn.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){h.w("calculateFogMatrix is not supported on globe projection.");const r=h.ba();return h.ag(r),r}getVisibleUnwrappedCoordinates(e){return[new h.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=qn(e);h.aR(l,l,1+r/h.bu);const d=h.bv();return h.aw(d,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,l=[new h.P(0,0),new h.P(e,0),new h.P(this.width,0),new h.P(this.width,r),new h.P(this.width,this.height),new h.P(e,this.height),new h.P(0,this.height),new h.P(0,r)],d=[];for(const I of l)d.push(this.unprojectScreenPoint(I));let g=0,y=0,w=0,T=0;const E=this.center;for(const I of d){const D=h.bA(E.lng,I.lng),O=h.bA(E.lat,I.lat);D<y&&(y=D),D>g&&(g=D),O<T&&(T=O),O>w&&(w=O)}const A=[E.lng+y,E.lat+T,E.lng+g,E.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(A[3]=90,A[0]=-180,A[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(A[1]=-90,A[0]=-180,A[2]=180),new qi(A)}getConstrained(e,r){const l=h.ah(e.lat,-h.ai,h.ai),d=h.ah(+r,this.minZoom+nn(0,l),this.maxZoom);return{center:new h.S(e.lng,l),zoom:d}}calculateCenterFromCameraLngLatAlt(e,r,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,d)}setLocationAtPoint(e,r){const l=qn(this.unprojectScreenPoint(r)),d=qn(e),g=h.bp();h.bB(g);const y=h.bp();h.by(y,l,g,-this.center.lng*Math.PI/180),h.bx(y,y,g,this.center.lat*Math.PI/180);const w=d[0]*d[0]+d[2]*d[2],T=y[0]*y[0];if(w<T)return;const E=Math.sqrt(w-T),A=-E,I=h.bC(d[0],d[2],y[0],E),D=h.bC(d[0],d[2],y[0],A),O=h.bp();h.by(O,d,g,-I);const q=h.bC(O[1],O[2],y[1],y[2]),K=h.bp();h.by(K,d,g,-D);const W=h.bC(K[1],K[2],y[1],y[2]),Q=.5*Math.PI,ee=q>=-Q&&q<=Q,ne=W>=-Q&&W<=Q;let ie,ce;if(ee&&ne){const ze=this.center.lng*Math.PI/180,Ee=this.center.lat*Math.PI/180;h.bD(I,ze)+h.bD(q,Ee)<h.bD(D,ze)+h.bD(W,Ee)?(ie=I,ce=q):(ie=D,ce=W)}else if(ee)ie=I,ce=q;else{if(!ne)return;ie=D,ce=W}const de=ie/Math.PI*180,ae=ce/Math.PI*180,me=this.center.lat;this.setCenter(new h.S(de,h.ah(ae,-90,90))),this.setZoom(this.zoom+nn(me,this.center.lat))}locationToScreenPoint(e,r){const l=qn(e);if(r){const d=r.getElevationForLngLatZoom(e,this._helper._tileZoom);h.aR(l,l,1+d/h.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const r=h.bv();return h.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new h.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l)return l}return h.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,r){const l=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,d)}getRayDirectionFromPixel(e){const r=h.bv();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,h.aw(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=h.bp();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const d=h.bp();return h.aV(d,l),d}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=h.bv();return h.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const l=h.aX(e,r),d=h.bp(),g=h.bp();h.aR(g,r,l),h.aU(d,e,g);const y=1-h.aX(d,d);if(y<0)return null;const w=h.aX(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),E=w/T,A=T;return{tMin:Math.min(E,A),tMax:Math.max(E,A)}}unprojectScreenPoint(e){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(r,l);if(d){const A=h.bp();h.aS(A,r,[l[0]*d.tMin,l[1]*d.tMin,l[2]*d.tMin]);const I=h.bp();return h.aV(I,A),Gl(I)}const g=this._cachedClippingPlane,y=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],w=-h.b1(g,r)/y,T=h.bp();if(w>0)h.aS(T,r,[l[0]*w,l[1]*w,l[2]*w]);else{const A=h.bp();h.aS(A,r,[2*l[0],2*l[1],2*l[2]]);const I=h.b1(this._cachedClippingPlane,A);h.aU(T,A,[this._cachedClippingPlane[0]*I,this._cachedClippingPlane[1]*I,this._cachedClippingPlane[2]*I])}const E=(function(A){const I=h.bp();return I[0]=A[0]*-A[3],I[1]=A[1]*-A[3],I[2]=A[2]*-A[3],{center:I,radius:Math.sqrt(1-A[3]*A[3])}})(g);return Gl((function(A,I,D){const O=h.bp();h.aU(O,D,A);const q=h.bp();return h.bq(q,A,O,I/h.a$(O)),q})(E.center,E.radius,T))}getMatrixForModel(e,r){const l=h.S.convert(e),d=1/h.bu,g=h.b9();return h.bz(g,g,l.lng/180*Math.PI),h.b7(g,g,-l.lat/180*Math.PI),h.M(g,g,[0,0,1+r/h.bu]),h.b7(g,g,.5*Math.PI),h.N(g,g,[d,d,d]),g}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new h.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Eo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new la({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new bi,this._verticalPerspectiveTransform=new Xl}clone(){const e=new Eo;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return h.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,l){const d=this._mercatorTransform.getPitchedTextCorrection(e,r,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,l);return h.bk(d,g,this._globeness)}projectTileCoordinates(e,r,l,d){return this.currentTransform.projectTileCoordinates(e,r,l,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,d)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class ma{get useGlobeControls(){return!0}handlePanInertia(e,r){const l=Ih(e,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const l=e.around,d=r.screenPointToLocation(l);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const g=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const y=r.zoom-g;if(y===0)return;const w=h.bA(r.center.lng,d.lng),T=w/(Math.abs(w/180)+1),E=h.bA(r.center.lat,d.lat),A=r.getRayDirectionFromPixel(l),I=r.cameraPosition,D=-1*h.aX(I,A),O=h.bp();h.aS(O,I,[A[0]*D,A[1]*D,A[2]*D]);const q=h.aZ(O)-1,K=Math.exp(.5*-Math.max(q-.3,0)),W=ll(r.worldSize,r.center.lat)/Math.min(r.width,r.height),Q=h.bn(W,.9,.5,1,.25),ee=(1-h.af(-y))*Math.min(K,Q),ne=r.center.lat,ie=r.zoom,ce=new h.S(r.center.lng+T*ee,h.ah(r.center.lat+E*ee,-h.ai,h.ai));r.setLocationAtPoint(d,l);const de=r.center,ae=h.bn(Math.abs(w),45,85,0,1),me=h.bn(W,.75,.35,0,1),ze=Math.pow(Math.max(ae,me),.25),Ee=h.bA(de.lng,ce.lng),Ae=h.bA(de.lat,ce.lat);r.setCenter(new h.S(de.lng+Ee*ze,de.lat+Ae*ze).wrap()),r.setZoom(ie+nn(ne,r.center.lat))}handleMapControlsPan(e,r,l){if(!e.panDelta)return;const d=r.center.lat,g=r.zoom;r.setCenter(Ih(e.panDelta,r).wrap()),r.setZoom(g+nn(d,r.center.lat))}cameraForBoxAndBearing(e,r,l,d,g){const y=bn(e,r,l,d,g),w=r.left/g.width*2-1,T=(g.width-r.right)/g.width*2-1,E=r.top/g.height*-2+1,A=(g.height-r.bottom)/g.height*-2+1,I=h.bA(l.getWest(),l.getEast())<0,D=I?l.getEast():l.getWest(),O=I?l.getWest():l.getEast(),q=Math.max(l.getNorth(),l.getSouth()),K=Math.min(l.getNorth(),l.getSouth()),W=D+.5*h.bA(D,O),Q=q+.5*h.bA(q,K),ee=g.clone();ee.setCenter(y.center),ee.setBearing(y.bearing),ee.setPitch(0),ee.setRoll(0),ee.setZoom(y.zoom);const ne=ee.modelViewProjectionMatrix,ie=[qn(l.getNorthWest()),qn(l.getNorthEast()),qn(l.getSouthWest()),qn(l.getSouthEast()),qn(new h.S(O,Q)),qn(new h.S(D,Q)),qn(new h.S(W,q)),qn(new h.S(W,K))],ce=qn(y.center);let de=Number.POSITIVE_INFINITY;for(const ae of ie)w<0&&(de=ma.getLesserNonNegativeNonNull(de,ma.solveVectorScale(ae,ce,ne,"x",w))),T>0&&(de=ma.getLesserNonNegativeNonNull(de,ma.solveVectorScale(ae,ce,ne,"x",T))),E>0&&(de=ma.getLesserNonNegativeNonNull(de,ma.solveVectorScale(ae,ce,ne,"y",E))),A<0&&(de=ma.getLesserNonNegativeNonNull(de,ma.solveVectorScale(ae,ce,ne,"y",A)));if(Number.isFinite(de)&&de!==0)return y.zoom=ee.zoom+h.ak(de),y;Cu()}handleJumpToCenterZoom(e,r){const l=e.center.lat,d=e.getConstrained(r.center?h.S.convert(r.center):e.center,e.zoom).center;e.setCenter(d.wrap());const g=r.zoom!==void 0?+r.zoom:e.zoom+nn(l,d.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,r){const l=e.zoom,d=e.center,g=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},T=r.zoom!==void 0,E=!e.isPaddingEqual(r.padding);let A=!1;const I=r.center?h.S.convert(r.center):d,D=e.getConstrained(I,l).center;sr(e,D);const O=e.clone();O.setCenter(D),O.setZoom(T?+r.zoom:l+nn(d.lat,I.lat)),O.setBearing(r.bearing);const q=new h.P(h.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),h.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(D,q);const K=(r.offset&&r.offsetAsPoint.mag())>0?O.center:D,W=T?+r.zoom:l+nn(d.lat,K.lat),Q=l+nn(d.lat,0),ee=W+nn(K.lat,0),ne=h.bA(d.lng,K.lng),ie=h.bA(d.lat,K.lat),ce=h.af(ee-Q);return A=W!==l,{easeFunc:de=>{if(h.be(y,w)||Gn({startEulerAngles:y,endEulerAngles:w,tr:e,k:de,useSlerp:y.roll!=w.roll}),E&&e.interpolatePadding(g,r.padding,de),r.around)h.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const ae=ee>Q?Math.min(2,ce):Math.max(.5,ce),me=Math.pow(ae,1-de),ze=Eu(d,ne,ie,de*me);e.setCenter(ze.wrap())}if(A){const ae=h.C.number(Q,ee,de)+nn(0,e.center.lat);e.setZoom(ae)}},isZooming:A,elevationCenter:K}}handleFlyTo(e,r){const l=r.zoom!==void 0,d=e.center,g=e.zoom,y=e.padding,w=!e.isPaddingEqual(r.padding),T=e.getConstrained(h.S.convert(r.center||r.locationAtOffset),g).center,E=l?+r.zoom:e.zoom+nn(e.center.lat,T.lat),A=e.clone();A.setCenter(T),A.setZoom(E),A.setBearing(r.bearing);const I=new h.P(h.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),h.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));A.setLocationAtPoint(T,I);const D=A.center;sr(e,D);const O=(function(ie,ce,de){const ae=qn(ce),me=qn(de),ze=h.aX(ae,me),Ee=Math.acos(ze),Ae=Ys(ie);return Ee/(2*Math.PI)*Ae})(e,d,D),q=g+nn(d.lat,0),K=E+nn(D.lat,0),W=h.af(K-q);let Q;if(typeof r.minZoom=="number"){const ie=+r.minZoom+nn(D.lat,0),ce=Math.min(ie,q,K)+nn(0,D.lat),de=e.getConstrained(D,ce).zoom+nn(D.lat,0);Q=h.af(de-q)}const ee=h.bA(d.lng,D.lng),ne=h.bA(d.lat,D.lat);return{easeFunc:(ie,ce,de,ae)=>{const me=Eu(d,ee,ne,de);w&&e.interpolatePadding(y,r.padding,ie);const ze=ie===1?D:me;e.setCenter(ze.wrap());const Ee=q+h.ak(ce);e.setZoom(ie===1?E:Ee+nn(0,ze.lat))},scaleOfZoom:W,targetCenter:D,scaleOfMinZoom:Q,pixelPathLength:O}}static solveVectorScale(e,r,l,d,g){const y=d==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],E=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],A=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],I=r[0]*w[0]+r[1]*w[1]+r[2]*w[2];return A+g*E===T+g*I||w[3]*(T-A)+y[3]*(I-E)+T*I==A*E?null:(A+y[3]-g*I-g*w[3])/(A-T-g*I+g*E)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class Rh{constructor(e){this._globe=e,this._mercatorCameraHelper=new Jn,this._verticalPerspectiveCameraHelper=new ma}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,l){this.currentHelper.handleMapControlsPan(e,r,l)}cameraForBoxAndBearing(e,r,l,d,g){return this.currentHelper.cameraForBoxAndBearing(e,r,l,d,g)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const Ic=(m,e)=>h.y(m,e&&e.filter((r=>r.identifier!=="source.canvas"))),Lh=h.bE();class Au extends h.E{constructor(e,r={}){var l,d;super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const w=this.sourceCaches[y].getSource().type;w!=="vector"&&w!=="geojson"||this.sourceCaches[y].reload()}},this.map=e,this.dispatcher=new At(Et(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((y,w)=>this.getGlyphs(y,w))),this.dispatcher.registerMessageHandler("GI",((y,w)=>this.getImages(y,w))),this.dispatcher.registerMessageHandler("GDA",((y,w)=>this.getDashes(y,w))),this.imageManager=new Dn,this.imageManager.setEventedParent(this);const g=((l=e._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((d=document.documentElement)===null||d===void 0?void 0:d.lang)||void 0;this.glyphManager=new da(e._requestManager,r.localIdeographFontFamily,g),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new So,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",h.bG()),hs().on(Nn,this._rtlPluginLoaded),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const w=this.sourceCaches[y.sourceId];if(!w)return;const T=w.getSource();if(T&&T.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===T.id&&this._validateLayer(A)}}))}setGlobalStateProperty(e,r){var l,d,g;this._checkLoaded();const y=r===null?(g=(d=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||d===void 0?void 0:d.default)!==null&&g!==void 0?g:null:r;if(h.bH(y,this._globalState[e]))return this;this._globalState[e]=y,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const l in e)!h.bH(this._globalState[l],e[l].default)&&(r.push(l),this._globalState[l]=e[l].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;const r=new Set,l={};for(const d of e){l[d]=this._globalState[d];for(const g in this._layers){const y=this._layers[g],w=y.getLayoutAffectingGlobalStateRefs(),T=y.getPaintAffectingGlobalStateRefs();if(w.has(d)&&r.add(y.source),T.has(d))for(const{name:E,value:A}of T.get(d))this._updatePaintProperty(y,E,A)}}this.dispatcher.broadcast("UGS",l);for(const d in this.sourceCaches)r.has(d)&&(this._reloadSource(d),this._changed=!0)}loadURL(e,r={},l){this.fire(new h.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;h.j(d,this._loadStyleRequest).then((y=>{this._loadStyleRequest=null,this._load(y.data,r,l)})).catch((y=>{this._loadStyleRequest=null,y&&!g.signal.aborted&&this.fire(new h.k(y))}))}loadJSON(e,r={},l){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ne.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,l)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(Lh,{validate:!1})}_load(e,r,l){var d,g;let y=r.transformStyle?r.transformStyle(l,e):e;if(!r.validate||!Ic(this,h.z(y))){y=Object.assign({},y),this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Fe(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Ct(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var e;const r=h.bI(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",r),this._order=r.map((l=>l.id)),this._layers={},this._serializedLayers=null;for(const l of r){const d=h.bJ(l,this._globalState);d.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=d}}_loadSprite(e,r=!1,l=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,y,w,T){return h._(this,void 0,void 0,(function*(){const E=ei(g),A=w>1?"@2x":"",I={},D={};for(const{id:O,url:q}of E){const K=y.transformRequest(Dt(q,A,".json"),"SpriteJSON");I[O]=h.j(K,T);const W=y.transformRequest(Dt(q,A,".png"),"SpriteImage");D[O]=Jt.getImage(W,T)}return yield Promise.all([...Object.values(I),...Object.values(D)]),(function(O,q){return h._(this,void 0,void 0,(function*(){const K={};for(const W in O){K[W]={};const Q=Ne.getImageCanvasContext((yield q[W]).data),ee=(yield O[W]).data;for(const ne in ee){const{width:ie,height:ce,x:de,y:ae,sdf:me,pixelRatio:ze,stretchX:Ee,stretchY:Ae,content:Pe,textFitWidth:Je,textFitHeight:Qe}=ee[ne];K[W][ne]={data:null,pixelRatio:ze,sdf:me,stretchX:Ee,stretchY:Ae,content:Pe,textFitWidth:Je,textFitHeight:Qe,spriteData:{width:ie,height:ce,x:de,y:ae,context:Q}}}}return K}))})(I,D)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const y in g){this._spritesImagesIds[y]=[];const w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter((T=>!(T in g))):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in g[y]){const E=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,g[y][T],!1):this.imageManager.addImage(E,g[y][T]),r&&(this._changedImages[E]=!0)}}})).catch((g=>{this._spriteRequest=null,d=g,this.fire(new h.k(d))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),l&&l(d)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const l=e.sourceLayer;if(!l)return;const d=r.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.k(new Error(`Source layer "${l}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?h.bK(l):l);const d=[];for(const g of e)if(l[g]){const y=r?h.bK(l[g]):l[g];d.push(y)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const d=this._layers[l];d.type!=="custom"&&(e[l]=d.serialize())}return e}hasTransitions(){var e,r,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const d=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(d.length||g.length)&&this._updateWorkerLayers(d,g);for(const y in this._updatedSources){const w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const d in this.sourceCaches){const g=this.sourceCaches[d];l[d]=g.used,g.used=!1}for(const d of this._order){const g=this._layers[d];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const d in l){const g=this.sourceCaches[d];!!l[d]!=!!g.used&&g.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var l;this._checkLoaded();const d=this.serialize();if(e=r.transformStyle?r.transformStyle(d,e):e,((l=r.validate)===null||l===void 0||l)&&Ic(this,h.z(e)))return!1;(e=h.bK(e)).layers=h.bI(e.layers);const g=h.bL(d,e),y=this._getOperationsToPerform(g);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],l=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":r.push((()=>{}));break;default:l.push(d.command)}return{operations:r,unimplemented:l}}addImage(e,r){if(this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(h.z.source,`sources.${e}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=this.sourceCaches[e]=new Zt(e,r,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e}))),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new h.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,l={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new h.k(new Error(`Layer "${d}" already exists on this map.`)));let g;if(e.type==="custom"){if(Ic(this,h.bM(e)))return;g=h.bJ(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=h.bK(e),e=h.e(e,{source:d})),this._validate(h.z.layer,`layers.${d}`,e,{arrayIndex:-1},l))return;g=h.bJ(e,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:d}})}const y=r?this._order.indexOf(r):this._order.length;if(r&&y===-1)this.fire(new h.k(new Error(`Cannot add layer "${d}" before non-existing layer "${r}".`)));else{if(this._order.splice(y,0,d),this._layerOrderChanged=!0,this._layers[d]=g,this._removedLayers[d]&&g.source&&g.type!=="custom"){const w=this._removedLayers[d];delete this._removedLayers[d],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const l=this._order.indexOf(e);this._order.splice(l,1);const d=r?this._order.indexOf(r):this._order.length;r&&d===-1?this.fire(new h.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,l){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===r&&d.maxzoom===l||(r!=null&&(d.minzoom=r),l!=null&&(d.maxzoom=l),this._updateLayer(d)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,l={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!h.bH(d.filter,r))return r==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(h.z.filter,`layers.${d.id}.filter`,r,null,l)||(d.setFilter(h.bK(r)),this._updateLayer(d)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.bK(this.getLayer(e).filter)}setLayoutProperty(e,r,l,d={}){this._checkLoaded();const g=this.getLayer(e);g?h.bH(g.getLayoutProperty(r),l)||(g.setLayoutProperty(r,l,d),this._updateLayer(g)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const l=this.getLayer(e);if(l)return l.getLayoutProperty(r);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,l,d={}){this._checkLoaded();const g=this.getLayer(e);g?h.bH(g.getPaintProperty(r),l)||this._updatePaintProperty(g,r,l,d):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,l,d={}){e.setPaintProperty(r,l,d)&&this._updateLayer(e),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const l=e.source,d=e.sourceLayer,g=this.sourceCaches[l];if(g===void 0)return void this.fire(new h.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=g.getSource().type;y==="geojson"&&d?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||d?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(d,e.id,r)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const l=e.source,d=this.sourceCaches[l];if(d===void 0)return void this.fire(new h.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=d.getSource().type,y=g==="vector"?e.sourceLayer:void 0;g!=="vector"||y?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(y,e.id,r):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,l=e.sourceLayer,d=this.sourceCaches[r];if(d!==void 0)return d.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(l,e.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.bN(this.sourceCaches,(g=>g.serialize())),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,d=this.stylesheet;return h.bO({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:r,terrain:l},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=y=>this._layers[y].type==="fill-extrusion",l={},d=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(r(w)){l[w]=y;for(const T of e){const E=T[w];if(E)for(const A of E)d.push(A)}}}d.sort(((y,w)=>w.intersectionZ-y.intersectionZ));const g=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(r(w))for(let T=d.length-1;T>=0;T--){const E=d[T].feature;if(l[E.layer.id]<y)break;g.push(E),d.pop()}else for(const T of e){const E=T[w];if(E)for(const A of E)g.push(A.feature)}}return g}queryRenderedFeatures(e,r,l){r&&r.filter&&this._validate(h.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const d={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of r.layers){const A=this._layers[E];if(!A)return this.fire(new h.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];d[A.source]=!0}}const g=[];r.availableImages=this._availableImages;const y=this._serializedAllLayers(),w=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:w,globalState:this._globalState});for(const E in this.sourceCaches)r.layers&&!d[E]||g.push(ui(this.sourceCaches[E],this._layers,y,e,T,l,this.map.terrain?(A,I,D)=>this.map.terrain.getElevation(A,I,D):void 0));return this.placement&&g.push((function(E,A,I,D,O,q,K){const W={},Q=q.queryRenderedSymbols(D),ee=[];for(const ne of Object.keys(Q).map(Number))ee.push(K[ne]);ee.sort(ir);for(const ne of ee){const ie=ne.featureIndex.lookupSymbolFeatures(Q[ne.bucketInstanceId],A,ne.bucketIndex,ne.sourceLayerIndex,{filterSpec:O.filter,globalState:O.globalState},O.layers,O.availableImages,E);for(const ce in ie){const de=W[ce]=W[ce]||[],ae=ie[ce];ae.sort(((me,ze)=>{const Ee=ne.featureSortOrder;if(Ee){const Ae=Ee.indexOf(me.featureIndex);return Ee.indexOf(ze.featureIndex)-Ae}return ze.featureIndex-me.featureIndex}));for(const me of ae)de.push(me)}}return(function(ne,ie,ce){for(const de in ne)for(const ae of ne[de])nr(ae,ce[ie[de].source]);return ne})(W,E,I)})(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,r){r!=null&&r.filter&&this._validate(h.z.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.sourceCaches[e];return l?(function(d,g){const y=d.getRenderableIds().map((E=>d.getTileByID(E))),w=[],T={};for(let E=0;E<y.length;E++){const A=y[E],I=A.tileID.canonical.key;T[I]||(T[I]=!0,A.querySourceFeatures(w,g))}return w})(l,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const l=this.light.getLight();let d=!1;for(const y in e)if(!h.bH(e[y],l[y])){d=!0;break}if(!d)return;const g={now:Ne.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const l=this.getSky();let d=!1;if(!e&&!l)return;if(e&&!l)d=!0;else if(!e&&l)d=!0;else for(const y in e)if(!h.bH(e[y],l[y])){d=!0;break}if(!d)return;const g={now:Ne.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(g)}_setProjectionInternal(e){const r=(function(l){if(Array.isArray(l)){const d=new ol({type:l});return{projection:d,transform:new Eo,cameraHelper:new Rh(d)}}switch(l){case"mercator":return{projection:new $t,transform:new bi,cameraHelper:new Jn};case"globe":{const d=new ol({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Eo,cameraHelper:new Rh(d)}}case"vertical-perspective":return{projection:new Zl,transform:new Xl,cameraHelper:new ma};default:return h.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new $t,transform:new bi,cameraHelper:new Jn}}})(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,r,l,d,g={}){return(!g||g.validate!==!1)&&Ic(this,e.call(h.z,h.e({key:r,style:this.serialize(),value:l,styleSpec:h.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),hs().off(Nn,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const l=this.sourceCaches[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,l,d,g=!1){let y=!1,w=!1;const T={};for(const E of this._order){const A=this._layers[E];if(A.type!=="symbol")continue;if(!T[A.source]){const D=this.sourceCaches[A.source];T[A.source]=D.getRenderableIds(!0).map((O=>D.getTileByID(O))).sort(((O,q)=>q.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(q.tileID)?-1:1)))}const I=this.crossTileSymbolIndex.addLayer(A,T[A.source],e.center.lng);y=y||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ne.now(),e.zoom))&&(this.pauseablePlacement=new La(e,this.map.terrain,this._order,g,r,l,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ne.now()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(const E of this._order){const A=this._layers[E];A.type==="symbol"&&this.placement.updateLayerOpacities(A,T[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ne.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return h._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,r.icons),l}))}getGlyphs(e,r){return h._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(h.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,r){return h._(this,void 0,void 0,(function*(){const l={};for(const[d,g]of Object.entries(r.dashes))l[d]=this.lineAtlas.getDash(g.dasharray,g.round);return l}))}addSprite(e,r,l={},d){this._checkLoaded();const g=[{id:e,url:r}],y=[...ei(this.stylesheet.sprite),...g];this._validate(h.z.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(g,!0,d))}removeSprite(e){this._checkLoaded();const r=ei(this.stylesheet.sprite);if(r.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ei(this.stylesheet.sprite)}setSprite(e,r={},l){this._checkLoaded(),e&&this._validate(h.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Od=h.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Fd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,l,d,g,y,w,T,E){this.context=e;let A=this.boundPaintVertexBuffers.length!==d.length;for(let I=0;!A&&I<d.length;I++)this.boundPaintVertexBuffers[I]!==d[I]&&(A=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==E?this.freshBind(r,l,d,g,y,w,T,E):(e.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),T&&T.bind(),E&&E.bind())}freshBind(e,r,l,d,g,y,w,T){const E=e.numAttributes,A=this.context,I=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=d,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,r.enableAttributes(I,e);for(const D of l)D.enableAttributes(I,e);y&&y.enableAttributes(I,e),w&&w.enableAttributes(I,e),T&&T.enableAttributes(I,e),r.bind(),r.setVertexAttribPointers(I,e,g);for(const D of l)D.bind(),D.setVertexAttribPointers(I,e,g);y&&(y.bind(),y.setVertexAttribPointers(I,e,g)),d&&d.bind(),w&&(w.bind(),w.setVertexAttribPointers(I,e,g)),T&&(T.bind(),T.setVertexAttribPointers(I,e,g)),A.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Rc=(m,e,r,l,d)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):h.bf.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):h.bf.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),zu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ao(m){const e=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const l=m[r].split(" ");e.push(l.pop())}return e}class Pu{constructor(e,r,l,d,g,y,w,T,E=[]){const A=e.gl;this.program=A.createProgram();const I=Ao(r.staticAttributes),D=l?l.getBinderAttributes():[],O=I.concat(D),q=fa.prelude.staticUniforms?Ao(fa.prelude.staticUniforms):[],K=w.staticUniforms?Ao(w.staticUniforms):[],W=r.staticUniforms?Ao(r.staticUniforms):[],Q=l?l.getBinderUniforms():[],ee=q.concat(K).concat(W).concat(Q),ne=[];for(const Ee of ee)ne.indexOf(Ee)<0&&ne.push(Ee);const ie=l?l.defines():[];wr(A)&&ie.unshift("#version 300 es"),g&&ie.push("#define OVERDRAW_INSPECTOR;"),y&&ie.push("#define TERRAIN3D;"),T&&ie.push(T),E&&ie.push(...E);let ce=ie.concat(fa.prelude.fragmentSource,w.fragmentSource,r.fragmentSource).join(`
`),de=ie.concat(fa.prelude.vertexSource,w.vertexSource,r.vertexSource).join(`
`);wr(A)||(ce=(function(Ee){return Ee.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ce),de=(function(Ee){return Ee.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(de));const ae=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(ae,ce),A.compileShader(ae),!A.getShaderParameter(ae,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(ae)}`);A.attachShader(this.program,ae);const me=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(me,de),A.compileShader(me),!A.getShaderParameter(me,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(me)}`);A.attachShader(this.program,me),this.attributes={};const ze={};this.numAttributes=O.length;for(let Ee=0;Ee<this.numAttributes;Ee++)O[Ee]&&(A.bindAttribLocation(this.program,Ee,O[Ee]),this.attributes[O[Ee]]=Ee);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(me),A.deleteShader(ae);for(let Ee=0;Ee<ne.length;Ee++){const Ae=ne[Ee];if(Ae&&!ze[Ae]){const Pe=A.getUniformLocation(this.program,Ae);Pe&&(ze[Ae]=Pe)}}this.fixedUniforms=d(e,ze),this.terrainUniforms=((Ee,Ae)=>({u_depth:new h.bP(Ee,Ae.u_depth),u_terrain:new h.bP(Ee,Ae.u_terrain),u_terrain_dim:new h.bg(Ee,Ae.u_terrain_dim),u_terrain_matrix:new h.bR(Ee,Ae.u_terrain_matrix),u_terrain_unpack:new h.bS(Ee,Ae.u_terrain_unpack),u_terrain_exaggeration:new h.bg(Ee,Ae.u_terrain_exaggeration)}))(e,ze),this.projectionUniforms=((Ee,Ae)=>({u_projection_matrix:new h.bR(Ee,Ae.u_projection_matrix),u_projection_tile_mercator_coords:new h.bS(Ee,Ae.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.bS(Ee,Ae.u_projection_clipping_plane),u_projection_transition:new h.bg(Ee,Ae.u_projection_transition),u_projection_fallback_matrix:new h.bR(Ee,Ae.u_projection_fallback_matrix)}))(e,ze),this.binderUniforms=l?l.getUniforms(e,ze):[]}draw(e,r,l,d,g,y,w,T,E,A,I,D,O,q,K,W,Q,ee,ne){const ie=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(d),e.setColorMode(g),e.setCullFace(y),T){e.activeTexture.set(ie.TEXTURE2),ie.bindTexture(ie.TEXTURE_2D,T.depthTexture),e.activeTexture.set(ie.TEXTURE3),ie.bindTexture(ie.TEXTURE_2D,T.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(T[de])}if(E)for(const de in E)this.projectionUniforms[zu[de]].set(E[de]);if(w)for(const de in this.fixedUniforms)this.fixedUniforms[de].set(w[de]);W&&W.setUniforms(e,this.binderUniforms,q,{zoom:K});let ce=0;switch(r){case ie.LINES:ce=2;break;case ie.TRIANGLES:ce=3;break;case ie.LINE_STRIP:ce=1}for(const de of O.get()){const ae=de.vaos||(de.vaos={});(ae[A]||(ae[A]=new Fd)).bind(e,this,I,W?W.getPaintVertexBuffers():[],D,de.vertexOffset,Q,ee,ne),ie.drawElements(r,de.primitiveLength*ce,ie.UNSIGNED_SHORT,de.primitiveOffset*ce*2)}}}function Lc(m,e,r){const l=1/h.aC(r,1,e.transform.tileZoom),d=Math.pow(2,r.tileID.overscaledZ),g=r.tileSize*Math.pow(2,e.transform.tileZoom)/d,y=g*(r.tileID.canonical.x+r.tileID.wrap*d),w=g*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}const Tr=(m,e,r,l)=>{const d=m.style.light,g=d.properties.get("position"),y=[g.x,g.y,g.z],w=h.bV();d.properties.get("anchor")==="viewport"&&h.bW(w,m.transform.bearingInRadians),h.bX(y,y,w);const T=m.transform.transformLightDirection(y),E=d.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:l}},Du=(m,e,r,l,d,g,y)=>h.e(Tr(m,e,r,l),Lc(g,m,y),{u_height_factor:-Math.pow(2,d.overscaledZ)/y.tileSize/8}),Ks=(m,e,r,l)=>h.e(Lc(e,m,r),{u_fill_translate:l}),Yl=(m,e)=>({u_world:m,u_fill_translate:e}),ul=(m,e,r,l,d)=>h.e(Ks(m,e,r,d),{u_world:l}),kh=(m,e,r,l,d)=>{const g=m.transform;let y,w,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){const E=h.aC(e,1,g.zoom);y=!0,w=[E,E],T=E/(h.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else y=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:T,u_translate:l}},Kl=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Bh=m=>({u_viewport_size:[m.width,m.height]}),Ws=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),zo=(m,e,r,l)=>{const d=h.aC(m,1,e)/(h.$*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:h.aC(m,1,e),u_intensity:r,u_globe_extrude_scale:d}},Iu=(m,e,r,l)=>{const d=h.L();h.bY(d,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:d,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Ud=(m,e,r)=>{const l=r.paint.get("hillshade-accent-color");let d;switch(r.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const g=r.getIlluminationProperties();for(let y=0;y<g.directionRadians.length;y++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[y]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:kc(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:l,u_method:d,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Oh=(m,e)=>{const r=e.stride,l=h.L();return h.bY(l,0,h.$,-h.$,0,0,1),h.M(l,l,[0,-h.$,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function kc(m,e){const r=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new h.a1(0,l/r).toLngLat().lat,new h.a1(0,(l+1)/r).toLngLat().lat]}const Ru=(m,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:m.paint.get("color-relief-opacity")}),Qs=(m,e,r,l)=>{const d=m.transform;return{u_translation:Oc(m,e,r),u_ratio:l/h.aC(e,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},hl=(m,e,r,l,d)=>h.e(Qs(m,e,r,l),{u_image:0,u_image_height:d}),Fh=(m,e,r,l,d)=>{const g=m.transform,y=Bc(e,g);return{u_translation:Oc(m,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:l/h.aC(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[y,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},jr=(m,e,r,l,d)=>{const g=Bc(e,m.transform);return h.e(Qs(m,e,r,l),{u_tileratio:g,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image:0,u_mix:d.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Bc(m,e){return 1/h.aC(m,1,e.tileZoom)}function Oc(m,e,r){return h.aD(m.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Po=(m,e,r,l,d)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Lu(l.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var g,y};function Lu(m){m*=Math.PI/180;const e=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const dl=(m,e,r,l,d,g,y,w,T,E,A,I,D)=>{const O=y.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:O.width/O.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+A,u_pitch_with_map:+l,u_is_along_line:d,u_is_variable_anchor:g,u_texsize:I,u_texture:0,u_translation:E,u_pitched_scale:D}},ku=(m,e,r,l,d,g,y,w,T,E,A,I,D,O)=>{const q=y.transform;return h.e(dl(m,e,r,l,d,g,y,w,T,E,A,I,O),{u_gamma_scale:l?Math.cos(q.pitch*Math.PI/180)*q.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Uh=(m,e,r,l,d,g,y,w,T,E,A,I,D)=>h.e(ku(m,e,r,l,d,g,y,w,T,E,!0,A,0,D),{u_texsize_icon:I,u_texture_icon:1}),jh=(m,e)=>({u_opacity:m,u_color:e}),Nh=(m,e,r,l,d)=>h.e((function(g,y,w,T){const E=w.imageManager.getPattern(g.from.toString()),A=w.imageManager.getPattern(g.to.toString()),{width:I,height:D}=w.imageManager.getPixelSize(),O=Math.pow(2,T.tileID.overscaledZ),q=T.tileSize*Math.pow(2,w.transform.tileZoom)/O,K=q*(T.tileID.canonical.x+T.tileID.wrap*O),W=q*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[I,D],u_mix:y.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/h.aC(T,1,w.transform.tileZoom),u_pixel_coord_upper:[K>>16,W>>16],u_pixel_coord_lower:[65535&K,65535&W]}})(r,d,e,l),{u_opacity:m}),Bu=(m,e)=>{},Ou={fillExtrusion:(m,e)=>({u_lightpos:new h.bT(m,e.u_lightpos),u_lightpos_globe:new h.bT(m,e.u_lightpos_globe),u_lightintensity:new h.bg(m,e.u_lightintensity),u_lightcolor:new h.bT(m,e.u_lightcolor),u_vertical_gradient:new h.bg(m,e.u_vertical_gradient),u_opacity:new h.bg(m,e.u_opacity),u_fill_translate:new h.bU(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new h.bT(m,e.u_lightpos),u_lightpos_globe:new h.bT(m,e.u_lightpos_globe),u_lightintensity:new h.bg(m,e.u_lightintensity),u_lightcolor:new h.bT(m,e.u_lightcolor),u_vertical_gradient:new h.bg(m,e.u_vertical_gradient),u_height_factor:new h.bg(m,e.u_height_factor),u_opacity:new h.bg(m,e.u_opacity),u_fill_translate:new h.bU(m,e.u_fill_translate),u_image:new h.bP(m,e.u_image),u_texsize:new h.bU(m,e.u_texsize),u_pixel_coord_upper:new h.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(m,e.u_pixel_coord_lower),u_scale:new h.bT(m,e.u_scale),u_fade:new h.bg(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new h.bU(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new h.bP(m,e.u_image),u_texsize:new h.bU(m,e.u_texsize),u_pixel_coord_upper:new h.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(m,e.u_pixel_coord_lower),u_scale:new h.bT(m,e.u_scale),u_fade:new h.bg(m,e.u_fade),u_fill_translate:new h.bU(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new h.bU(m,e.u_world),u_fill_translate:new h.bU(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new h.bU(m,e.u_world),u_image:new h.bP(m,e.u_image),u_texsize:new h.bU(m,e.u_texsize),u_pixel_coord_upper:new h.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(m,e.u_pixel_coord_lower),u_scale:new h.bT(m,e.u_scale),u_fade:new h.bg(m,e.u_fade),u_fill_translate:new h.bU(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new h.bg(m,e.u_camera_to_center_distance),u_scale_with_map:new h.bP(m,e.u_scale_with_map),u_pitch_with_map:new h.bP(m,e.u_pitch_with_map),u_extrude_scale:new h.bU(m,e.u_extrude_scale),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new h.bg(m,e.u_globe_extrude_scale),u_translate:new h.bU(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new h.bU(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new h.bU(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new h.bQ(m,e.u_color),u_overlay:new h.bP(m,e.u_overlay),u_overlay_scale:new h.bg(m,e.u_overlay_scale)}),depth:Bu,clippingMask:Bu,heatmap:(m,e)=>({u_extrude_scale:new h.bg(m,e.u_extrude_scale),u_intensity:new h.bg(m,e.u_intensity),u_globe_extrude_scale:new h.bg(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new h.bR(m,e.u_matrix),u_world:new h.bU(m,e.u_world),u_image:new h.bP(m,e.u_image),u_color_ramp:new h.bP(m,e.u_color_ramp),u_opacity:new h.bg(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new h.bP(m,e.u_image),u_latrange:new h.bU(m,e.u_latrange),u_exaggeration:new h.bg(m,e.u_exaggeration),u_altitudes:new h.b_(m,e.u_altitudes),u_azimuths:new h.b_(m,e.u_azimuths),u_accent:new h.bQ(m,e.u_accent),u_method:new h.bP(m,e.u_method),u_shadows:new h.bZ(m,e.u_shadows),u_highlights:new h.bZ(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new h.bR(m,e.u_matrix),u_image:new h.bP(m,e.u_image),u_dimension:new h.bU(m,e.u_dimension),u_zoom:new h.bg(m,e.u_zoom),u_unpack:new h.bS(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new h.bP(m,e.u_image),u_unpack:new h.bS(m,e.u_unpack),u_dimension:new h.bU(m,e.u_dimension),u_elevation_stops:new h.bP(m,e.u_elevation_stops),u_color_stops:new h.bP(m,e.u_color_stops),u_color_ramp_size:new h.bP(m,e.u_color_ramp_size),u_opacity:new h.bg(m,e.u_opacity)}),line:(m,e)=>({u_translation:new h.bU(m,e.u_translation),u_ratio:new h.bg(m,e.u_ratio),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.bU(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new h.bU(m,e.u_translation),u_ratio:new h.bg(m,e.u_ratio),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.bU(m,e.u_units_to_pixels),u_image:new h.bP(m,e.u_image),u_image_height:new h.bg(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new h.bU(m,e.u_translation),u_texsize:new h.bU(m,e.u_texsize),u_ratio:new h.bg(m,e.u_ratio),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_image:new h.bP(m,e.u_image),u_units_to_pixels:new h.bU(m,e.u_units_to_pixels),u_scale:new h.bT(m,e.u_scale),u_fade:new h.bg(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new h.bU(m,e.u_translation),u_ratio:new h.bg(m,e.u_ratio),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_units_to_pixels:new h.bU(m,e.u_units_to_pixels),u_image:new h.bP(m,e.u_image),u_mix:new h.bg(m,e.u_mix),u_tileratio:new h.bg(m,e.u_tileratio),u_crossfade_from:new h.bg(m,e.u_crossfade_from),u_crossfade_to:new h.bg(m,e.u_crossfade_to),u_lineatlas_width:new h.bg(m,e.u_lineatlas_width),u_lineatlas_height:new h.bg(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new h.bU(m,e.u_tl_parent),u_scale_parent:new h.bg(m,e.u_scale_parent),u_buffer_scale:new h.bg(m,e.u_buffer_scale),u_fade_t:new h.bg(m,e.u_fade_t),u_opacity:new h.bg(m,e.u_opacity),u_image0:new h.bP(m,e.u_image0),u_image1:new h.bP(m,e.u_image1),u_brightness_low:new h.bg(m,e.u_brightness_low),u_brightness_high:new h.bg(m,e.u_brightness_high),u_saturation_factor:new h.bg(m,e.u_saturation_factor),u_contrast_factor:new h.bg(m,e.u_contrast_factor),u_spin_weights:new h.bT(m,e.u_spin_weights),u_coords_top:new h.bS(m,e.u_coords_top),u_coords_bottom:new h.bS(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new h.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bP(m,e.u_is_size_feature_constant),u_size_t:new h.bg(m,e.u_size_t),u_size:new h.bg(m,e.u_size),u_camera_to_center_distance:new h.bg(m,e.u_camera_to_center_distance),u_pitch:new h.bg(m,e.u_pitch),u_rotate_symbol:new h.bP(m,e.u_rotate_symbol),u_aspect_ratio:new h.bg(m,e.u_aspect_ratio),u_fade_change:new h.bg(m,e.u_fade_change),u_label_plane_matrix:new h.bR(m,e.u_label_plane_matrix),u_coord_matrix:new h.bR(m,e.u_coord_matrix),u_is_text:new h.bP(m,e.u_is_text),u_pitch_with_map:new h.bP(m,e.u_pitch_with_map),u_is_along_line:new h.bP(m,e.u_is_along_line),u_is_variable_anchor:new h.bP(m,e.u_is_variable_anchor),u_texsize:new h.bU(m,e.u_texsize),u_texture:new h.bP(m,e.u_texture),u_translation:new h.bU(m,e.u_translation),u_pitched_scale:new h.bg(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new h.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bP(m,e.u_is_size_feature_constant),u_size_t:new h.bg(m,e.u_size_t),u_size:new h.bg(m,e.u_size),u_camera_to_center_distance:new h.bg(m,e.u_camera_to_center_distance),u_pitch:new h.bg(m,e.u_pitch),u_rotate_symbol:new h.bP(m,e.u_rotate_symbol),u_aspect_ratio:new h.bg(m,e.u_aspect_ratio),u_fade_change:new h.bg(m,e.u_fade_change),u_label_plane_matrix:new h.bR(m,e.u_label_plane_matrix),u_coord_matrix:new h.bR(m,e.u_coord_matrix),u_is_text:new h.bP(m,e.u_is_text),u_pitch_with_map:new h.bP(m,e.u_pitch_with_map),u_is_along_line:new h.bP(m,e.u_is_along_line),u_is_variable_anchor:new h.bP(m,e.u_is_variable_anchor),u_texsize:new h.bU(m,e.u_texsize),u_texture:new h.bP(m,e.u_texture),u_gamma_scale:new h.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_is_halo:new h.bP(m,e.u_is_halo),u_translation:new h.bU(m,e.u_translation),u_pitched_scale:new h.bg(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new h.bP(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bP(m,e.u_is_size_feature_constant),u_size_t:new h.bg(m,e.u_size_t),u_size:new h.bg(m,e.u_size),u_camera_to_center_distance:new h.bg(m,e.u_camera_to_center_distance),u_pitch:new h.bg(m,e.u_pitch),u_rotate_symbol:new h.bP(m,e.u_rotate_symbol),u_aspect_ratio:new h.bg(m,e.u_aspect_ratio),u_fade_change:new h.bg(m,e.u_fade_change),u_label_plane_matrix:new h.bR(m,e.u_label_plane_matrix),u_coord_matrix:new h.bR(m,e.u_coord_matrix),u_is_text:new h.bP(m,e.u_is_text),u_pitch_with_map:new h.bP(m,e.u_pitch_with_map),u_is_along_line:new h.bP(m,e.u_is_along_line),u_is_variable_anchor:new h.bP(m,e.u_is_variable_anchor),u_texsize:new h.bU(m,e.u_texsize),u_texsize_icon:new h.bU(m,e.u_texsize_icon),u_texture:new h.bP(m,e.u_texture),u_texture_icon:new h.bP(m,e.u_texture_icon),u_gamma_scale:new h.bg(m,e.u_gamma_scale),u_device_pixel_ratio:new h.bg(m,e.u_device_pixel_ratio),u_is_halo:new h.bP(m,e.u_is_halo),u_translation:new h.bU(m,e.u_translation),u_pitched_scale:new h.bg(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new h.bg(m,e.u_opacity),u_color:new h.bQ(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new h.bg(m,e.u_opacity),u_image:new h.bP(m,e.u_image),u_pattern_tl_a:new h.bU(m,e.u_pattern_tl_a),u_pattern_br_a:new h.bU(m,e.u_pattern_br_a),u_pattern_tl_b:new h.bU(m,e.u_pattern_tl_b),u_pattern_br_b:new h.bU(m,e.u_pattern_br_b),u_texsize:new h.bU(m,e.u_texsize),u_mix:new h.bg(m,e.u_mix),u_pattern_size_a:new h.bU(m,e.u_pattern_size_a),u_pattern_size_b:new h.bU(m,e.u_pattern_size_b),u_scale_a:new h.bg(m,e.u_scale_a),u_scale_b:new h.bg(m,e.u_scale_b),u_pixel_coord_upper:new h.bU(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bU(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bg(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new h.bP(m,e.u_texture),u_ele_delta:new h.bg(m,e.u_ele_delta),u_fog_matrix:new h.bR(m,e.u_fog_matrix),u_fog_color:new h.bQ(m,e.u_fog_color),u_fog_ground_blend:new h.bg(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bg(m,e.u_fog_ground_blend_opacity),u_horizon_color:new h.bQ(m,e.u_horizon_color),u_horizon_fog_blend:new h.bg(m,e.u_horizon_fog_blend),u_is_globe_mode:new h.bg(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new h.bg(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new h.bP(m,e.u_texture),u_terrain_coords_id:new h.bg(m,e.u_terrain_coords_id),u_ele_delta:new h.bg(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new h.bg(m,e.u_input),u_output_expected:new h.bg(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new h.bT(m,e.u_sun_pos),u_atmosphere_blend:new h.bg(m,e.u_atmosphere_blend),u_globe_position:new h.bT(m,e.u_globe_position),u_globe_radius:new h.bg(m,e.u_globe_radius),u_inv_proj_matrix:new h.bR(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new h.bQ(m,e.u_sky_color),u_horizon_color:new h.bQ(m,e.u_horizon_color),u_horizon:new h.bU(m,e.u_horizon),u_horizon_normal:new h.bU(m,e.u_horizon_normal),u_sky_horizon_blend:new h.bg(m,e.u_sky_horizon_blend),u_sky_blend:new h.bg(m,e.u_sky_blend)})};class Vh{constructor(e,r,l){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ga={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ka{constructor(e,r,l,d){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let l=0;l<this.attributes.length;l++){const d=r.attributes[this.attributes[l].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,r,l){for(let d=0;d<this.attributes.length;d++){const g=this.attributes[d],y=r.attributes[g.name];y!==void 0&&e.vertexAttribPointer(y,g.components,e[ga[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class li{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fc extends li{getDefault(){return h.bf.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Uc extends li{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Fu extends li{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Wl extends li{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Do extends li{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Js extends li{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Uu extends li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ql extends li{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ju extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Zh extends li{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class eo extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class fl extends li{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class jc extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Jl extends li{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Nr extends li{getDefault(){return h.bf.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ec extends li{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Nc extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class to extends li{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tc extends li{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class pl extends li{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class or extends li{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Nu extends li{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Vu extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ic extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ca extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Io extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ma extends li{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Vr extends li{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const l=this.gl;wr(l)?l.bindVertexArray(e):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ml extends li{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class nc extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ys extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Zr extends li{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class io extends Zr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Vc extends Zr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Gt extends Zr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Gr="Framebuffer is not complete";class jd{constructor(e,r,l,d,g){this.context=e,this.width=r,this.height=l;const y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new io(e,w),d)this.depthAttachment=g?new Gt(e,w):new Vc(e,w);else if(g)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(Gr)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Oa{constructor(e){var r,l;if(this.gl=e,this.clearColor=new Fc(this),this.clearDepth=new Uc(this),this.clearStencil=new Fu(this),this.colorMask=new Wl(this),this.depthMask=new Do(this),this.stencilMask=new Js(this),this.stencilFunc=new Uu(this),this.stencilOp=new Ql(this),this.stencilTest=new ju(this),this.depthRange=new Zh(this),this.depthTest=new eo(this),this.depthFunc=new fl(this),this.blend=new jc(this),this.blendFunc=new Jl(this),this.blendColor=new Nr(this),this.blendEquation=new ec(this),this.cullFace=new Nc(this),this.cullFaceSide=new to(this),this.frontFace=new tc(this),this.program=new pl(this),this.activeTexture=new or(this),this.viewport=new Nu(this),this.bindFramebuffer=new Vu(this),this.bindRenderbuffer=new ic(this),this.bindTexture=new ca(this),this.bindVertexBuffer=new Io(this),this.bindElementBuffer=new Ma(this),this.bindVertexArray=new Vr(this),this.pixelStoreUnpack=new ml(this),this.pixelStoreUnpackPremultiplyAlpha=new nc(this),this.pixelStoreUnpackFlipY=new ys(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),wr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:d==null?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Vh(this,e,r)}createVertexBuffer(e,r,l){return new Ka(this,e,r,l)}createRenderbuffer(e,r,l){const d=this.gl,g=d.createRenderbuffer();return this.bindRenderbuffer.set(g),d.renderbufferStorage(d.RENDERBUFFER,e,r,l),this.bindRenderbuffer.set(null),g}createFramebuffer(e,r,l,d){return new jd(this,e,r,l,d)}clear({color:e,depth:r,stencil:l}){const d=this.gl;let g=0;e&&(g|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(g|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(g|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),d.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.bH(e.blendFunction,wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return wr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return wr(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let qr;function Hr(m,e,r,l,d){const g=m.context,y=m.transform,w=g.gl,T=m.useProgram("collisionBox"),E=[];let A=0,I=0;for(let Q=0;Q<l.length;Q++){const ee=l[Q],ne=e.getTile(ee).getBucket(r);if(!ne)continue;const ie=d?ne.textCollisionBox:ne.iconCollisionBox,ce=ne.collisionCircleArray;ce.length>0&&(E.push({circleArray:ce,circleOffset:I,coord:ee}),A+=ce.length/4,I=A),ie&&T.draw(g,w.LINES,It.disabled,Kt.disabled,m.colorModeForRenderPass(),wt.disabled,Kl(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),y.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,null,m.transform.zoom,null,null,ie.collisionVertexBuffer)}if(!d||!E.length)return;const D=m.useProgram("collisionCircle"),O=new h.b$;O.resize(4*A),O._trim();let q=0;for(const Q of E)for(let ee=0;ee<Q.circleArray.length/4;ee++){const ne=4*ee,ie=Q.circleArray[ne+0],ce=Q.circleArray[ne+1],de=Q.circleArray[ne+2],ae=Q.circleArray[ne+3];O.emplace(q++,ie,ce,de,ae,0),O.emplace(q++,ie,ce,de,ae,1),O.emplace(q++,ie,ce,de,ae,2),O.emplace(q++,ie,ce,de,ae,3)}(!qr||qr.length<2*A)&&(qr=(function(Q){const ee=2*Q,ne=new h.c1;ne.resize(ee),ne._trim();for(let ie=0;ie<ee;ie++){const ce=6*ie;ne.uint16[ce+0]=4*ie+0,ne.uint16[ce+1]=4*ie+1,ne.uint16[ce+2]=4*ie+2,ne.uint16[ce+3]=4*ie+2,ne.uint16[ce+4]=4*ie+3,ne.uint16[ce+5]=4*ie+0}return ne})(A));const K=g.createIndexBuffer(qr,!0),W=g.createVertexBuffer(O,h.c0.members,!0);for(const Q of E){const ee=Bh(m.transform);D.draw(g,w.TRIANGLES,It.disabled,Kt.disabled,m.colorModeForRenderPass(),wt.disabled,ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q.coord),null,r.id,W,K,h.aM.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,m.transform.zoom,null,null,null)}W.destroy(),K.destroy()}const Gh=h.ag(new Float32Array(16));function ac(m,e,r,l,d,g){const{horizontalAlign:y,verticalAlign:w}=h.aH(m);return new h.P((-(y-.5)*e/d+l[0])*g,(-(w-.5)*r/d+l[1])*g)}function Ro(m,e,r,l,d,g){const y=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(g);r||(w=w.rotate(-d));const T=y.add(w);return mn(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const w=Zn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(l.rotate(T))}return m.add(l)}function rc(m,e,r,l,d,g,y,w,T,E,A,I){const D=m.text.placedSymbolArray,O=m.text.dynamicLayoutVertexArray,q=m.icon.dynamicLayoutVertexArray,K={};O.clear();for(let W=0;W<D.length;W++){const Q=D.get(W),ee=Q.hidden||!Q.crossTileID||m.allowVerticalPlacement&&!Q.placedOrientation?null:l[Q.crossTileID];if(ee){const ne=new h.P(Q.anchorX,Q.anchorY),ie={getElevation:I,width:d.width,height:d.height,pitchedLabelPlaneMatrix:g,pitchWithMap:r,transform:d,tileAnchorPoint:ne,translation:E,unwrappedTileID:A},ce=r?Gs(ne.x,ne.y,ie):Zn(ne.x,ne.y,ie),de=Ve(d.cameraToCenterDistance,ce.signedDistanceFromCamera);let ae=h.ap(m.textSizeData,w,Q)*de/h.aB;r&&(ae*=m.tilePixelRatio/y);const{width:me,height:ze,anchor:Ee,textOffset:Ae,textBoxScale:Pe}=ee,Je=ac(Ee,me,ze,Ae,Pe,ae),Qe=d.getPitchedTextCorrection(ne.x+E[0],ne.y+E[1],A),qe=Ro(ce.point,ie,e,Je,-d.bearingInRadians,Qe),lt=m.allowVerticalPlacement&&Q.placedOrientation===h.ao.vertical?Math.PI/2:0;for(let Ot=0;Ot<Q.numGlyphs;Ot++)h.av(O,qe,lt);T&&Q.associatedIconIndex>=0&&(K[Q.associatedIconIndex]={shiftedAnchor:qe,angle:lt})}else Ta(Q.numGlyphs,O)}if(T){q.clear();const W=m.icon.placedSymbolArray;for(let Q=0;Q<W.length;Q++){const ee=W.get(Q);if(ee.hidden)Ta(ee.numGlyphs,q);else{const ne=K[Q];if(ne)for(let ie=0;ie<ee.numGlyphs;ie++)h.av(q,ne.shiftedAnchor,ne.angle);else Ta(ee.numGlyphs,q)}}m.icon.dynamicLayoutVertexBuffer.updateData(q)}m.text.dynamicLayoutVertexBuffer.updateData(O)}function sc(m,e,r){return r.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Lo(m,e,r,l,d,g,y,w,T,E,A,I,D){const O=m.context,q=O.gl,K=m.transform,W=w==="map",Q=T==="map",ee=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",ne=W&&!Q&&!ee,ie=!r.layout.get("symbol-sort-key").isConstant();let ce=!1;const de=m.getDepthModeForSublayer(0,It.ReadOnly),ae=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),me=[],ze=K.getCircleRadiusCorrection();for(const Ee of l){const Ae=e.getTile(Ee),Pe=Ae.getBucket(r);if(!Pe)continue;const Je=d?Pe.text:Pe.icon;if(!Je||!Je.segments.get().length||!Je.hasVisibleVertices)continue;const Qe=Je.programConfigurations.get(r.id),qe=d||Pe.sdfIcons,lt=d?Pe.textSizeData:Pe.iconSizeData,Ot=Q||K.pitch!==0,fi=m.useProgram(sc(qe,d,Pe),Qe),Ui=h.an(lt,K.zoom),Di=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ee);let Hi,ji,Fn,$i,Si=[0,0],Ai=null;if(d)ji=Ae.glyphAtlasTexture,Fn=q.LINEAR,Hi=Ae.glyphAtlasTexture.size,Pe.iconsInText&&(Si=Ae.imageAtlasTexture.size,Ai=Ae.imageAtlasTexture,$i=Ot||m.options.rotating||m.options.zooming||lt.kind==="composite"||lt.kind==="camera"?q.LINEAR:q.NEAREST);else{const wn=r.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;ji=Ae.imageAtlasTexture,Fn=qe||m.options.rotating||m.options.zooming||wn||Ot?q.LINEAR:q.NEAREST,Hi=Ae.imageAtlasTexture.size}const qt=h.aC(Ae,1,m.transform.zoom),Un=Vn(W,m.transform,qt),cr=h.L();h.aq(cr,Un);const fo=Ln(Q,W,m.transform,qt),is=h.aD(K,Ae,g,y),jo=K.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Tl=ae&&Pe.hasTextData(),zs=r.layout.get("icon-text-fit")!=="none"&&Tl&&Pe.hasIconData();if(ee){const wn=m.style.map.terrain?(xa,Ni)=>m.style.map.terrain.getElevation(Ee,xa,Ni):null,_n=r.layout.get("text-rotation-alignment")==="map";Ia(Pe,m,d,Un,cr,Q,E,_n,Ee.toUnwrapped(),K.width,K.height,is,wn)}const po=d&&ae||zs,Ga=ee||po?Gh:Q?Un:m.transform.clipSpaceToPixelsMatrix,Ps=qe&&r.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Er;Er=qe?Pe.iconsInText?Uh(lt.kind,Ui,ne,Q,ee,po,m,Ga,fo,is,Hi,Si,ze):ku(lt.kind,Ui,ne,Q,ee,po,m,Ga,fo,is,d,Hi,0,ze):dl(lt.kind,Ui,ne,Q,ee,po,m,Ga,fo,is,d,Hi,ze);const Ds={program:fi,buffers:Je,uniformValues:Er,projectionData:jo,atlasTexture:ji,atlasTextureIcon:Ai,atlasInterpolation:Fn,atlasInterpolationIcon:$i,isSDF:qe,hasHalo:Ps};if(ie&&Pe.canOverlap){ce=!0;const wn=Je.segments.get();for(const _n of wn)me.push({segments:new h.aM([_n]),sortKey:_n.sortKey,state:Ds,terrainData:Di})}else me.push({segments:Je.segments,sortKey:0,state:Ds,terrainData:Di})}ce&&me.sort(((Ee,Ae)=>Ee.sortKey-Ae.sortKey));for(const Ee of me){const Ae=Ee.state;if(O.activeTexture.set(q.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,q.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(O.activeTexture.set(q.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Ae.isSDF){const Pe=Ae.uniformValues;Ae.hasHalo&&(Pe.u_is_halo=1,gl(Ae.buffers,Ee.segments,r,m,Ae.program,de,A,I,Pe,Ae.projectionData,Ee.terrainData)),Pe.u_is_halo=0}gl(Ae.buffers,Ee.segments,r,m,Ae.program,de,A,I,Ae.uniformValues,Ae.projectionData,Ee.terrainData)}}function gl(m,e,r,l,d,g,y,w,T,E,A){const I=l.context;d.draw(I,I.gl.TRIANGLES,g,y,w,wt.backCCW,T,A,E,r.id,m.layoutVertexBuffer,m.indexBuffer,e,r.paint,l.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Fa(m,e,r,l,d){const g=m.context,y=g.gl,w=Kt.disabled,T=new wi([y.ONE,y.ONE],h.bf.transparent,[!0,!0,!0,!0]),E=e.getBucket(r);if(!E)return;const A=l.key;let I=r.heatmapFbos.get(A);I||(I=$r(g,e.tileSize,e.tileSize),r.heatmapFbos.set(A,I)),g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:h.bf.transparent});const D=E.programConfigurations.get(r.id),O=m.useProgram("heatmap",D,!d),q=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=m.style.map.terrain.getTerrainData(l);O.draw(g,y.TRIANGLES,It.disabled,w,T,wt.disabled,zo(e,m.transform.zoom,r.paint.get("heatmap-intensity"),1),K,q,r.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,r.paint,m.transform.zoom,D)}function ko(m,e,r,l,d){const g=m.context,y=g.gl,w=m.transform;g.setColorMode(m.colorModeForRenderPass());const T=no(g,e),E=r.key,A=e.heatmapFbos.get(E);if(!A)return;g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,A.colorAttachment.get()),g.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const I=w.getProjectionData({overscaledTileID:r,applyTerrainMatrix:d,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(g,y.TRIANGLES,It.disabled,Kt.disabled,m.colorModeForRenderPass(),wt.disabled,Iu(m,e,0,1),null,I,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,w.zoom),A.destroy(),e.heatmapFbos.delete(E)}function $r(m,e,r){var l,d;const g=m.gl,y=g.createTexture();g.bindTexture(g.TEXTURE_2D,y),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const w=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,T=(d=m.RGBA16F)!==null&&d!==void 0?d:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,T,e,r,0,g.RGBA,w,null);const E=m.createFramebuffer(e,r,!1,!1);return E.colorAttachment.set(y),E}function no(m,e){return e.colorRampTexture||(e.colorRampTexture=new h.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function vs(m,e,r,l,d){if(!r||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let y=g[r.to.toString()],w=g[r.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){const T=d.getPaintProperty(e);y=g[T],w=g[T]}y&&w&&m.setConstantPatternPositions(y,w)}function ta(m,e,r,l,d,g,y,w){const T=m.context.gl,E="fill-pattern",A=r.paint.get(E),I=A&&A.constantOr(1),D=r.getCrossfadeParameters();let O,q,K,W,Q;const ee=m.transform,ne=r.paint.get("fill-translate"),ie=r.paint.get("fill-translate-anchor");y?(q=I&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=T.LINES):(q=I?"fillPattern":"fill",O=T.TRIANGLES);const ce=A.constantOr(null);for(const de of l){const ae=e.getTile(de);if(I&&!ae.patternsLoaded())continue;const me=ae.getBucket(r);if(!me)continue;const ze=me.programConfigurations.get(r.id),Ee=m.useProgram(q,ze),Ae=m.style.map.terrain&&m.style.map.terrain.getTerrainData(de);I&&(m.context.activeTexture.set(T.TEXTURE0),ae.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),ze.updatePaintBuffers(D)),vs(ze,E,ce,ae,r);const Pe=ee.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),Je=h.aD(ee,ae,ne,ie);if(y){W=me.indexBuffer2,Q=me.segments2;const qe=[T.drawingBufferWidth,T.drawingBufferHeight];K=q==="fillOutlinePattern"&&I?ul(m,D,ae,qe,Je):Yl(qe,Je)}else W=me.indexBuffer,Q=me.segments,K=I?Ks(m,D,ae,Je):{u_fill_translate:Je};const Qe=m.stencilModeForClipping(de);Ee.draw(m.context,O,d,Qe,g,wt.backCCW,K,Ae,Pe,r.id,me.layoutVertexBuffer,W,Q,r.paint,m.transform.zoom,ze)}}function _a(m,e,r,l,d,g,y,w){const T=m.context,E=T.gl,A="fill-extrusion-pattern",I=r.paint.get(A),D=I.constantOr(1),O=r.getCrossfadeParameters(),q=r.paint.get("fill-extrusion-opacity"),K=I.constantOr(null),W=m.transform;for(const Q of l){const ee=e.getTile(Q),ne=ee.getBucket(r);if(!ne)continue;const ie=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),ce=ne.programConfigurations.get(r.id),de=m.useProgram(D?"fillExtrusionPattern":"fillExtrusion",ce);D&&(m.context.activeTexture.set(E.TEXTURE0),ee.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ce.updatePaintBuffers(O));const ae=W.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!w,applyTerrainMatrix:!0});vs(ce,A,K,ee,r);const me=h.aD(W,ee,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ze=r.paint.get("fill-extrusion-vertical-gradient"),Ee=D?Du(m,ze,q,me,Q,O,ee):Tr(m,ze,q,me);de.draw(T,T.gl.TRIANGLES,d,g,y,wt.backCCW,Ee,ie,ae,r.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,r.paint,m.transform.zoom,ce,m.style.map.terrain&&ne.centroidVertexBuffer)}}function Xr(m,e,r,l,d,g,y,w,T){var E;const A=m.style.projection,I=m.context,D=m.transform,O=I.gl,q=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],K=m.useProgram("hillshade",null,!1,q),W=!m.options.moving;for(const Q of l){const ee=e.getTile(Q),ne=ee.fbo;if(!ne)continue;const ie=A.getMeshFromTileID(I,Q.canonical,w,!0,"raster"),ce=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(Q);I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,ne.colorAttachment.get());const de=D.getProjectionData({overscaledTileID:Q,aligned:W,applyGlobeMatrix:!T,applyTerrainMatrix:!0});K.draw(I,O.TRIANGLES,g,d[Q.overscaledZ],y,wt.backCCW,Ud(m,ee,r),ce,de,r.id,ie.vertexBuffer,ie.indexBuffer,ie.segments)}}function ya(m,e,r,l,d,g,y,w,T){var E;const A=m.style.projection,I=m.context,D=m.transform,O=I.gl,q=m.useProgram("colorRelief"),K=!m.options.moving;let W=!0,Q=0;for(const ee of l){const ne=e.getTile(ee),ie=ne.dem;if(W){const Ee=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:Ae,colorTexture:Pe}=r.getColorRampTextures(I,Ee,ie.getUnpackVector());I.activeTexture.set(O.TEXTURE1),Ae.bind(O.NEAREST,O.CLAMP_TO_EDGE),I.activeTexture.set(O.TEXTURE4),Pe.bind(O.LINEAR,O.CLAMP_TO_EDGE),W=!1,Q=Ae.size[0]}if(!ie||!ie.data)continue;const ce=ie.stride,de=ie.getPixels();if(I.activeTexture.set(O.TEXTURE0),I.pixelStoreUnpackPremultiplyAlpha.set(!1),ne.demTexture=ne.demTexture||m.getTileTexture(ce),ne.demTexture){const Ee=ne.demTexture;Ee.update(de,{premultiply:!1}),Ee.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else ne.demTexture=new h.T(I,de,O.RGBA,{premultiply:!1}),ne.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const ae=A.getMeshFromTileID(I,ee.canonical,w,!0,"raster"),me=(E=m.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(ee),ze=D.getProjectionData({overscaledTileID:ee,aligned:K,applyGlobeMatrix:!T,applyTerrainMatrix:!0});q.draw(I,O.TRIANGLES,g,d[ee.overscaledZ],y,wt.backCCW,Ru(r,ne.dem,Q),me,ze,r.id,ae.vertexBuffer,ae.indexBuffer,ae.segments)}}const lr=[new h.P(0,0),new h.P(h.$,0),new h.P(h.$,h.$),new h.P(0,h.$)];function Wa(m,e,r,l,d,g,y,w,T=!1,E=!1){const A=l[l.length-1].overscaledZ,I=m.context,D=I.gl,O=m.useProgram("raster"),q=m.transform,K=m.style.projection,W=m.colorModeForRenderPass(),Q=!m.options.moving;for(const ee of l){const ne=m.getDepthModeForSublayer(ee.overscaledZ-A,r.paint.get("raster-opacity")===1?It.ReadWrite:It.ReadOnly,D.LESS),ie=e.getTile(ee);ie.registerFadeDuration(r.paint.get("raster-fade-duration"));const ce=e.findLoadedParent(ee,0),de=e.findLoadedSibling(ee),ae=oc(ie,ce||de||null,e,r,m.transform,m.style.map.terrain);let me,ze;const Ee=r.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;I.activeTexture.set(D.TEXTURE0),ie.texture.bind(Ee,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(D.TEXTURE1),ce?(ce.texture.bind(Ee,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),me=Math.pow(2,ce.tileID.overscaledZ-ie.tileID.overscaledZ),ze=[ie.tileID.canonical.x*me%1,ie.tileID.canonical.y*me%1]):ie.texture.bind(Ee,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),ie.texture.useMipmap&&I.extTextureFilterAnisotropic&&m.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Ae=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),Pe=q.getProjectionData({overscaledTileID:ee,aligned:Q,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),Je=Po(ze||[0,0],me||1,ae,r,w),Qe=K.getMeshFromTileID(I,ee.canonical,g,y,"raster");O.draw(I,D.TRIANGLES,ne,d?d[ee.overscaledZ]:Kt.disabled,W,T?wt.frontCCW:wt.backCCW,Je,Ae,Pe,r.id,Qe.vertexBuffer,Qe.indexBuffer,Qe.segments)}}function oc(m,e,r,l,d,g){const y=l.paint.get("raster-fade-duration");if(!g&&y>0){const w=Ne.now(),T=(w-m.timeAdded)/y,E=e?(w-e.timeAdded)/y:-1,A=r.getSource(),I=ct(d,{tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!e||Math.abs(e.tileID.overscaledZ-I)>Math.abs(m.tileID.overscaledZ-I),O=D&&m.refreshedUponExpiration?1:h.ah(D?T:1-E,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const lc=new h.bf(1,0,0,1),Zc=new h.bf(0,1,0,1),Zu=new h.bf(0,0,1,1),Bn=new h.bf(1,0,1,1),Oi=new h.bf(0,1,1,1);function ni(m,e,r,l){ai(m,0,e+r/2,m.transform.width,r,l)}function Yr(m,e,r,l){ai(m,e-r/2,0,r,m.transform.height,l)}function ai(m,e,r,l,d,g){const y=m.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*m.pixelRatio,r*m.pixelRatio,l*m.pixelRatio,d*m.pixelRatio),y.clear({color:g}),w.disable(w.SCISSOR_TEST)}function xs(m,e,r){const l=m.context,d=l.gl,g=m.useProgram("debug"),y=It.disabled,w=Kt.disabled,T=m.colorModeForRenderPass(),E="$debug",A=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);l.activeTexture.set(d.TEXTURE0);const I=e.getTileByID(r.key).latestRawTileData,D=Math.floor((I&&I.byteLength||0)/1024),O=e.getTile(r).tileSize,q=512/Math.min(O,512)*(r.overscaledZ/m.transform.zoom)*.5;let K=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(K+=` => ${r.overscaledZ}`),(function(Q,ee){Q.initDebugOverlayCanvas();const ne=Q.debugOverlayCanvas,ie=Q.context.gl,ce=Q.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,ne.width,ne.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(ee,5,5),ce.strokeText(ee,5,5),Q.debugOverlayTexture.update(ne),Q.debugOverlayTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)})(m,`${K} ${D}kB`);const W=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,d.TRIANGLES,y,w,wi.alphaBlended,wt.disabled,Ws(h.bf.transparent,q),null,W,E,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(l,d.LINE_STRIP,y,w,T,wt.disabled,Ws(h.bf.red),A,W,E,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function On(m,e,r,l){const{isRenderingGlobe:d}=l,g=m.context,y=g.gl,w=m.transform,T=m.colorModeForRenderPass(),E=m.getDepthModeFor3D(),A=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const I of r){const D=e.getTerrainMesh(I.tileID),O=m.renderToTexture.getTexture(I),q=e.getTerrainData(I.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,O.texture);const K=e.getMeshFrameDelta(w.zoom),W=w.calculateFogMatrix(I.tileID.toUnwrapped()),Q=Rc(K,W,m.style.sky,w.pitch,d),ee=w.getProjectionData({overscaledTileID:I.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});A.draw(g,y.TRIANGLES,E,Kt.disabled,T,wt.backCCW,Q,q,ee,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}function cc(m,e){if(!e.mesh){const r=new h.aL;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new h.aN;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Xs(m.createVertexBuffer(r,_s.members),m.createIndexBuffer(l),h.aM.simpleSegment(0,0,r.length,l.length))}return e.mesh}class uc{constructor(e,r){this.context=new Oa(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Zt.maxUnderzooming+Zt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new So}resize(e,r,l){if(this.width=Math.floor(e*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,r=new h.aL;r.emplaceBack(0,0),r.emplaceBack(h.$,0),r.emplaceBack(0,h.$),r.emplaceBack(h.$,h.$),this.tileExtentBuffer=e.createVertexBuffer(r,_s.members),this.tileExtentSegments=h.aM.simpleSegment(0,0,4,2);const l=new h.aL;l.emplaceBack(0,0),l.emplaceBack(h.$,0),l.emplaceBack(0,h.$),l.emplaceBack(h.$,h.$),this.debugBuffer=e.createVertexBuffer(l,_s.members),this.debugSegments=h.aM.simpleSegment(0,0,4,5);const d=new h.c6;d.emplaceBack(0,0,0,0),d.emplaceBack(h.$,0,h.$,0),d.emplaceBack(0,h.$,0,h.$),d.emplaceBack(h.$,h.$,h.$,h.$),this.rasterBoundsBuffer=e.createVertexBuffer(d,Od.members),this.rasterBoundsSegments=h.aM.simpleSegment(0,0,4,2);const g=new h.aL;g.emplaceBack(0,0),g.emplaceBack(h.$,0),g.emplaceBack(0,h.$),g.emplaceBack(h.$,h.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,_s.members),this.rasterBoundsSegmentsPosOnly=h.aM.simpleSegment(0,0,4,5);const y=new h.aL;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,_s.members),this.viewportSegments=h.aM.simpleSegment(0,0,4,2);const w=new h.c7;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const T=new h.aN;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const E=this.context.gl;this.stencilClearMode=new Kt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new Xs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.L();h.bY(l,0,this.width,this.height,0,0,1),h.N(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const d={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,It.disabled,this.stencilClearMode,wi.disabled,wt.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const d=this.context;d.setColorMode(wi.disabled),d.setDepthMode(It.disabled);const g={};for(const y of r)g[y.key]=this.nextStencilID++;this._renderTileMasks(g,r,l,!0),this._renderTileMasks(g,r,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,r,l,d){const g=this.context,y=g.gl,w=this.style.projection,T=this.transform,E=this.useProgram("clippingMask");for(const A of r){const I=e[A.key],D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),O=w.getMeshFromTileID(this.context,A.canonical,d,!0,"stencil"),q=T.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!l,applyTerrainMatrix:!0});E.draw(g,y.TRIANGLES,It.disabled,new Kt({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),wi.disabled,l?wt.disabled:wt.backCCW,null,D,q,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,l=this.style.projection,d=this.transform,g=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=be(d,{tileSize:d.tileSize});for(const T of w){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),A=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),I=d.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,r.TRIANGLES,y,Kt.disabled,wi.disabled,wt.backCCW,null,E,I,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Kt({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Kt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,l=e.sort(((y,w)=>w.overscaledZ-y.overscaledZ)),d=l[l.length-1].overscaledZ,g=l[0].overscaledZ-d+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const y={};for(let w=0;w<g;w++)y[w+d]=new Kt({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=g,[y,l]}return[{[d]:Kt.disabled},l]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,l=e.sort(((y,w)=>w.overscaledZ-y.overscaledZ)),d=l[l.length-1].overscaledZ,g=l[0].overscaledZ-d+1;if(this.clearStencil(),g>1){const y={},w={};for(let T=0;T<g;T++)y[T+d]=new Kt({func:r.GREATER,mask:255},g+1+T,255,r.KEEP,r.KEEP,r.REPLACE),w[T+d]=new Kt({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*g+1,[y,w,l]}return this.nextStencilID=3,[{[d]:new Kt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[d]:new Kt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new wi([e.CONSTANT_COLOR,e.ONE],new h.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wi.unblended:wi.alphaBlended}getDepthModeForSublayer(e,r,l){if(!this.opaquePassEnabledForLayer())return It.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new It(l||this.context.gl.LEQUAL,r,[d,d])}getDepthModeFor3D(){return new It(this.context.gl.LEQUAL,It.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var l,d;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ne.now()),this.imageManager.beginFrame();const g=this.style._order,y=this.style.sourceCaches,w={},T={},E={},A={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const D in y){const O=y[D];O.used&&O.prepare(this.context),w[D]=O.getVisibleCoordinates(!1),T[D]=w[D].slice().reverse(),E[D]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<g.length;D++)if(this.style._layers[g[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of g){const O=this.style._layers[D];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const q=T[O.source];(O.type==="custom"||q.length)&&this.renderLayer(this,y[O.source],O,q,A)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:D=>this.useProgram(D)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?h.bf.black:h.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(D,O){const q=D.context,K=q.gl,W=((de,ae,me)=>{const ze=Math.cos(ae.rollInRadians),Ee=Math.sin(ae.rollInRadians),Ae=le(ae),Pe=ae.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:de.properties.get("sky-color"),u_horizon_color:de.properties.get("horizon-color"),u_horizon:[(ae.width/2-Ae*Ee)*me,(ae.height/2+Ae*ze)*me],u_horizon_normal:[-Ee,ze],u_sky_horizon_blend:de.properties.get("sky-horizon-blend")*ae.height/2*me,u_sky_blend:Pe}})(O,D.style.map.transform,D.pixelRatio),Q=new It(K.LEQUAL,It.ReadWrite,[0,1]),ee=Kt.disabled,ne=D.colorModeForRenderPass(),ie=D.useProgram("sky"),ce=cc(q,O);ie.draw(q,K.TRIANGLES,Q,ee,ne,wt.disabled,W,null,void 0,"sky",ce.vertexBuffer,ce.indexBuffer,ce.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[g[this.currentLayer]],O=y[D.source],q=w[D.source];this._renderTileClippingMasks(D,q,!1),this.renderLayer(this,O,D,q,A)}this.renderPass="translucent";let I=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const D=this.style._layers[g[this.currentLayer]],O=y[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D,A))continue;this.opaquePassEnabledForLayer()||I||(I=!0,A.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const q=(D.type==="symbol"?E:T)[D.source];this._renderTileClippingMasks(D,w[D.source],!!this.renderToTexture),this.renderLayer(this,O,D,q,A)}if(A.isRenderingGlobe&&(function(D,O,q){const K=D.context,W=K.gl,Q=D.useProgram("atmosphere"),ee=new It(W.LEQUAL,It.ReadOnly,[0,1]),ne=D.transform,ie=(function(Pe,Je){const Qe=Pe.properties.get("position"),qe=[-Qe.x,-Qe.y,-Qe.z],lt=h.ag(new Float64Array(16));return Pe.properties.get("anchor")==="map"&&(h.b6(lt,lt,Je.rollInRadians),h.b7(lt,lt,-Je.pitchInRadians),h.b6(lt,lt,Je.bearingInRadians),h.b7(lt,lt,Je.center.lat*Math.PI/180),h.bz(lt,lt,-Je.center.lng*Math.PI/180)),h.c5(qe,qe,lt),qe})(q,D.transform),ce=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),de=O.properties.get("atmosphere-blend")*ce.projectionTransition;if(de===0)return;const ae=ll(ne.worldSize,ne.center.lat),me=ne.inverseProjectionMatrix,ze=new Float64Array(4);ze[3]=1,h.aw(ze,ze,ne.modelViewProjectionMatrix),ze[0]/=ze[3],ze[1]/=ze[3],ze[2]/=ze[3],ze[3]=1,h.aw(ze,ze,me),ze[0]/=ze[3],ze[1]/=ze[3],ze[2]/=ze[3],ze[3]=1;const Ee=((Pe,Je,Qe,qe,lt)=>({u_sun_pos:Pe,u_atmosphere_blend:Je,u_globe_position:Qe,u_globe_radius:qe,u_inv_proj_matrix:lt}))(ie,de,[ze[0],ze[1],ze[2]],ae,me),Ae=cc(K,O);Q.draw(K,W.TRIANGLES,ee,Kt.disabled,wi.alphaBlended,wt.disabled,Ee,null,null,"atmosphere",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const D=(function(O,q){let K=null;const W=Object.values(O._layers).flatMap((ie=>ie.source&&!ie.isHidden(q)?[O.sourceCaches[ie.source]]:[])),Q=W.filter((ie=>ie.getSource().type==="vector")),ee=W.filter((ie=>ie.getSource().type!=="vector")),ne=ie=>{(!K||K.getSource().maxzoom<ie.getSource().maxzoom)&&(K=ie)};return Q.forEach((ie=>ne(ie))),K||ee.forEach((ie=>ne(ie))),K})(this.style,this.transform.zoom);D&&(function(O,q,K){for(let W=0;W<K.length;W++)xs(O,q,K[W])})(this,D,D.getVisibleCoordinates())}this.options.showPadding&&(function(D){const O=D.transform.padding;ni(D,D.transform.height-(O.top||0),3,lc),ni(D,O.bottom||0,3,Zc),Yr(D,O.left||0,3,Zu),Yr(D,D.transform.width-(O.right||0),3,Bn);const q=D.transform.centerPoint;(function(K,W,Q,ee){ai(K,W-1,Q-10,2,20,ee),ai(K,W-10,Q-1,20,2,ee)})(D,q.x,D.transform.height-q.y,Oi)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!h.c8(r,l):!h.c9(r,l)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(h.ca(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,y){const w=g.context,T=w.gl,E=g.transform,A=wi.unblended,I=new It(T.LEQUAL,It.ReadWrite,[0,1]),D=y.sourceCache.getRenderableTiles(),O=g.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:h.bf.transparent,depth:1});for(const q of D){const K=y.getTerrainMesh(q.tileID),W=y.getTerrainData(q.tileID),Q=E.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ee={u_ele_delta:y.getMeshFrameDelta(E.zoom)};O.draw(w,T.TRIANGLES,I,Kt.disabled,A,wt.backCCW,ee,W,Q,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,y){const w=g.context,T=w.gl,E=g.transform,A=wi.unblended,I=new It(T.LEQUAL,It.ReadWrite,[0,1]),D=y.getCoordsTexture(),O=y.sourceCache.getRenderableTiles(),q=g.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:h.bf.transparent,depth:1}),y.coordsIndex=[];for(const K of O){const W=y.getTerrainMesh(K.tileID),Q=y.getTerrainData(K.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,D.texture);const ee={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(E.zoom)},ne=E.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(w,T.TRIANGLES,I,Kt.disabled,A,wt.backCCW,ee,Q,ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),y.coordsIndex.push(K.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,r,l,d,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(d||[]).length)&&(this.id=l.id,h.cb(l)?(function(y,w,T,E,A,I){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=I,O=Kt.disabled,q=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(K,W,Q,ee,ne,ie,ce,de,ae){const me=W.transform,ze=W.style.map.terrain,Ee=ne==="map",Ae=ie==="map";for(const Pe of K){const Je=ee.getTile(Pe),Qe=Je.getBucket(Q);if(!Qe||!Qe.text||!Qe.text.segments.get().length)continue;const qe=h.an(Qe.textSizeData,me.zoom),lt=h.aC(Je,1,W.transform.zoom),Ot=Vn(Ee,W.transform,lt),fi=Q.layout.get("icon-text-fit")!=="none"&&Qe.hasIconData();if(qe){const Ui=Math.pow(2,me.zoom-Je.tileID.overscaledZ),Di=ze?(Hi,ji)=>ze.getElevation(Pe,Hi,ji):null;rc(Qe,Ee,Ae,ae,me,Ot,Ui,qe,fi,h.aD(me,Je,ce,de),Pe.toUnwrapped(),Di)}}})(E,y,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),A),T.paint.get("icon-opacity").constantOr(1)!==0&&Lo(y,w,T,E,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),O,q,D),T.paint.get("text-opacity").constantOr(1)!==0&&Lo(y,w,T,E,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),O,q,D),w.map.showCollisionBoxes&&(Hr(y,w,T,E,!0),Hr(y,w,T,E,!1))})(e,r,l,d,this.style.placement.variableOffsets,g):h.cc(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=A,D=T.paint.get("circle-opacity"),O=T.paint.get("circle-stroke-width"),q=T.paint.get("circle-stroke-opacity"),K=!T.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(O.constantOr(1)===0||q.constantOr(1)===0))return;const W=y.context,Q=W.gl,ee=y.transform,ne=y.getDepthModeForSublayer(0,It.ReadOnly),ie=Kt.disabled,ce=y.colorModeForRenderPass(),de=[],ae=ee.getCircleRadiusCorrection();for(let me=0;me<E.length;me++){const ze=E[me],Ee=w.getTile(ze),Ae=Ee.getBucket(T);if(!Ae)continue;const Pe=T.paint.get("circle-translate"),Je=T.paint.get("circle-translate-anchor"),Qe=h.aD(ee,Ee,Pe,Je),qe=Ae.programConfigurations.get(T.id),lt=y.useProgram("circle",qe),Ot=Ae.layoutVertexBuffer,fi=Ae.indexBuffer,Ui=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ze),Di={programConfiguration:qe,program:lt,layoutVertexBuffer:Ot,indexBuffer:fi,uniformValues:kh(y,Ee,T,Qe,ae),terrainData:Ui,projectionData:ee.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!I,applyTerrainMatrix:!0})};if(K){const Hi=Ae.segments.get();for(const ji of Hi)de.push({segments:new h.aM([ji]),sortKey:ji.sortKey,state:Di})}else de.push({segments:Ae.segments,sortKey:0,state:Di})}K&&de.sort(((me,ze)=>me.sortKey-ze.sortKey));for(const me of de){const{programConfiguration:ze,program:Ee,layoutVertexBuffer:Ae,indexBuffer:Pe,uniformValues:Je,terrainData:Qe,projectionData:qe}=me.state;Ee.draw(W,Q.TRIANGLES,ne,ie,ce,wt.backCCW,Je,Qe,qe,T.id,Ae,Pe,me.segments,T.paint,y.transform.zoom,ze)}})(e,r,l,d,g):h.cd(l)?(function(y,w,T,E,A){if(T.paint.get("heatmap-opacity")===0)return;const I=y.context,{isRenderingToTexture:D,isRenderingGlobe:O}=A;if(y.style.map.terrain){for(const q of E){const K=w.getTile(q);w.hasRenderableParent(q)||(y.renderPass==="offscreen"?Fa(y,K,T,q,O):y.renderPass==="translucent"&&ko(y,T,q,D,O))}I.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function(q,K,W,Q){const ee=q.context,ne=ee.gl,ie=q.transform,ce=Kt.disabled,de=new wi([ne.ONE,ne.ONE],h.bf.transparent,[!0,!0,!0,!0]);(function(ae,me,ze){const Ee=ae.gl;ae.activeTexture.set(Ee.TEXTURE1),ae.viewport.set([0,0,me.width/4,me.height/4]);let Ae=ze.heatmapFbos.get(h.c2);Ae?(Ee.bindTexture(Ee.TEXTURE_2D,Ae.colorAttachment.get()),ae.bindFramebuffer.set(Ae.framebuffer)):(Ae=$r(ae,me.width/4,me.height/4),ze.heatmapFbos.set(h.c2,Ae))})(ee,q,W),ee.clear({color:h.bf.transparent});for(let ae=0;ae<Q.length;ae++){const me=Q[ae];if(K.hasRenderableParent(me))continue;const ze=K.getTile(me),Ee=ze.getBucket(W);if(!Ee)continue;const Ae=Ee.programConfigurations.get(W.id),Pe=q.useProgram("heatmap",Ae),Je=ie.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Qe=ie.getCircleRadiusCorrection();Pe.draw(ee,ne.TRIANGLES,It.disabled,ce,de,wt.backCCW,zo(ze,ie.zoom,W.paint.get("heatmap-intensity"),Qe),null,Je,W.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,W.paint,ie.zoom,Ae)}ee.viewport.set([0,0,q.width,q.height])})(y,w,T,E):y.renderPass==="translucent"&&(function(q,K){const W=q.context,Q=W.gl;W.setColorMode(q.colorModeForRenderPass());const ee=K.heatmapFbos.get(h.c2);ee&&(W.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,ee.colorAttachment.get()),W.activeTexture.set(Q.TEXTURE1),no(W,K).bind(Q.LINEAR,Q.CLAMP_TO_EDGE),q.useProgram("heatmapTexture").draw(W,Q.TRIANGLES,It.disabled,Kt.disabled,q.colorModeForRenderPass(),wt.disabled,Iu(q,K,0,1),null,null,K.id,q.viewportBuffer,q.quadTriangleIndexBuffer,q.viewportSegments,K.paint,q.transform.zoom))})(y,T)})(e,r,l,d,g):h.ce(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=A,D=T.paint.get("line-opacity"),O=T.paint.get("line-width");if(D.constantOr(1)===0||O.constantOr(1)===0)return;const q=y.getDepthModeForSublayer(0,It.ReadOnly),K=y.colorModeForRenderPass(),W=T.paint.get("line-dasharray"),Q=W.constantOr(1),ee=T.paint.get("line-pattern"),ne=ee.constantOr(1),ie=T.paint.get("line-gradient"),ce=T.getCrossfadeParameters(),de=ne?"linePattern":Q?"lineSDF":ie?"lineGradient":"line",ae=y.context,me=ae.gl,ze=y.transform;let Ee=!0;for(const Ae of E){const Pe=w.getTile(Ae);if(ne&&!Pe.patternsLoaded())continue;const Je=Pe.getBucket(T);if(!Je)continue;const Qe=Je.programConfigurations.get(T.id),qe=y.context.program.get(),lt=y.useProgram(de,Qe),Ot=Ee||lt.program!==qe,fi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae),Ui=ee.constantOr(null),Di=W&&W.constantOr(null);if(Ui&&Pe.imageAtlas){const Si=Pe.imageAtlas,Ai=Si.patternPositions[Ui.to.toString()],qt=Si.patternPositions[Ui.from.toString()];Ai&&qt&&Qe.setConstantPatternPositions(Ai,qt)}else if(Di){const Si=T.layout.get("line-cap")==="round",Ai=y.lineAtlas.getDash(Di.to,Si),qt=y.lineAtlas.getDash(Di.from,Si);Qe.setConstantDashPositions(Ai,qt)}const Hi=ze.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),ji=ze.getPixelScale(),Fn=ne?Fh(y,Pe,T,ji,ce):Q?jr(y,Pe,T,ji,ce):ie?hl(y,Pe,T,ji,Je.lineClipsArray.length):Qs(y,Pe,T,ji);if(ne)ae.activeTexture.set(me.TEXTURE0),Pe.imageAtlasTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE),Qe.updatePaintBuffers(ce);else if(Q)(Ot||y.lineAtlas.dirty)&&(ae.activeTexture.set(me.TEXTURE0),y.lineAtlas.bind(ae)),Qe.updatePaintBuffers(ce);else if(ie){const Si=Je.gradients[T.id];let Ai=Si.texture;if(T.gradientVersion!==Si.version){let qt=256;if(T.stepInterpolant){const Un=w.getSource().maxzoom,cr=Ae.canonical.z===Un?Math.ceil(1<<y.transform.maxZoom-Ae.canonical.z):1;qt=h.ah(h.c3(Je.maxLineLength/h.$*1024*cr),256,ae.maxTextureSize)}Si.gradient=h.c4({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:qt,image:Si.gradient||void 0,clips:Je.lineClipsArray}),Si.texture?Si.texture.update(Si.gradient):Si.texture=new h.T(ae,Si.gradient,me.RGBA),Si.version=T.gradientVersion,Ai=Si.texture}ae.activeTexture.set(me.TEXTURE0),Ai.bind(T.stepInterpolant?me.NEAREST:me.LINEAR,me.CLAMP_TO_EDGE)}const $i=y.stencilModeForClipping(Ae);lt.draw(ae,me.TRIANGLES,q,$i,K,wt.disabled,Fn,fi,Hi,T.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,T.paint,y.transform.zoom,Qe,Je.layoutVertexBuffer2),Ee=!1}})(e,r,l,d,g):h.cf(l)?(function(y,w,T,E,A){const I=T.paint.get("fill-color"),D=T.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const{isRenderingToTexture:O}=A,q=y.colorModeForRenderPass(),K=T.paint.get("fill-pattern"),W=y.opaquePassEnabledForLayer()&&!K.constantOr(1)&&I.constantOr(h.bf.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===W){const Q=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?It.ReadWrite:It.ReadOnly);ta(y,w,T,E,Q,q,!1,O)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const Q=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly);ta(y,w,T,E,Q,q,!0,O)}})(e,r,l,d,g):h.cg(l)?(function(y,w,T,E,A){const I=T.paint.get("fill-extrusion-opacity");if(I===0)return;const{isRenderingToTexture:D}=A;if(y.renderPass==="translucent"){const O=new It(y.context.gl.LEQUAL,It.ReadWrite,y.depthRangeFor3D);if(I!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))_a(y,w,T,E,O,Kt.disabled,wi.disabled,D),_a(y,w,T,E,O,y.stencilModeFor3D(),y.colorModeForRenderPass(),D);else{const q=y.colorModeForRenderPass();_a(y,w,T,E,O,Kt.disabled,q,D)}}})(e,r,l,d,g):h.ch(l)?(function(y,w,T,E,A){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=A,D=y.context,O=y.style.projection.useSubdivision,q=y.getDepthModeForSublayer(0,It.ReadOnly),K=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(W,Q,ee,ne,ie,ce,de){const ae=W.context,me=ae.gl;for(const ze of ee){const Ee=Q.getTile(ze),Ae=Ee.dem;if(!Ae||!Ae.data||!Ee.needsHillshadePrepare)continue;const Pe=Ae.dim,Je=Ae.stride,Qe=Ae.getPixels();if(ae.activeTexture.set(me.TEXTURE1),ae.pixelStoreUnpackPremultiplyAlpha.set(!1),Ee.demTexture=Ee.demTexture||W.getTileTexture(Je),Ee.demTexture){const lt=Ee.demTexture;lt.update(Qe,{premultiply:!1}),lt.bind(me.NEAREST,me.CLAMP_TO_EDGE)}else Ee.demTexture=new h.T(ae,Qe,me.RGBA,{premultiply:!1}),Ee.demTexture.bind(me.NEAREST,me.CLAMP_TO_EDGE);ae.activeTexture.set(me.TEXTURE0);let qe=Ee.fbo;if(!qe){const lt=new h.T(ae,{width:Pe,height:Pe,data:null},me.RGBA);lt.bind(me.LINEAR,me.CLAMP_TO_EDGE),qe=Ee.fbo=ae.createFramebuffer(Pe,Pe,!0,!1),qe.colorAttachment.set(lt.texture)}ae.bindFramebuffer.set(qe.framebuffer),ae.viewport.set([0,0,Pe,Pe]),W.useProgram("hillshadePrepare").draw(ae,me.TRIANGLES,ie,ce,de,wt.disabled,Oh(Ee.tileID,Ae),null,null,ne.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),Ee.needsHillshadePrepare=!1}})(y,w,E,T,q,Kt.disabled,K),D.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(O){const[W,Q,ee]=y.stencilConfigForOverlapTwoPass(E);Xr(y,w,T,ee,W,q,K,!1,I),Xr(y,w,T,ee,Q,q,K,!0,I)}else{const[W,Q]=y.getStencilConfigForOverlapAndUpdateStencilID(E);Xr(y,w,T,Q,W,q,K,!1,I)}})(e,r,l,d,g):h.ci(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent"||!E.length)return;const{isRenderingToTexture:I}=A,D=y.style.projection.useSubdivision,O=y.getDepthModeForSublayer(0,It.ReadOnly),q=y.colorModeForRenderPass();if(D){const[K,W,Q]=y.stencilConfigForOverlapTwoPass(E);ya(y,w,T,Q,K,O,q,!1,I),ya(y,w,T,Q,W,O,q,!0,I)}else{const[K,W]=y.getStencilConfigForOverlapAndUpdateStencilID(E);ya(y,w,T,W,K,O,q,!1,I)}})(e,r,l,d,g):h.cj(l)?(function(y,w,T,E,A){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:I}=A,D=w.getSource(),O=y.style.projection.useSubdivision;if(D instanceof rr)Wa(y,w,T,E,null,!1,!1,D.tileCoords,D.flippedWindingOrder,I);else if(O){const[q,K,W]=y.stencilConfigForOverlapTwoPass(E);Wa(y,w,T,W,q,!1,!0,lr,!1,I),Wa(y,w,T,W,K,!0,!0,lr,!1,I)}else{const[q,K]=y.getStencilConfigForOverlapAndUpdateStencilID(E);Wa(y,w,T,K,q,!1,!0,lr,!1,I)}})(e,r,l,d,g):h.ck(l)?(function(y,w,T,E,A){const I=T.paint.get("background-color"),D=T.paint.get("background-opacity");if(D===0)return;const{isRenderingToTexture:O}=A,q=y.context,K=q.gl,W=y.style.projection,Q=y.transform,ee=Q.tileSize,ne=T.paint.get("background-pattern");if(y.isPatternMissing(ne))return;const ie=!ne&&I.a===1&&D===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ie)return;const ce=Kt.disabled,de=y.getDepthModeForSublayer(0,ie==="opaque"?It.ReadWrite:It.ReadOnly),ae=y.colorModeForRenderPass(),me=y.useProgram(ne?"backgroundPattern":"background"),ze=E||be(Q,{tileSize:ee,terrain:y.style.map.terrain});ne&&(q.activeTexture.set(K.TEXTURE0),y.imageManager.bind(y.context));const Ee=T.getCrossfadeParameters();for(const Ae of ze){const Pe=Q.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Je=ne?Nh(D,y,ne,{tileID:Ae,tileSize:ee},Ee):jh(D,I),Qe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae),qe=W.getMeshFromTileID(q,Ae.canonical,!1,!0,"raster");me.draw(q,K.TRIANGLES,de,ce,ae,wt.backCCW,Je,Qe,Pe,T.id,qe.vertexBuffer,qe.indexBuffer,qe.segments)}})(e,0,l,d,g):h.cl(l)&&(function(y,w,T,E){const{isRenderingGlobe:A}=E,I=y.context,D=T.implementation,O=y.style.projection,q=y.transform,K=q.getProjectionDataForCustomLayer(A),W={farZ:q.farZ,nearZ:q.nearZ,fov:q.fov*Math.PI/180,modelViewProjectionMatrix:q.modelViewProjectionMatrix,projectionMatrix:q.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:K},Q=D.renderingMode?D.renderingMode:"2d";if(y.renderPass==="offscreen"){const ee=D.prerender;ee&&(y.setCustomLayerDefaults(),I.setColorMode(y.colorModeForRenderPass()),ee.call(D,I.gl,W),I.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),I.setColorMode(y.colorModeForRenderPass()),I.setStencilMode(Kt.disabled);const ee=Q==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,It.ReadOnly);I.setDepthMode(ee),D.render(I.gl,W),I.setDirty(),y.setBaseState(),I.bindFramebuffer.set(null)}})(e,0,l,g))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!r||!l}useProgram(e,r,l=!1,d=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,y=this.style.projection,w=l?fa.projectionMercator:y.shaderPreludeCode,T=l?br:y.shaderDefine,E=e+(r?r.cacheKey:"")+`/${l?Mo:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[E]||(this.cache[E]=new Pu(this.context,fa[e],r,Ou[e],this._showOverdrawInspector,g,w,T,d)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function ao(m,e){let r,l=!1,d=null,g=null;const y=()=>{d=null,l&&(m.apply(g,r),d=setTimeout(y,e),l=!1)};return(...w)=>(l=!0,g=this,r=w,d||y(),d)}class Qa{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(l=d)})),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let d=l;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${l}`);let g=window.location.hash.replace(d,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let y=window.location.href.replace(/(#.+)?$/,g);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=ao(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,d=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,d),y=Math.round(r.lng*g)/g,w=Math.round(r.lat*g)/g,T=this._map.getBearing(),E=this._map.getPitch();let A="";if(A+=e?`/${y}/${w}/${l}`:`${l}/${w}/${y}`,(T||E)&&(A+="/"+Math.round(10*T)/10),E&&(A+=`/${Math.round(E)}`),this._hashName){const I=this._hashName;let D=!1;const O=window.location.hash.slice(1).split("&").map((q=>{const K=q.split("=")[0];return K===I?(D=!0,`${K}=${A}`):q})).filter((q=>q));return D||O.push(`${I}=${A}`),`#${O.join("&")}`}return`#${A}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new h.S(+e[2],+e[1])}catch{return!1}const r=+e[0],l=+(e[3]||0),d=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const bs={linearity:.3,easing:h.cm(0,0,.3,1)},ws=h.e({deceleration:2500,maxSpeed:1400},bs),hc=h.e({deceleration:20,maxSpeed:1400},bs),ro=h.e({deceleration:1e3,maxSpeed:360},bs),Kr=h.e({deceleration:1e3,maxSpeed:90},bs),Ts=h.e({deceleration:1e3,maxSpeed:360},bs);class Wr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ne.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=Ne.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)r.zoom+=g.zoomDelta||0,r.bearing+=g.bearingDelta||0,r.pitch+=g.pitchDelta||0,r.roll+=g.rollDelta||0,g.panDelta&&r.pan._add(g.panDelta),g.around&&(r.around=g.around),g.pinchAround&&(r.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const g=Ja(r.pan.mag(),l,h.e({},ws,e||{})),y=r.pan.mult(g.amount/r.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);d.center=w.easingCenter,d.offset=w.easingOffset,so(d,g)}if(r.zoom){const g=Ja(r.zoom,l,hc);d.zoom=this._map.transform.zoom+g.amount,so(d,g)}if(r.bearing){const g=Ja(r.bearing,l,ro);d.bearing=this._map.transform.bearing+h.ah(g.amount,-179,179),so(d,g)}if(r.pitch){const g=Ja(r.pitch,l,Kr);d.pitch=this._map.transform.pitch+g.amount,so(d,g)}if(r.roll){const g=Ja(r.roll,l,Ts);d.roll=this._map.transform.roll+h.ah(g.amount,-179,179),so(d,g)}if(d.zoom||d.bearing){const g=r.pinchAround===void 0?r.around:r.pinchAround;d.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),h.e(d,{noMoveStart:!0})}}function so(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Ja(m,e,r){const{maxSpeed:l,linearity:d,deceleration:g}=r,y=h.ah(m*d/(e/1e3),-l,l),w=Math.abs(y)/(g*d);return{easing:r.easing,duration:1e3*w,amount:y*(w/2)}}class Hn extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l,d={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const g=Te.mousePos(r.getCanvas(),l),y=r.unproject(g);super(e,h.e({point:g,lngLat:y,originalEvent:l},d)),this._defaultPrevented=!1,this.target=r}}class Ss extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){const d=e==="touchend"?l.changedTouches:l.touches,g=Te.touchPos(r.getCanvasContainer(),d),y=g.map((T=>r.unproject(T))),w=g.reduce(((T,E,A,I)=>T.add(E.div(I.length))),new h.P(0,0));super(e,{points:g,point:w,lngLats:y,lngLat:r.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Ms extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class ia{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ms(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new Hn(e.type,this._map,e))}mouseup(e){this._map.fire(new Hn(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Hn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Hn(e.type,this._map,e))}mouseover(e){this._map.fire(new Hn(e.type,this._map,e))}mouseout(e){this._map.fire(new Hn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ss(e.type,this._map,e))}touchmove(e){this._map.fire(new Ss(e.type,this._map,e))}touchend(e){this._map.fire(new Ss(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ss(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dc{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Hn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Hn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(h.P.convert(e),this._map.terrain)}}class Gu{constructor(e,r){this._map=e,this._tr=new Bo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(Te.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=l,this._box||(this._box=Te.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(d.x,l.x),y=Math.max(d.x,l.x),w=Math.min(d.y,l.y),T=Math.max(d.y,l.y);Te.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=y-g+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const l=this._startPos,d=r;if(this.reset(),Te.suppressClick(),l.x!==d.x||l.y!==d.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(l,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Te.remove(this._box),this._box=null),Te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new h.l(e,{originalEvent:r}))}}function Gc(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const r={};for(let l=0;l<m.length;l++)r[m[l].identifier]=e[l];return r}class qc{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(d){const g=new h.P(0,0);for(const y of d)g._add(y);return g.div(d.length)})(r),this.touches=Gc(l,r)))}touchmove(e,r,l){if(this.aborted||!this.centroid)return;const d=Gc(l,r);for(const g in this.touches){const y=d[g];(!y||y.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,r,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class dn{constructor(e){this.singleTap=new qc(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,l){this.singleTap.touchstart(e,r,l)}touchmove(e,r,l){this.singleTap.touchmove(e,r,l)}touchend(e,r,l){const d=this.singleTap.touchend(e,r,l);if(d){const g=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(d)<30;if(g&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Ua{constructor(e){this._tr=new Bo(e),this._zoomIn=new dn({numTouches:1,numTaps:2}),this._zoomOut=new dn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,l){this._zoomIn.touchstart(e,r,l),this._zoomOut.touchstart(e,r,l)}touchmove(e,r,l){this._zoomIn.touchmove(e,r,l),this._zoomOut.touchmove(e,r,l)}touchend(e,r,l){const d=this._zoomIn.touchend(e,r,l),g=this._zoomOut.touchend(e,r,l),y=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(d)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $n{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(r)?r[0]:r;return!this._moved&&d.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(l,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Te.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _l=0,er=2,Sr={[_l]:1,[er]:2};class Qr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=Te.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,l){const d=Sr[l];return r.buttons===void 0||(r.buttons&d)!==d})(e,this._eventButton)}isValidEndEvent(e){return Te.mouseButton(e)===this._eventButton}}class Nd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class qh{constructor(e=new Qr({checkCorrectEvent:()=>!0}),r=new Nd){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,l){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const Hc=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class qu{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,l){return this._calculateTransform(e,r,l)}touchmove(e,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,l){this._calculateTransform(e,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,l){l.length>0&&(this._active=!0);const d=Gc(l,r),g=new h.P(0,0),y=new h.P(0,0);let w=0;for(const E in d){const A=d[E],I=this._touches[E];I&&(g._add(A),y._add(A.sub(I)),w++,d[E]=A)}if(this._touches=d,this._shouldBePrevented(w)||!y.mag())return;const T=y.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,l){if(!this._firstTwoTouches)return;e.preventDefault();const[d,g]=this._firstTwoTouches,y=ja(l,r,d),w=ja(l,r,g);if(!y||!w)return;const T=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],T,e)}touchend(e,r,l){if(!this._firstTwoTouches)return;const[d,g]=this._firstTwoTouches,y=ja(l,r,d),w=ja(l,r,g);y&&w||(this._active&&Te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ja(m,e,r){for(let l=0;l<m.length;l++)if(m[l].identifier===r)return e[l]}function ot(m,e){return Math.log(m/e)/Math.LN2}class $c extends tr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ot(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ot(this._distance,l),pinchAround:r}}}function Cs(m,e){return 180*m.angleWith(e)/Math.PI}class fc extends tr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,l){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Cs(this._vector,d),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,l=Cs(e,this._startVector);return Math.abs(l)<r}}function Jr(m){return Math.abs(m.y)>Math.abs(m.x)}class Es extends tr{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,l){super.touchstart(e,r,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Jr(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,g,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,l){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,g=r.mag()>=2;if(!d&&!g)return;if(!d||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==r.y>0;return Jr(e)&&Jr(r)&&y}}const Xc={panStep:100,bearingStep:15,pitchStep:10};class Xt{constructor(e){this._tr=new Bo(e);const r=Xc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,l=0,d=0,g=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,d=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:As,zoom:r?Math.round(T.zoom)+r*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+d*this._pitchStep,offset:[-g*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function As(m){return m*(2-m)}const oo=4.000244140625,Yc=1/450;class Hu{constructor(e,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Bo(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Yc}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Ne.now(),d=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%oo==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Te.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(h.S.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>oo?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);const E=typeof this._targetZoom!="number"?e.scale:h.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),h.ak(E*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,d=this._easing;let g,y=!1;if(this._type==="wheel"&&l&&d){const w=Ne.now()-this._lastWheelEventTime,T=Math.min((w+5)/200,1),E=d(T);g=h.C.number(l,r,E),T<1?this._frameId||(this._frameId=!0):y=!0}else g=r,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!y,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=h.co;if(this._prevEase){const l=this._prevEase,d=(Ne.now()-l.start)/l.duration,g=l.easing(d+.01)-l.easing(d),y=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-y*y);r=h.cm(y,w,.25,1)}return this._prevEase={start:Ne.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Oo{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yl{constructor(e){this._tr=new Bo(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vl{constructor(){this._tap=new dn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,l){if(!this._swipePoint)if(this._tapTime){const d=r[0],g=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(d)<30;g&&y?l.length>0&&(this._swipePoint=d,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,r,l)}touchmove(e,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const d=r[0],g=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,r,l)}touchend(e,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const d=this._tap.touchend(e,r,l);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fo{constructor(e,r,l){this._el=e,this._mousePan=r,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pc{constructor(e,r,l,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Kc{constructor(e,r,l,d){this._el=e,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class lo{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Te.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=r,this._container.appendChild(d);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Te.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const mc=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Ca extends h.l{}function pi(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class $u{constructor(e,r){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,g)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=d.type==="renderFrame"?void 0:d,w={needsRenderFrame:!1},T={},E={};for(const{handlerName:D,handler:O,allowed:q}of this._handlers){if(!O.isEnabled())continue;let K;if(this._blockedByActive(E,q,D))O.reset();else if(O[g||d.type]){if(h.cp(d,g||d.type)){const W=Te.mousePos(this._map.getCanvas(),d);K=O[g||d.type](d,W)}else if(h.cq(d,g||d.type)){const W=this._getMapTouches(d.touches),Q=Te.touchPos(this._map.getCanvas(),W);K=O[g||d.type](d,Q,W)}else h.cr(g||d.type)||(K=O[g||d.type](d));this.mergeHandlerResult(w,T,K,D,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()}(K||O.isActive())&&(E[D]=O)}const A={};for(const D in this._previousActiveHandlers)E[D]||(A[D]=y);this._previousActiveHandlers=E,(Object.keys(A).length||pi(w))&&(this._changes.push([w,T,A]),this._triggerRenderFrame()),(Object.keys(E).length||pi(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:I}=w;I&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],I(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,g,y]of this._listeners)Te.addEventListener(d,g,d===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,r,l]of this._listeners)Te.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new ia(r,e));const d=r.boxZoom=new Gu(r,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const g=r.cooperativeGestures=new lo(r,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const y=new Ua(r),w=new yl(r);r.doubleClickZoom=new Oo(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const T=new vl;this._add("tapDragZoom",T);const E=r.touchPitch=new Es(r);this._add("touchPitch",E),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const A=()=>r.project(r.getCenter()),I=(function({enable:ie,clickTolerance:ce,aroundCenter:de=!0,minPixelCenterThreshold:ae=100,rotateDegreesPerPixelMoved:me=.8},ze){const Ee=new Qr({checkCorrectEvent:Ae=>Te.mouseButton(Ae)===0&&Ae.ctrlKey||Te.mouseButton(Ae)===2&&!Ae.ctrlKey});return new $n({clickTolerance:ce,move:(Ae,Pe)=>{const Je=ze();if(de&&Math.abs(Je.y-Ae.y)>ae)return{bearingDelta:h.cn(new h.P(Ae.x,Pe.y),Pe,Je)};let Qe=(Pe.x-Ae.x)*me;return de&&Pe.y<Je.y&&(Qe=-Qe),{bearingDelta:Qe}},moveStateManager:Ee,enable:ie,assignEvents:Hc})})(e,A),D=(function({enable:ie,clickTolerance:ce,pitchDegreesPerPixelMoved:de=-.5}){const ae=new Qr({checkCorrectEvent:me=>Te.mouseButton(me)===0&&me.ctrlKey||Te.mouseButton(me)===2});return new $n({clickTolerance:ce,move:(me,ze)=>({pitchDelta:(ze.y-me.y)*de}),moveStateManager:ae,enable:ie,assignEvents:Hc})})(e),O=(function({enable:ie,clickTolerance:ce,rollDegreesPerPixelMoved:de=.3},ae){const me=new Qr({checkCorrectEvent:ze=>Te.mouseButton(ze)===2&&ze.ctrlKey});return new $n({clickTolerance:ce,move:(ze,Ee)=>{const Ae=ae();let Pe=(Ee.x-ze.x)*de;return Ee.y<Ae.y&&(Pe=-Pe),{rollDelta:Pe}},moveStateManager:me,enable:ie,assignEvents:Hc})})(e,A);r.dragRotate=new pc(e,I,D,O),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",D,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const q=(function({enable:ie,clickTolerance:ce}){const de=new Qr({checkCorrectEvent:ae=>Te.mouseButton(ae)===0&&!ae.ctrlKey});return new $n({clickTolerance:ce,move:(ae,me)=>({around:me,panDelta:me.sub(ae)}),activateOnStart:!0,moveStateManager:de,enable:ie,assignEvents:Hc})})(e),K=new qu(e,r);r.dragPan=new Fo(l,q,K),this._add("mousePan",q),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const W=new fc,Q=new $c;r.touchZoomRotate=new Kc(l,Q,W,T),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const ee=r.scrollZoom=new Hu(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ee,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ne=r.keyboard=new Xt(r);this._add("keyboard",ne),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new dc(r))}_add(e,r,l){this._handlers.push({handlerName:e,handler:r,allowed:l}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!mc(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,l){for(const d in e)if(d!==l&&(!r||r.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const l of e)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(e,r,l,d,g){if(!l)return;h.e(e,l);const y={handlerName:d,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(r.zoom=y),l.panDelta!==void 0&&(r.drag=y),l.rollDelta!==void 0&&(r.roll=y),l.pitchDelta!==void 0&&(r.pitch=y),l.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const e={},r={},l={};for(const[d,g,y]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),h.e(r,g),h.e(l,y);this._updateMapTransform(e,r,l),this._changes=[]}_updateMapTransform(e,r,l){const d=this._map,g=d._getTransformForUpdate(),y=d.terrain;if(!(pi(e)||y&&this._terrainMovement))return this._fireEvents(r,l,!0);d._stop(!0);let{panDelta:w,zoomDelta:T,bearingDelta:E,pitchDelta:A,rollDelta:I,around:D,pinchAround:O}=e;O!==void 0&&(D=O),D=D||d.transform.centerPoint,y&&!g.isPointOnMapSurface(D)&&(D=g.centerPoint);const q={panDelta:w,zoomDelta:T,rollDelta:I,pitchDelta:A,bearingDelta:E,around:D};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(D)&&(D=g.centerPoint);const K=D.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(w?D.sub(w):D);this._handleMapControls({terrain:y,tr:g,deltasForHelper:q,preZoomAroundLoc:K,combinedEventsInProgress:r,panDelta:w}),d._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,l,!0)}_handleMapControls({terrain:e,tr:r,deltasForHelper:l,preZoomAroundLoc:d,combinedEventsInProgress:g,panDelta:y}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,r),e)return w.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,r,d)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&y?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(y))):w.handleMapControlsPan(l,r,d)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,r,d));w.handleMapControlsPan(l,r,d)}_fireEvents(e,r,l){const d=mc(this._eventsInProgress),g=mc(e),y={};for(const I in e){const{originalEvent:D}=e[I];this._eventsInProgress[I]||(y[`${I}start`]=D),this._eventsInProgress[I]=e[I]}!d&&g&&this._fireEvent("movestart",g.originalEvent);for(const I in y)this._fireEvent(I,y[I]);g&&this._fireEvent("move",g.originalEvent);for(const I in e){const{originalEvent:D}=e[I];this._fireEvent(I,D)}const w={};let T;for(const I in this._eventsInProgress){const{handlerName:D,originalEvent:O}=this._eventsInProgress[I];this._handlersById[D].isActive()||(delete this._eventsInProgress[I],T=r[D]||O,w[`${I}end`]=T)}for(const I in w)this._fireEvent(I,w[I]);const E=mc(this._eventsInProgress),A=(d||g)&&!E;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const I=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&I.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(I)}if(l&&A){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!I||!I.essential&&Ne.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:T})),D(this._map.getBearing())&&this._map.resetNorth()):(D(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new h.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Ca("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Mr extends h.E{constructor(e,r,l){super(),this._renderFrameCallback=()=>{const d=Math.min((Ne.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new h.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,l){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},r),l)}panTo(e,r,l){return this.easeTo(h.e({center:e},r),l)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,l){return this.easeTo(h.e({zoom:e},r),l)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)).fire(new h.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,l){return this.easeTo(h.e({bearing:e},r),l)}resetNorth(e,r){return this.rotateTo(0,h.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=qi.convert(e).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,r)}_cameraForBoxAndBearing(e,r,l,d){const g={top:0,bottom:0,right:0,left:0};if(typeof(d=h.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const E=d.padding;d.padding={top:E,bottom:E,right:E,left:E}}const y=h.e(g,d.padding);d.padding=y;const w=this.transform,T=new qi(e,r);return this.cameraHelper.cameraForBoxAndBearing(d,y,T,l,w)}fitBounds(e,r,l){return this._fitInternal(this.cameraForBounds(e,r),r,l)}fitScreenCoordinates(e,r,l,d,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(e)),this.transform.screenPointToLocation(h.P.convert(r)),l,d),d,g)}_fitInternal(e,r,l){return e?(delete(r=h.e(e,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(e,r){this.stop();const l=this._getTransformForUpdate();let d=!1,g=!1,y=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(d=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(g=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new h.l("movestart",r)).fire(new h.l("move",r)),T&&this.fire(new h.l("zoomstart",r)).fire(new h.l("zoom",r)).fire(new h.l("zoomend",r)),d&&this.fire(new h.l("rotatestart",r)).fire(new h.l("rotate",r)).fire(new h.l("rotateend",r)),g&&this.fire(new h.l("pitchstart",r)).fire(new h.l("pitch",r)).fire(new h.l("pitchend",r)),y&&this.fire(new h.l("rollstart",r)).fire(new h.l("roll",r)).fire(new h.l("rollend",r)),this.fire(new h.l("moveend",r))}calculateCameraOptionsFromTo(e,r,l,d=0){const g=h.a1.fromLngLat(e,r),y=h.a1.fromLngLat(l,d),w=y.x-g.x,T=y.y-g.y,E=y.z-g.z,A=Math.hypot(w,T,E);if(A===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(w,T),D=h.ak(this.transform.cameraToCenterDistance/A/this.transform.tileSize),O=180*Math.atan2(w,-T)/Math.PI;let q=180*Math.acos(I/A)/Math.PI;return q=E<0?90-q:90+q,{center:y.toLngLat(),elevation:d,zoom:D,pitch:q,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,l,d,g){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,r,l,d);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:d,roll:g}}easeTo(e,r){this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.co},e)).animate===!1||!e.essential&&Ne.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),d=this.getBearing(),g=l.pitch,y=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,d):d,T="pitch"in e?+e.pitch:g,E="roll"in e?this._normalizeBearing(e.roll,y):y,A="padding"in e?e.padding:l.padding,I=h.P.convert(e.offset);let D,O;e.around&&(D=h.S.convert(e.around),O=l.locationToScreenPoint(D));const q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:T,roll:E,padding:A,around:D,aroundPoint:O,offsetAsPoint:I,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==w,this._pitching=this._pitching||T!==g,this._rolling=this._rolling||E!==y,this._padding=!l.isPaddingEqual(A),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,q),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease((W=>{K.easeFunc(W),this.terrain&&!e.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(W=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,W)}),e),this}_prepareEase(e,r,l={}){this._moving=!0,r||l.moving||this.fire(new h.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new h.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new h.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new h.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new h.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(r-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(h.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),l=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(l<d){const g=this.calculateCameraOptionsFromTo(r,d,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&r.push((d=>this.transformCameraUpdate(d))),!r.length)return;const l=e.clone();for(const d of r){const g=l.clone(),{center:y,zoom:w,roll:T,pitch:E,bearing:A,elevation:I}=d(g);y&&g.setCenter(y),I!==void 0&&g.setElevation(I),w!==void 0&&g.setZoom(w),T!==void 0&&g.setRoll(T),E!==void 0&&g.setPitch(E),A!==void 0&&g.setBearing(A),l.apply(g)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new h.l("move",e)),this._zooming&&this.fire(new h.l("zoom",e)),this._rotating&&this.fire(new h.l("rotate",e)),this._pitching&&this.fire(new h.l("pitch",e)),this._rolling&&this.fire(new h.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,d=this._rotating,g=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new h.l("zoomend",e)),d&&this.fire(new h.l("rotateend",e)),g&&this.fire(new h.l("pitchend",e)),y&&this.fire(new h.l("rollend",e)),this.fire(new h.l("moveend",e))}flyTo(e,r){if(!e.essential&&Ne.prefersReducedMotion){const Pe=h.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Pe,r)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.co},e);const l=this._getTransformForUpdate(),d=l.bearing,g=l.pitch,y=l.roll,w=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,d):d,E="pitch"in e?+e.pitch:g,A="roll"in e?this._normalizeBearing(e.roll,y):y,I="padding"in e?e.padding:l.padding,D=h.P.convert(e.offset);let O=l.centerPoint.add(D);const q=l.screenPointToLocation(O),K=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:E,roll:A,padding:I,locationAtOffset:q,offsetAsPoint:D,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let W=e.curve;const Q=Math.max(l.width,l.height),ee=Q/K.scaleOfZoom,ne=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(W=Math.sqrt(Q/K.scaleOfMinZoom/ne*2));const ie=W*W;function ce(Pe){const Je=(ee*ee-Q*Q+(Pe?-1:1)*ie*ie*ne*ne)/(2*(Pe?ee:Q)*ie*ne);return Math.log(Math.sqrt(Je*Je+1)-Je)}function de(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function ae(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const me=ce(!1);let ze=function(Pe){return ae(me)/ae(me+W*Pe)},Ee=function(Pe){return Q*((ae(me)*(de(Je=me+W*Pe)/ae(Je))-de(me))/ie)/ne;var Je},Ae=(ce(!0)-me)/W;if(Math.abs(ne)<2e-6||!isFinite(Ae)){if(Math.abs(Q-ee)<1e-6)return this.easeTo(e,r);const Pe=ee<Q?-1:1;Ae=Math.abs(Math.log(ee/Q))/W,Ee=()=>0,ze=Je=>Math.exp(Pe*W*Je)}return e.duration="duration"in e?+e.duration:1e3*Ae/("screenSpeed"in e?+e.screenSpeed/W:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==T,this._pitching=E!==g,this._rolling=A!==y,this._padding=!l.isPaddingEqual(I),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease((Pe=>{const Je=Pe*Ae,Qe=1/ze(Je),qe=Ee(Je);this._rotating&&l.setBearing(h.C.number(d,T,Pe)),this._pitching&&l.setPitch(h.C.number(g,E,Pe)),this._rolling&&l.setRoll(h.C.number(y,A,Pe)),this._padding&&(l.interpolatePadding(w,I,Pe),O=l.centerPoint.add(D)),K.easeFunc(Pe,Qe,qe,O),this.terrain&&!e.freezeElevation&&this._updateElevation(Pe),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,r)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,r,l){l.animate===!1||l.duration===0?(e(1),r()):(this._easeStart=Ne.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=h.aO(e,-180,180);const l=Math.abs(e-r);return Math.abs(e-360-r)<l&&(e-=360),Math.abs(e+360-r)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.S.convert(e),this.transform.tileZoom):null}}const Cr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Uo{constructor(e=Cr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Te.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Te.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const l=this._map._getUIString(`AttributionControl.${r}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style.sourceCaches;for(const d in r){const g=r[d];if(g.used||g.usedForTerrain){const y=g.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter((d=>String(d).trim())),e.sort(((d,g)=>d.length-g.length)),e=e.filter(((d,g)=>{for(let y=g+1;y<e.length;y++)if(e[y].indexOf(d)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=Te.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class gc{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Te.create("div","maplibregl-ctrl");const r=Te.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Wc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const d of l)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var _c=h.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Na extends h.E{constructor(e){super(),this._lastTilesetChange=Ne.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const l={};for(const d of be(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),h.bY(d.terrainRttPosMatrix32f,0,h.$,h.$,0,0,1),this._tiles[d.key]=new ds(d,this.tileSize),this._lastTilesetChange=Ne.now());for(const d in this._tiles)l[d]||delete this._tiles[d]}freeRtt(e){for(const r in this._tiles){const l=this._tiles[r];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const l of this._renderableTilesKeys){const d=this._tiles[l].tileID,g=e.clone(),y=h.ba();if(d.canonical.equals(e.canonical))h.bY(y,0,h.$,h.$,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const w=d.canonical.z-e.canonical.z,T=d.canonical.x-(d.canonical.x>>w<<w),E=d.canonical.y-(d.canonical.y>>w<<w),A=h.$>>w;h.bY(y,0,A,A,0,0,1),h.M(y,y,[-T*A,-E*A,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const w=e.canonical.z-d.canonical.z,T=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),A=h.$>>w;h.bY(y,0,h.$,h.$,0,0,1),h.M(y,y,[T*A,E*A,0]),h.N(y,y,[1/2**w,1/2**w,0])}}g.terrainRttPosMatrix32f=new Float32Array(y),r[l]=g}return r}_getTerrainCoordsForTileRanges(e,r){const l={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(!this._isWithinTileRanges(g,r))continue;const y=e.clone(),w=h.ba();if(g.canonical.z===e.canonical.z){const T=e.canonical.x-g.canonical.x,E=e.canonical.y-g.canonical.y;h.bY(w,0,h.$,h.$,0,0,1),h.M(w,w,[T*h.$,E*h.$,0])}else if(g.canonical.z>e.canonical.z){const T=g.canonical.z-e.canonical.z,E=g.canonical.x-(g.canonical.x>>T<<T),A=g.canonical.y-(g.canonical.y>>T<<T),I=e.canonical.x-(g.canonical.x>>T),D=e.canonical.y-(g.canonical.y>>T),O=h.$>>T;h.bY(w,0,O,O,0,0,1),h.M(w,w,[-E*O+I*h.$,-A*O+D*h.$,0])}else{const T=e.canonical.z-g.canonical.z,E=e.canonical.x-(e.canonical.x>>T<<T),A=e.canonical.y-(e.canonical.y>>T<<T),I=(e.canonical.x>>T)-g.canonical.x,D=(e.canonical.y>>T)-g.canonical.y,O=h.$<<T;h.bY(w,0,O,O,0,0,1),h.M(w,w,[E*h.$+I*O,A*h.$+D*O,0])}y.terrainRttPosMatrix32f=new Float32Array(w),l[d]=y}return l}getSourceTile(e,r){const l=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>l.maxzoom&&(d=l.maxzoom),d<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&r)for(;d>=l.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(d--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class yc{constructor(e,r,l){this._meshCache={},this.painter=e,this.sourceCache=new Na(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,l,d=h.$){var g;if(!(r>=0&&r<d&&l>=0&&l<d))return 0;const y=this.getTerrainData(e),w=(g=y.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const T=h.cs([],[r/d*h.$,l/d*h.$],y.u_terrain_matrix),E=[T[0]*w.dim,T[1]*w.dim],A=Math.floor(E[0]),I=Math.floor(E[1]),D=E[0]-A,O=E[1]-I;return w.get(A,I)*(1-D)*(1-O)+w.get(A+1,I)*D*(1-O)+w.get(A,I+1)*(1-D)*O+w.get(A+1,I+1)*D*O}getElevationForLngLatZoom(e,r){if(!h.ct(r,e.wrap()))return 0;const{tileID:l,mercatorX:d,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(l,d%h.$,g%h.$,h.$)}getElevation(e,r,l,d=h.$){return this.getDEMElevation(e,r,l,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,g=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(d,g,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(d,new h.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ag([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const d=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new h.T(d,r.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),r.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const d=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?g=e.canonical.z-d:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>g<<g),w=e.canonical.y-(e.canonical.y>>g<<g),T=h.cu(new Float64Array(16),[1/(h.$<<g),1/(h.$<<g),0]);h.M(T,T,[y*h.$,w*h.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,l=r.width/devicePixelRatio,d=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(r.context,{width:l,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(r.context,{width:l,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,d,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,y=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)r[y+0]=255&w,r[y+1]=255&g,r[y+2]=w>>8<<4|g>>8,r[y+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),d=new h.T(e,l,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,d=l.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(g,w-y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const T=r[0]+(r[2]>>4<<8),E=r[1]+((15&r[2])<<8),A=this.coordsIndex[255-r[3]],I=A&&this.sourceCache.getTileByID(A);if(!I)return null;const D=this._coordsTextureSize,O=(1<<I.tileID.canonical.z)*D;return new h.a1((I.tileID.canonical.x*D+T)/O+I.tileID.wrap,(I.tileID.canonical.y*D+E)/O,this.getElevation(I.tileID,T,E,D))}depthAtPoint(e){const r=new Uint8Array(4),l=this.painter.context,d=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,d=l&&e.canonical.y===0,g=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${d?"n":""}_${g?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const w=this.painter.context,T=new h.cv,E=new h.aN,A=this.meshSize,I=h.$/A,D=A*A;for(let ae=0;ae<=A;ae++)for(let me=0;me<=A;me++)T.emplaceBack(me*I,ae*I,0);for(let ae=0;ae<D;ae+=A+1)for(let me=0;me<A;me++)E.emplaceBack(me+ae,A+me+ae+1,A+me+ae+2),E.emplaceBack(me+ae,A+me+ae+2,me+ae+1);const O=T.length,q=O+(A+1),K=(A+1)*A,W=d?h.bh:0,Q=d?0:1,ee=g?h.bi:h.$,ne=g?0:1;for(let ae=0;ae<=A;ae++)T.emplaceBack(ae*I,W,Q);for(let ae=0;ae<=A;ae++)T.emplaceBack(ae*I,ee,ne);for(let ae=0;ae<A;ae++)E.emplaceBack(K+ae,q+ae,q+ae+1),E.emplaceBack(K+ae,q+ae+1,K+ae+1),E.emplaceBack(0+ae,O+ae+1,O+ae),E.emplaceBack(0+ae,0+ae+1,O+ae+1);const ie=T.length,ce=ie+2*(A+1);for(const ae of[0,1])for(let me=0;me<=A;me++)for(const ze of[0,1])T.emplaceBack(ae*h.$,me*I,ze);for(let ae=0;ae<2*A;ae+=2)E.emplaceBack(ie+ae,ie+ae+1,ie+ae+3),E.emplaceBack(ie+ae,ie+ae+3,ie+ae+2),E.emplaceBack(ce+ae,ce+ae+3,ce+ae+1),E.emplaceBack(ce+ae,ce+ae+2,ce+ae+3);const de=new Xs(w.createVertexBuffer(T,_c.members),w.createIndexBuffer(E),h.aM.simpleSegment(0,0,T.length,E.length));return this._meshCache[y]=de,de}getMeshFrameDelta(e){return 2*Math.PI*h.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var l;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(l=this.getMinMaxElevation(d).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,r){const l=h.a1.fromLngLat(e.wrap()),d=(1<<r)*h.$,g=l.x*d,y=l.y*d,w=Math.floor(g/h.$),T=Math.floor(y/h.$);return{tileID:new h.Z(r,0,r,w,T),mercatorX:g,mercatorY:y}}}class dt{constructor(e,r,l){this._context=e,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:e,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>e.id!==r)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const mt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class co{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new dt(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(r))),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const d=e.sourceCaches[l].getVisibleCoordinates(),g=e.sourceCaches[l].getSource(),y=g instanceof rr?g.terrainTileRanges:null;for(const w of d){const T=this.terrain.sourceCache.getTerrainCoords(w,y);for(const E in T)this._coordsAscending[l][E]||(this._coordsAscending[l][E]=[]),this._coordsAscending[l][E].push(T[E])}}this._coordsAscendingStr={};for(const l of e._order){const d=e._layers[l],g=d.source;if(mt[d.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const y in this._coordsAscending[g])this._coordsAscendingStr[g][y]=this._coordsAscending[g][y].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const d in this._coordsAscendingStr){const g=this._coordsAscendingStr[d][l.tileID.key];g&&g!==l.rttCoords[d]&&(l.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),d=e.type,g=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(mt[d]&&(this._prevType&&mt[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(mt[this._prevType]||mt[d]&&y){this._prevType=d;const w=this._stacks.length-1,T=this._stacks[w]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(On(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[w]){const I=this.pool.getObjectForId(E.rtt[w].id);if(I.stamp===E.rtt[w].stamp){this.pool.useObject(I);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),E.rtt[w]={id:A.id,stamp:A.stamp},g.context.bindFramebuffer.set(A.fbo.framebuffer),g.context.clear({color:h.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let I=0;I<T.length;I++){const D=g.style._layers[T[I]],O=D.source?this._coordsAscending[D.source][E.tileID.key]:[E.tileID];g.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),g._renderTileClippingMasks(D,O,!0),g.renderLayer(g,g.style.sourceCaches[D.source],D,O,l),D.source&&(E.rttCoords[D.source]=this._coordsAscendingStr[D.source][E.tileID.key])}}return On(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),mt[d]}return!1}}const Xu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},xl=pe,na={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Cr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Va={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class gn{constructor(e,r,l=!1){this.mousedown=g=>{this.startMove(g,Te.mousePos(this.element,g)),Te.addEventListener(window,"mousemove",this.mousemove),Te.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,Te.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Te.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),Te.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Te.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=Te.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const d=new qh;this._rotatePitchHandler=new $n({clickTolerance:3,move:(g,y)=>{const w=r.getBoundingClientRect(),T=new h.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:h.cn(new h.P(g.x,y.y),y,T),pitchDelta:l?-.5*(y.y-g.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,Te.addEventListener(r,"mousedown",this.mousedown),Te.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),Te.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),Te.disableDrag()}move(e,r){const l=this.map,{bearingDelta:d,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,r)||{};d&&l.setBearing(l.getBearing()+d),g&&l.setPitch(l.getPitch()+g)}off(){const e=this.element;Te.removeEventListener(e,"mousedown",this.mousedown),Te.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Te.removeEventListener(window,"touchend",this.touchend),Te.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Te.enableDrag(),Te.removeEventListener(window,"mousemove",this.mousemove),Te.removeEventListener(window,"mouseup",this.mouseup),Te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Te.removeEventListener(window,"touchend",this.touchend)}}let Za;function uo(m,e,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return m==null?void 0:m.wrap();const d=new h.S(m.lng,m.lat);if(m=new h.S(m.lng,m.lat),e){const g=new h.S(m.lng-360,m.lat),y=new h.S(m.lng+360,m.lat),w=r.locationToScreenPoint(m).distSqr(e);r.locationToScreenPoint(g).distSqr(e)<w?m=g:r.locationToScreenPoint(y).distSqr(e)<w&&(m=y)}for(;Math.abs(m.lng-r.center.lng)>180;){const g=r.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=r.width&&g.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==d.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:d}const Fi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ti(m,e,r){const l=m.classList;for(const d in Fi)l.remove(`maplibregl-${r}-anchor-${d}`);l.add(`maplibregl-${r}-anchor-${e}`)}class va extends h.E{constructor(e){if(super(),this._onKeyPress=r=>{const l=r.code,d=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=uo(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),Te.setTransform(this._element,`${Fi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${d}`),Ne.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Te.create("div");const r=Te.createNS("http://www.w3.org/2000/svg","svg"),l=41,d=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${d}px`),r.setAttributeNS(null,"viewBox",`0 0 ${d} ${l}`);const g=Te.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const y=Te.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const w=Te.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Q of T){const ee=Te.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",Q.rx),ee.setAttributeNS(null,"ry",Q.ry),w.appendChild(ee)}const E=Te.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const A=Te.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(A);const I=Te.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");const D=Te.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(D);const O=Te.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");const q=Te.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=Te.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const W=Te.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),q.appendChild(K),q.appendChild(W),y.appendChild(w),y.appendChild(E),y.appendChild(I),y.appendChild(O),y.appendChild(q),r.appendChild(y),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(r),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),Ti(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,l;const d=(r=this._map)===null||r===void 0?void 0:r.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!d||g){const O=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-w<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/y.transform.pixelsPerMeter,A=Math.sin(y.getPitch()*Math.PI/180)*E,I=y.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),D=y.transform.lngLatToCameraDepth(this._lngLat,T+A)-I>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Ji={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let es=0,Ea=!1;const Nt={maxWidth:100,unit:"metric"};function mi(m,e,r){const l=r&&r.maxWidth||100,d=m._container.clientHeight/2,g=m._container.clientWidth/2,y=m.unproject([g-l/2,d]),w=m.unproject([g+l/2,d]),T=Math.round(m.project(w).x-m.project(y).x),E=Math.min(l,T,m._container.clientWidth),A=y.distanceTo(w);if(r&&r.unit==="imperial"){const I=3.2808*A;I>5280?Pi(e,E,I/5280,m._getUIString("ScaleControl.Miles")):Pi(e,E,I,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Pi(e,E,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Pi(e,E,A/1e3,m._getUIString("ScaleControl.Kilometers")):Pi(e,E,A,m._getUIString("ScaleControl.Meters"))}function Pi(m,e,r,l){const d=(function(g){const y=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(T){const E=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*E)/E})(w),y*w})(r);m.style.width=e*(d/r)+"px",m.innerHTML=`${d}&nbsp;${l}`}const bl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ho=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ts(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,m),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-m),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(m,0),right:new h.P(-m,0)}}if(m instanceof h.P||Array.isArray(m)){const e=h.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(m.center||[0,0]),top:h.P.convert(m.top||[0,0]),"top-left":h.P.convert(m["top-left"]||[0,0]),"top-right":h.P.convert(m["top-right"]||[0,0]),bottom:h.P.convert(m.bottom||[0,0]),"bottom-left":h.P.convert(m["bottom-left"]||[0,0]),"bottom-right":h.P.convert(m["bottom-right"]||[0,0]),left:h.P.convert(m.left||[0,0]),right:h.P.convert(m.right||[0,0])}}return ts(new h.P(0,0))}const wl=pe;z.AJAXError=h.cz,z.Event=h.l,z.Evented=h.E,z.LngLat=h.S,z.MercatorCoordinate=h.a1,z.Point=h.P,z.addProtocol=h.cA,z.config=h.a,z.removeProtocol=h.cB,z.AttributionControl=Uo,z.BoxZoomHandler=Gu,z.CanvasSource=Dr,z.CooperativeGesturesHandler=lo,z.DoubleClickZoomHandler=Oo,z.DragPanHandler=Fo,z.DragRotateHandler=pc,z.EdgeInsets=kr,z.FullscreenControl=class extends h.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Te.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Te.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},z.GeoJSONSource=xr,z.GeolocateControl=class extends h.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new h.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,d=this._map.getBearing(),g=h.e({bearing:d},this.options.fitBoundsOptions),y=qi.fromLngLat(r,l);this._map.fitBounds(y,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new h.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ea)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=Te.create("button","maplibregl-ctrl-geolocate",this._container),Te.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Te.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new va({element:this._dotElement}),this._circleElement=Te.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new va({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const l=(r==null?void 0:r[0])instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},Ji,m)}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(Za!==void 0&&!e)return Za;if(window.navigator.permissions===void 0)return Za=!!window.navigator.geolocation,Za;try{Za=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Za=!!window.navigator.geolocation}return Za}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Te.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,es=0,Ea=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),r=m.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const e=this._map.project(m),r=this._map.unproject([e.x+100,e.y]),l=m.distanceTo(r)/100,d=2*this._accuracy/l;this._circleElement.style.width=`${d.toFixed(2)}px`,this._circleElement.style.height=`${d.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":es--,Ea=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),es++,es>1?(m={maximumAge:6e5,timeout:0},Ea=!0):(m=this.options.positionOptions,Ea=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},z.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Te.create("button","maplibregl-ctrl-globe",this._container),Te.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Te.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},z.Hash=Qa,z.ImageSource=rr,z.KeyboardHandler=Xt,z.LngLatBounds=qi,z.LogoControl=gc,z.Map=class extends Mr{constructor(m){var e,r;h.cw.mark(h.cx.create);const l=Object.assign(Object.assign(Object.assign({},na),m),{canvasContextAttributes:Object.assign(Object.assign({},na.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new bi,g=new Jn;if(l.minZoom!==void 0&&d.setMinZoom(l.minZoom),l.maxZoom!==void 0&&d.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&d.setMinPitch(l.minPitch),l.maxPitch!==void 0&&d.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&d.setRenderWorldCopies(l.renderWorldCopies),super(d,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Wc,this._controls=[],this._mapId=h.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Xu),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Jt.addThrottleControl((()=>this.isMoving())),this._requestManager=new vi(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const T=ao((E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())}),50);this._resizeObserver=new ResizeObserver((E=>{w?T(E):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new $u(this,l),this._hash=l.hash&&new Qa(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,h.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((r=(e=l.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Uo(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new gc,l.logoPosition),this.on("style.load",(()=>{if(y||this._resizeTransform(),this.transform.unmodified){const w=h.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new h.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new h.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new h.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return be(this.transform,m)}calculateCameraOptionsFromTo(m,e,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,r,l)}resize(m,e=!0){const[r,l]=this._containerDimensions(),d=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,d),this.painter.resize(r,l,d),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const w=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,w),this.painter.resize(r,l,w)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new h.l("movestart",m)).fire(new h.l("move",m))),this.fire(new h.l("resize",m)),g&&this.fire(new h.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[r,l]=this._containerDimensions();this.transform.resize(r,l,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,l,m)}_getClampedPixelRatio(m,e){const{0:r,1:l}=this._maxCanvasSize,d=this.getPixelRatio(),g=m*d,y=e*d;return Math.min(g>r?r/g:1,y>l?l/y:1)*d}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(qi.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(h.S.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(h.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,r){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:g=>{const y=e.filter((T=>this.getLayer(T))),w=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];w.length?l||(l=!0,r.call(this,new Hn(m,this,g.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:y=>{const w=e.filter((T=>this.getLayer(T)));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?l=!0:l&&(l=!1,r.call(this,new Hn(m,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,r.call(this,new Hn(m,this,y.originalEvent)))}}}}{const l=d=>{const g=e.filter((w=>this.getLayer(w))),y=g.length!==0?this.queryRenderedFeatures(d.point,{layers:g}):[];y.length&&(d.features=y,r.call(this,d),delete d.features)};return{layers:e,listener:r,delegates:{[m]:l}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let d=0;d<l.length;d++){const g=l[d];if(g.listener===r&&g.layers.length===e.length&&g.layers.every((y=>e.includes(y)))){for(const y in g.delegates)this.off(y,g.delegates[y]);return void l.splice(d,1)}}}on(m,e,r){if(r===void 0)return super.on(m,e);const l=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,l,r);this._saveDelegatedListener(m,d);for(const g in d.delegates)this.on(g,d.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,r)}}}once(m,e,r){if(r===void 0)return super.once(m,e);const l=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,l,r);for(const g in d.delegates){const y=d.delegates[g];d.delegates[g]=(...w)=>{this._removeDelegatedListener(m,l,r),y(...w)}}this._saveDelegatedListener(m,d);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(m,e,r){return r===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let r;const l=m instanceof h.P||Array.isArray(m),d=l?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:m)||{},d instanceof h.P||typeof d[0]=="number")r=[h.P.convert(d)];else{const g=h.P.convert(d[0]),y=h.P.convert(d[1]);r=[g,new h.P(y.x,g.y),y,new h.P(g.x,y.y),g]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var r,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,e)));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Au(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,d):this.style.loadJSON(m,e,d),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Au(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");h.j(r,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new h.k(l))}))}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(r){h.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new h.k(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===m.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new yc(this.painter,e,m),this.painter.renderToTexture=new co(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const r=m[e]._tiles;for(const l in r){const d=r[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=Ke(Math.max(1,m),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=Ke(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const r=this.style.sourceCaches[m];if(!r)throw new Error(`There is no source cache with ID "${m}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map((l=>new h.a4(l.z,l.x,l.y))))}addImage(m,e,r={}){const{pixelRatio:l=1,sdf:d=!1,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:D}=e,O=e;return this.style.addImage(m,{data:new h.R({width:A,height:I},new Uint8Array(D)),pixelRatio:l,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E,sdf:d,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m),this}}{const{width:A,height:I,data:D}=Ne.getImageData(e);this.style.addImage(m,{data:new h.R({width:A,height:I},D),pixelRatio:l,stretchX:g,stretchY:y,content:w,textFitWidth:T,textFitHeight:E,sdf:d,version:0})}}updateImage(m,e){const r=this.style.getImage(m);if(!r)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||h.b(e)?Ne.getImageData(e):e,{width:d,height:g,data:y}=l;if(d===void 0||g===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==r.data.width||g!==r.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||h.b(e));return r.data.replace(y,w),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Jt.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,r){return this.style.setLayerZoomRange(m,e,r),this._update(!0)}setFilter(m,e,r={}){return this.style.setFilter(m,e,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,r,l={}){return this.style.setPaintProperty(m,e,r,l),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,r,l={}){return this.style.setLayoutProperty(m,e,r,l),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,r,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,(r=>{r||this._update(!0)})),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=Te.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Te.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const d=this._controlContainer=Te.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((y=>{g[y]=Te.create("div",`maplibregl-ctrl-${y} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:m},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new uc(r,this.transform),ti.testSupport(r)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,r,l,d,g;const y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=Ne.now();this.style.zoomHistory.update(I,D);const O=new h.F(I,{now:D,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),q=O.crossFadingFactor();q===1&&q===this._crossFadingFactor||(T=!0,this._crossFadingFactor=q),this.style.update(O)}const E=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cw.mark(h.cx.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,h.cw.mark(h.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Jt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Te.remove(this._canvasContainer),Te.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cw.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ne.frame(this._frameRequest,(m=>{h.cw.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!h.cy(e)&&!(function(r){return r.message===Gr})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return xl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},z.MapMouseEvent=Hn,z.MapTouchEvent=Ss,z.MapWheelEvent=Ms,z.Marker=va,z.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);e.title=l,e.setAttribute("aria-label",l)},this.options=h.e({},Va,m),this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),Te.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),Te.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=Te.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const r=Te.create("button",m,this._container);return r.type="button",r.addEventListener("click",e),r}},z.Popup=class extends h.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Te.remove(this._content),this._container&&(Te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Te.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Te.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=uo(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const d=ts(this.options.offset);if(!l){const y=this._container.offsetWidth,w=this._container.offsetHeight;let T;T=r.y+d.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<y/2?T.push("left"):r.x>this._map.transform.width-y/2&&T.push("right"),l=T.length===0?"bottom":T.join("-")}let g=r.add(d[l]);this.options.subpixelPositioning||(g=g.round()),Te.setTransform(this._container,`${Fi[l]} translate(${g.x}px,${g.y}px)`),Ti(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(bl),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=h.S.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=m;l=r.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Te.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=Te.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ho);m&&m.focus()}},z.RasterDEMTileSource=wo,z.RasterTileSource=ar,z.ScaleControl=class{constructor(m){this._onMove=()=>{mi(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,mi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Nt),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},z.ScrollZoomHandler=Hu,z.Style=Au,z.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Te.create("button","maplibregl-ctrl-terrain",this._container),Te.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},z.TwoFingersTouchPitchHandler=Es,z.TwoFingersTouchRotateHandler=fc,z.TwoFingersTouchZoomHandler=$c,z.TwoFingersTouchZoomRotateHandler=Kc,z.VectorTileSource=Xa,z.VideoSource=Us,z.addSourceType=(m,e)=>h._(void 0,void 0,void 0,(function*(){if(Ns(m))throw new Error(`A source type called "${m}" already exists.`);((r,l)=>{js[r]=l})(m,e)})),z.clearPrewarmedResources=function(){const m=rt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(oi),rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},z.createTileMesh=rl,z.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},z.getRTLTextPluginStatus=function(){return hs().getRTLTextPluginStatus()},z.getVersion=function(){return wl},z.getWorkerCount=function(){return fe.workerCount},z.getWorkerUrl=function(){return h.a.WORKER_URL},z.importScriptInWorkers=function(m){return Qt().broadcast("IS",m)},z.prewarm=function(){Et().acquire(oi)},z.setMaxParallelImageRequests=function(m){h.a.MAX_PARALLEL_IMAGE_REQUESTS=m},z.setRTLTextPlugin=function(m,e){return hs().setRTLTextPlugin(m,e)},z.setWorkerCount=function(m){fe.workerCount=m},z.setWorkerUrl=function(m){h.a.WORKER_URL=m}}));var oe=V;return oe}))})(Rp)),Rp.exports}var jm=Qg();const Lp=og(jm),Jg=sg({__proto__:null,default:Lp},[jm]);var Fs=Uint8Array,Id=Uint16Array,e_=Int32Array,Nm=new Fs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vm=new Fs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),t_=new Fs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zm=function(B,N){for(var V=new Id(31),U=0;U<31;++U)V[U]=N+=1<<B[U-1];for(var J=new e_(V[30]),U=1;U<30;++U)for(var oe=V[U];oe<V[U+1];++oe)J[oe]=oe-V[U]<<5|U;return{b:V,r:J}},Gm=Zm(Nm,2),qm=Gm.b,i_=Gm.r;qm[28]=258,i_[258]=28;var n_=Zm(Vm,0),a_=n_.b,sm=new Id(32768);for(var zn=0;zn<32768;++zn){var bu=(zn&43690)>>1|(zn&21845)<<1;bu=(bu&52428)>>2|(bu&13107)<<2,bu=(bu&61680)>>4|(bu&3855)<<4,sm[zn]=((bu&65280)>>8|(bu&255)<<8)>>1}var Vf=(function(B,N,V){for(var U=B.length,J=0,oe=new Id(N);J<U;++J)B[J]&&++oe[B[J]-1];var z=new Id(N);for(J=1;J<N;++J)z[J]=z[J-1]+oe[J-1]<<1;var h;if(V){h=new Id(1<<N);var pe=15-N;for(J=0;J<U;++J)if(B[J])for(var _e=J<<4|B[J],We=N-B[J],ke=z[B[J]-1]++<<We,Ne=ke|(1<<We)-1;ke<=Ne;++ke)h[sm[ke]>>pe]=_e}else for(h=new Id(U),J=0;J<U;++J)B[J]&&(h[J]=sm[z[B[J]-1]++]>>15-B[J]);return h}),Gf=new Fs(288);for(var zn=0;zn<144;++zn)Gf[zn]=8;for(var zn=144;zn<256;++zn)Gf[zn]=9;for(var zn=256;zn<280;++zn)Gf[zn]=7;for(var zn=280;zn<288;++zn)Gf[zn]=8;var Hm=new Fs(32);for(var zn=0;zn<32;++zn)Hm[zn]=5;var r_=Vf(Gf,9,1),s_=Vf(Hm,5,1),am=function(B){for(var N=B[0],V=1;V<B.length;++V)B[V]>N&&(N=B[V]);return N},tl=function(B,N,V){var U=N/8|0;return(B[U]|B[U+1]<<8)>>(N&7)&V},rm=function(B,N){var V=N/8|0;return(B[V]|B[V+1]<<8|B[V+2]<<16)>>(N&7)},o_=function(B){return(B+7)/8|0},l_=function(B,N,V){return(V==null||V>B.length)&&(V=B.length),new Fs(B.subarray(N,V))},c_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Os=function(B,N,V){var U=new Error(N||c_[B]);if(U.code=B,Error.captureStackTrace&&Error.captureStackTrace(U,Os),!V)throw U;return U},cm=function(B,N,V,U){var J=B.length,oe=0;if(!J||N.f&&!N.l)return V||new Fs(0);var z=!V,h=z||N.i!=2,pe=N.i;z&&(V=new Fs(J*3));var _e=function(nr){var Qn=V.length;if(nr>Qn){var qi=new Fs(Math.max(Qn*2,nr));qi.set(V),V=qi}},We=N.f||0,ke=N.p||0,Ne=N.b||0,Te=N.l,ti=N.d,kt=N.m,Zi=N.n,Ii=J*8;do{if(!Te){We=tl(B,ke,1);var di=tl(B,ke+1,3);if(ke+=3,di)if(di==1)Te=r_,ti=s_,kt=9,Zi=5;else if(di==2){var ei=tl(B,ke,31)+257,Dt=tl(B,ke+10,15)+4,Pn=ei+tl(B,ke+5,31)+1;ke+=14;for(var Dn=new Fs(Pn),In=new Fs(19),xi=0;xi<Dt;++xi)In[t_[xi]]=tl(B,ke+xi*3,7);ke+=Dt*3;for(var Gi=am(In),da=(1<<Gi)-1,wa=Vf(In,Gi,1),xi=0;xi<Pn;){var Rn=wa[tl(B,ke,da)];ke+=Rn&15;var Mt=Rn>>4;if(Mt<16)Dn[xi++]=Mt;else{var Fe=0,st=0;for(Mt==16?(st=3+tl(B,ke,3),ke+=2,Fe=Dn[xi-1]):Mt==17?(st=3+tl(B,ke,7),ke+=3):Mt==18&&(st=11+tl(B,ke,127),ke+=7);st--;)Dn[xi++]=Fe}}var Ct=Dn.subarray(0,ei),_t=Dn.subarray(ei);kt=am(Ct),Zi=am(_t),Te=Vf(Ct,kt,1),ti=Vf(_t,Zi,1)}else Os(1);else{var Mt=o_(ke)+4,Jt=B[Mt-4]|B[Mt-3]<<8,vi=Mt+Jt;if(vi>J){pe&&Os(0);break}h&&_e(Ne+Jt),V.set(B.subarray(Mt,vi),Ne),N.b=Ne+=Jt,N.p=ke=vi*8,N.f=We;continue}if(ke>Ii){pe&&Os(0);break}}h&&_e(Ne+131072);for(var oi=(1<<kt)-1,fe=(1<<Zi)-1,Ge=ke;;Ge=ke){var Fe=Te[rm(B,ke)&oi],rt=Fe>>4;if(ke+=Fe&15,ke>Ii){pe&&Os(0);break}if(Fe||Os(2),rt<256)V[Ne++]=rt;else if(rt==256){Ge=ke,Te=null;break}else{var ut=rt-254;if(rt>264){var xi=rt-257,Et=Nm[xi];ut=tl(B,ke,(1<<Et)-1)+qm[xi],ke+=Et}var At=ti[rm(B,ke)&fe],Qt=At>>4;At||Os(3),ke+=At&15;var _t=a_[Qt];if(Qt>3){var Et=Vm[Qt];_t+=rm(B,ke)&(1<<Et)-1,ke+=Et}if(ke>Ii){pe&&Os(0);break}h&&_e(Ne+131072);var Ci=Ne+ut;if(Ne<_t){var ui=oe-_t,ir=Math.min(_t,Ci);for(ui+Ne<0&&Os(3);Ne<ir;++Ne)V[Ne]=U[ui+Ne]}for(;Ne<Ci;++Ne)V[Ne]=V[Ne-_t]}}N.l=Te,N.p=Ge,N.b=Ne,N.f=We,Te&&(We=1,N.m=kt,N.d=ti,N.n=Zi)}while(!We);return Ne!=V.length&&z?l_(V,0,Ne):V.subarray(0,Ne)},u_=new Fs(0),h_=function(B){(B[0]!=31||B[1]!=139||B[2]!=8)&&Os(6,"invalid gzip data");var N=B[3],V=10;N&4&&(V+=(B[10]|B[11]<<8)+2);for(var U=(N>>3&1)+(N>>4&1);U>0;U-=!B[V++]);return V+(N&2)},d_=function(B){var N=B.length;return(B[N-4]|B[N-3]<<8|B[N-2]<<16|B[N-1]<<24)>>>0},f_=function(B,N){return((B[0]&15)!=8||B[0]>>4>7||(B[0]<<8|B[1])%31)&&Os(6,"invalid zlib data"),(B[1]>>5&1)==1&&Os(6,"invalid zlib data: "+(B[1]&32?"need":"unexpected")+" dictionary"),(B[1]>>3&4)+2};function p_(B,N){return cm(B,{i:2},N,N)}function m_(B,N){var V=h_(B);return V+8>B.length&&Os(6,"invalid gzip data"),cm(B.subarray(V,-8),{i:2},new Fs(d_(B)),N)}function g_(B,N){return cm(B.subarray(f_(B),-4),{i:2},N,N)}function __(B,N){return B[0]==31&&B[1]==139&&B[2]==8?m_(B,N):(B[0]&15)!=8||B[0]>>4>7||(B[0]<<8|B[1])%31?p_(B,N):g_(B,N)}var y_=typeof TextDecoder<"u"&&new TextDecoder,v_=0;try{y_.decode(u_,{stream:!0}),v_=1}catch{}var x_=Object.defineProperty,Zf=Math.pow,rn=(B,N)=>x_(B,"name",{value:N,configurable:!0}),$a=(B,N,V)=>new Promise((U,J)=>{var oe=pe=>{try{h(V.next(pe))}catch(_e){J(_e)}},z=pe=>{try{h(V.throw(pe))}catch(_e){J(_e)}},h=pe=>pe.done?U(pe.value):Promise.resolve(pe.value).then(oe,z);h((V=V.apply(B,N)).next())});rn((B,N)=>{let V=!1,U="",J=L.GridLayer.extend({createTile:rn((oe,z)=>{let h=document.createElement("img"),pe=new AbortController,_e=pe.signal;return h.cancel=()=>{pe.abort()},V||(B.getHeader().then(We=>{We.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):We.tileType===2?U="image/png":We.tileType===3?U="image/jpeg":We.tileType===4?U="image/webp":We.tileType===5&&(U="image/avif")}),V=!0),B.getZxy(oe.z,oe.x,oe.y,_e).then(We=>{if(We){let ke=new Blob([We.data],{type:U}),Ne=window.URL.createObjectURL(ke);h.src=Ne,h.cancel=void 0,z(void 0,h)}}).catch(We=>{if(We.name!=="AbortError")throw We}),h},"createTile"),_removeTile:rn(function(oe){let z=this._tiles[oe];z&&(z.el.cancel&&z.el.cancel(),z.el.width=0,z.el.height=0,z.el.deleted=!0,L.DomUtil.remove(z.el),delete this._tiles[oe],this.fire("tileunload",{tile:z.el,coords:this._keyToTileCoords(oe)}))},"_removeTile")});return new J(N)},"leafletRasterLayer");var b_=rn(B=>(N,V)=>{if(V instanceof AbortController)return B(N,V);let U=new AbortController;return B(N,U).then(J=>V(void 0,J.data,J.cacheControl||"",J.expires||""),J=>V(J)).catch(J=>V(J)),{cancel:rn(()=>U.abort(),"cancel")}},"v3compat"),$m=class{constructor(N){this.tilev4=rn((V,U)=>$a(this,null,function*(){if(V.type==="json"){let Te=V.url.substr(10),ti=this.tiles.get(Te);if(ti||(ti=new km(Te),this.tiles.set(Te,ti)),this.metadata)return{data:yield ti.getTileJson(V.url)};let kt=yield ti.getHeader();return(kt.minLon>=kt.maxLon||kt.minLat>=kt.maxLat)&&console.error(`Bounds of PMTiles archive ${kt.minLon},${kt.minLat},${kt.maxLon},${kt.maxLat} are not valid.`),{data:{tiles:[`${V.url}/{z}/{x}/{y}`],minzoom:kt.minZoom,maxzoom:kt.maxZoom,bounds:[kt.minLon,kt.minLat,kt.maxLon,kt.maxLat]}}}let J=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),oe=V.url.match(J);if(!oe)throw new Error("Invalid PMTiles protocol URL");let z=oe[1],h=this.tiles.get(z);h||(h=new km(z),this.tiles.set(z,h));let pe=oe[2],_e=oe[3],We=oe[4],ke=yield h.getHeader(),Ne=yield h==null?void 0:h.getZxy(+pe,+_e,+We,U.signal);if(Ne)return{data:new Uint8Array(Ne.data),cacheControl:Ne.cacheControl,expires:Ne.expires};if(ke.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=b_(this.tilev4),this.tiles=new Map,this.metadata=(N==null?void 0:N.metadata)||!1,this.errorOnMissingTile=(N==null?void 0:N.errorOnMissingTile)||!1}add(N){this.tiles.set(N.source.getKey(),N)}get(N){return this.tiles.get(N)}};rn($m,"Protocol");var w_=$m;function Xm(B,N){return(N>>>0)*4294967296+(B>>>0)}rn(Xm,"toNum");function Ym(B,N){let V=N.buf,U=V[N.pos++],J=(U&112)>>4;if(U<128||(U=V[N.pos++],J|=(U&127)<<3,U<128)||(U=V[N.pos++],J|=(U&127)<<10,U<128)||(U=V[N.pos++],J|=(U&127)<<17,U<128)||(U=V[N.pos++],J|=(U&127)<<24,U<128)||(U=V[N.pos++],J|=(U&1)<<31,U<128))return Xm(B,J);throw new Error("Expected varint not more than 10 bytes")}rn(Ym,"readVarintRemainder");function Dd(B){let N=B.buf,V=N[B.pos++],U=V&127;return V<128||(V=N[B.pos++],U|=(V&127)<<7,V<128)||(V=N[B.pos++],U|=(V&127)<<14,V<128)||(V=N[B.pos++],U|=(V&127)<<21,V<128)?U:(V=N[B.pos],U|=(V&15)<<28,Ym(U,B))}rn(Dd,"readVarint");function um(B,N,V,U){if(U===0){V===1&&(N[0]=B-1-N[0],N[1]=B-1-N[1]);let J=N[0];N[0]=N[1],N[1]=J}}rn(um,"rotate");function Km(B,N){let V=Zf(2,B),U=N,J=N,oe=N,z=[0,0],h=1;for(;h<V;)U=1&oe/2,J=1&(oe^U),um(h,z,U,J),z[0]+=h*U,z[1]+=h*J,oe=oe/4,h*=2;return[B,z[0],z[1]]}rn(Km,"idOnLevel");var T_=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Wm(B,N,V){if(B>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(N>Zf(2,B)-1||V>Zf(2,B)-1)throw new Error("tile x/y outside zoom level bounds");let U=T_[B],J=Zf(2,B),oe=0,z=0,h=0,pe=[N,V],_e=J/2;for(;_e>0;)oe=(pe[0]&_e)>0?1:0,z=(pe[1]&_e)>0?1:0,h+=_e*_e*(3*oe^z),um(_e,pe,oe,z),_e=_e/2;return U+h}rn(Wm,"zxyToTileId");function S_(B){let N=0;for(let V=0;V<27;V++){let U=(1<<V)*(1<<V);if(N+U>B)return Km(V,B-N);N+=U}throw new Error("Tile zoom level exceeds max safe number limit (26)")}rn(S_,"tileIdToZxy");var M_=(B=>(B[B.Unknown=0]="Unknown",B[B.None=1]="None",B[B.Gzip=2]="Gzip",B[B.Brotli=3]="Brotli",B[B.Zstd=4]="Zstd",B))(M_||{});function Bp(B,N){return $a(this,null,function*(){if(N===1||N===0)return B;if(N===2){if(typeof globalThis.DecompressionStream>"u")return __(new Uint8Array(B));let V=new Response(B).body;if(!V)throw new Error("Failed to read response stream");let U=V.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(U).arrayBuffer()}throw new Error("Compression method not supported")})}rn(Bp,"defaultDecompress");var C_=(B=>(B[B.Unknown=0]="Unknown",B[B.Mvt=1]="Mvt",B[B.Png=2]="Png",B[B.Jpeg=3]="Jpeg",B[B.Webp=4]="Webp",B[B.Avif=5]="Avif",B))(C_||{});function Qm(B){return B===1?".mvt":B===2?".png":B===3?".jpg":B===4?".webp":B===5?".avif":""}rn(Qm,"tileTypeExt");var E_=127;function Jm(B,N){let V=0,U=B.length-1;for(;V<=U;){let J=U+V>>1,oe=N-B[J].tileId;if(oe>0)V=J+1;else if(oe<0)U=J-1;else return B[J]}return U>=0&&(B[U].runLength===0||N-B[U].tileId<B[U].runLength)?B[U]:null}rn(Jm,"findTile");var A_=class{constructor(N){this.file=N}getKey(){return this.file.name}getBytes(N,V){return $a(this,null,function*(){return{data:yield this.file.slice(N,N+V).arrayBuffer()}})}};rn(A_,"FileSource");var eg=class{constructor(N,V=new Headers){this.url=N,this.customHeaders=V,this.mustReload=!1;let U="";"navigator"in globalThis&&(U=globalThis.navigator.userAgent||"");let J=U.indexOf("Windows")>-1,oe=/Chrome|Chromium|Edg|OPR|Brave/.test(U);this.chromeWindowsNoCache=!1,J&&oe&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(N){this.customHeaders=N}getBytes(N,V,U,J){return $a(this,null,function*(){let oe,z;U?z=U:(oe=new AbortController,z=oe.signal);let h=new Headers(this.customHeaders);h.set("range",`bytes=${N}-${N+V-1}`);let pe;this.mustReload?pe="reload":this.chromeWindowsNoCache&&(pe="no-store");let _e=yield fetch(this.url,{signal:z,cache:pe,headers:h});if(N===0&&_e.status===416){let Ne=_e.headers.get("Content-Range");if(!Ne||!Ne.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let Te=+Ne.substr(8);_e=yield fetch(this.url,{signal:z,cache:"reload",headers:{range:`bytes=0-${Te-1}`}})}let We=_e.headers.get("Etag");if(We!=null&&We.startsWith("W/")&&(We=null),_e.status===416||J&&We&&We!==J)throw this.mustReload=!0,new om(`Server returned non-matching ETag ${J} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(_e.status>=300)throw new Error(`Bad response code: ${_e.status}`);let ke=_e.headers.get("Content-Length");if(_e.status===200&&(!ke||+ke>V))throw oe&&oe.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield _e.arrayBuffer(),etag:We||void 0,cacheControl:_e.headers.get("Cache-Control")||void 0,expires:_e.headers.get("Expires")||void 0}})}};rn(eg,"FetchSource");var z_=eg;function bo(B,N){let V=B.getUint32(N+4,!0),U=B.getUint32(N+0,!0);return V*Zf(2,32)+U}rn(bo,"getUint64");function tg(B,N){let V=new DataView(B),U=V.getUint8(7);if(U>3)throw new Error(`Archive is spec version ${U} but this library supports up to spec version 3`);return{specVersion:U,rootDirectoryOffset:bo(V,8),rootDirectoryLength:bo(V,16),jsonMetadataOffset:bo(V,24),jsonMetadataLength:bo(V,32),leafDirectoryOffset:bo(V,40),leafDirectoryLength:bo(V,48),tileDataOffset:bo(V,56),tileDataLength:bo(V,64),numAddressedTiles:bo(V,72),numTileEntries:bo(V,80),numTileContents:bo(V,88),clustered:V.getUint8(96)===1,internalCompression:V.getUint8(97),tileCompression:V.getUint8(98),tileType:V.getUint8(99),minZoom:V.getUint8(100),maxZoom:V.getUint8(101),minLon:V.getInt32(102,!0)/1e7,minLat:V.getInt32(106,!0)/1e7,maxLon:V.getInt32(110,!0)/1e7,maxLat:V.getInt32(114,!0)/1e7,centerZoom:V.getUint8(118),centerLon:V.getInt32(119,!0)/1e7,centerLat:V.getInt32(123,!0)/1e7,etag:N}}rn(tg,"bytesToHeader");function hm(B){let N={buf:new Uint8Array(B),pos:0},V=Dd(N),U=[],J=0;for(let oe=0;oe<V;oe++){let z=Dd(N);U.push({tileId:J+z,offset:0,length:0,runLength:1}),J+=z}for(let oe=0;oe<V;oe++)U[oe].runLength=Dd(N);for(let oe=0;oe<V;oe++)U[oe].length=Dd(N);for(let oe=0;oe<V;oe++){let z=Dd(N);z===0&&oe>0?U[oe].offset=U[oe-1].offset+U[oe-1].length:U[oe].offset=z-1}return U}rn(hm,"deserializeIndex");var ig=class extends Error{};rn(ig,"EtagMismatch");var om=ig;function dm(B,N){return $a(this,null,function*(){let V=yield B.getBytes(0,16384);if(new DataView(V.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let U=V.data.slice(0,E_),J=tg(U,V.etag),oe=V.data.slice(J.rootDirectoryOffset,J.rootDirectoryOffset+J.rootDirectoryLength),z=`${B.getKey()}|${J.etag||""}|${J.rootDirectoryOffset}|${J.rootDirectoryLength}`,h=hm(yield N(oe,J.internalCompression));return[J,[z,h.length,h]]})}rn(dm,"getHeaderAndRoot");function fm(B,N,V,U,J){return $a(this,null,function*(){let oe=yield B.getBytes(V,U,void 0,J.etag),z=yield N(oe.data,J.internalCompression),h=hm(z);if(h.length===0)throw new Error("Empty directory is invalid");return h})}rn(fm,"getDirectory");var P_=class{constructor(N=100,V=!0,U=Bp){this.cache=new Map,this.maxCacheEntries=N,this.counter=1,this.decompress=U}getHeader(N){return $a(this,null,function*(){let V=N.getKey(),U=this.cache.get(V);if(U)return U.lastUsed=this.counter++,U.data;let J=yield dm(N,this.decompress);return J[1]&&this.cache.set(J[1][0],{lastUsed:this.counter++,data:J[1][2]}),this.cache.set(V,{lastUsed:this.counter++,data:J[0]}),this.prune(),J[0]})}getDirectory(N,V,U,J){return $a(this,null,function*(){let oe=`${N.getKey()}|${J.etag||""}|${V}|${U}`,z=this.cache.get(oe);if(z)return z.lastUsed=this.counter++,z.data;let h=yield fm(N,this.decompress,V,U,J);return this.cache.set(oe,{lastUsed:this.counter++,data:h}),this.prune(),h})}prune(){if(this.cache.size>this.maxCacheEntries){let N=1/0,V;this.cache.forEach((U,J)=>{U.lastUsed<N&&(N=U.lastUsed,V=J)}),V&&this.cache.delete(V)}}invalidate(N){return $a(this,null,function*(){this.cache.delete(N.getKey())})}};rn(P_,"ResolvedValueCache");var ng=class{constructor(N=100,V=!0,U=Bp){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=N,this.counter=1,this.decompress=U}getHeader(N){return $a(this,null,function*(){let V=N.getKey(),U=this.cache.get(V);if(U)return U.lastUsed=this.counter++,yield U.data;let J=new Promise((oe,z)=>{dm(N,this.decompress).then(h=>{h[1]&&this.cache.set(h[1][0],{lastUsed:this.counter++,data:Promise.resolve(h[1][2])}),oe(h[0]),this.prune()}).catch(h=>{z(h)})});return this.cache.set(V,{lastUsed:this.counter++,data:J}),J})}getDirectory(N,V,U,J){return $a(this,null,function*(){let oe=`${N.getKey()}|${J.etag||""}|${V}|${U}`,z=this.cache.get(oe);if(z)return z.lastUsed=this.counter++,yield z.data;let h=new Promise((pe,_e)=>{fm(N,this.decompress,V,U,J).then(We=>{pe(We),this.prune()}).catch(We=>{_e(We)})});return this.cache.set(oe,{lastUsed:this.counter++,data:h}),h})}prune(){if(this.cache.size>=this.maxCacheEntries){let N=1/0,V;this.cache.forEach((U,J)=>{U.lastUsed<N&&(N=U.lastUsed,V=J)}),V&&this.cache.delete(V)}}invalidate(N){return $a(this,null,function*(){let V=N.getKey();if(this.invalidations.get(V))return yield this.invalidations.get(V);this.cache.delete(N.getKey());let U=new Promise((J,oe)=>{this.getHeader(N).then(z=>{J(),this.invalidations.delete(V)}).catch(z=>{oe(z)})});this.invalidations.set(V,U)})}};rn(ng,"SharedPromiseCache");var D_=ng,ag=class{constructor(N,V,U){typeof N=="string"?this.source=new z_(N):this.source=N,U?this.decompress=U:this.decompress=Bp,V?this.cache=V:this.cache=new D_}getHeader(){return $a(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(N,V,U,J){return $a(this,null,function*(){let oe=Wm(N,V,U),z=yield this.cache.getHeader(this.source);if(N<z.minZoom||N>z.maxZoom)return;let h=z.rootDirectoryOffset,pe=z.rootDirectoryLength;for(let _e=0;_e<=3;_e++){let We=yield this.cache.getDirectory(this.source,h,pe,z),ke=Jm(We,oe);if(ke){if(ke.runLength>0){let Ne=yield this.source.getBytes(z.tileDataOffset+ke.offset,ke.length,J,z.etag);return{data:yield this.decompress(Ne.data,z.tileCompression),cacheControl:Ne.cacheControl,expires:Ne.expires}}h=z.leafDirectoryOffset+ke.offset,pe=ke.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(N,V,U,J){return $a(this,null,function*(){try{return yield this.getZxyAttempt(N,V,U,J)}catch(oe){if(oe instanceof om)return this.cache.invalidate(this.source),yield this.getZxyAttempt(N,V,U,J);throw oe}})}getMetadataAttempt(){return $a(this,null,function*(){let N=yield this.cache.getHeader(this.source),V=yield this.source.getBytes(N.jsonMetadataOffset,N.jsonMetadataLength,void 0,N.etag),U=yield this.decompress(V.data,N.internalCompression),J=new TextDecoder("utf-8");return JSON.parse(J.decode(U))})}getMetadata(){return $a(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(N){if(N instanceof om)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw N}})}getTileJson(N){return $a(this,null,function*(){let V=yield this.getHeader(),U=yield this.getMetadata(),J=Qm(V.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${N}/{z}/{x}/{y}${J}`],vector_layers:U.vector_layers,attribution:U.attribution,description:U.description,name:U.name,version:U.version,bounds:[V.minLon,V.minLat,V.maxLon,V.maxLat],center:[V.centerLon,V.centerLat,V.centerZoom],minzoom:V.minZoom,maxzoom:V.maxZoom}})}};rn(ag,"PMTiles");var km=ag;function I_(){const[B,N]=yt.useState(null);yt.useEffect(()=>{const U=new w_;return Lp.addProtocol("pmtiles",U.tile),()=>{Lp.removeProtocol("pmtiles")}},[]);const V=U=>{var oe,z;const J=(oe=U.features)!=null&&oe.length?{year:(z=U.features)==null?void 0:z[0].properties.constructi,latitude:U.lngLat.lat,longitude:U.lngLat.lng}:null;N(J)};return zh.jsx("div",{className:Sm.mapContainer,children:zh.jsx(Rg,{initialViewState:{longitude:-73.95747,latitude:40.71825,zoom:10.5},interactiveLayerIds:["buildings"],mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",mapLib:Lp,onMouseMove:V,children:zh.jsxs(Hg,{id:"buildings",type:"vector",url:"pmtiles://https://storage.googleapis.com/ascend-map-cloud/nyc-buildings.pmtiles",children:[zh.jsx(Kg,{id:"buildings",type:"fill",source:"buildings","source-layer":"data",paint:{"fill-color":["interpolate-hcl",["exponential",1],["get","constructi"],1800,"#1D6996",1825,"#0F8554",1918,"#EDAD08",1933,"#E17C05",1960,"#6F4070",2001,"#994E95",2020,"#f00"],"fill-opacity":.5}}),B&&zh.jsx(kg,{longitude:B==null?void 0:B.longitude,latitude:B==null?void 0:B.latitude,anchor:"bottom",offset:10,closeButton:!1,className:Sm.mapPopup,children:B==null?void 0:B.year})]})})})}gg.createRoot(document.getElementById("root")).render(zh.jsx(yt.StrictMode,{children:zh.jsx(I_,{})}));
